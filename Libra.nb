(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[    435892,      10619]
NotebookOptionsPosition[    419948,      10155]
NotebookOutlinePosition[    420968,      10191]
CellTagsIndexPosition[    420895,      10186]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Libra package", "Title",
 CellChangeTimes->{{3.6175177940295467`*^9, 3.6175178003557425`*^9}, {
   3.718577609719571*^9, 3.718577611722925*^9}, {3.722555109426653*^9, 
   3.722555110429866*^9}, 3.722577045598638*^9}],

Cell["\<\
Libra is a package for manipulation with the differential systems
\[Copyright] Roman N. Lee 2017\
\>", "Text",
 CellChangeTimes->{{3.718577617070098*^9, 3.7185776298553953`*^9}, {
  3.718577686304055*^9, 3.7185777470438423`*^9}, {3.7225551027678347`*^9, 
  3.7225551135386047`*^9}}],

Cell[BoxData[
 RowBox[{"BeginPackage", "[", "\"\<Libra`\>\"", "]"}]], "Code",
 CellChangeTimes->{{3.718577782966878*^9, 3.7185777978508177`*^9}, {
  3.720137667121503*^9, 3.7201376752027187`*^9}, {3.722554966518113*^9, 
  3.722554967486833*^9}, {3.722555231349399*^9, 3.722555232925305*^9}, {
  3.722555340735598*^9, 3.722555341679596*^9}, {3.7225555707287903`*^9, 
  3.722555574336773*^9}, {3.722557816477088*^9, 3.722557817388624*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "Print", "[", 
   "\"\<Hello, I am Libra. Hopefully I can help you, with the reduction of \
the differential systems to \[Epsilon]-form.\>\"", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.718577847228801*^9, 3.718577848537767*^9}, {
   3.718578012752762*^9, 3.71857813208257*^9}, {3.718578181330419*^9, 
   3.718578182222333*^9}, 3.718578267288775*^9, 3.722554979382238*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "Print", "[", 
   "\"\<To start with, please, define the differential system.\\n    See \!\(\*
StyleBox[\"?\",
FontWeight->\"Bold\"]\)\!\(\*
StyleBox[\"NewDSystem\",
FontWeight->\"Bold\"]\) for details.\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.718577847228801*^9, 3.718577848537767*^9}, {
   3.718578012752762*^9, 3.71857813208257*^9}, {3.718578181330419*^9, 
   3.718578182222333*^9}, 3.718578267288775*^9, {3.71857831317295*^9, 
   3.71857840025073*^9}, 3.721354594605257*^9}],

Cell[BoxData[
 RowBox[{"NewDSystem", ";"}]], "Code",
 CellChangeTimes->{
  3.718578412013706*^9, {3.718579520178177*^9, 3.718579590608918*^9}, {
   3.719595985790648*^9, 3.719595986602619*^9}, {3.719596023669298*^9, 
   3.719596025030671*^9}, {3.71959642939603*^9, 3.71959644336932*^9}, {
   3.7195969814126787`*^9, 3.7195969989258327`*^9}, 3.7195973441125402`*^9, {
   3.719598446009367*^9, 3.71959845604491*^9}, 3.719625702227388*^9, {
   3.7213546492080936`*^9, 3.721354651103321*^9}, {3.721354906394627*^9, 
   3.721354928088849*^9}}],

Cell[BoxData[{
 RowBox[{"History", ";", "HistoryIndex", ";", "Undo", ";", "Redo", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"HistoryAppend", ";", "HistoryAddExtra", ";", "HistoryDeleteExtra", 
  ";", "HistoryConsolidate", ";"}], "\[IndentingNewLine]", 
 RowBox[{"HistoryBurn", ";"}]}], "Code",
 CellChangeTimes->{
  3.718578412013706*^9, {3.718579520178177*^9, 3.718579590608918*^9}, {
   3.719595985790648*^9, 3.719595986602619*^9}, {3.719596023669298*^9, 
   3.719596025030671*^9}, {3.71959642939603*^9, 3.71959644336932*^9}, {
   3.7195969814126787`*^9, 3.7195969989258327`*^9}, 3.7195973441125402`*^9, {
   3.719598446009367*^9, 3.71959845604491*^9}, 3.719625702227388*^9, 
   3.721381322936898*^9, {3.721381366366564*^9, 3.721381372610132*^9}, {
   3.721459193764492*^9, 3.721459195457589*^9}, {3.721459838218947*^9, 
   3.7214598390747347`*^9}}],

Cell[BoxData[
 RowBox[{"EntangledBlocksIndices", ";", "DependentRowIndices", ";", 
  "DependentColumnIndices", ";", "DiagonalBlocksIndices", ";"}]], "Code",
 CellChangeTimes->{{3.719627208605134*^9, 3.719627218107347*^9}, {
  3.721111984767797*^9, 3.7211119857993803`*^9}}],

Cell[BoxData[
 RowBox[{"DeleteDependentRows", ";"}]], "Code",
 CellChangeTimes->{{3.721436678741048*^9, 3.7214366800031*^9}}],

Cell[BoxData[
 RowBox[{"InvertBlockTriangular", ";"}]], "Code",
 CellChangeTimes->{{3.7201559866524343`*^9, 3.7201559914045267`*^9}, {
  3.720156055484242*^9, 3.720156070349401*^9}, {3.721256298325274*^9, 
  3.721256304461762*^9}}],

Cell[BoxData[
 RowBox[{"Transform", ";", "ChangeVar", ";"}]], "Code",
 CellChangeTimes->{
  3.719735816219767*^9, {3.720150078714465*^9, 3.7201500797305517`*^9}}],

Cell[BoxData[
 RowBox[{"TClosure", ";"}]], "Code",
 CellChangeTimes->{{3.719660007230115*^9, 3.719660021387529*^9}, 
   3.719736770676527*^9}],

Cell[BoxData[
 RowBox[{"Denominators", ";", "PolesPosition", ";", "PoleOrder", ";", 
  "PolesInfo", ";"}]], "Code",
 CellChangeTimes->{{3.7197367567811413`*^9, 3.7197367680445004`*^9}, 
   3.719737400432942*^9, 3.721260276889592*^9}],

Cell[BoxData[{
 RowBox[{"DiagonalQ", ";"}], "\[IndentingNewLine]", 
 RowBox[{"NilpotentQ", ";"}], "\[IndentingNewLine]", 
 RowBox[{"FuchsianQ", ";"}], "\[IndentingNewLine]", 
 RowBox[{"JFormQ", ";"}]}], "Code",
 CellChangeTimes->{{3.5946962031649194`*^9, 3.5946962033500443`*^9}, {
   3.5946964648589287`*^9, 3.594696476782811*^9}, {3.594697189537241*^9, 
   3.594697190571929*^9}, 3.594768409230133*^9, {3.5948156181441107`*^9, 
   3.59481568531152*^9}, 3.5958489045143733`*^9, 3.624119329112715*^9, 
   3.6248139109718237`*^9, {3.6248293280009055`*^9, 3.6248293425445395`*^9}, {
   3.625031012030669*^9, 3.625031062693838*^9}, {3.721110504020259*^9, 
   3.721110514234618*^9}},
 CellTags->"Queries"],

Cell[BoxData[
 RowBox[{"JDecomposition", ";", "JDecompositionData", ";"}]], "Code",
 CellChangeTimes->{{3.721114069229454*^9, 3.721114071837435*^9}}],

Cell[BoxData[
 RowBox[{"RatFuncQ", ";", "PolyQ", ";"}]], "Code",
 CellChangeTimes->{{3.721175553818005*^9, 3.721175559819407*^9}}],

Cell[BoxData[
 RowBox[{"Factors", ";", "FactorPlus", ";", "FactorListPlus", ";"}]], "Code",
 CellChangeTimes->{{3.721255878614786*^9, 3.721255886125231*^9}, {
  3.7212579673698378`*^9, 3.7212579706326847`*^9}}],

Cell[BoxData[
 RowBox[{"LeadingOrder", ";"}]], "Code",
 CellChangeTimes->{
  3.721260235011323*^9, {3.721262492876348*^9, 3.721262493992638*^9}, {
   3.721378583257607*^9, 3.721378587137632*^9}, 3.721386275919363*^9}],

Cell[BoxData[
 RowBox[{"SeriesCoefficients", ";", "LeadingSeries", ";", 
  "LeadingSeriesCoefficient", ";", "LeadingSeriesCoefficients", ";"}]], "Code",
 CellChangeTimes->{
  3.721260235011323*^9, {3.721262492876348*^9, 3.721262493992638*^9}, {
   3.721378583257607*^9, 3.721378587137632*^9}, {3.721386275919363*^9, 
   3.721386281328573*^9}}],

Cell[BoxData[
 RowBox[{"PoincareRank", ";"}]], "Code",
 CellChangeTimes->{
  3.721346790267362*^9, {3.721346925990546*^9, 3.721346929380039*^9}, 
   3.721982040658798*^9}],

Cell[BoxData[
 RowBox[{"DSystemQ", ";"}]], "Code",
 CellChangeTimes->{{3.721354244714307*^9, 3.721354251471333*^9}, 
   3.721354394585951*^9}],

Cell[BoxData[
 RowBox[{"System`PartitionByLengths", ";"}]], "Code",
 CellChangeTimes->{{3.7213642214598293`*^9, 3.721364222131728*^9}}],

Cell[BoxData[
 RowBox[{"Balance", ";", "VisBalancing", ";"}]], "Code",
 CellChangeTimes->{{3.721448644161029*^9, 3.721448649073791*^9}}],

Cell[BoxData[
 RowBox[{"A0ToSubspaces", ";", "A0A1ToSubspaces", ";", "Projector", 
  ";"}]], "Code",
 CellChangeTimes->{{3.7225551752109423`*^9, 3.722555220076285*^9}}],

Cell[BoxData[
 RowBox[{"FactorOut", ";", "FactorDependence", ";"}]], "Code",
 CellChangeTimes->{{3.721452086763105*^9, 3.7214520890475817`*^9}, {
  3.722559428531679*^9, 3.722559429962291*^9}}],

Cell[BoxData[
 RowBox[{"GaussSolve", ";"}]], "Code",
 CellChangeTimes->{{3.721953882841181*^9, 3.721953888217627*^9}}],

Cell[BoxData[
 RowBox[{"PolynomialModInverse", ";", "QuolynomialMod", ";"}]], "Code"],

Cell[BoxData[
 RowBox[{"DenominatorOrder", ";"}]], "Code",
 CellChangeTimes->{3.7219771255716553`*^9}],

Cell[BoxData[
 RowBox[{"BlockTriangularToFuchsian", ";"}]], "Code",
 CellChangeTimes->{3.721981157766115*^9}],

Cell[BoxData[
 RowBox[{"RadicalsUp", ";"}]], "Code",
 CellChangeTimes->{3.7221647443730373`*^9}],

Cell[BoxData[
 RowBox[{"HistoryCheck", ";", "HistoryChop", ";"}]], "Code",
 CellChangeTimes->{
  3.722653277296607*^9, 3.722653401533276*^9, {3.722653900880968*^9, 
   3.722653901766403*^9}}],

Cell[BoxData[{
 RowBox[{"II", ";", 
  RowBox[{"Protect", "[", "II", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"II", "::", "usage"}], "=", 
  "\"\<II[{\!\(\*SubscriptBox[\(a\), \(n\)]\),\!\(\*SubscriptBox[\(a\), \(n - \
1\)]\),\!\(\*SubscriptBox[\(\[Ellipsis]a\), \(1\)]\)},x] denotes iterated \
integral, \!\(TraditionalForm\`II[{\*SubscriptBox[\(a\), \(n\)], \
\*SubscriptBox[\(a\), \(n - 1\)], \*SubscriptBox[\(\[Ellipsis]a\), \(1\)]}, \
x] = \(\*UnderscriptBox[\(\[Integral]\[Ellipsis] \[Integral]\), \
\(\*SubscriptBox[\(x\), \(0\)] < \*SubscriptBox[\(x\), \(1\)] < \
\*SubscriptBox[\(\[Ellipsis]x\), \(n\)] < x\)] \*FractionBox[\(\
\[DifferentialD]\*SubscriptBox[\(x\), \(n\)]\), \(\*SubscriptBox[\(x\), \
\(n\)] - \*SubscriptBox[\(a\), \(n\)]\)] \(\[Ellipsis]\) \*FractionBox[\(\
\[DifferentialD]\*SubscriptBox[\(x\), \(1\)]\), \(\*SubscriptBox[\(x\), \
\(1\)] - \*SubscriptBox[\(a\), \(1\)]\)]\(\\\ \)\)\), where \
\!\(TraditionalForm\`\*SubscriptBox[\(x\), \(0\)]\) is arbitrary (with \
convention II[{},x]=1). II[{\!\(\*SubscriptBox[\(a\), \
\(n\)]\),\!\(\*SubscriptBox[\(a\), \(n - 1\)]\),\!\(\*SubscriptBox[\(\
\[Ellipsis]a\), \(1\)]\)},x,\!\(\*SubscriptBox[\(x\), \(0\)]\)] specifies \
\!\(\*SubscriptBox[\(x\), \(0\)]\). By definition, II[{\!\(\*SubscriptBox[\(x\
\), \(0\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(x\), \
\(0\)]\)},x,\!\(\*SubscriptBox[\(x\), \
\(0\)]\)]=Log[x-\!\(\*SubscriptBox[\(x\), \(0\)]\)\!\(\*SuperscriptBox[\(]\), \
\(n\)]\)/n!.\>\""}]}], "Code",
 CellChangeTimes->{{3.722927658397004*^9, 3.722927677137918*^9}, {
   3.72457159992666*^9, 3.724571601171032*^9}, 3.724634624473295*^9, {
   3.724643363289102*^9, 3.724643382464204*^9}, {3.724643422905127*^9, 
   3.7246436148438263`*^9}}],

Cell[BoxData[
 RowBox[{"SeriesSolutionData", ";", "ConstructSeriesSolution", ";", "Pexp", 
  ";"}]], "Code",
 CellChangeTimes->{{3.722927658397004*^9, 3.722927677137918*^9}, {
  3.72457159992666*^9, 3.724571601171032*^9}, {3.724634624473295*^9, 
  3.724634646049954*^9}, {3.724643365396096*^9, 3.7246433673607607`*^9}}],

Cell[CellGroupData[{

Cell["Private Section", "Section",
 CellChangeTimes->{{3.718578424129755*^9, 3.718578427906485*^9}}],

Cell[BoxData[
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]], "Code",
 CellChangeTimes->{{3.7185778213164663`*^9, 3.71857782938163*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"todolist", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"todo", "[", "s_String", "]"}], ":=", 
   RowBox[{"AppendTo", "[", 
    RowBox[{"todolist", ",", "s"}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.7211130068526487`*^9, 3.7211130158979883`*^9}, {
  3.7211131126562*^9, 3.7211131544581833`*^9}}],

Cell[CellGroupData[{

Cell["History", "Subsection",
 CellChangeTimes->{{3.719595957786281*^9, 3.719595982902207*^9}, 
   3.719596028807907*^9}],

Cell["\<\
History[ds] is the central object. It is a list with the elements of the \
following form:
{M,\[OpenCurlyDoubleQuote]Operation\[CloseCurlyDoubleQuote],extra1\[Rule]\
\[Ellipsis],\[Ellipsis]}\
\>", "Text",
 CellChangeTimes->{{3.719596032160843*^9, 3.719596150135215*^9}, {
  3.719596390046036*^9, 3.719596393780437*^9}, {3.719596458997857*^9, 
  3.719596460563396*^9}}],

Cell[CellGroupData[{

Cell["History, HistoryIndex", "Subsubsection",
 CellChangeTimes->{{3.71962498999254*^9, 3.719625011177001*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"History", "::", "usage"}], "=", 
   "\"\<History[ds] is the central object. It is a list with the elements of \
the following form:\n\
{M,\\\"Operation\\\",extra1\[Rule]\[Ellipsis],\[Ellipsis]}\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.719596467204249*^9, 3.719596490892064*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryIndex", "::", "usage"}], "=", 
   "\"\<HistoryIndex[ds] is the current position in the History[ds]\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7195965054224033`*^9, 3.719596553896739*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"History", "::", "first"}], "=", 
   "\"\<Undo can not be done. Already at the beginning.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.71959691579707*^9, 3.7195969507370987`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"History", "::", "last"}], "=", 
   "\"\<Redo can not be done. Already at the end.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.71959691579707*^9, 3.719596969102137*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"History", "::", "nothing"}], "=", 
   "\"\<History change not required.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719598676797695*^9, 3.719598755350388*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["HistoryAppend, HistoryAddExtra,HistoryDeleteExtra", "Subsubsection",
 CellChangeTimes->{{3.71962498999254*^9, 3.719625036395739*^9}, 
   3.7213813242010307`*^9, {3.721381387007059*^9, 3.721381387386506*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryAppend", "::", "usage"}], "=", 
   "\"\<HistoryAppend[ds,{M,{func,arg1,\[Ellipsis]},extra1\[Rule]\[Ellipsis],\
\[Ellipsis]}] adds the most recent entry to the history.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7195978529732943`*^9, 3.719597960908473*^9}, {
  3.71959809275099*^9, 3.7195980944839907`*^9}, {3.720137855672104*^9, 
  3.72013787666775*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "HistoryAppend", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"HistoryChop", "\[Rule]", "False"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.722653951613639*^9, 3.722653995670396*^9}, {
  3.72265437715664*^9, 3.722654380045867*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryAppend", "[", 
    RowBox[{
     RowBox[{"ds_Symbol", "?", "DSystemQ"}], ",", 
     RowBox[{"event", ":", 
      RowBox[{"{", 
       RowBox[{"_Association", ",", "_List", ",", "___"}], "}"}]}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"If", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TrueQ", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "HistoryChop", "]"}], "||", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"History", "[", "ds", "]"}], "]"}], "<=", 
        RowBox[{"HistoryIndex", "[", "ds", "]"}]}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "^=", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"History", "[", "ds", "]"}], ",", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}]}], "]"}], ",", "event"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], "+", "1"}]}], ";", 
      RowBox[{"Protect", "[", "ds", "]"}], ";", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{
         RowBox[{"\"\<History length for \>\"", "<>", 
          RowBox[{"SymbolName", "[", "ds", "]"}], "<>", "\"\< is \>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "<>", 
          "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"HistoryAppend", "::", "chop"}], ",", "ds"}], "]"}]}], "]"}]}],
   ";"}]], "Code",
 CellChangeTimes->{{3.719597974639216*^9, 3.719598096215912*^9}, {
   3.719599239286027*^9, 3.7195993024611073`*^9}, {3.7195997582763863`*^9, 
   3.719599763628571*^9}, {3.719619626377492*^9, 3.719619639849568*^9}, {
   3.71962487860917*^9, 3.719624922088863*^9}, {3.720137848299488*^9, 
   3.720137848939308*^9}, {3.7201421469631844`*^9, 3.720142190599379*^9}, 
   3.720142225107325*^9, {3.720150272576716*^9, 3.7201502824753237`*^9}, 
   3.721354400409285*^9, {3.7226543962382727`*^9, 3.72265453666673*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryAppend", "::", "chop"}], "=", 
  "\"\<Did not change history to avoid overwriting forward entries. Use \
HistoryChop[`1`] first.\>\""}]], "Code",
 CellChangeTimes->{{3.72265357343967*^9, 3.72265360323105*^9}, {
  3.722654192845683*^9, 3.7226542671016417`*^9}, {3.7226543609047413`*^9, 
  3.722654367156735*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryAddExtra", "::", "usage"}], "=", 
   "\"\<HistoryAddExtra[ds_Symbol,extra1\[Rule]\[Ellipsis],\[Ellipsis]] adds \
some optional information to the current history event.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719598140798427*^9, 3.7195981935482817`*^9}, {
  3.721381325361005*^9, 3.72138132629139*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryAddExtra", "[", 
   RowBox[{
    RowBox[{"ds_Symbol", "?", "DSystemQ"}], ",", "rules__Rule"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
    RowBox[{
     RowBox[{"History", "[", "ds", "]"}], "^=", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], ",", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], "\[Rule]", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"History", "[", "ds", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"Alternatives", "@@", 
              RowBox[{"First", "/@", 
               RowBox[{"{", "rules", "}"}]}]}], "\[Rule]", "_"}]}], "]"}], 
          ",", 
          RowBox[{"{", "rules", "}"}]}], "]"}]}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"Style", "[", 
      RowBox[{
       RowBox[{"\"\<Added extra(s) \>\"", "<>", 
        RowBox[{"StringRiffle", "[", 
         RowBox[{
          RowBox[{"ToString", "/@", 
           RowBox[{"First", "/@", 
            RowBox[{"{", "rules", "}"}]}]}], ",", "\"\<,\>\""}], "]"}], "<>", 
        "\"\< to current history entry.\>\""}], ",", "Small"}], "]"}], 
     "]"}]}], ")"}]}]], "Code",
 CellChangeTimes->{{3.719598107692502*^9, 3.719598125258328*^9}, {
   3.7195982039758997`*^9, 3.719598235488505*^9}, {3.71959833069168*^9, 
   3.719598430216449*^9}, {3.7196662767930737`*^9, 3.719666305759068*^9}, {
   3.719699706075268*^9, 3.719699731115158*^9}, 3.71969981596187*^9, 
   3.719699879148592*^9, {3.719730859966421*^9, 3.719730959957045*^9}, {
   3.719731016694643*^9, 3.7197310293843718`*^9}, {3.7197310708873653`*^9, 
   3.7197311040710087`*^9}, {3.720142176701212*^9, 3.720142218803358*^9}, 
   3.7213544019604893`*^9, 3.721381327049756*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryDeleteExtra", "::", "usage"}], "=", 
   "\"\<HistoryDeleteExtra[ds_Symbol,extra1,\[Ellipsis]] removes optional \
information from the current history event.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721381398296479*^9, 3.721381417435027*^9}, {
  3.721385636912373*^9, 3.721385645176796*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryDeleteExtra", "[", 
   RowBox[{
    RowBox[{"ds_Symbol", "?", "DSystemQ"}], ",", "extras___"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
    RowBox[{
     RowBox[{"History", "[", "ds", "]"}], "^=", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], ",", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], "\[Rule]", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"History", "[", "ds", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"Alternatives", "@@", "extras"}], "\[Rule]", "_"}]}], 
         "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"Print", "[", 
     RowBox[{"Style", "[", 
      RowBox[{
       RowBox[{"\"\<Added extra(s) \>\"", "<>", 
        RowBox[{"StringRiffle", "[", 
         RowBox[{
          RowBox[{"ToString", "/@", "extras"}], ",", "\"\<,\>\""}], "]"}], 
        "<>", "\"\< to current history entry.\>\""}], ",", "Small"}], "]"}], 
     "]"}]}], ")"}]}]], "Code",
 CellChangeTimes->{{3.7213814372205257`*^9, 3.721381486995615*^9}, 
   3.722664969572916*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Undo, Redo,HistoryChop", "Subsubsection",
 CellChangeTimes->{{3.71962498999254*^9, 3.719625022352832*^9}, {
  3.722653719565228*^9, 3.722653719760894*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Undo", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", 
     RowBox[{"n_Integer:", "1"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"HistoryIndex", "[", "ds", "]"}], ">", "n"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{
         RowBox[{"\"\<History length is \>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{
            RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
            RowBox[{
             RowBox[{"HistoryIndex", "[", "ds", "]"}], "-", "n"}]}], "]"}], 
          "<>", "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}]}],
      ",", 
     RowBox[{"Message", "[", 
      RowBox[{"History", "::", "first"}], "]"}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.719596607734528*^9, 3.7195966123448*^9}, {
   3.719596751136837*^9, 3.719596901625928*^9}, {3.719599833923675*^9, 
   3.719599942378243*^9}, 3.719600006847765*^9, {3.719600063164566*^9, 
   3.7196000897520857`*^9}, {3.7196566307837887`*^9, 
   3.7196566949714317`*^9}, {3.720150820146731*^9, 3.720150867302041*^9}, {
   3.7214573302328253`*^9, 3.7214573381271544`*^9}, 3.7214574692105103`*^9, {
   3.7214576304319363`*^9, 3.7214576329840593`*^9}, {3.721542703672428*^9, 
   3.721542705989113*^9}, {3.721542828511777*^9, 3.72154283128865*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Undo", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "All"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
    RowBox[{"Print", "[", 
     RowBox[{"Style", "[", 
      RowBox[{
       RowBox[{"\"\<History length is \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", "1"}], "]"}], "<>", 
        "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Protect", "[", "ds", "]"}], ";", 
    RowBox[{
     RowBox[{"History", "[", "ds", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}]}], 
   ")"}]}]], "Code",
 CellChangeTimes->{{3.7214573452306957`*^9, 3.7214573501273947`*^9}, {
   3.721457390879311*^9, 3.7214574316630993`*^9}, 3.7214576365312366`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Redo", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", 
     RowBox[{"n_Integer:", "1"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"HistoryIndex", "[", "ds", "]"}], "\[LessEqual]", 
      RowBox[{
       RowBox[{"Length", "@", 
        RowBox[{"History", "[", "ds", "]"}]}], "-", "n"}]}], ",", 
     RowBox[{
      RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{
         RowBox[{"\"\<History length is \>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{
            RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
            RowBox[{
             RowBox[{"HistoryIndex", "[", "ds", "]"}], "+", "n"}]}], "]"}], 
          "<>", "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}], ";", 
      RowBox[{"Protect", "[", "ds", "]"}], ";", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}]}],
      ",", 
     RowBox[{"Message", "[", 
      RowBox[{"History", "::", "last"}], "]"}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.719596607734528*^9, 3.7195966123448*^9}, {
   3.719596751136837*^9, 3.719596901625928*^9}, {3.719599833923675*^9, 
   3.719599942378243*^9}, 3.719600006847765*^9, {3.719600063164566*^9, 
   3.7196000897520857`*^9}, {3.7196566307837887`*^9, 
   3.7196566949714317`*^9}, {3.720150820146731*^9, 3.720150867302041*^9}, {
   3.7214573302328253`*^9, 3.7214573381271544`*^9}, {3.72145745758414*^9, 
   3.7214574649035387`*^9}, 3.721457638352008*^9, 3.7215428253607883`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Redo", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "All"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
     RowBox[{"Print", "[", 
      RowBox[{"Style", "[", 
       RowBox[{
        RowBox[{"\"\<History length is \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
           RowBox[{"Length", "@", 
            RowBox[{"History", "[", "ds", "]"}]}]}], "]"}], "<>", 
         "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}], ";", 
     RowBox[{"Protect", "[", "ds", "]"}], ";", 
     RowBox[{
      RowBox[{"History", "[", "ds", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}]}], 
    ")"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.7214573452306957`*^9, 3.7214573501273947`*^9}, {
   3.721457390879311*^9, 3.7214574316630993`*^9}, {3.72145747525998*^9, 
   3.7214575156983213`*^9}, 3.7214576399356318`*^9, {3.721542710614259*^9, 
   3.721542713935669*^9}, {3.721542792929023*^9, 3.7215428182320547`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryChop", "::", "usage"}], "=", 
   "\"\<HistoryChop[ds_] chops off forward entries in history. Use before \
applying HistoryConsolidate.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7226538151025257`*^9, 3.7226538933260307`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryChop", "[", 
   RowBox[{"ds_", "?", "DSystemQ"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
    RowBox[{
     RowBox[{"History", "[", "ds", "]"}], "^=", 
     RowBox[{"Take", "[", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], ",", 
       RowBox[{"HistoryIndex", "[", "ds", "]"}]}], "]"}]}], ";", 
    RowBox[{"Protect", "[", "ds", "]"}], ";", 
    RowBox[{"HistoryIndex", "[", "ds", "]"}]}], ")"}]}]], "Code",
 CellChangeTimes->{{3.722653687653651*^9, 3.722653796217017*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["HistoryConsolidate", "Subsubsection",
 CellChangeTimes->{{3.721456971187381*^9, 3.721456983629878*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryConsolidate", "::", "usage"}], "=", 
   "\"\<HistoryConsolidate[ds] consolidates history\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7214571852793694`*^9, 3.721457216030945*^9}, {
  3.72145752660787*^9, 3.721457532615746*^9}, {3.7214576031519957`*^9, 
  3.72145760811141*^9}, {3.723160339048361*^9, 3.723160339183856*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"HistoryConsolidate", "::", "err"}], "=", 
   "\"\<Undo history entry is met.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HistoryConsolidate", "::", "chop"}], "=", 
  "\"\<Did not change history to avoid overwriting forward entries. Use \
HistoryChop[`1`] first.\>\""}]}], "Code",
 CellChangeTimes->{{3.72265357343967*^9, 3.72265360323105*^9}, {
  3.722654192845683*^9, 3.7226542671016417`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "HistoryConsolidate", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"HistoryChop", "\[Rule]", "False"}], ",", 
     RowBox[{"HistoryAppend", "\[Rule]", "True"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.722653951613639*^9, 3.722653995670396*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryConsolidate", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "ds"}], "]"}]}], ",", "i", ",", "t", ",", 
      "start", ",", "end", ",", "val", ",", "old", ",", "new", ",", "subs"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"First", ",", " ", 
      RowBox[{"calculate", " ", 
       RowBox[{"transformation", ".", " ", "We"}], " ", "move", " ", "in", 
       " ", "history", " ", "up", " ", "to", " ", "the", " ", "first", " ", 
       RowBox[{"Undo", "[", 
        RowBox[{"ds", ",", "All"}], "]"}], " ", "or", " ", "first", " ", 
       "entry"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"starting", " ", 
      RowBox[{"index", ":", " ", 
       RowBox[{
       "either", " ", "1", " ", "or", " ", "index", " ", "of", " ", "first", 
        " ", "full", " ", "undo"}]}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"start", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"History", "[", "ds", "]"}], ",", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Undo", ",", "ds", ",", "_"}], "}"}], "|", 
            RowBox[{"{", 
             RowBox[{"NewDSystem", ",", "ds", ",", "__"}], "}"}]}], ",", 
           "___"}], "}"}], ",", 
         RowBox[{"{", "1", "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"val", "=", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"start", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"old", "=", 
      RowBox[{"new", "=", 
       RowBox[{"subs", "=", 
        RowBox[{"Keys", "[", "val", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"end", "=", 
      RowBox[{"HistoryIndex", "[", "ds", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Monitor", "[", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Replace", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"History", "[", "ds", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Transform", ",", "ds", ",", "tt_"}], "}"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{"T", "=", 
                RowBox[{"Factor", "[", 
                 RowBox[{"T", ".", "tt"}], "]"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "ChangeVar", ",", "ds", ",", "tt_", ",", "nw_", ",", "___"}], 
               "}"}], "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"T", "=", 
                 RowBox[{"Factor", "[", 
                  RowBox[{"T", "/.", "tt"}], "]"}]}], ";", 
                RowBox[{"subs", "=", 
                 RowBox[{"Factor", "[", 
                  RowBox[{"subs", "/.", "tt"}], "]"}]}], ";", 
                RowBox[{"new", "=", "nw"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Factor", ",", "ds"}], "}"}], "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{"T", "=", 
                RowBox[{"Factor", "[", "T", "]"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Simplify", ",", "ds", ",", "tt___"}], "}"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"T", "=", 
                 RowBox[{"Simplify", "[", 
                  RowBox[{"T", ",", "tt"}], "]"}]}], ";", 
                RowBox[{"subs", "=", 
                 RowBox[{"Simplify", "[", 
                  RowBox[{"subs", ",", "tt"}], "]"}]}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Map", ",", "f_", ",", "ds", ",", "tt___"}], "}"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{"T", "=", 
                RowBox[{"Map", "[", 
                 RowBox[{"f", ",", "T", ",", "tt"}], "]"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"MapAt", ",", "f_", ",", "ds", ",", "tt___"}], "}"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{"T", "=", 
                RowBox[{"MapAt", "[", 
                 RowBox[{"f", ",", "T", ",", "tt"}], "]"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Undo", ",", "__"}], "}"}], "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Message", "[", 
                 RowBox[{"HistoryConsolidate", "::", "err"}], "]"}], ";", 
                RowBox[{"Abort", "[", "]"}]}], ")"}]}]}], 
            "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"start", "+", "1"}], ",", "end"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ProgressIndicator", "[", 
        RowBox[{"i", ",", 
         RowBox[{"{", 
          RowBox[{"start", ",", "end"}], "}"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"TrueQ", "@", 
        RowBox[{"OptionValue", "[", "HistoryAppend", "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"TrueQ", "@", 
           RowBox[{"OptionValue", "[", "HistoryChop", "]"}]}], "||", 
          RowBox[{
           RowBox[{"Length", "@", 
            RowBox[{"History", "[", "ds", "]"}]}], "\[LessEqual]", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}]}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"HistoryAppend", "[", 
           RowBox[{"ds", ",", 
            RowBox[{"{", 
             RowBox[{"val", ",", 
              RowBox[{"{", 
               RowBox[{"Undo", ",", "ds", ",", 
                RowBox[{"end", "-", "start"}]}], "}"}]}], "}"}]}], "]"}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"ChangeVar", "[", 
           RowBox[{"ds", ",", 
            RowBox[{"Thread", "[", 
             RowBox[{"old", "\[Rule]", "subs"}], "]"}], ",", "new"}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Transform", "[", 
           RowBox[{"ds", ",", "T"}], "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"HistoryConsolidate", "::", "chop"}], ",", "ds"}], "]"}]}],
         "\[IndentingNewLine]", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "T"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.721368137908499*^9, 3.721368161678334*^9}, 
   3.721436409387233*^9, {3.721457616105809*^9, 3.721457682679695*^9}, {
   3.7214578707521057`*^9, 3.721458414338336*^9}, {3.721458445905623*^9, 
   3.721458447481927*^9}, {3.721458509394725*^9, 3.721458641987094*^9}, {
   3.721458682978167*^9, 3.721458800858676*^9}, {3.7214588368269167`*^9, 
   3.721458871354396*^9}, {3.7214589093789053`*^9, 3.7214590199714823`*^9}, {
   3.7214590657229433`*^9, 3.721459117863152*^9}, {3.721459148067765*^9, 
   3.721459171723463*^9}, 3.721459326676236*^9, {3.721482672765971*^9, 
   3.7214826732402067`*^9}, {3.7217256200087957`*^9, 3.721725630621688*^9}, {
   3.72172567385791*^9, 3.7217257121238403`*^9}, {3.722653479202548*^9, 
   3.722653566129753*^9}, {3.722653918488049*^9, 3.722653945400576*^9}, {
   3.722654013887039*^9, 3.7226541056926517`*^9}, {3.722654140455698*^9, 
   3.722654211552306*^9}, {3.722654274967917*^9, 3.722654276674596*^9}, {
   3.722654866527734*^9, 3.722655003968033*^9}, {3.722655119416403*^9, 
   3.7226551228081636`*^9}, 3.7226551652317743`*^9, {3.722655522034258*^9, 
   3.722655523380074*^9}, {3.7226556904265842`*^9, 3.722655698949789*^9}, {
   3.722655966363982*^9, 3.722655976460588*^9}, {3.722656042282106*^9, 
   3.722656093852879*^9}, {3.7226640790988894`*^9, 3.722664085586831*^9}, 
   3.722753615121805*^9, {3.7229278108063793`*^9, 3.722927881174464*^9}, {
   3.722928008350833*^9, 3.722928008543133*^9}, {3.723158815059164*^9, 
   3.72315890778859*^9}, {3.723159598481081*^9, 3.723159608337343*^9}, {
   3.723159682569602*^9, 3.723159733617086*^9}, {3.723160109363722*^9, 
   3.723160112427266*^9}, {3.723160144155411*^9, 3.723160146162744*^9}, {
   3.723160234187562*^9, 3.723160239439637*^9}, {3.7231605876156473`*^9, 
   3.7231606395816317`*^9}, {3.723160678588085*^9, 3.723160683859207*^9}, {
   3.723160734668433*^9, 3.723160734799479*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["HistoryRewrite", "Subsubsection",
 CellChangeTimes->{{3.721456971187381*^9, 3.721456983629878*^9}, {
  3.723160285750622*^9, 3.723160287255146*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryRewrite", "::", "usage"}], "=", 
   "\"\<HistoryRewrite[ds,{start,end}] rewrite history sequence with one \
transformation.\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.7214571852793694`*^9, 3.721457216030945*^9}, {
  3.72145752660787*^9, 3.721457532615746*^9}, {3.7214576031519957`*^9, 
  3.72145760811141*^9}, {3.723160290453574*^9, 3.72316033179249*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryRewrite", "::", "err"}], "=", 
   "\"\<Undo history entry is met.\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.72265357343967*^9, 3.72265360323105*^9}, {
  3.722654192845683*^9, 3.7226542671016417`*^9}, {3.7231603477611303`*^9, 
  3.723160351049202*^9}, {3.7231603840501633`*^9, 3.723160384570359*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryRewrite", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"start_Integer", ",", "end_Integer"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "ds"}], "]"}]}], ",", "i", ",", "t", ",", 
      "val", ",", "old", ",", "new", ",", "subs"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"First", ",", " ", 
      RowBox[{"calculate", " ", 
       RowBox[{"transformation", ".", " ", "We"}], " ", "move", " ", "in", 
       " ", "history", " ", "up", " ", "to", " ", "the", " ", "first", " ", 
       RowBox[{"Undo", "[", 
        RowBox[{"ds", ",", "All"}], "]"}], " ", "or", " ", "first", " ", 
       "entry"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"starting", " ", 
      RowBox[{"index", ":", " ", 
       RowBox[{
       "either", " ", "1", " ", "or", " ", "index", " ", "of", " ", "first", 
        " ", "full", " ", "undo"}]}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"val", "=", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"start", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"old", "=", 
      RowBox[{"new", "=", 
       RowBox[{"subs", "=", 
        RowBox[{"Keys", "[", "val", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Monitor", "[", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Replace", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"History", "[", "ds", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Transform", ",", "ds", ",", "tt_"}], "}"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{"T", "=", 
                RowBox[{"Factor", "[", 
                 RowBox[{"T", ".", "tt"}], "]"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
               "ChangeVar", ",", "ds", ",", "tt_", ",", "nw_", ",", "___"}], 
               "}"}], "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"T", "=", 
                 RowBox[{"Factor", "[", 
                  RowBox[{"T", "/.", "tt"}], "]"}]}], ";", 
                RowBox[{"subs", "=", 
                 RowBox[{"Factor", "[", 
                  RowBox[{"subs", "/.", "tt"}], "]"}]}], ";", 
                RowBox[{"new", "=", "nw"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Factor", ",", "ds"}], "}"}], "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{"T", "=", 
                RowBox[{"Factor", "[", "T", "]"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Simplify", ",", "ds", ",", "tt___"}], "}"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"T", "=", 
                 RowBox[{"Simplify", "[", 
                  RowBox[{"T", ",", "tt"}], "]"}]}], ";", 
                RowBox[{"subs", "=", 
                 RowBox[{"Simplify", "[", 
                  RowBox[{"subs", ",", "tt"}], "]"}]}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Map", ",", "f_", ",", "ds", ",", "tt___"}], "}"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{"T", "=", 
                RowBox[{"Map", "[", 
                 RowBox[{"f", ",", "T", ",", "tt"}], "]"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"MapAt", ",", "f_", ",", "ds", ",", "tt___"}], "}"}], 
              "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{"T", "=", 
                RowBox[{"MapAt", "[", 
                 RowBox[{"f", ",", "T", ",", "tt"}], "]"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Undo", ",", "__"}], "}"}], "\[RuleDelayed]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Message", "[", 
                 RowBox[{"HistoryConsolidate", "::", "err"}], "]"}], ";", 
                RowBox[{"Abort", "[", "]"}]}], ")"}]}]}], 
            "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"start", "+", "1"}], ",", "end"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ProgressIndicator", "[", 
        RowBox[{"i", ",", 
         RowBox[{"{", 
          RowBox[{"start", ",", "end"}], "}"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"TODO", ":", " ", 
       RowBox[{"modify", " ", 
        RowBox[{
         RowBox[{"history", "!!"}], "!"}]}]}], "*)"}], ";", 
     "\[IndentingNewLine]", "T"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.721368137908499*^9, 3.721368161678334*^9}, 
   3.721436409387233*^9, {3.721457616105809*^9, 3.721457682679695*^9}, {
   3.7214578707521057`*^9, 3.721458414338336*^9}, {3.721458445905623*^9, 
   3.721458447481927*^9}, {3.721458509394725*^9, 3.721458641987094*^9}, {
   3.721458682978167*^9, 3.721458800858676*^9}, {3.7214588368269167`*^9, 
   3.721458871354396*^9}, {3.7214589093789053`*^9, 3.7214590199714823`*^9}, {
   3.7214590657229433`*^9, 3.721459117863152*^9}, {3.721459148067765*^9, 
   3.721459171723463*^9}, 3.721459326676236*^9, {3.721482672765971*^9, 
   3.7214826732402067`*^9}, {3.7217256200087957`*^9, 3.721725630621688*^9}, {
   3.72172567385791*^9, 3.7217257121238403`*^9}, {3.722653479202548*^9, 
   3.722653566129753*^9}, {3.722653918488049*^9, 3.722653945400576*^9}, {
   3.722654013887039*^9, 3.7226541056926517`*^9}, {3.722654140455698*^9, 
   3.722654211552306*^9}, {3.722654274967917*^9, 3.722654276674596*^9}, {
   3.722654866527734*^9, 3.722655003968033*^9}, {3.722655119416403*^9, 
   3.7226551228081636`*^9}, 3.7226551652317743`*^9, {3.722655522034258*^9, 
   3.722655523380074*^9}, {3.7226556904265842`*^9, 3.722655698949789*^9}, {
   3.722655966363982*^9, 3.722655976460588*^9}, {3.722656042282106*^9, 
   3.722656093852879*^9}, {3.7226640790988894`*^9, 3.722664085586831*^9}, 
   3.722753615121805*^9, {3.7229278108063793`*^9, 3.722927881174464*^9}, {
   3.722928008350833*^9, 3.722928008543133*^9}, {3.723158815059164*^9, 
   3.72315890778859*^9}, {3.723159598481081*^9, 3.723159608337343*^9}, {
   3.723159682569602*^9, 3.723159733617086*^9}, {3.723160109363722*^9, 
   3.723160112427266*^9}, {3.723160144155411*^9, 3.723160146162744*^9}, {
   3.723160234187562*^9, 3.723160239439637*^9}, {3.7231603753743057`*^9, 
   3.723160462652729*^9}, {3.723160707495509*^9, 3.723160754861763*^9}, {
   3.723161011053042*^9, 3.7231610236537743`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"todo", "[", "\"\<implement HistoryRewrite\>\"", "]"}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.723161035744617*^9, 3.723161058288952*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["HistoryCheck", "Subsubsection",
 CellChangeTimes->{
  3.7226531526263227`*^9, {3.722653341327401*^9, 3.7226533421069*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryCheck", "::", "usage"}], "=", 
   "\"\<HistoryCheck[ds_] checks history consistency. It simply redoes all \
transformations and checks whether the same result is obtained.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7226531670464*^9, 3.7226532609539413`*^9}, {
  3.7226533462877197`*^9, 3.722653346992751*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"HistoryCheck", "::", "inconsistent"}], "=", 
   "\"\<History[`1`] is inconsistent at index `2`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HistoryCheck", "[", "des_", "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", ",", "i", ",", 
      RowBox[{"hi", "=", 
       RowBox[{"HistoryIndex", "[", "des", "]"}]}], ",", "mn", ",", 
      "action"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"mn", "=", 
           RowBox[{
            RowBox[{"History", "[", "des", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"action", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"History", "[", "des", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], "/.", 
            RowBox[{"des", "\[Rule]", "m"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", "##2", "]"}], "&"}], "@@", "action"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", "m", "]"}], ";", 
            RowBox[{"Print", "[", "mn", "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"TrueQ", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Union", "[", 
                  RowBox[{"Keys", "[", "mn", "]"}], "]"}], "===", 
                 RowBox[{"Union", "[", 
                  RowBox[{"Keys", "[", 
                   RowBox[{"m", "[", "]"}], "]"}], "]"}]}], "&&", 
                RowBox[{"(", 
                 RowBox[{"And", "@@", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"MatchQ", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{
                    RowBox[{"mn", "[", "#", "]"}], "-", 
                    RowBox[{"m", "[", "#", "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", "..."}], "}"}], "..."}], "}"}]}], "]"}], 
                    "&"}], "/@", 
                    RowBox[{"Keys", "[", "mn", "]"}]}], ")"}]}], ")"}]}], 
               ")"}]}]}], ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{
               RowBox[{"HistoryCheck", "::", "inconsistent"}], ",", "des", 
               ",", "i"}], "]"}], ";", 
             RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "hi"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Overlay", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "hi"}], "}"}]}], "]"}], ",", "i"}], "}"}], 
         ",", 
         RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "\"\<History is consistent!\>\"", "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.722645585868342*^9, 3.7226456814667664`*^9}, {
  3.722645733842559*^9, 3.722645957114786*^9}, {3.722646020859342*^9, 
  3.7226462943190737`*^9}, {3.722646518532654*^9, 3.722646525108231*^9}, {
  3.7226467478768578`*^9, 3.7226467602448187`*^9}, {3.72264701372639*^9, 
  3.7226471424442377`*^9}, {3.722647229928184*^9, 3.722647230248801*^9}, {
  3.7226533490769053`*^9, 3.7226533839707117`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["HistoryBurn", "Subsubsection",
 CellChangeTimes->{{3.721456971187381*^9, 3.721456983629878*^9}, {
  3.721457229470092*^9, 3.721457230966455*^9}, {3.7214594411533957`*^9, 
  3.7214594417214108`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryBurn", "::", "err"}], "=", "\"\<Can not burn!\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7214596755977497`*^9, 3.7214596841064177`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryBurn", "[", 
   RowBox[{"ds_", "?", "DSystemQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "ds"}], "]"}]}], ",", "i", ",", "t", ",", 
      "start", ",", "end", ",", "val"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"First", ",", " ", 
      RowBox[{"calculate", " ", 
       RowBox[{"transformation", ".", " ", "We"}], " ", "move", " ", "in", 
       " ", "history", " ", "up", " ", "to", " ", "the", " ", "first", " ", 
       RowBox[{"Undo", "[", 
        RowBox[{"ds", ",", "All"}], "]"}], " ", "or", " ", "first", " ", 
       "entry"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"starting", " ", 
      RowBox[{"index", ":", " ", 
       RowBox[{
       "either", " ", "1", " ", "or", " ", "index", " ", "of", " ", "first", 
        " ", "full", " ", "undo"}]}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"start", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Undo", ",", "ds", ",", "All"}], "}"}], "|", 
            RowBox[{"{", 
             RowBox[{"NewDSystem", ",", "ds", ",", "__"}], "}"}]}], ",", 
           "___"}], "}"}], ",", 
         RowBox[{"{", "1", "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"val", "=", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"start", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"end", "=", 
      RowBox[{"HistoryIndex", "[", "ds", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"val", "=!=", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"HistoryBurn", "::", "err"}], "]"}], ";", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Unprotect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"History", "[", "ds", "]"}], "^=", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"start", "+", "1"}], ";;", "end"}], "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
      RowBox[{"Length", "@", 
       RowBox[{"History", "[", "ds", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", "ds", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721456971187381*^9, 3.721456983629878*^9}, {
   3.721457229470092*^9, 3.721457230966455*^9}, {3.7214594411533957`*^9, 
   3.7214594593384647`*^9}, 3.721459529912527*^9, {3.7214596126923*^9, 
   3.7214598225806427`*^9}, {3.7214824765515633`*^9, 3.721482548253634*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["DE system", "Subsection",
 CellChangeTimes->{
  3.7185784431616087`*^9, {3.719660172691893*^9, 3.719660174033565*^9}}],

Cell[CellGroupData[{

Cell["NewDSystem", "Subsubsection",
 CellChangeTimes->{{3.71966017905875*^9, 3.7196602055731897`*^9}, 
   3.719734539264958*^9, 3.7213546623135757`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NewDSystem", "::", "usage"}], "=", 
   "\"\<NewDSystem[ds,{x->Mx, y->My,\[Ellipsis]}] defines a new differential \
system associated with the variable ds.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NewDSystem", "::", "size"}], "=", 
   "\"\<Size of the systems mismatch.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NewDSystem", "::", "error"}], "=", 
   "\"\<Something went wrong. Aborting...\>\""}], ";"}]}], "Code",
 CellChangeTimes->{{3.718578444160791*^9, 3.7185785979371853`*^9}, {
  3.7185787264251337`*^9, 3.718578758227241*^9}, {3.718578913756291*^9, 
  3.718579130804022*^9}, {3.718579276127596*^9, 3.718579292233103*^9}, {
  3.71857965987282*^9, 3.718579680367364*^9}, {3.719583305545381*^9, 
  3.7195833252522383`*^9}, {3.721354663277278*^9, 3.721354665072289*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "NewDSystem", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Print", "\[Rule]", "True"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.72264661039853*^9, 3.722646626150292*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds_", ",", "def_Rule", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds", ",", 
    RowBox[{"{", "def", "}"}], ",", "opts"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds_Symbol", ",", "defs_Association", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds", ",", 
    RowBox[{"defs", "/.", 
     RowBox[{"Association", "\[Rule]", "List"}]}], ",", "opts"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds_Symbol", ",", 
    RowBox[{"defs", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"_Symbol", "\[Rule]", 
         RowBox[{"_", "?", "SquareMatrixQ"}]}], ")"}], ".."}], "}"}]}], ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "l", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Quiet", "[", 
      RowBox[{
       RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
       RowBox[{"Clear", "[", "ds", "]"}]}], "]"}], ";", 
     RowBox[{"(*", 
      RowBox[{
      "in", " ", "case", " ", "ds", " ", "was", " ", "defined", " ", 
       "earlier"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Check", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "^=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{
         RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", "0"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"DSystemQ", "[", "ds", "]"}], "^=", "True"}], ";", 
        RowBox[{"(*", 
         RowBox[{
         "will", " ", "be", " ", "used", " ", "in", " ", "arguments", " ", 
          "patterns"}], "*)"}], 
        RowBox[{"l", "=", 
         RowBox[{"Length", "/@", 
          RowBox[{"Last", "/@", "defs"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"(", 
            RowBox[{"SameQ", "@@", "l"}], ")"}]}], ",", 
          RowBox[{"Message", "[", 
           RowBox[{"NewDSystem", "::", "size"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Length", "[", "ds", "]"}], "^=", 
         RowBox[{"First", "@", "l"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"HistoryAppend", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Association", "[", "defs", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"NewDSystem", ",", "ds", ",", 
              RowBox[{"Association", "[", "defs", "]"}]}], "}"}]}], "}"}]}], 
         "]"}], ";"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{
           "#", "<>", "\"\<$M:=History[\>\"", "<>", "#", "<>", 
            "\"\<][[HistoryIndex[\>\"", "<>", "#", "<>", 
            "\"\<],1]];Protect[\>\"", "<>", "#", "<>", "\"\<$M]\>\""}], "]"}],
           "&"}], "[", 
         RowBox[{"SymbolName", "[", "ds", "]"}], "]"}], "*)"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"NewDSystem", "::", "error"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Unprotect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"redefineOperations", "[", "ds", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"TrueQ", "@", 
        RowBox[{"OptionValue", "[", "Print", "]"}]}], ",", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Successfully created differential system for \>\"", "<>", 
         RowBox[{"ToString", "@", 
          RowBox[{"Length", "@", "ds"}]}], "<>", "\"\< functions of \>\"", "<>", 
         RowBox[{"StringRiffle", "[", 
          RowBox[{
           RowBox[{"ToString", "/@", 
            RowBox[{"First", "/@", "defs"}]}], ",", "\"\<,\>\""}], "]"}], 
         "<>", "\"\<.\>\""}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ds", "::", "usage"}], "=", 
      RowBox[{"\"\<Differential system for \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Length", "@", "ds"}]}], "<>", "\"\< functions of \>\"", "<>", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"Riffle", "[", 
         RowBox[{
          RowBox[{"ToString", "/@", 
           RowBox[{"First", "/@", "defs"}]}], ",", "\"\<,\>\""}], "]"}]}], 
       "<>", "\"\<.\>\""}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
     "Print", "[", 
      "\"\<Next, you might want to find denominators appearing. See \!\(\*
StyleBox[\"?\",
FontWeight->\"Bold\"]\)\!\(\*
StyleBox[\"Denominators\",
FontWeight->\"Bold\"]\).\>\"", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.718579300815147*^9, 3.718579382666951*^9}, {
   3.718579445732171*^9, 3.718579510346806*^9}, {3.7185795713303967`*^9, 
   3.718579655667205*^9}, {3.718579686415147*^9, 3.718579741720283*^9}, {
   3.719583121415666*^9, 3.719583289192506*^9}, {3.7195833313334303`*^9, 
   3.719583436553649*^9}, {3.719595363137726*^9, 3.719595492915167*^9}, {
   3.719595585594792*^9, 3.719595587493594*^9}, 3.719595674915206*^9, {
   3.719597012387968*^9, 3.719597118861285*^9}, {3.719597174117198*^9, 
   3.719597231142548*^9}, {3.719597302570046*^9, 3.7195973228559637`*^9}, {
   3.719597381769662*^9, 3.7195974253902273`*^9}, {3.719597531444923*^9, 
   3.719597569944098*^9}, {3.719597655077704*^9, 3.719597693896027*^9}, {
   3.7195991335242367`*^9, 3.719599136943551*^9}, {3.719600150695073*^9, 
   3.719600174091508*^9}, {3.719619553524702*^9, 3.719619581545991*^9}, {
   3.719619876876605*^9, 3.7196198773446712`*^9}, {3.719621789562789*^9, 
   3.7196218153390417`*^9}, {3.719621927523898*^9, 3.719622024913827*^9}, {
   3.719622064995522*^9, 3.719622131767776*^9}, {3.7196602925586643`*^9, 
   3.719660301236218*^9}, {3.7196656106933203`*^9, 3.719665638989236*^9}, 
   3.719731044799958*^9, {3.719736404538786*^9, 3.719736413123609*^9}, 
   3.719740275918*^9, {3.719756587122817*^9, 3.719756605106944*^9}, {
   3.720016086101871*^9, 3.7200160899275103`*^9}, {3.720017064743177*^9, 
   3.72001709999369*^9}, {3.720017189184111*^9, 3.720017201841878*^9}, 
   3.720017444707818*^9, {3.7200174858651543`*^9, 3.7200174992240562`*^9}, {
   3.720017590222838*^9, 3.7200176002304*^9}, {3.7200176984883127`*^9, 
   3.7200178277210083`*^9}, 3.720017905642529*^9, {3.7200186242785597`*^9, 
   3.7200186272560787`*^9}, {3.720137903598793*^9, 3.720137908304805*^9}, {
   3.720142024125119*^9, 3.7201420992527857`*^9}, 3.720142129925112*^9, {
   3.720142297796999*^9, 3.720142299887911*^9}, {3.720150231787264*^9, 
   3.720150238578167*^9}, {3.720150350267871*^9, 3.720150353306981*^9}, {
   3.7201503882101803`*^9, 3.7201503940501013`*^9}, 3.721354404386806*^9, {
   3.721354665786091*^9, 3.721354672585949*^9}, {3.7226466365911083`*^9, 
   3.722646676447404*^9}, {3.7226468900192337`*^9, 3.722646925542104*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["redefineOperations", "Subsubsection",
 CellChangeTimes->{3.7221632996136007`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"redefineOperations", "[", "ds_Symbol", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t1", ",", "i", ",", "keys", ",", "l"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"ds", ",", "opts___"}], "]"}], "^:=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"ds$M", ",", 
             RowBox[{
              RowBox[{"t1", "=", 
               RowBox[{"#", "[", 
                RowBox[{"ds$M", ",", "opts"}], "]"}]}], ";", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"t1", "===", "ds$M"}], ",", 
                RowBox[{"Message", "[", 
                 RowBox[{"History", "::", "nothing"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"HistoryAppend", "[", 
                  RowBox[{"ds", ",", 
                   RowBox[{"{", 
                    RowBox[{"t1", ",", 
                    RowBox[{"{", 
                    RowBox[{"#", ",", "ds", ",", "opts"}], "}"}]}], "}"}]}], 
                  "]"}], ";", "t1"}]}], "]"}]}]}], "]"}], "[", 
           RowBox[{
            RowBox[{"History", "[", "ds", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], 
            "]"}], "]"}]}], ";"}], ")"}], "&"}], "/@", 
      RowBox[{"{", 
       RowBox[{
       "Factor", ",", "Simplify", ",", "FullSimplify", ",", "Apart", ",", 
        "Together"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Variables", "[", "ds", "]"}], "^:=", 
      RowBox[{"Keys", "[", 
       RowBox[{
        RowBox[{"History", "[", "ds", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Protect", "/@", 
      RowBox[{"Variables", "[", "ds", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ds", "[", "x_", "]"}], ":=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}],
         ")"}], "[", "x", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ds", "[", "]"}], ":=", 
      RowBox[{"ds", "[", 
       RowBox[{"[", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ds", "/:", 
      RowBox[{"Part", "[", 
       RowBox[{"ds", ",", "a___"}], "]"}], ":=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{"#", ",", "a"}], "]"}], "&"}], ",", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ds", "/:", 
      RowBox[{"Map", "[", 
       RowBox[{"f_", ",", "ds", ",", "pars___"}], "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"t1", "=", 
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], 
          "]"}]}], ";", 
        RowBox[{"keys", "=", 
         RowBox[{"Keys", "[", "t1", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"l", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Length", "@", "keys"}], ")"}], "*", 
          SuperscriptBox[
           RowBox[{"Length", "[", "ds", "]"}], "2"]}]}], ";", 
        RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Monitor", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"t1", "[", "#", "]"}], "=", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"i", "++"}], ";", "#"}], ")"}], "&"}], "@*", 
                 "f"}], ",", 
                RowBox[{"t1", "[", "#", "]"}], ",", "pars"}], "]"}]}], ")"}], 
            "&"}], "/@", "keys"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ProgressIndicator", "[", 
           RowBox[{"i", ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "l"}], "}"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"HistoryAppend", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"{", 
           RowBox[{"t1", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"Map", "[", 
                RowBox[{"f", ",", "#1", ",", "##2"}], "]"}], "&"}], ",", "ds",
               ",", "pars"}], "}"}]}], "}"}]}], "]"}]}], ")"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ds", "/:", 
      RowBox[{"MapAt", "[", 
       RowBox[{"f_", ",", "ds", ",", "pars___"}], "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"t1", "=", 
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], 
          "]"}]}], ";", 
        RowBox[{"keys", "=", 
         RowBox[{"Keys", "[", "t1", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"l", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Length", "@", "keys"}], ")"}], "*", 
          SuperscriptBox[
           RowBox[{"Length", "[", "ds", "]"}], "2"]}]}], ";", 
        RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Monitor", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"t1", "[", "#", "]"}], "=", 
              RowBox[{"MapAt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"i", "++"}], ";", "#"}], ")"}], "&"}], "@*", 
                 "f"}], ",", 
                RowBox[{"t1", "[", "#", "]"}], ",", "pars"}], "]"}]}], ")"}], 
            "&"}], "/@", "keys"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ProgressIndicator", "[", 
           RowBox[{"i", ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "l"}], "}"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"HistoryAppend", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"{", 
           RowBox[{"t1", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"MapAt", "[", 
                RowBox[{"f", ",", "#1", ",", "##2"}], "]"}], "&"}], ",", "ds",
               ",", "pars"}], "}"}]}], "}"}]}], "]"}]}], ")"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->CompressedData["
1:eJwdz00og3EABvA3Ck1Kk1rUMpQ20zgs2mo1bROZ1kRqbD6aOYgyc5ALafMx
GikvByP5KJKEFZPJDprRMq0daBOZzIEi5Sv/5z08/S7Pc3h4rd1aYwJFUVwS
2FoYC0ztx+WvF+sRmLqmKZkmnoRYUpiv+ZXBXu+9Er6PeeqgkBaZYMOezgyb
upYH4AC1YWV2gwYb3AwW2OFlRfsk5Je4vDCp4YAxN+rRR4ilV5wO6N8WcvWu
uPyHO8SDGWXOchj0RJSQ/sqsgbeBT8Yztb+F6TvCJjicVd/J9G5eGON/MjNM
XJFaYFWdiDIQJww7jIrij9k5otdN07D3+mnTSVSpWVuw/+Fxvu+Q/BzX7kLK
QR/B59joMfxL05/CHHH1OVSIBVEYEpnv4EyRhd3mjst9ybN5kN9k48PwmlII
dSsHKmj1NddCSQ9bBx2SAiNcTFnohKuHjWZYP/iWpT8ifznf2fBhZ2nITky3
qIehu1I6Au2CwnH4D4XgBRQ=
  "]]
}, Open  ]],

Cell[CellGroupData[{

Cell["DSystemQ", "Subsubsection",
 CellChangeTimes->{{3.71966017905875*^9, 3.7196602065727043`*^9}, 
   3.721354406048121*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DSystemQ", "::", "usage"}], "=", 
   "\"\<DSystemQ[ds] returns True if ds is a differential system.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DSystemQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{{3.719660208790081*^9, 3.719660266364728*^9}, {
  3.721354407321693*^9, 3.7213544110645113`*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Linear Algebra", "Subsection",
 CellChangeTimes->{{3.721436352321959*^9, 3.721436358529262*^9}}],

Cell[CellGroupData[{

Cell["DeleteDependentRows", "Subsubsection",
 CellChangeTimes->{3.72143631149159*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeleteDependentRows", "::", "usage"}], "=", 
   "\"\<DeleteDependentRows[{v1,v2,...}] constructs basis in linear span of \
vectors v1,v2,\[Ellipsis]. Basically, it removes all dependent vectors from \
the given list.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7214331268336163`*^9, 3.721433161582429*^9}, {
  3.721433192333995*^9, 3.721433257047196*^9}, {3.721433330079853*^9, 
  3.721433463066819*^9}, {3.7214335771706057`*^9, 3.721433596330242*^9}, {
  3.721434283917411*^9, 3.721434284834832*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DeleteDependentRows", "[", 
   RowBox[{"vectors", ":", 
    RowBox[{"{", "__List", "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"r", "=", "0"}], ",", 
      RowBox[{"basis", "=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"rrbasis", "=", 
       RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Scan", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"MatrixRank", "[", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"basis", ",", "#"}], "]"}], "]"}], ">", "r"}], ",", 
           RowBox[{"r", "++"}], ",", 
           RowBox[{"basis", "=", 
            RowBox[{"Most", "[", "basis", "]"}]}]}], "]"}], ")"}], "&"}], ",",
        "vectors"}], "]"}], ";", "basis"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721433466105363*^9, 3.721433509484315*^9}, {
  3.721433599010501*^9, 3.7214336096414843`*^9}, {3.7214336648170347`*^9, 
  3.721433825519891*^9}, {3.721433945086652*^9, 3.721433946207259*^9}, {
  3.7214339770069323`*^9, 3.721434013935508*^9}, {3.721434046543439*^9, 
  3.721434119927552*^9}, {3.721434249395426*^9, 3.721434309713563*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["JDecomposition", "Subsubsection",
 CellChangeTimes->{{3.721112403351812*^9, 3.721112411551209*^9}, {
  3.7214365194824*^9, 3.721436541761698*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDecomposition", "::", "usage"}], "=", "\"\<JDecomposition[\!\(\*
StyleBox[\"m\", \"TI\"]\)] yields the Jordan decomposition of a square matrix \
\!\(\*
StyleBox[\"m\", \"TI\"]\). The result is a list {\!\(\*
StyleBox[\"b\", \"TI\"]\),\!\(\*
StyleBox[\"n\", \"TI\"]\)} where \!\(\*
StyleBox[\"b\", \"TI\"]\) is a similarity matrix and \!\(\*
StyleBox[\"n\", \"TI\"]\) is the Jordan canonical form of \!\(\*
StyleBox[\"m\", \"TI\"]\). JDecomposition[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"l\", \"TI\"]\)] does the same, except that it puts \!\(\*
StyleBox[\"l\", \"TI\"]\) above diagonal instead of 1.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.5958489157408714`*^9, 3.5958493537314262`*^9}, {
   3.5958494455337453`*^9, 3.595849463284602*^9}, {3.5958495531826496`*^9, 
   3.595849602769771*^9}, 3.62481375210259*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDecomposition", "[", 
   RowBox[{"m_", "?", "SquareMatrixQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"s", ",", "d", ",", "a", ",", "b", ",", "p", ",", "jc", ",", 
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "m"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Check", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"s", ",", "a"}], "}"}], "=", 
        RowBox[{"JordanDecomposition", "[", "m", "]"}]}], ",", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s", "=", 
      RowBox[{"Factor", "@", "s"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"Simplify", "@", 
       RowBox[{"Factor", "@", 
        RowBox[{"Transform", "[", 
         RowBox[{"m", ",", "s"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"JFormQ", "[", "a", "]"}]}], ",", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Ugly", " ", "hack", " ", "to", " ", "deal", " ", "with", " ", 
       RowBox[{"Mathematica", "'"}], "s", " ", "bugs", " ", "related", " ", 
       "to", " ", "JordanDecomposition"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"d", "=", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"FoldList", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#2", "===", "0"}], ",", "1", ",", 
            RowBox[{"#1", "/", "#2"}]}], "]"}], "&"}], ",", "1", ",", 
         RowBox[{"Diagonal", "[", 
          RowBox[{"a", ",", "1"}], "]"}]}], "]"}], "]"}]}], ";", 
     RowBox[{"s", "=", 
      RowBox[{"s", ".", "d"}]}], ";", 
     RowBox[{"a", "=", 
      RowBox[{"Simplify", "@", 
       RowBox[{"Transform", "[", 
        RowBox[{"a", ",", "d"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"s", ",", "a"}], "}"}]}]}], "\n", "]"}]}]], "Code",
 CellChangeTimes->{{3.594701055468109*^9, 3.5947010804236107`*^9}, 
   3.6248149556528144`*^9, 3.625141171200361*^9, 3.625141238074743*^9, {
   3.625141310024493*^9, 3.6251413185061235`*^9}, 3.625199610120382*^9, {
   3.625199682747583*^9, 3.625199709436294*^9}, {3.6252001556790648`*^9, 
   3.6252001719588685`*^9}, {3.625200202464115*^9, 3.6252002042302866`*^9}, {
   3.625200579718958*^9, 3.6252005827059393`*^9}, {3.625202845054161*^9, 
   3.625202845187249*^9}, {3.6252036303190966`*^9, 3.6252036372486954`*^9}, {
   3.6252042856910505`*^9, 3.6252042886420093`*^9}, {3.6264967664123945`*^9, 
   3.6264967720051117`*^9}, {3.626496844485278*^9, 3.6264968741797514`*^9}, {
   3.681598656393116*^9, 3.6815986627280073`*^9}, {3.681598713841381*^9, 
   3.68159871516964*^9}, {3.7204005381674013`*^9, 3.7204005399997473`*^9}, {
   3.721112486653428*^9, 3.721112501234851*^9}, {3.721112601370891*^9, 
   3.7211126110026903`*^9}, {3.721112690874538*^9, 3.721112720395142*^9}, {
   3.7211127570037613`*^9, 3.721112814666265*^9}, {3.721112863771288*^9, 
   3.721112920435687*^9}, {3.7211129738388357`*^9, 3.7211129756344357`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["JDecompositionData", "Subsubsection",
 CellChangeTimes->{3.721436515212688*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDecompositionData", "::", "usage"}], "=", 
   "\"\<JDecompositionData[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives data for the Jordan decomposition of a \
square matrix \!\(\*
StyleBox[\"m\", \"TI\"]\). The result has a form {{\!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\),\!\(\*
StyleBox[\"ulist\", \"TI\"]\),\!\(\*
StyleBox[\"vlist\", \"TI\"]\)},...} where each element corresponds to Jordan \
cell with the eigenvalue \!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\) , \!\(\*
StyleBox[\"ulist\", \"TI\"]\) being a Jordan chain vectors, starting from the \
eigenvectors, and \!\(\*
StyleBox[\"vlist\", \"TI\"]\) being the same for transposed matrix. Note that \
dual bases are \!\(\*
StyleBox[\"ulist\", \"TI\"]\) and Reverse[\!\(\*
StyleBox[\"vlist\", \"TI\"]\)].\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.5958489157408714`*^9, 3.5958493537314262`*^9}, {
   3.5958494455337453`*^9, 3.595849463284602*^9}, {3.5958495531826496`*^9, 
   3.595849602769771*^9}, 3.62481375210259*^9, {3.6252114066448107`*^9, 
   3.6252117292098913`*^9}, {3.721364338269762*^9, 3.721364339853943*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDecompositionData", "[", "m_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "m"}]}], ",", "\[IndentingNewLine]", "t", ",", 
      "j", ",", "\[IndentingNewLine]", "inds", ",", "\[IndentingNewLine]", 
      "sizes", ",", "\[IndentingNewLine]", "evals", ",", 
      "\[IndentingNewLine]", "us", ",", "vs"}], "\[IndentingNewLine]", "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"t", ",", "j"}], "}"}], "=", 
      RowBox[{"JDecomposition", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"inds", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"Diagonal", "[", 
            RowBox[{"j", ",", "1"}], "]"}], ",", "0", ",", 
           RowBox[{"{", "1", "}"}]}], "]"}], ",", "n"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sizes", "=", 
      RowBox[{"Differences", "[", "inds", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Assert", "[", 
      RowBox[{"n", "===", 
       RowBox[{"Plus", "@@", "sizes"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"evals", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"j", "[", 
         RowBox[{"[", 
          RowBox[{"#", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
       RowBox[{"Rest", "[", "inds", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"us", "=", 
      RowBox[{"PartitionByLengths", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", "t", "]"}], ",", "sizes"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vs", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{"Reverse", "/@", 
        RowBox[{"PartitionByLengths", "[", 
         RowBox[{
          RowBox[{"Inverse", "[", "t", "]"}], ",", "sizes"}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Factor", "@", 
       RowBox[{"Outer", "[", 
        RowBox[{"Dot", ",", 
         RowBox[{"Flatten", "[", 
          RowBox[{"vs", ",", "1"}], "]"}], ",", 
         RowBox[{"Flatten", "[", 
          RowBox[{"us", ",", "1"}], "]"}], ",", "1"}], "]"}]}], 
      RowBox[{"(*", 
       RowBox[{
       "supposed", " ", "to", " ", "be", " ", "identity", " ", "matrix"}], 
       "*)"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"evals", ",", "us", ",", "vs"}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.681598435471023*^9, 3.681598440494897*^9}, {
   3.681598540304131*^9, 3.6815985422797747`*^9}, 3.681598737577104*^9, {
   3.7213641208537207`*^9, 3.721364124116818*^9}, {3.721364196589827*^9, 
   3.721364198502041*^9}, 3.72143655826014*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["GaussSolve", "Subsubsection",
 CellChangeTimes->{{3.721953650031817*^9, 3.721953680911995*^9}, 
   3.721953897654182*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GaussSolve", "::", "usage"}], "=", 
   "\"\<GaussSolve[eqs,vars] implements gauss method of the solution of \
linear equations. Option Continue\[Rule]True|False defines how the procedure \
proceeds when hitting the equation that can not be satisfied (like \
1\[Equal]0). With Continue\[Rule]True such equation is simply neglected, and \
with Continue\[Rule]False the procedure immediately returns $Failed (i.e., no \
solution).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7219537882887383`*^9, 3.721953897679122*^9}, {
  3.7219539593768053`*^9, 3.721954223777403*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GaussSolve", "::", "inconsistent"}], "=", 
   "\"\<Inconsistent equation encountered.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721954761567959*^9, 3.721954818720047*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "GaussSolve", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Monitor", "\[Rule]", "True"}], ",", 
     RowBox[{"Continue", "\[Rule]", "True"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.6368151167523623`*^9, 3.636815118211299*^9}, {
   3.6368152430426607`*^9, 3.63681528045931*^9}, {3.636815690268203*^9, 
   3.6368156917071247`*^9}, {3.636815786673912*^9, 3.636815799207189*^9}, {
   3.636815873360807*^9, 3.6368158772180767`*^9}, {3.636815939018305*^9, 
   3.636815946449506*^9}, {3.6368159995496264`*^9, 3.6368160026269627`*^9}, {
   3.636816063177524*^9, 3.636816142093259*^9}, {3.681624354463532*^9, 
   3.681624520569107*^9}, {3.688365918308423*^9, 3.688365984914689*^9}, {
   3.7214525869943447`*^9, 3.721452588194523*^9}, 3.72195373820475*^9, 
   3.721953897684228*^9, {3.721953935265192*^9, 3.721953955304826*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GaussSolve", "[", 
   RowBox[{"eqs_", ",", "vars_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sol1", ",", "res", ",", 
      RowBox[{"i", "=", "0"}], ",", 
      RowBox[{"l", "=", 
       RowBox[{"Length", "@", "eqs"}]}], ",", "sf", ",", 
      RowBox[{"cnt", "=", 
       RowBox[{"TrueQ", "[", 
        RowBox[{"OptionValue", "[", "Continue", "]"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sf", "=", 
      RowBox[{
       RowBox[{"Collect", "[", 
        RowBox[{"#", ",", "vars", ",", "Together"}], "]"}], "&"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"TrueQ", "[", 
         RowBox[{"OptionValue", "[", "Monitor", "]"}], "]"}], ",", "Monitor", 
        ",", 
        RowBox[{"#1", "&"}]}], "]"}], "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Catch", "[", 
        RowBox[{"Fold", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"i", "++"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Quiet", "[", 
              RowBox[{
               RowBox[{"Check", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"{", "sol1", "}"}], "=", 
                  RowBox[{"Quiet", "[", 
                   RowBox[{
                    RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{"0", "\[Equal]", 
                    RowBox[{"sf", "[", 
                    RowBox[{"#2", "/.", "#1"}], "]"}]}], ",", "vars"}], "]"}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"Solve", "::", "svars"}], "}"}]}], "]"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"sol1", "=", 
                   RowBox[{"{", "}"}]}], ";", 
                  RowBox[{"If", "[", 
                   RowBox[{"cnt", ",", 
                    RowBox[{"Message", "[", 
                    RowBox[{"GaussSolve", "::", "inconsistent"}], "]"}], ",", 
                    RowBox[{"Throw", "[", "$Failed", "]"}]}], "]"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{"Set", "::", "shape"}], "}"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"Set", "::", "shape"}], "}"}]}], "]"}], ";", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#1", "\[Rule]", 
                   RowBox[{"sf", "[", 
                    RowBox[{"#2", "/.", "sol1"}], "]"}]}], ")"}], "&"}], "@@@",
                 "#1"}], ",", "sol1"}], "]"}]}], ")"}], "&"}], ",", 
          RowBox[{"{", "}"}], ",", "eqs"}], "]"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Overlay", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "l"}], "}"}]}], "]"}], ",", 
           RowBox[{
            RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\</\>\"", "<>", 
            RowBox[{"ToString", "[", "l", "]"}]}]}], "}"}], ",", 
         RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.6368151167523623`*^9, 3.636815118211299*^9}, {
   3.6368152430426607`*^9, 3.63681528045931*^9}, {3.636815690268203*^9, 
   3.6368156917071247`*^9}, {3.636815786673912*^9, 3.636815799207189*^9}, {
   3.636815873360807*^9, 3.6368158772180767`*^9}, {3.636815939018305*^9, 
   3.636815946449506*^9}, {3.6368159995496264`*^9, 3.6368160026269627`*^9}, {
   3.636816063177524*^9, 3.636816142093259*^9}, {3.681624354463532*^9, 
   3.681624520569107*^9}, {3.688365918308423*^9, 3.688365992227393*^9}, 
   3.70709016659851*^9, 3.721953739688005*^9, 3.721953897689825*^9, {
   3.721954265034272*^9, 3.721954372961494*^9}, {3.7219544428736153`*^9, 
   3.721954473049819*^9}, {3.72195455299331*^9, 3.7219545941463623`*^9}, {
   3.721954638475116*^9, 3.721954751778903*^9}, {3.721954827418323*^9, 
   3.72195484663407*^9}, {3.721954906763729*^9, 3.721954915522512*^9}, {
   3.7219550315168447`*^9, 3.721955054493164*^9}, 3.721955093525738*^9, {
   3.7219551311894617`*^9, 3.7219551393666887`*^9}, {3.7219551707432127`*^9, 
   3.7219551745017776`*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Polynomial Algebra", "Subsection",
 CellChangeTimes->{{3.7219745860081873`*^9, 3.72197459221539*^9}}],

Cell[CellGroupData[{

Cell["PolynomialModInverse", "Subsubsection",
 CellChangeTimes->{3.721974951713025*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolynomialModInverse", "::", "usage"}], "=", 
   "\"\<PolynomialModInverse[poly1,poly2,x] gives the polynomial invpoly1 \
such that invpoly1*poly1= 1 (mod poly2).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721974611153246*^9, 3.721974702800254*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PolynomialModInverse", "[", 
   RowBox[{"poly1_", ",", "poly2_", ",", "x_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"gcd", ",", "u", ",", "v"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"gcd", ",", 
        RowBox[{"{", 
         RowBox[{"u", ",", "v"}], "}"}]}], "}"}], "=", 
      RowBox[{"PolynomialExtendedGCD", "[", 
       RowBox[{"poly1", ",", "poly2", ",", "x"}], "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FreeQ", "[", 
        RowBox[{"gcd", ",", "x"}], "]"}], ",", 
       FractionBox["u", "gcd"], ",", 
       FractionBox["1", "0"]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"QuolynomialMod", "::", "usage"}], "=", 
   "\"\<QuolynomialMod[quoly,poly,x] gives the \\\"remainder\\\" of the \
rational function quoly when divided by poly.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721974611153246*^9, 3.721974731337377*^9}, {
  3.721974960750544*^9, 3.721975011037758*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuolynomialMod", "[", 
   RowBox[{"quoly_", ",", "poly_", ",", "x_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"num", ",", "den"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"num", ",", "den"}], "}"}], "=", 
      RowBox[{"Through", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Numerator", ",", "Denominator"}], "}"}], "@", 
        RowBox[{"Factor", "@", "quoly"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PolynomialRemainder", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"PolynomialModInverse", "[", 
         RowBox[{"den", ",", "poly", ",", "x"}], "]"}], "*", "num"}], ",", 
       "poly", ",", "x"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"RadicalsUp", ",", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RadicalsUp", "[", "ex_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"den", "=", 
        RowBox[{"Denominator", "[", "ex", "]"}]}], ",", "num", ",", "denc"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"num", "=", 
       RowBox[{"den", "*", "ex"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"denc", "=", 
       RowBox[{"(", 
        RowBox[{"den", "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"Power", "[", 
             RowBox[{"_", ",", 
              RowBox[{"1", "/", "2"}]}], "]"}]}], "\[RuleDelayed]", 
           RowBox[{"-", "x"}]}], "}"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"denc", "=!=", "den"}], ",", 
        RowBox[{"Factor", "[", 
         FractionBox[
          RowBox[{"Expand", "[", 
           RowBox[{"num", "*", "denc"}], "]"}], 
          RowBox[{"Expand", "[", 
           RowBox[{"den", "*", "denc"}], "]"}]], "]"}], ",", "ex"}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.722164690837919*^9, 3.722164721651515*^9}, 
   3.7221667232259083`*^9, {3.722166919409831*^9, 3.72216692478305*^9}, {
   3.722166975495359*^9, 3.7221670129618196`*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Basic matrix operations", "Subsection",
 CellChangeTimes->{{3.719625670755124*^9, 3.7196256751467237`*^9}, {
  3.719625803259419*^9, 3.7196258059788322`*^9}}],

Cell[CellGroupData[{

Cell["Queries", "Subsubsection",
 CellChangeTimes->{{3.7211104864098473`*^9, 3.721110494296945*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NilpotentQ", "::", "usage"}], "=", "\"\<NilpotentQ[\!\(\*
StyleBox[\"m\", \"TI\"]\)]  gives True if \!\(\*
StyleBox[\"m\", \"TI\"]\) is nilpotent.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NilpotentQ", "[", 
   RowBox[{"m_", "?", "SquareMatrixQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "x", "}"}], ",", 
    RowBox[{
     RowBox[{"Collect", "[", 
      RowBox[{
       RowBox[{"CharacteristicPolynomial", "[", 
        RowBox[{"m", ",", "x"}], "]"}], ",", "x", ",", "Factor"}], "]"}], "===", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"-", "x"}], ")"}], "^", 
      RowBox[{"Length", "@", "m"}]}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NilpotentQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{{3.7211112028931923`*^9, 3.721111203132535*^9}, {
  3.7211114622103043`*^9, 3.7211114651845207`*^9}, {3.721111714958542*^9, 
  3.721111727086018*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DiagonalQ", "::", "usage"}], "=", "\"\<DiagonalQ[\!\(\*
StyleBox[\"m\", \"TI\"]\)]  gives True if \!\(\*
StyleBox[\"m\", \"TI\"]\) is diagonal.\>\""}], ";", 
  RowBox[{
   RowBox[{"DiagonalQ", "[", 
    RowBox[{"A_", "?", "SquareMatrixQ"}], "]"}], ":=", 
   RowBox[{"MatchQ", "[", 
    RowBox[{
     RowBox[{"Equal", "@@@", 
      RowBox[{"Position", "[", 
       RowBox[{"A", ",", 
        RowBox[{"Except", "[", "0", "]"}], ",", 
        RowBox[{"{", "2", "}"}], ",", 
        RowBox[{"Heads", "->", "False"}]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"True", ".."}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DiagonalQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{
  3.7211112088770638`*^9, 3.721111469825316*^9, {3.7211117019102497`*^9, 
   3.7211117099256077`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PolyQ", "::", "usage"}], "=", 
   "\"\<PolyQ[expr,x] gives True if expr is a polynomial function of \
x.\\nPolyQ[{a,b,...},x] gives True iff \
PolyQ[a,x]&&PolyQ[b,x]&&..=True.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", "p", "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PolyQ", "[", 
      RowBox[{"expr_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"Catch", "[", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"expr", ",", "x"}], "]"}], ";", "True"}], "]"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"SetAttributes", "[", 
     RowBox[{"p", ",", "Listable"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{
       RowBox[{"ex", ":", 
        RowBox[{"(", 
         RowBox[{"_Plus", "|", "_Times"}], ")"}]}], ",", "x_"}], "]"}], ":=", 
     RowBox[{"p", "[", 
      RowBox[{
       RowBox[{"List", "@@", "ex"}], ",", "x"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{
       RowBox[{"Power", "[", 
        RowBox[{"ex_", ",", 
         RowBox[{"_Integer", "?", "Positive"}]}], "]"}], ",", "x_"}], "]"}], ":=", 
     RowBox[{"p", "[", 
      RowBox[{"ex", ",", "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{"ex_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ex", "===", "x"}], "||", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"ex", ",", "x"}], "]"}]}], ")"}]}], ",", 
       RowBox[{"Throw", "@", "False"}]}], "]"}]}], ";"}]}], 
  "\[IndentingNewLine]", "]"}]}], "Code",
 CellChangeTimes->{{3.721175118249138*^9, 3.72117519184606*^9}, {
  3.721175496702361*^9, 3.7211755065345573`*^9}, {3.7211761882987328`*^9, 
  3.721176190476061*^9}, {3.721181185146391*^9, 3.721181206912819*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RatFuncQ", "::", "usage"}], "=", 
   "\"\<RatFuncQ[expr,x] gives True if expr is a rational function of \
x.\\nRatFuncQ[{a,b,...},x] gives True iff \
RatFuncQ[a,x]&&RatFuncQ[b,x]&&..=True.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", "rf", "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RatFuncQ", "[", 
      RowBox[{"expr_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"Catch", "[", 
      RowBox[{
       RowBox[{"rf", "[", 
        RowBox[{"expr", ",", "x"}], "]"}], ";", "True"}], "]"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"SetAttributes", "[", 
     RowBox[{"rf", ",", "Listable"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rf", "[", 
      RowBox[{
       RowBox[{"ex", ":", 
        RowBox[{"(", 
         RowBox[{"_Plus", "|", "_Times"}], ")"}]}], ",", "x_"}], "]"}], ":=", 
     RowBox[{"rf", "[", 
      RowBox[{
       RowBox[{"List", "@@", "ex"}], ",", "x"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rf", "[", 
      RowBox[{
       RowBox[{"Power", "[", 
        RowBox[{"ex_", ",", "_Integer"}], "]"}], ",", "x_"}], "]"}], ":=", 
     RowBox[{"rf", "[", 
      RowBox[{"ex", ",", "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rf", "[", 
      RowBox[{"ex_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"ex", "===", "x"}], "||", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"ex", ",", "x"}], "]"}]}], ")"}]}], ",", 
       RowBox[{"Throw", "@", "False"}]}], "]"}]}], ";"}]}], 
  "\[IndentingNewLine]", "]"}]}], "Code",
 CellChangeTimes->{{3.721174862910118*^9, 3.721174891224807*^9}, {
  3.72117494825513*^9, 3.721175108987998*^9}, {3.721175478546997*^9, 
  3.721175519113105*^9}, {3.721176656115665*^9, 3.721176659306477*^9}, {
  3.721181216142544*^9, 3.721181230177726*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"JFormQ", "::", "usage"}], "=", "\"\<JFormQ[\!\(\*
StyleBox[\"m\", \"TI\"]\)]  gives True if \!\(\*
StyleBox[\"m\", \"TI\"]\) is a Jordan form.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JFormQ", "[", 
    RowBox[{"{", 
     RowBox[{"{", "_", "}"}], "}"}], "]"}], "=", "True"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JFormQ", "[", 
    RowBox[{"A_", "?", "SquareMatrixQ"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"d", "=", 
        RowBox[{"Diagonal", "[", "A", "]"}]}], ",", "\n", 
       RowBox[{"c1", "=", 
        RowBox[{
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Diagonal", "[", 
                RowBox[{"A", ",", "#"}], "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", 
               RowBox[{"2", ",", 
                RowBox[{
                 RowBox[{"Length", "@", "A"}], "-", "1"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Diagonal", "[", 
                RowBox[{"A", ",", "#"}], "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"1", "-", 
                 RowBox[{"Length", "@", "A"}]}], ",", 
                RowBox[{"-", "1"}]}], "]"}]}]}], "}"}], "]"}], "]"}], "===", 
         RowBox[{"{", "0", "}"}]}]}]}], "\n", "}"}], ",", "\n", 
     RowBox[{"c1", "&&", 
      RowBox[{"And", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"d", "[", 
            RowBox[{"[", "#", "]"}], "]"}], "===", 
           RowBox[{"d", "[", 
            RowBox[{"[", 
             RowBox[{"#", "+", "1"}], "]"}], "]"}]}], "&"}], "/@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Diagonal", "[", 
             RowBox[{"A", ",", "1"}], "]"}], ",", 
            RowBox[{"Except", "[", "0", "]"}], ",", 
            RowBox[{"{", "1", "}"}], ",", 
            RowBox[{"Heads", "->", "False"}]}], "]"}], "]"}]}], ")"}]}]}]}], 
    "\n", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JFormQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{{3.625333810587212*^9, 3.6253338271214075`*^9}, {
   3.721111234750115*^9, 3.7211112353650503`*^9}, 3.7211114782305202`*^9, {
   3.7211116848388577`*^9, 3.721111693956182*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FuchsianQ", "::", "usage"}], "=", "\"\<FuchsianQ[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)]  gives True if \!\(\*
StyleBox[\"m\", \"TI\"]\) has only simple poles in \!\(\*
StyleBox[\"x\", \"TI\"]\).\>\""}], ";", 
  RowBox[{
   RowBox[{
    RowBox[{"FuchsianQ", "[", 
     RowBox[{"m_", ",", "x_"}], "]"}], "/;", 
    RowBox[{"RatFuncQ", "[", 
     RowBox[{"m", ",", "x"}], "]"}]}], ":=", 
   RowBox[{"MatchQ", "[", 
    RowBox[{
     RowBox[{"PolesInfo", "[", 
      RowBox[{"m", ",", "x"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_", ",", 
         RowBox[{"_", "?", "NonPositive"}]}], "}"}], "..."}], "}"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FuchsianQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{{3.625031082415009*^9, 3.625031088978259*^9}, {
   3.6250311402204933`*^9, 3.6250311638957005`*^9}, 3.7211112288132477`*^9, 
   3.72111148339824*^9, {3.721111738574562*^9, 3.7211117692866793`*^9}, {
   3.72117636004358*^9, 3.721176382377513*^9}, 3.721347048906081*^9, 
   3.721347137484569*^9, 3.721452356417967*^9, {3.722596051523273*^9, 
   3.722596065442286*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["TClosure", "Subsubsection",
 CellChangeTimes->{{3.7196546910410557`*^9, 3.719654738194751*^9}, {
  3.719660064064293*^9, 3.719660064703003*^9}, {3.719706070292749*^9, 
  3.7197060908103743`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TClosure", "::", "usage"}], "=", 
   "\"\<TClosure[m_?MatrixQ] calculates transitive closure of the relation \
given by m.\\n  \
Try\\n(MatrixPlot/@{#,TClosure[#]})&[{{1,0,0,0},{1,0,0,0},{0,1,1,1},{0,0,1,0}}\
]\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719651583727508*^9, 3.719651657330677*^9}, {
   3.719653095911035*^9, 3.719653108864572*^9}, {3.719653831070327*^9, 
   3.719653849986565*^9}, {3.719653954480691*^9, 3.719653958422495*^9}, {
   3.719656159293182*^9, 3.719656238965705*^9}, {3.719659062532278*^9, 
   3.719659076803988*^9}, {3.7196600731714354`*^9, 3.719660085529818*^9}, 
   3.719730734382061*^9, {3.722559151444743*^9, 3.722559151610249*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TClosure", "[", 
   RowBox[{"m_", "?", "SquareMatrixQ"}], "]"}], ":=", 
  RowBox[{"tclosure", "[", 
   RowBox[{"m", ",", "1"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.7197061056456327`*^9, 3.719706115279158*^9}, 
   3.719706157827229*^9, 3.719740289973288*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"tclosure", "::", "usage"}], "=", 
   "\"\<tclosure[m_,d:(1|0):1] calculates transitive closure of the relation \
given by m. If the second argument is 0, the relation is symmetrized.\\n  Try\
\\n(MatrixPlot/@{#,TClosure[#]})&[{{1,0,0,0},{1,0,0,0},{0,1,1,1},{0,0,1,0}}]\>\
\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tclosure", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"d", ":", 
     RowBox[{"(", 
      RowBox[{"1", "|", "0"}], ")"}], ":", "1"}], ",", 
    RowBox[{"p_:", 
     RowBox[{"Except", "[", "0", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"paths", ",", "edges", ",", "newpaths"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"paths", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", "#"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "@", "m"}], "]"}]}], "}"}]}], ";", 
     RowBox[{"(*", "vertices", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"edges", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"Rule", "@@@", 
         RowBox[{"Position", "[", 
          RowBox[{"m", ",", "p", ",", 
           RowBox[{"{", "2", "}"}], ",", 
           RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}]}], ",", 
        RowBox[{"Join", "@@", "paths"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"d", "===", "0"}], ",", 
       RowBox[{"edges", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Join", "[", 
          RowBox[{"edges", ",", 
           RowBox[{"Reverse", "/@", "edges"}]}], "]"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"paths", ",", "edges"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"edges", "=", 
      RowBox[{"Dispatch", "[", "edges", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "}"}], "\[NotEqual]", 
        RowBox[{"(", 
         RowBox[{"newpaths", "=", 
          RowBox[{"Complement", "[", 
           RowBox[{
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{"#1", "\[Rule]", 
                  RowBox[{"ReplaceList", "[", 
                   RowBox[{"#2", ",", "edges"}], "]"}]}], "]"}], "&"}], "@@@", 
               RowBox[{"Last", "@", "paths"}]}], "]"}]}], ",", 
            RowBox[{"Join", "@@", "paths"}]}], "]"}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"paths", ",", "newpaths"}], "]"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"Dimensions", "@", "m"}], ",", "2"}], "]"}]}], "]"}], ",", 
       RowBox[{
        RowBox[{"List", "@@@", 
         RowBox[{"Flatten", "[", "paths", "]"}]}], "\[Rule]", "1"}]}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.719651701607442*^9, 3.7196517138561697`*^9}, {
   3.719652298133848*^9, 3.719652365587676*^9}, {3.719652396073495*^9, 
   3.7196523962272053`*^9}, {3.719652507896278*^9, 3.719652509011404*^9}, {
   3.719652545481112*^9, 3.719652547125983*^9}, {3.7196531234565477`*^9, 
   3.7196531342145033`*^9}, {3.719653196948207*^9, 3.719653218635384*^9}, {
   3.719654654884411*^9, 3.719654659576186*^9}, {3.7196547455301313`*^9, 
   3.719654751352714*^9}, {3.719655284993042*^9, 3.719655398076249*^9}, {
   3.719655881351858*^9, 3.7196559126751537`*^9}, {3.7196559705111647`*^9, 
   3.719655976776245*^9}, {3.719660090170336*^9, 3.719660090393218*^9}, {
   3.719706061161648*^9, 3.71970606168744*^9}, {3.719706149702243*^9, 
   3.7197061534959908`*^9}, {3.7197307145261583`*^9, 3.719730723048646*^9}, {
   3.719731931604109*^9, 3.7197319602936077`*^9}, 3.719732062693516*^9, {
   3.7197324820955*^9, 3.719732487616021*^9}, {3.719734368042199*^9, 
   3.719734369786233*^9}, {3.719734421483749*^9, 3.719734440501052*^9}, {
   3.719734478471178*^9, 3.719734489807366*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TClosure", "[", 
   RowBox[{"ds_", "?", "DSystemQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tc", ",", "lc"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tc", "=", 
      RowBox[{"TClosure", "/.", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", "2"}],
         "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"tc", "===", "TClosure"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"lc", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{
           RowBox[{"Values", "[", 
            RowBox[{"ds", "[", 
             RowBox[{"[", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tc", "=", 
         RowBox[{"tclosure", "[", 
          RowBox[{"lc", ",", "1", ",", 
           RowBox[{"Except", "[", 
            RowBox[{"{", 
             RowBox[{"0", ".."}], "}"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"HistoryAddExtra", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"TClosure", "\[Rule]", "tc"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Read TClosure from extras.\>\"", ",", "Small"}], "]"}], 
        "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "tc"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.719665653647743*^9, 3.71966571888421*^9}, {
   3.719665749948429*^9, 3.71966584544868*^9}, {3.719665882214034*^9, 
   3.719665884838501*^9}, {3.719665952463447*^9, 3.719666056384942*^9}, {
   3.719666109106063*^9, 3.7196661775650187`*^9}, {3.7196999982388697`*^9, 
   3.7197000715684347`*^9}, {3.719705906994117*^9, 3.71970591033497*^9}, {
   3.719705950352181*^9, 3.719705997013092*^9}, {3.719706128422389*^9, 
   3.719706181981895*^9}, 3.719730778319806*^9, {3.719732090444763*^9, 
   3.719732104773196*^9}, {3.719732171405158*^9, 3.719732208725486*^9}, {
   3.719732310774341*^9, 3.71973237494258*^9}, 3.719732414479376*^9, {
   3.7197325082399483`*^9, 3.7197325224077587`*^9}, {3.720184915308753*^9, 
   3.720184920323051*^9}, 3.7213544128893147`*^9, 3.721381327920908*^9, {
   3.7217165768667173`*^9, 3.72171657752232*^9}, {3.7217166400426607`*^9, 
   3.7217166435785847`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TClosure", "[", "as_Association", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tc", ",", "lc"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tc", "=", 
      RowBox[{"TClosure", "/.", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", "2"}],
         "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"lc", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"Values", "[", 
         RowBox[{"ds", "[", 
          RowBox[{"[", "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tclosure", "[", 
      RowBox[{"lc", ",", "1", ",", 
       RowBox[{"Except", "[", 
        RowBox[{"{", 
         RowBox[{"0", ".."}], "}"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.719665653647743*^9, 3.71966571888421*^9}, {
   3.719665749948429*^9, 3.71966584544868*^9}, {3.719665882214034*^9, 
   3.719665884838501*^9}, {3.719665952463447*^9, 3.719666056384942*^9}, {
   3.719666109106063*^9, 3.7196661775650187`*^9}, {3.7196999982388697`*^9, 
   3.7197000715684347`*^9}, {3.719705906994117*^9, 3.71970591033497*^9}, {
   3.719705950352181*^9, 3.719705997013092*^9}, {3.719706128422389*^9, 
   3.719706181981895*^9}, 3.719730778319806*^9, {3.719732090444763*^9, 
   3.719732104773196*^9}, {3.719732171405158*^9, 3.719732208725486*^9}, {
   3.719732310774341*^9, 3.71973237494258*^9}, 3.719732414479376*^9, {
   3.7197325082399483`*^9, 3.7197325224077587`*^9}, {3.720184915308753*^9, 
   3.720184976874489*^9}, {3.721716581010387*^9, 3.72171658313783*^9}, 
   3.721716647459573*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["EntangledBlocksIndices", "Subsubsection",
 CellChangeTimes->{{3.719625996899959*^9, 3.719626022595653*^9}, 
   3.7197318157141933`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EntangledBlocksIndices", "::", "usage"}], "=", 
   "\"\<EntangledBlocksIndices[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives a partitioned list {{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]},\[Ellipsis]} such that the \
reordering {\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis],\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]} of columns and rows of \!\(\*
StyleBox[\"m\", \"TI\"]\) transforms it to lower block-triangular form. The \
partition indicates separate blocks. The order guarantees that dependent \
blocks appear earlier.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.5946962031649194`*^9, 3.5946962033500443`*^9}, {
   3.5946964648589287`*^9, 3.594696476782811*^9}, {3.594697189537241*^9, 
   3.594697190571929*^9}, {3.594768409230133*^9, 3.5947684147347717`*^9}, {
   3.624814416190477*^9, 3.624814424413924*^9}, {3.6248159746928186`*^9, 
   3.6248159833355436`*^9}, {3.6251994886047354`*^9, 3.625199498034993*^9}, {
   3.722301738650923*^9, 3.7223017955532713`*^9}, 3.7229121136292553`*^9},
 CellTags->"Queries"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EntangledBlocksIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "eb", "}"}], ",", 
    RowBox[{
     RowBox[{"eb", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"Union", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{"#", ",", "1", ",", 
              RowBox[{"{", "1", "}"}]}], "]"}], "]"}], "&"}], "/@", 
          RowBox[{"If", "[", 
           RowBox[{"tc", ",", "m", ",", 
            RowBox[{"TClosure", "[", "m", "]"}]}], "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Last", "@", "#"}], ",", 
           RowBox[{"Length", "@", "#"}]}], "}"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Complement", "@@", 
        RowBox[{"Reverse", "[", 
         RowBox[{"Take", "[", 
          RowBox[{"eb", ",", "i"}], "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "eb"}]}], "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{
  3.719654341574215*^9, {3.719654476306919*^9, 3.719654481295598*^9}, {
   3.7196554119650707`*^9, 3.7196554122682657`*^9}, {3.719660041474751*^9, 
   3.719660041718134*^9}, {3.719731145455214*^9, 3.719731145599196*^9}, {
   3.7197317417542753`*^9, 3.719731744306674*^9}, {3.71973185875562*^9, 
   3.7197318617230587`*^9}, {3.720157191356635*^9, 3.7201573014717073`*^9}, {
   3.7201576435101547`*^9, 3.720157750676778*^9}, {3.722301694587873*^9, 
   3.7223017091210957`*^9}, {3.722309679302579*^9, 3.722309731486992*^9}, 
   3.7223098486250772`*^9, 3.7223100463945837`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"EntangledBlocksIndices", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "eb", "}"}], ",", 
    RowBox[{
     RowBox[{"eb", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"Union", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{"#", ",", "1", ",", 
              RowBox[{"{", "1", "}"}]}], "]"}], "]"}], "&"}], "/@", 
          RowBox[{"TClosure", "[", "ds", "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Last", "@", "#"}], ",", 
           RowBox[{"Length", "@", "#"}]}], "}"}], "&"}]}], "]"}]}], ";", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Complement", "@@", 
        RowBox[{"Reverse", "[", 
         RowBox[{"Take", "[", 
          RowBox[{"eb", ",", "i"}], "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "eb"}]}], "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.7223097991220427`*^9, 3.722309815975421*^9}, {
   3.722309859441794*^9, 3.722309904726425*^9}, 3.722310027969605*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EntangledBlocksIndices", "::", "usage"}], "=", 
   "\"\<EntangledBlocksIndices[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives a partitioned list {{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]},\[Ellipsis]} such that the \
reordering {\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis],\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]} of columns and rows of \!\(\*
StyleBox[\"m\", \"TI\"]\) transforms it to lower block-triangular form. \nThe \
partition indicates separate blocks.\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.5946962031649194`*^9, 3.5946962033500443`*^9}, {
  3.5946964648589287`*^9, 3.594696476782811*^9}, {3.594697189537241*^9, 
  3.594697190571929*^9}, {3.594768409230133*^9, 3.5947684147347717`*^9}, {
  3.624814416190477*^9, 3.624814424413924*^9}, {3.6248159746928186`*^9, 
  3.6248159833355436`*^9}, {3.6251994886047354`*^9, 3.625199498034993*^9}},
 CellTags->"Queries"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EntangledBlocksIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"GatherBy", "[", 
    RowBox[{
     RowBox[{"MapIndexed", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#2", ",", 
          RowBox[{"Union", "[", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{"#", ",", "1", ",", 
              RowBox[{"{", "1", "}"}]}], "]"}], ",", 
            RowBox[{"{", "#2", "}"}]}], "]"}]}], "}"}], "&"}], ",", 
       RowBox[{"If", "[", 
        RowBox[{"tc", ",", "m", ",", 
         RowBox[{"TClosure", "[", "m", "]"}]}], "]"}]}], "]"}], ",", "Last"}],
     "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "All", ",", "1", ",", "1"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{
  3.719654341574215*^9, {3.719654476306919*^9, 3.719654481295598*^9}, {
   3.7196554119650707`*^9, 3.7196554122682657`*^9}, {3.719660041474751*^9, 
   3.719660041718134*^9}, {3.719731145455214*^9, 3.719731145599196*^9}, {
   3.7197317417542753`*^9, 3.719731744306674*^9}, {3.71973185875562*^9, 
   3.7197318617230587`*^9}, {3.720157191356635*^9, 3.7201573014717073`*^9}, {
   3.7201576435101547`*^9, 3.720157750676778*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"EntangledBlocksIndices", "[", 
   RowBox[{"ds_", ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"GatherBy", "[", 
    RowBox[{
     RowBox[{"MapIndexed", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#2", ",", 
          RowBox[{"Position", "[", 
           RowBox[{"#", ",", "1", ",", 
            RowBox[{"{", "1", "}"}]}], "]"}]}], "}"}], "&"}], ",", 
       RowBox[{"TClosure", "[", "ds", "]"}]}], "]"}], ",", "Last"}], "]"}], 
   "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "All", ",", "1", ",", "1"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{
  3.719654341574215*^9, {3.719654476306919*^9, 3.719654481295598*^9}, {
   3.7196554119650707`*^9, 3.7196554122682657`*^9}, {3.719660041474751*^9, 
   3.719660041718134*^9}, {3.719731145455214*^9, 3.719731145599196*^9}, {
   3.7197317417542753`*^9, 3.719731744306674*^9}, {3.71973185875562*^9, 
   3.7197318617230587`*^9}, {3.720157191356635*^9, 3.7201573014717073`*^9}, {
   3.7201576435101547`*^9, 3.720157750676778*^9}, {3.720157786670072*^9, 
   3.720157787392651*^9}, 3.7201578187457743`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["DiagonalBlocksIndices", "Subsubsection",
 CellChangeTimes->{3.719731767251678*^9}],

Cell["TODO: maybe symmetrization is not necessary?", "Text",
 CellChangeTimes->{{3.7197317793617992`*^9, 3.719731809106439*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DiagonalBlocksIndices", "::", "usage"}], "=", 
   "\"\<DiagonalBlocksIndices[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives a partitioned list {{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]},\[Ellipsis]} such that the \
reordering {\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis],\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]} of columns and rows of \!\(\*
StyleBox[\"m\", \"TI\"]\) transforms it to block-diagonal form. The partition \
indicates separate diagonal blocks.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.5946962031649194`*^9, 3.5946962033500443`*^9}, {
  3.5946964648589287`*^9, 3.594696476782811*^9}, {3.594697189537241*^9, 
  3.594697190571929*^9}, {3.594768409230133*^9, 3.5947684147347717`*^9}, {
  3.624814416190477*^9, 3.624814424413924*^9}, {3.6248159746928186`*^9, 
  3.6248159833355436`*^9}, {3.6251994886047354`*^9, 3.625199498034993*^9}, {
  3.6252024026655583`*^9, 3.625202452257471*^9}},
 CellTags->"Queries"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DiagonalBlocksIndices", "[", "m_", "]"}], ":=", 
  RowBox[{
   RowBox[{"GatherBy", "[", 
    RowBox[{
     RowBox[{"MapIndexed", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#2", ",", 
          RowBox[{"Position", "[", 
           RowBox[{"#", ",", "1", ",", 
            RowBox[{"{", "1", "}"}]}], "]"}]}], "}"}], "&"}], ",", 
       RowBox[{"tclosure", "[", 
        RowBox[{"m", ",", "0"}], "]"}]}], "]"}], ",", "Last"}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "All", ",", "1", ",", "1"}], "]"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.7196554281916323`*^9, 3.719655431277666*^9}, {
  3.719660047256283*^9, 3.71966004751105*^9}, {3.7197311605674677`*^9, 
  3.719731161047188*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["DependentRowIndices,DependentColumnIndices", "Subsubsection",
 CellChangeTimes->{
  3.7197317588026857`*^9, {3.721111832469984*^9, 3.721111881294001*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DependentRowIndices", "::", "usage"}], "=", 
   "\"\<DependentRowIndices[\!\(\*
StyleBox[\"matrix\", \"TI\"]\),\!\(\*
StyleBox[\"index\", \"TI\"]\)] gives a list of indices of all dependent \
rows\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.594768425070605*^9, 3.594768541069293*^9}, {
  3.594768605677006*^9, 3.594768617955124*^9}, {3.594768763048047*^9, 
  3.594768801818677*^9}},
 CellTags->"Queries"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DependentRowIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "rows_", ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Union", "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{"#", ",", "1", ",", 
        RowBox[{"{", "1", "}"}]}], "]"}], "&"}], "/@", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{"tc", ",", "m", ",", 
        RowBox[{"TClosure", "[", "m", "]"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "rows", "}"}], "]"}], "]"}], "]"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{
  3.71973257074367*^9, {3.7197326253236103`*^9, 3.719732625495676*^9}, {
   3.719734228910142*^9, 3.719734248773912*^9}, {3.719734575354805*^9, 
   3.719734614965242*^9}, {3.719734706266326*^9, 3.719734731276202*^9}, {
   3.7197348610113907`*^9, 3.719734879076476*^9}, {3.7201573556078*^9, 
   3.720157363280262*^9}, {3.7201577328059683`*^9, 3.7201577479337187`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DependentRowIndices", "[", 
   RowBox[{"ds_", ",", "rows_", ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Union", "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{"#", ",", "1", ",", 
        RowBox[{"{", "1", "}"}]}], "]"}], "&"}], "/@", 
     RowBox[{
      RowBox[{"TClosure", "[", "ds", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "rows", "}"}], "]"}], "]"}], "]"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{
  3.71973257074367*^9, {3.7197326253236103`*^9, 3.719732625495676*^9}, {
   3.719734228910142*^9, 3.719734248773912*^9}, {3.719734575354805*^9, 
   3.719734614965242*^9}, {3.719734706266326*^9, 3.719734731276202*^9}, {
   3.7197348610113907`*^9, 3.719734879076476*^9}, {3.7201573556078*^9, 
   3.720157363280262*^9}, {3.7201577328059683`*^9, 3.7201577745099688`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DependentColumnIndices", "::", "usage"}], "=", 
   "\"\<DependentColumnIndices[\!\(\*
StyleBox[\"matrix\", \"TI\"]\),\!\(\*
StyleBox[\"index\", \"TI\"]\)] gives a list of indices of all dependent \
columns\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721111963847333*^9, 3.721111972382742*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DependentColumnIndices", "[", 
   RowBox[{"m_", ",", "args__"}], "]"}], ":=", 
  RowBox[{"DependentRowIndices", "[", 
   RowBox[{
    RowBox[{"Transpose", "[", "m", "]"}], ",", "args"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.721111889855186*^9, 3.721111953607114*^9}, 
   3.722578310674747*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["InvertBlockTriangular", "Subsubsection",
 CellChangeTimes->{{3.689837283323153*^9, 3.689837309343875*^9}, {
   3.695346284320386*^9, 3.695346284472209*^9}, {3.719625758923317*^9, 
   3.719625768971397*^9}, 3.720156071511805*^9, {3.720185050345173*^9, 
   3.720185050484827*^9}, 3.721256313676182*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"InvertBlockTriangular", "::", "usage"}], "=", 
   "\"\<InvertBlockTriangular[m] is an optimized version of Inverse[m] for \
block-triangular matrices.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.689838189120213*^9, 3.6898382372563477`*^9}, 
   3.693193027522334*^9, {3.72015607273525*^9, 3.720156074335528*^9}, {
   3.7212563165724487`*^9, 3.721256321594676*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "InvertBlockTriangular", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Print", "\[Rule]", "False"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721543588154291*^9, 3.721543630958571*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"InvertBlockTriangular", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"s", "=", 
       RowBox[{"TClosure", "[", "m", "]"}]}], ",", "diag", ",", "dep", ",", 
      RowBox[{"mi", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "m"}], "]"}]}], ",", 
      RowBox[{"stat", "=", "\"\<\>\""}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"invert", " ", "diagonal"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"TrueQ", "@", 
         RowBox[{"OptionValue", "[", "Print", "]"}]}], ",", "Monitor", ",", 
        RowBox[{"#", "&"}]}], "]"}], "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"stat", "=", "\"\<Finding diagonal blocks\[Ellipsis]\>\""}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"diag", "=", 
         RowBox[{"EntangledBlocksIndices", "[", 
          RowBox[{"s", ",", "True"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"stat", "=", 
             RowBox[{"\"\<Inverting diagonal elements with indices \>\"", "<>", 
              RowBox[{"ToString", "[", "#", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"mi", "[", 
              RowBox[{"[", 
               RowBox[{"#", ",", "#"}], "]"}], "]"}], "=", 
             RowBox[{"Factor", "[", 
              RowBox[{"Inverse", "[", 
               RowBox[{
                RowBox[{"m", "[", 
                 RowBox[{"[", 
                  RowBox[{"#", ",", "#"}], "]"}], "]"}], ",", 
                RowBox[{"Sequence", "@@", 
                 RowBox[{"FilterRules", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "\[Rule]", 
                    RowBox[{"OptionValue", "[", "#", "]"}]}], "&"}], "@@@", 
                    RowBox[{"Options", "[", "InvertBlockTriangular", "]"}]}], 
                   ",", 
                   RowBox[{"Options", "[", "Inverse", "]"}]}], "]"}]}]}], 
               "]"}], "]"}]}]}], ")"}], "&"}], "/@", "diag"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"dep", "=", 
             RowBox[{"Complement", "[", 
              RowBox[{
               RowBox[{"DependentRowIndices", "[", 
                RowBox[{"s", ",", "#", ",", "True"}], "]"}], ",", "#"}], 
              "]"}]}], ";", 
            RowBox[{"stat", "=", 
             RowBox[{"\"\<Inverting off-diagonal elements \>\"", "<>", 
              RowBox[{"ToString", "[", "dep", "]"}], "<>", 
              "\"\< on rows \>\"", "<>", 
              RowBox[{"ToString", "[", "#", "]"}]}]}], ";", 
            RowBox[{
             RowBox[{"mi", "[", 
              RowBox[{"[", 
               RowBox[{"#", ",", "dep"}], "]"}], "]"}], "=", 
             RowBox[{"-", 
              RowBox[{"FactorPlus", "[", 
               RowBox[{
                RowBox[{"mi", "[", 
                 RowBox[{"[", 
                  RowBox[{"#", ",", "#"}], "]"}], "]"}], ".", 
                RowBox[{"FactorPlus", "[", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"#", ",", "dep"}], "]"}], "]"}], ".", 
                  RowBox[{"mi", "[", 
                   RowBox[{"[", 
                    RowBox[{"dep", ",", "dep"}], "]"}], "]"}]}], "]"}]}], 
               "]"}]}]}]}], ")"}], "&"}], "/@", "diag"}], ";"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", "stat"}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "mi", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.689837314161792*^9, 3.689837327877672*^9}, {
   3.693192689187665*^9, 3.693192696547106*^9}, {3.693192811123892*^9, 
   3.693192816419774*^9}, 3.7201560436462917`*^9, 3.720156075629786*^9, {
   3.720156627567404*^9, 3.7201566356782703`*^9}, {3.7201570363429117`*^9, 
   3.720157058415958*^9}, {3.720157119951582*^9, 3.720157121975534*^9}, {
   3.720157159289012*^9, 3.720157162892065*^9}, {3.720157384494575*^9, 
   3.7201573922899637`*^9}, {3.721028759843788*^9, 3.7210287623886547`*^9}, {
   3.7210288520377407`*^9, 3.7210288812625923`*^9}, {3.721029062196168*^9, 
   3.721029067491753*^9}, {3.721029128021254*^9, 3.721029139644513*^9}, 
   3.721029333064184*^9, 3.721029906836112*^9, {3.721030822263856*^9, 
   3.7210308437672777`*^9}, {3.7212180136235437`*^9, 3.721218024904112*^9}, {
   3.721256329140182*^9, 3.721256332680421*^9}, {3.7215436373605213`*^9, 
   3.7215436641927233`*^9}, {3.721543756275454*^9, 3.721543804513298*^9}, {
   3.722576908862357*^9, 3.722576909494079*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Series etc.", "Subsection",
 CellChangeTimes->{{3.719625670755124*^9, 3.7196256751467237`*^9}, {
  3.719625803259419*^9, 3.7196258059788322`*^9}, {3.721114456293867*^9, 
  3.7211144616801023`*^9}}],

Cell[CellGroupData[{

Cell["Series (redefine), SeriesCoefficients", "Subsubsection",
 CellChangeTimes->{{3.721114469209756*^9, 3.721114491709803*^9}, 
   3.721114782798402*^9, {3.721130085467752*^9, 3.7211300981357517`*^9}, {
   3.721386141112261*^9, 3.721386143595418*^9}}],

Cell["\<\
Let us fix Series to always give SeriesData and to correctly thread lists and \
matrices\
\>", "Text",
 CellChangeTimes->{{3.721114787342085*^9, 3.721114825134726*^9}, {
  3.721115159280148*^9, 3.721115180312457*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "Series", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Series", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "x0_", ",", "n_Integer"}], "}"}]}], "]"}], "/;", 
   RowBox[{"FreeQ", "[", 
    RowBox[{"expr", ",", "x"}], "]"}]}], ":=", 
  RowBox[{"expr", "+", 
   RowBox[{"SeriesData", "[", 
    RowBox[{"x", ",", "x0", ",", 
     RowBox[{"{", "}"}], ",", 
     RowBox[{"n", "+", "1"}], ",", 
     RowBox[{"n", "+", "1"}], ",", "1"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Series", "[", 
   RowBox[{"expr_List", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x0_", ",", "n_Integer"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Series", "[", 
      RowBox[{"#", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "x0", ",", "n"}], "}"}]}], "]"}], "&"}], ",", 
    "expr"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "Series", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"todo", "[", "\"\<NB: Series redefined!\>\"", "]"}]}], "Code",
 CellChangeTimes->{{3.7211145769872103`*^9, 3.72111475148678*^9}, {
  3.721114838680212*^9, 3.7211148691111717`*^9}, {3.721114943472725*^9, 
  3.721114972264021*^9}, {3.721115033305772*^9, 3.721115064000175*^9}, {
  3.721115189521079*^9, 3.721115226273196*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"\<\"rewrite JDecomposition and JFormQ: should preserve \
block-triangular structure is possible.\"\>", 
   ",", "\<\"NB: Series redefined!\"\>"}], "}"}]], "Output",
 CellChangeTimes->{3.721262471220521*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "2", ",", "2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7211145101533957`*^9, 3.721114515366473*^9}, {
  3.72111455818435*^9, 3.721114597270219*^9}, {3.721114756880534*^9, 
  3.721114774192081*^9}}],

Cell[BoxData[
 InterpretationBox[
  RowBox[{"1", "+", 
   InterpretationBox[
    SuperscriptBox[
     RowBox[{"O", "[", 
      RowBox[{"x", "-", "2"}], "]"}], "3"],
    SeriesData[$CellContext`x, 2, {}, 0, 3, 1],
    Editable->False]}],
  SeriesData[$CellContext`x, 2, {1}, 0, 3, 1],
  Editable->False]], "Output",
 CellChangeTimes->{
  3.721114519506071*^9, {3.7211145589277477`*^9, 3.7211145975165987`*^9}, {
   3.721114753541202*^9, 3.721114774536633*^9}}]
}, Open  ]],

Cell["SeriesCoefficients (convenient for matrices)", "Text",
 CellChangeTimes->{{3.721130113023964*^9, 3.7211301162815104`*^9}, 
   3.721176916758677*^9, {3.7212603403316793`*^9, 3.7212603692226667`*^9}, {
   3.7212635036420383`*^9, 3.721263503815041*^9}, {3.721271600510744*^9, 
   3.7212716047331467`*^9}, {3.721378181627317*^9, 3.721378184500306*^9}, {
   3.7213860805265827`*^9, 3.7213860981061*^9}, 3.721386178657846*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SeriesCoefficients", "::", "usage"}], "=", 
   "\"\<SeriesCoefficients[f,{x,x0,n}] generate a power series expansion for \
f about the point x=x0 up to  (x-x0)^n return the list of these terms\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.721271627872477*^9, 3.721271655358736*^9}, {
  3.721378196053143*^9, 3.7213782344236*^9}, {3.721386181825918*^9, 
  3.721386204379362*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesCoefficients", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", "series", ",", "n"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"series", "=", 
      RowBox[{"Series", "[", 
       RowBox[{"A", ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0", ",", "k"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n", "=", 
      RowBox[{"LeadingOrder", "[", 
       RowBox[{"series", ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"SeriesCoefficient", "[", 
        RowBox[{"series", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0", ",", "#"}], "}"}]}], "]"}], "&"}], "/@", 
      RowBox[{"Range", "[", 
       RowBox[{"n", ",", "k"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.7212762692481728`*^9, 3.721276273944704*^9}, {
   3.721378041660084*^9, 3.7213780476788607`*^9}, {3.7213780916816597`*^9, 
   3.721378147199555*^9}, {3.721378245942226*^9, 3.721378281654258*^9}, {
   3.721378362458531*^9, 3.721378452556354*^9}, {3.721385839063093*^9, 
   3.721385882249897*^9}, 3.72138599241002*^9, {3.721386212291338*^9, 
   3.721386234944861*^9}, {3.7213863804859133`*^9, 3.721386442327775*^9}, 
   3.7213866610738173`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
LeadingSeries,LeadingSeriesCoefficient,LeadingSeriesCoefficients\
\>", "Subsubsection",
 CellChangeTimes->{{3.721130113023964*^9, 3.7211301162815104`*^9}, 
   3.721176916758677*^9, {3.7212603403316793`*^9, 3.7212603692226667`*^9}, {
   3.7212635036420383`*^9, 3.721263503815041*^9}, {3.721271600510744*^9, 
   3.7212716047331467`*^9}, {3.721386129524364*^9, 3.721386129770952*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingSeries", "::", "usage"}], "=", 
   "\"\<LeadingSeries[f,{x,x0,n}] generate a power series expansion for f \
about the point x=x0 with n first nonzero terms of expansion\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7211769221830187`*^9, 3.721176946191174*^9}, {
  3.7211770631114693`*^9, 3.721177147947342*^9}, {3.721260351246509*^9, 
  3.721260354358981*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"LeadingSeries", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"n", "=", 
       RowBox[{"LeadingOrder", "[", 
        RowBox[{"A", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "\[Infinity]"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"A", "+", 
         RowBox[{"SeriesData", "[", 
          RowBox[{"x", ",", "x0", ",", 
           RowBox[{"{", "}"}], ",", "\[Infinity]", ",", "\[Infinity]", ",", 
           "1"}], "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Series", "[", 
      RowBox[{"A", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "x0", ",", 
         RowBox[{"n", "+", "k"}]}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LeadingSeries", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "\[Infinity]", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"n", "=", 
       RowBox[{"LeadingOrder", "[", 
        RowBox[{"A", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "\[Infinity]"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"A", "+", 
         RowBox[{"SeriesData", "[", 
          RowBox[{"x", ",", "\[Infinity]", ",", 
           RowBox[{"{", "}"}], ",", "\[Infinity]", ",", "\[Infinity]", ",", 
           "1"}], "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Series", "[", 
      RowBox[{"A", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "\[Infinity]", ",", 
         RowBox[{"n", "+", "k"}]}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}]}], "Code",
 CellChangeTimes->{{3.721177165833036*^9, 3.7211771832151623`*^9}, {
   3.721177286597918*^9, 3.721177353013176*^9}, {3.721177544044634*^9, 
   3.721177582257584*^9}, {3.721177651884191*^9, 3.721177655596026*^9}, {
   3.7211776885663443`*^9, 3.721177700051083*^9}, 3.7212141183848763`*^9, {
   3.7212602939241133`*^9, 3.7212603166963654`*^9}, {3.721260352297309*^9, 
   3.721260353308325*^9}, {3.721262568512467*^9, 3.721262617080518*^9}, {
   3.721264495535777*^9, 3.721264571817264*^9}, {3.721275934507187*^9, 
   3.7212759555132513`*^9}, 3.721275991924389*^9, 3.72127603195129*^9, {
   3.721276106369707*^9, 3.721276106853546*^9}, 3.721378521305128*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingSeriesCoefficient", "::", "usage"}], "=", 
   "\"\<LeadingSeriesCoefficient[f,{x,x0,n}] generate a power series \
expansion for f about the point x=x0 with n first nonzero terms of \
expansion\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721271627872477*^9, 3.721271655358736*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingSeriesCoefficient", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"n", "=", 
       RowBox[{"LeadingOrder", "[", 
        RowBox[{"A", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "\[Infinity]"}], ",", 
       RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"SeriesCoefficient", "[", 
      RowBox[{"A", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "x0", ",", 
         RowBox[{"n", "+", "k"}]}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}]], "Code",
 CellChangeTimes->{{3.7212762692481728`*^9, 3.721276273944704*^9}, {
   3.721378041660084*^9, 3.7213780476788607`*^9}, {3.7213780916816597`*^9, 
   3.721378147199555*^9}, 3.721378514853518*^9, 3.721385918693139*^9}],

Cell["LeadingSeriesCoefficients (convenient for matrices)", "Text",
 CellChangeTimes->{{3.721130113023964*^9, 3.7211301162815104`*^9}, 
   3.721176916758677*^9, {3.7212603403316793`*^9, 3.7212603692226667`*^9}, {
   3.7212635036420383`*^9, 3.721263503815041*^9}, {3.721271600510744*^9, 
   3.7212716047331467`*^9}, {3.721378181627317*^9, 3.721378184500306*^9}, {
   3.7213860805265827`*^9, 3.7213860981061*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingSeriesCoefficients", "::", "usage"}], "=", 
   "\"\<LeadingSeriesCoefficients[f,{x,x0,n}] generate a power series \
expansion for f about the point x=x0 with n first nonzero terms of expansion \
and return the list of these terms\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721271627872477*^9, 3.721271655358736*^9}, {
  3.721378196053143*^9, 3.7213782344236*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingSeriesCoefficients", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"n", "=", 
       RowBox[{"LeadingOrder", "[", 
        RowBox[{"A", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ",", "series"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "\[Infinity]"}], ",", 
       RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"series", "=", 
      RowBox[{"Series", "[", 
       RowBox[{"A", ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0", ",", 
          RowBox[{"n", "+", "k"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"SeriesCoefficient", "[", 
        RowBox[{"series", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0", ",", "#"}], "}"}]}], "]"}], "&"}], "/@", 
      RowBox[{"Range", "[", 
       RowBox[{"n", ",", 
        RowBox[{"n", "+", "k"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.7212762692481728`*^9, 3.721276273944704*^9}, {
   3.721378041660084*^9, 3.7213780476788607`*^9}, {3.7213780916816597`*^9, 
   3.721378147199555*^9}, {3.721378245942226*^9, 3.721378281654258*^9}, {
   3.721378362458531*^9, 3.721378452556354*^9}, {3.721385839063093*^9, 
   3.721385882249897*^9}, 3.72138599241002*^9, {3.7213864758641768`*^9, 
   3.721386487043613*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["LeadingOrder", "Subsubsection",
 CellChangeTimes->{3.7212600054381113`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingOrder", "::", "usage"}], "=", 
  "\"\<LeadingOrder[expr,{x,x0}] gives the leading order of expansion in x.\>\
\""}]], "Code",
 CellChangeTimes->{{3.7212600123966084`*^9, 3.721260069086038*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"LeadingOrder", "[", 
   RowBox[{"expr_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Min", "[", 
   RowBox[{"lorder", "[", 
    RowBox[{"expr", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "0"}], "}"}]}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LeadingOrder", "[", 
   RowBox[{"expr_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_"}], "}"}], ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Min", "[", 
   RowBox[{"lorder", "[", 
    RowBox[{"expr", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "x0"}], "}"}]}], "]"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.721216382392581*^9, 3.721216403554612*^9}, {
   3.721216434042107*^9, 3.7212165227764177`*^9}, {3.721216558815517*^9, 
   3.721216558910227*^9}, {3.721216608627376*^9, 3.7212166788415956`*^9}, {
   3.7212167909959*^9, 3.7212168953536386`*^9}, {3.7212171737710648`*^9, 
   3.721217177124671*^9}, {3.7212172179478893`*^9, 3.721217323891148*^9}, 
   3.721217371518373*^9, 3.721217436441401*^9, {3.721217633474066*^9, 
   3.7212176602426*^9}, {3.721256138980835*^9, 3.721256162094986*^9}, {
   3.721256411489962*^9, 3.721256416212864*^9}, {3.721257999110763*^9, 
   3.7212581361400414`*^9}, {3.721260085815127*^9, 3.721260115940406*^9}, {
   3.721260189680677*^9, 3.721260193705695*^9}, {3.721262347704783*^9, 
   3.721262372352289*^9}, {3.721264374903038*^9, 3.7212644075764313`*^9}, 
   3.7212785513044577`*^9, {3.721278670905985*^9, 3.721278671029895*^9}, {
   3.721285908397681*^9, 3.721285940968425*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"SetAttributes", "[", 
    RowBox[{"lorder", ",", "Listable"}], "]"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"0", ",", "x_Symbol"}], "]"}], "=", "\[Infinity]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"expr_", ",", "x_Symbol"}], "]"}], ":=", 
     RowBox[{"Plus", "@@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"Factors", "[", "expr", "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "^", "a_."}], ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{"a", " ", "n"}]}]}], "]"}]}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"expr_List", ",", "x_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"lorder", "[", 
        RowBox[{"#", ",", "x"}], "]"}], "&"}], "/@", "expr"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], "=", 
     "\[Infinity]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"expr_", ",", 
       RowBox[{"{", 
        RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
     RowBox[{"Plus", "@@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"FactorList", "[", 
         RowBox[{"expr", "/.", 
          RowBox[{"x", "\[Rule]", 
           RowBox[{"x", "+", "x0"}]}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "^", "a_."}], ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{"a", " ", "n"}]}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"expr_", ",", 
       RowBox[{"{", 
        RowBox[{"x_Symbol", ",", "\[Infinity]"}], "}"}]}], "]"}], ":=", 
     RowBox[{"Plus", "@@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"FactorList", "[", 
         RowBox[{"expr", "/.", 
          RowBox[{"x", "\[Rule]", 
           RowBox[{"1", "/", "x"}]}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "^", "a_."}], ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{"a", " ", "n"}]}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"lorder", "[", 
       RowBox[{"expr_SeriesData", ",", 
        RowBox[{"{", 
         RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], "/;", 
      RowBox[{"MatchQ", "[", 
       RowBox[{
        RowBox[{"Take", "[", 
         RowBox[{
          RowBox[{"List", "@@", "expr"}], ",", "2"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ":=", 
     RowBox[{"expr", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], ";"}]}]}]], "Code",
 CellChangeTimes->{{3.721264013946117*^9, 3.721264037813424*^9}, {
   3.721264311467393*^9, 3.7212643490369177`*^9}, {3.721271674507071*^9, 
   3.721271703077076*^9}, {3.721276309364785*^9, 3.72127631423538*^9}, {
   3.721276349396443*^9, 3.7212763502442713`*^9}, {3.72127679705446*^9, 
   3.7212767979623547`*^9}, {3.7212768507543364`*^9, 
   3.7212769725608053`*^9}, {3.7212771239667177`*^9, 3.721277189610032*^9}, {
   3.7212777981810913`*^9, 3.721277807362966*^9}, {3.721277853833679*^9, 
   3.721277880064343*^9}, {3.721278532982346*^9, 3.721278536811804*^9}, {
   3.7212787015830793`*^9, 3.7212787104513187`*^9}, {3.7212788235180197`*^9, 
   3.7212788331278753`*^9}, {3.721347400712051*^9, 3.721347422259848*^9}, 
   3.721349121853903*^9, {3.72134922953473*^9, 3.721349266735911*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Evolution operator", "Subsection",
 CellChangeTimes->{{3.724571534914136*^9, 3.724571538690577*^9}}],

Cell[CellGroupData[{

Cell["SeriesSolutionData", "Subsubsection",
 CellChangeTimes->{{3.724571548922279*^9, 3.724571550234561*^9}, 
   3.724640781292286*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SeriesSolutionData", "::", "usage"}], "=", 
   "\"\<SeriesSolutionData[M,{x,x0,n}] constructs data for generalized power \
series solution of the system \[PartialD]U=M\[InvisibleComma]U.\\nGeneralized \
form: SeriesSolutionData[M,{x,y(x),n}].\\n    \[FilledSmallCircle] M should \
be rational.\\n    \[FilledSmallCircle] M should be Fuchsian at x=x0.\\n    \
\[FilledSmallCircle] Residue A at x=x0 should be free of resonances.\\n    \
\[FilledSmallCircle] SeriesSolutionData returns data U with the asymptotics \
(x-x0)^A.\\nReturned data has the form of a list with each element having the \
form {\[Lambda],\!\(\*SubscriptBox[\(K\), \
\(\[Lambda]\)]\),s,{\!\(\*SubscriptBox[\(T\), \(1\)]\),\!\(\*SubscriptBox[\(\
\[Ellipsis]T\), \(s\)]\)}&,C[\[Lambda],0..\!\(\*SubscriptBox[\(K\), \(\
\[Lambda]\)]\)]}.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SeriesSolutionData", "::", "notrat"}], "=", 
   "\"\<Matrix received is not rational in `1`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SeriesSolutionData", "::", "ppr"}], "=", 
   "\"\<Positive Poincare rank at `1`=`2`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SeriesSolutionData", "::", "res"}], "=", 
   "\"\<Resonant eigenvalues at `1`=`2`.\>\""}], ";"}]}], "Code",
 CellChangeTimes->{{3.724557508402412*^9, 3.724558074721662*^9}, {
   3.72455812291422*^9, 3.724558814710828*^9}, {3.72455888992773*^9, 
   3.7245589825760183`*^9}, {3.7245590772004757`*^9, 
   3.7245591559603024`*^9}, {3.724559209904621*^9, 3.724559247937273*^9}, {
   3.724559373945208*^9, 3.72455940613592*^9}, {3.724559442625133*^9, 
   3.724559475085046*^9}, {3.7245595388665953`*^9, 3.724559606321946*^9}, {
   3.724559645729691*^9, 3.7245597149249*^9}, {3.724561585835918*^9, 
   3.7245616608031807`*^9}, {3.72456170969158*^9, 3.7245617684596148`*^9}, {
   3.724562474632307*^9, 3.72456257722167*^9}, {3.72456265822805*^9, 
   3.724562718014233*^9}, {3.7245628691653223`*^9, 3.7245629379523287`*^9}, {
   3.724562992814644*^9, 3.7245630161590443`*^9}, {3.724563117895488*^9, 
   3.7245631277041283`*^9}, 3.7245631600093517`*^9, {3.7245633387911654`*^9, 
   3.724563458682171*^9}, {3.724564607726287*^9, 3.724564666050934*^9}, {
   3.724564711754243*^9, 3.7245647849147673`*^9}, {3.724564830587393*^9, 
   3.724564859442768*^9}, {3.724565099603634*^9, 3.724565115753808*^9}, {
   3.724565222899396*^9, 3.724565244027137*^9}, 3.724565424932281*^9, {
   3.724565625159061*^9, 3.724565658948978*^9}, {3.724565698884059*^9, 
   3.724565757684884*^9}, {3.7245665483380833`*^9, 3.724566684891971*^9}, {
   3.724566720110775*^9, 3.724566720277038*^9}, {3.724566751485877*^9, 
   3.724566754114599*^9}, {3.724566784421155*^9, 3.72456679339694*^9}, 
   3.7245668288608007`*^9, {3.724566894838122*^9, 3.724566915270524*^9}, {
   3.7245671216711617`*^9, 3.724567187991231*^9}, {3.724567494517847*^9, 
   3.7245675921055307`*^9}, {3.724567628169162*^9, 3.724567651904294*^9}, {
   3.724567708232789*^9, 3.724567804091051*^9}, {3.724567858939662*^9, 
   3.724567922434082*^9}, {3.7245679668361998`*^9, 3.7245679995243263`*^9}, {
   3.724568140297234*^9, 3.724568208342577*^9}, {3.724568716322772*^9, 
   3.724568725441989*^9}, {3.724568806382262*^9, 3.724568885799498*^9}, {
   3.724568931512005*^9, 3.724569031488839*^9}, {3.7245690888906307`*^9, 
   3.7245691773891973`*^9}, {3.724569296408826*^9, 3.724569355570747*^9}, {
   3.7245696223731318`*^9, 3.7245696682815332`*^9}, {3.724569701264073*^9, 
   3.724570030980846*^9}, {3.72457011910854*^9, 3.724570153534108*^9}, {
   3.724570217952458*^9, 3.724570233908577*^9}, {3.724571561262162*^9, 
   3.724571579733132*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ssd", "[", 
   RowBox[{
    RowBox[{"M_", "?", "SquareMatrixQ"}], ",", "y_", ",", "yv_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "pr", ",", "A", ",", "T", ",", "JF", ",", "x2A", ",", "p", ",", "fp", 
      ",", "Q", ",", "poles", ",", "qs", ",", "Bs", ",", "\[Lambda]", ",", 
      "tmp", ",", "\[IndentingNewLine]", "Rcoefs", ",", "rcoefs", ",", "n", 
      ",", "Rdata", ",", "\[IndentingNewLine]", 
      RowBox[{"statusline", "=", "\"\<\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"RatFuncQ", "[", 
           RowBox[{"M", ",", "y"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SeriesSolutionData", "::", "notrat"}], ",", "yv"}], 
           "]"}], ";", 
          RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"pr", "=", 
            RowBox[{"PoincareRank", "[", 
             RowBox[{"M", ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", "0"}], "}"}]}], "]"}]}], ")"}], ">", "0"}], 
         ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SeriesSolutionData", "::", "ppr"}], ",", "yv", ",", 
            "0"}], "]"}], ";", 
          RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"A", "=", 
        RowBox[{"SeriesCoefficient", "[", 
         RowBox[{"M", ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", "0", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"statusline", "=", "\"\<Reducing to Jordan form\>\""}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "JF"}], "}"}], "=", 
        RowBox[{"JDecomposition", "[", "A", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fp", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{"Length", "/@", "#"}], "]"}], "-", "1"}]}], "]"}], 
          "&"}], "/@", 
         RowBox[{"GatherBy", "[", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", 
            RowBox[{"Map", "[", 
             RowBox[{"First", ",", 
              RowBox[{"Split", "[", 
               RowBox[{
                RowBox[{"Transpose", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Diagonal", "[", "JF", "]"}], ",", 
                   RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"Diagonal", "[", 
                    RowBox[{"JF", ",", "1"}], "]"}], ",", "0"}], "]"}]}], 
                  "}"}], "]"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#1", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "=!=", "0"}], "&"}]}], 
               "]"}], ",", 
              RowBox[{"{", "2", "}"}]}], "]"}], "]"}], ",", "First"}], 
          "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Leading expansion terms:\\n\>\"", ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"(", 
           RowBox[{"Riffle", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"TraditionalForm", "[", 
                RowBox[{
                 SuperscriptBox["yv", "#1"], 
                 SuperscriptBox[
                  RowBox[{"Log", "[", "yv", "]"}], "#2"]}], "]"}], "&"}], "@@@",
               "fp"}], ",", "\"\<,\>\""}], "]"}], ")"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Factor", "[", 
            RowBox[{"Subtract", "@@@", 
             RowBox[{"Subsets", "[", 
              RowBox[{
               RowBox[{"First", "/@", "fp"}], ",", 
               RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}], ",", "_Integer"}], 
          "]"}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SeriesSolutionData", "::", "res"}], ",", "yv", ",", 
            "0"}], "]"}], ";", 
          RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Now", " ", "we", " ", "find", " ", "common", " ", "denominator", 
          " ", "Q"}], ",", " ", 
         RowBox[{"Eq", 
          RowBox[{"(", "6", ")"}], " ", "of", " ", "DESS", " ", "paper"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"statusline", "=", "\"\<Getting rid  of denominators\>\""}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"poles", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"PolesPosition", "[", 
           RowBox[{"M", ",", "y"}], "]"}], ",", 
          RowBox[{"\[Infinity]", "|", "0"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Q", "=", 
        RowBox[{"Times", "@@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"y", "-", "#"}], ")"}], "^", 
             RowBox[{"(", 
              RowBox[{"1", "+", 
               RowBox[{"PoincareRank", "[", 
                RowBox[{"M", ",", 
                 RowBox[{"{", 
                  RowBox[{"y", ",", "#"}], "}"}]}], "]"}]}], ")"}]}], "&"}], "/@",
            "poles"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"qs", "=", 
        RowBox[{"CoefficientList", "[", 
         RowBox[{"Q", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Bs", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Coefficient", "[", 
           RowBox[{
            RowBox[{"Factor", "[", 
             RowBox[{"Q", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"y", " ", "M"}], "-", 
                RowBox[{"\[Lambda]", " ", 
                 RowBox[{"IdentityMatrix", "[", 
                  RowBox[{"Length", "@", "M"}], "]"}]}]}], ")"}]}], "]"}], 
            ",", "y", ",", "#"}], "]"}], "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{"Length", "[", "qs", "]"}], "-", "1"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"statusline", "=", "\"\<Evaluating matrix exponent.\>\""}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"x2A", "=", 
        RowBox[{"Factor", "[", 
         RowBox[{
          RowBox[{"Factor", "[", 
           RowBox[{"T", ".", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Expand", "[", 
               RowBox[{
                RowBox[{"Expand", "[", 
                 RowBox[{
                  RowBox[{"Simplify", "[", 
                   RowBox[{"MatrixExp", "[", 
                    RowBox[{"JF", "*", 
                    RowBox[{"Log", "[", "y", "]"}]}], "]"}], "]"}], 
                  RowBox[{"p", "[", 
                   RowBox[{"0", ",", "0"}], "]"}]}], "]"}], "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Log", "[", "y", "]"}], "\[Rule]", 
                   RowBox[{"p", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}], ",", 
                  RowBox[{"y", "\[Rule]", 
                   RowBox[{"p", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], "}"}]}], "]"}], "//.", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"p", "[", 
                   RowBox[{"a_", ",", "b_"}], "]"}], "^", "c_"}], ":>", 
                 RowBox[{"p", "[", 
                  RowBox[{
                   RowBox[{"a", "*", "c"}], ",", 
                   RowBox[{"b", "*", "c"}]}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"p", "[", 
                   RowBox[{"a_", ",", "b_"}], "]"}], "*", 
                  RowBox[{"p", "[", 
                   RowBox[{"c_", ",", "d_"}], "]"}]}], ":>", 
                 RowBox[{"p", "[", 
                  RowBox[{
                   RowBox[{"a", "+", "c"}], ",", 
                   RowBox[{"b", "+", "d"}]}], "]"}]}]}], "}"}]}], ")"}]}], 
           "]"}], ".", 
          RowBox[{"InvertBlockTriangular", "[", "T", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
       "statusline", "=", "\"\<Evaluating recurrence coefficients.\>\""}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Rcoefs", "=", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Alpha]", ",", "k"}], "}"}], ",", 
          RowBox[{"Evaluate", "@", 
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"bjf", "[", 
               RowBox[{"#1", ",", 
                RowBox[{"#2", "*", 
                 RowBox[{"IdentityMatrix", "[", 
                  RowBox[{"Length", "@", "M"}], "]"}]}], ",", 
                RowBox[{"k", "+", "1"}]}], "]"}], "&"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"MapIndexed", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "/.", 
                    RowBox[{"{", 
                    RowBox[{"\[Lambda]", "\[Rule]", 
                    RowBox[{"\[Alpha]", "+", "n", "-", 
                    RowBox[{"First", "[", "#2", "]"}], "+", "1"}]}], "}"}]}], 
                   ")"}], "&"}], ",", "Bs"}], "]"}], ",", 
               RowBox[{"-", "qs"}]}], "}"}], ",", "1"}], "]"}]}]}], 
         RowBox[{"(*", 
          RowBox[{"Function", "[", 
           RowBox[{"n", ","}], "]"}], "*)"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Rdata", "=", 
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Alpha]", ",", "k"}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"statusline", "=", 
             RowBox[{
             "\"\<Evaluating recurrence coefficients for power: \>\"", "<>", 
              RowBox[{"ToString", "[", "\[Alpha]", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"rcoefs", "=", 
             RowBox[{"Rcoefs", "[", 
              RowBox[{"\[Alpha]", ",", "k"}], "]"}]}], 
            RowBox[{"(*", 
             RowBox[{"[", "n", "]"}], "*)"}], ";", "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"InvertBlockTriangular", "[", 
              RowBox[{"-", 
               RowBox[{"rcoefs", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "may", " ", "be", " ", "improved", " ", "by", " ", "dedicated", 
               " ", "calculation", " ", "of", " ", "inverse", " ", "of", " ", 
               "bjf", " ", "with", " ", "\[IndentingNewLine]", "off"}], "-", 
              RowBox[{
              "diagonal", " ", "terms", " ", "calculated", " ", "by", " ", 
               "iterative", " ", "multiplication", " ", "by"}], " ", "-", 
              RowBox[{
               RowBox[{"A", "^", 
                RowBox[{"(", 
                 RowBox[{"-", "1"}], ")"}]}], "B"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"\[Alpha]", ",", "k", ",", 
              RowBox[{
               RowBox[{"Length", "@", "rcoefs"}], "-", "1"}], 
              RowBox[{"(*", 
               RowBox[{"=", 
                RowBox[{"s", " ", "from", " ", "the", " ", "paper"}]}], 
               "*)"}], ",", 
              RowBox[{"Function", "@@", 
               RowBox[{"(", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"tmp", ".", "#"}], "]"}], "&"}], "/@", 
                   RowBox[{"Rest", "[", "rcoefs", "]"}]}], "/.", 
                  RowBox[{"n", "\[RuleDelayed]", 
                   RowBox[{"Slot", "[", "1", "]"}]}]}], "}"}], ")"}]}], ",", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Coefficient", "[", 
                   RowBox[{"x2A", ",", 
                    RowBox[{"p", "[", 
                    RowBox[{"\[Alpha]", ",", "#"}], "]"}]}], "]"}], "&"}], "/@", 
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", "k"}], "]"}]}], ",", "1"}], "]"}]}], 
             "}"}]}]}], "\[IndentingNewLine]", "]"}], "@@@", "fp"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "\"\<Series data is constructed.\>\"", "]"}], 
       ";", "\[IndentingNewLine]", "Rdata"}], "\[IndentingNewLine]", ",", 
      "statusline"}], "]"}]}], "]"}]}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Shortcuts", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SeriesSolutionData", "[", 
      RowBox[{
       RowBox[{"M_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"{", 
        RowBox[{"x_", ",", "\[Infinity]"}], "}"}]}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "z", "}"}], ",", 
       RowBox[{"ssd", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            SuperscriptBox["x", "2"]}], "M"}], "/.", 
          RowBox[{"{", 
           RowBox[{"x", "\[Rule]", 
            RowBox[{"1", "/", "z"}]}], "}"}]}], ",", "z", ",", 
         RowBox[{"1", "/", "x"}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SeriesSolutionData", "[", 
       RowBox[{
        RowBox[{"M_", "?", "SquareMatrixQ"}], ",", 
        RowBox[{"{", 
         RowBox[{"x_", ",", "x0_"}], "}"}]}], "]"}], "/;", 
      RowBox[{"FreeQ", "[", 
       RowBox[{"x0", ",", "x"}], "]"}]}], ":=", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "z", "}"}], ",", 
       RowBox[{"ssd", "[", 
        RowBox[{
         RowBox[{"M", "/.", 
          RowBox[{"{", 
           RowBox[{"x", "\[Rule]", 
            RowBox[{"z", "+", "x0"}]}], "}"}]}], ",", "z", ",", 
         RowBox[{"x", "-", "x0"}]}], "]"}]}], "]"}]}], ";"}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SeriesSolutionData", "[", 
      RowBox[{
       RowBox[{"M_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"{", 
        RowBox[{"x_", ",", "y_"}], "}"}]}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"z", ",", "xvar"}], "}"}], ",", 
       RowBox[{
        RowBox[{"xvar", "=", 
         RowBox[{"x", "/.", 
          RowBox[{"First", "[", 
           RowBox[{"Solve", "[", 
            RowBox[{
             RowBox[{"z", "\[Equal]", "y"}], ",", "x"}], "]"}], "]"}]}]}], 
        ";", 
        RowBox[{"ssd", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"M", " ", 
            RowBox[{"D", "[", 
             RowBox[{"xvar", ",", "z"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{"x", "\[Rule]", "xvar"}], "}"}]}], ",", "z", ",", "y"}], 
         "]"}]}]}], "]"}]}], ";"}]}]}]], "Code",
 CellChangeTimes->{{3.724557508402412*^9, 3.724558074721662*^9}, {
   3.72455812291422*^9, 3.724558814710828*^9}, {3.72455888992773*^9, 
   3.7245589825760183`*^9}, {3.7245590772004757`*^9, 
   3.7245591559603024`*^9}, {3.724559209904621*^9, 3.724559247937273*^9}, {
   3.724559373945208*^9, 3.72455940613592*^9}, {3.724559442625133*^9, 
   3.724559475085046*^9}, {3.7245595388665953`*^9, 3.724559606321946*^9}, {
   3.724559645729691*^9, 3.7245597149249*^9}, {3.724561585835918*^9, 
   3.7245616608031807`*^9}, {3.72456170969158*^9, 3.7245617684596148`*^9}, {
   3.724562474632307*^9, 3.72456257722167*^9}, {3.72456265822805*^9, 
   3.724562718014233*^9}, {3.7245628691653223`*^9, 3.7245629379523287`*^9}, {
   3.724562992814644*^9, 3.7245630161590443`*^9}, {3.724563117895488*^9, 
   3.7245631277041283`*^9}, 3.7245631600093517`*^9, {3.7245633387911654`*^9, 
   3.724563458682171*^9}, {3.724564607726287*^9, 3.724564666050934*^9}, {
   3.724564711754243*^9, 3.7245647849147673`*^9}, {3.724564830587393*^9, 
   3.724564859442768*^9}, {3.724565099603634*^9, 3.724565115753808*^9}, {
   3.724565222899396*^9, 3.724565244027137*^9}, 3.724565424932281*^9, {
   3.724565625159061*^9, 3.724565658948978*^9}, {3.724565698884059*^9, 
   3.724565757684884*^9}, {3.7245665483380833`*^9, 3.724566684891971*^9}, {
   3.724566720110775*^9, 3.724566720277038*^9}, {3.724566751485877*^9, 
   3.724566754114599*^9}, {3.724566784421155*^9, 3.72456679339694*^9}, 
   3.7245668288608007`*^9, {3.724566894838122*^9, 3.724566915270524*^9}, {
   3.7245671216711617`*^9, 3.724567187991231*^9}, {3.724567494517847*^9, 
   3.7245675921055307`*^9}, {3.724567628169162*^9, 3.724567651904294*^9}, {
   3.724567708232789*^9, 3.724567804091051*^9}, {3.724567858939662*^9, 
   3.724567922434082*^9}, {3.7245679668361998`*^9, 3.7245679995243263`*^9}, {
   3.724568140297234*^9, 3.724568208342577*^9}, {3.724568716322772*^9, 
   3.724568725441989*^9}, {3.724568806382262*^9, 3.724568885799498*^9}, {
   3.724568931512005*^9, 3.724569031488839*^9}, {3.7245690888906307`*^9, 
   3.7245691773891973`*^9}, {3.724569296408826*^9, 3.724569355570747*^9}, {
   3.7245696223731318`*^9, 3.7245696682815332`*^9}, {3.724569701264073*^9, 
   3.724570030980846*^9}, {3.72457011910854*^9, 3.724570153534108*^9}, {
   3.724570217952458*^9, 3.724570233908577*^9}, {3.724571561262162*^9, 
   3.724571579733132*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["ConstructSeriesSolution", "Subsubsection",
 CellChangeTimes->{{3.724571548922279*^9, 3.724571550234561*^9}, {
  3.724640781292286*^9, 3.724640791367264*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ConstructSeriesSolution", "::", "usage"}], "=", 
   "\"\<ConstructSeriesSolution[rdata_,{x_,o_}] makes a series solution out \
of rdata (see ?SeriesSolutionData for how to get rdata).\\n    o \[LongDash] \
order in x.\\nIf \
f=ConstructSeriesSolution[SeriesSolutionData[M,{x,0}],{x,o}], then one may \
check the equation by Factor[D[y,x]-M.y].\\nOptions:\\n    \
O\[Rule]True|False:False \[LongDash] whether to add O[x]^o\\n    \
Split\[Rule]True|False:False determines whether to split contribution of \
different fractional powers.\\nSince Mathematica treats generalized power \
series poorly, using options O\[Rule]True and Split\[Rule]False \
simultaneously is not recommended. If option Split\[Rule]True is used,  \
ConstructSeriesSolution returns the result as a rectangular matrix \
n\[Times](n*|S|), with each square n\[Times]n block corresponding to a \
specific fractional power.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConstructSeriesSolution", "::", "mixed"}], "=", 
   "\"\<Since Mathematica treats generalized power series poorly, using \
options O\[Rule]True and Split\[Rule]False simultaneously is not recommended.\
\>\""}], ";"}]}], "Code",
 CellChangeTimes->{{3.724573326363451*^9, 3.7245733284796352`*^9}, {
   3.724573568858251*^9, 3.724573577327174*^9}, {3.7245737085156384`*^9, 
   3.7245737105311003`*^9}, {3.724573931671966*^9, 3.724573936940535*^9}, {
   3.7245756357615547`*^9, 3.724575673796444*^9}, {3.72457603016895*^9, 
   3.724576080834341*^9}, 3.7245762034389763`*^9, {3.7245762511814737`*^9, 
   3.724576269916218*^9}, {3.724576353598178*^9, 3.724576355430125*^9}, {
   3.724576466062735*^9, 3.724576499924611*^9}, {3.7245843215414467`*^9, 
   3.72458434214403*^9}, {3.724632505149716*^9, 3.724632531086482*^9}, 
   3.7246326361913977`*^9, {3.72463274713177*^9, 3.724632770424951*^9}, {
   3.724632873073833*^9, 3.724632914641952*^9}, {3.7246329474436207`*^9, 
   3.7246329523254833`*^9}, {3.724633965244459*^9, 3.724633966759568*^9}, {
   3.7246340255676394`*^9, 3.724634063542871*^9}, {3.724634225102263*^9, 
   3.724634377569359*^9}, {3.7246345077384253`*^9, 3.724634542594706*^9}, {
   3.724634835663616*^9, 3.7246348391829777`*^9}, {3.724634883311021*^9, 
   3.724634902083248*^9}, {3.7246350290186996`*^9, 3.7246350384741497`*^9}, {
   3.724635116184773*^9, 3.724635145224298*^9}, {3.724635225320634*^9, 
   3.724635252288093*^9}, {3.724635292712303*^9, 3.7246354325198174`*^9}, 
   3.72463548811873*^9, {3.7246408395461903`*^9, 3.724641089440737*^9}, {
   3.724641448091117*^9, 3.7246414749870863`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ConstructSeriesSolution", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"O", "\[Rule]", "False"}], ",", 
     RowBox[{"Split", "\[Rule]", "False"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.72464079492304*^9, 3.724640823265443*^9}, 
   3.724641237650147*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ConstructSeriesSolution", "[", 
   RowBox[{"rdata_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "o_"}], "}"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", ",", "n", ",", "sdata", ",", 
      RowBox[{"sf", "=", "Factor"}], ",", 
      RowBox[{"Oo", "=", 
       RowBox[{"TrueQ", "@", 
        RowBox[{"OptionValue", "[", "O", "]"}]}]}], ",", 
      RowBox[{"So", "=", 
       RowBox[{"TrueQ", "@", 
        RowBox[{"OptionValue", "[", "Split", "]"}]}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Oo", "&&", 
        RowBox[{"!", "So"}]}], ",", 
       RowBox[{"Message", "[", 
        RowBox[{"ConstructSeriesSolution", "::", "mixed"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Oo", "=", 
      RowBox[{"If", "[", 
       RowBox[{"Oo", ",", 
        RowBox[{
         SuperscriptBox["x", "o"], 
         RowBox[{"O", "[", "x", "]"}]}], ",", "0"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sdata", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"lp", ",", "llp", ",", "M", ",", "coefs", ",", "init"}], 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"c", "[", 
             RowBox[{"lp", ",", "0"}], "]"}], "=", "init"}], ";", 
           RowBox[{
            RowBox[{"c", "[", 
             RowBox[{"lp", ",", 
              RowBox[{"n_Integer", "?", "Positive"}]}], "]"}], ":=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Quiet", "[", 
               RowBox[{"Unset", "[", 
                RowBox[{"c", "[", 
                 RowBox[{"n", "-", "M", "-", "1"}], "]"}], "]"}], "]"}], ";", 
              RowBox[{"(*", 
               RowBox[{"clean", " ", "up"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"lp", ",", "n"}], "]"}], "=", 
               RowBox[{"sf", "@", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"coefs", "[", "n", "]"}], "[", 
                    RowBox[{"[", "m", "]"}], "]"}], ".", 
                   RowBox[{"c", "[", 
                    RowBox[{"lp", ",", 
                    RowBox[{"n", "-", "m"}]}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"m", ",", 
                    RowBox[{"Min", "[", 
                    RowBox[{"M", ",", "n"}], "]"}]}], "}"}]}], "]"}]}]}]}], 
             ")"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"x", "^", "lp"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   FractionBox[
                    RowBox[{
                    RowBox[{"Log", "[", "x", "]"}], "^", "#"}], 
                    RowBox[{"#", "!"}]], ")"}], "&"}], "/@", 
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", "llp"}], "]"}]}], ")"}], ".", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Partition", "[", 
                   RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Length", "@", "#"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"llp", "+", "1"}], ")"}]}]}], "]"}], "&"}], "[", 
                 RowBox[{"Sum", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"lp", ",", "n"}], "]"}], "*", 
                    SuperscriptBox["x", "n"]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"n", ",", "0", ",", "o"}], "}"}]}], "]"}], "]"}], 
                ")"}]}], "+", "Oo"}], ")"}]}]}]}], "\[IndentingNewLine]", 
         "]"}], "@@@", "rdata"}], ")"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"So", ",", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", "sdata", "}"}], "]"}], ",", 
       RowBox[{"Plus", "@@", "sdata"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.724573326363451*^9, 3.7245733284796352`*^9}, {
   3.724573568858251*^9, 3.724573577327174*^9}, {3.7245737085156384`*^9, 
   3.7245737105311003`*^9}, {3.724573931671966*^9, 3.724573936940535*^9}, {
   3.7245756357615547`*^9, 3.724575673796444*^9}, {3.72457603016895*^9, 
   3.724576080834341*^9}, 3.7245762034389763`*^9, {3.7245762511814737`*^9, 
   3.724576269916218*^9}, {3.724576353598178*^9, 3.724576355430125*^9}, {
   3.724576466062735*^9, 3.724576499924611*^9}, {3.7245843215414467`*^9, 
   3.72458434214403*^9}, {3.724632505149716*^9, 3.724632531086482*^9}, 
   3.7246326361913977`*^9, {3.72463274713177*^9, 3.724632770424951*^9}, {
   3.724632873073833*^9, 3.724632914641952*^9}, {3.7246329474436207`*^9, 
   3.7246329523254833`*^9}, {3.724633965244459*^9, 3.724633966759568*^9}, {
   3.7246340255676394`*^9, 3.724634063542871*^9}, {3.724634225102263*^9, 
   3.724634377569359*^9}, {3.7246345077384253`*^9, 3.724634542594706*^9}, {
   3.724634835663616*^9, 3.7246348391829777`*^9}, {3.724634883311021*^9, 
   3.724634902083248*^9}, {3.7246350290186996`*^9, 3.7246350384741497`*^9}, {
   3.724635116184773*^9, 3.724635145224298*^9}, {3.724635225320634*^9, 
   3.724635252288093*^9}, {3.724635292712303*^9, 3.7246354325198174`*^9}, 
   3.72463548811873*^9, {3.724641128388451*^9, 3.724641171980044*^9}, {
   3.7246412059919653`*^9, 3.7246412069638653`*^9}, {3.724641258484334*^9, 
   3.724641316031949*^9}, {3.724641400932399*^9, 3.7246414415906343`*^9}, {
   3.72464148251169*^9, 3.724641484940824*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Pexp", "Subsubsection",
 CellChangeTimes->{{3.724571541802348*^9, 3.7245715423225317`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Pexp", "::", "usage"}], "=", 
  "\"\<Pexp[{M,n},x] gives the perturbative expansion of the \
\!\(TraditionalForm\`Pexp[\[Integral]dx\\\ M]\) in \!\(TraditionalForm\`M\) \
up to the term \!\(TraditionalForm\`\(\(\[Proportional]\)\*SuperscriptBox[\(M\
\), \(n\)]\)\) in terms of the iterated integrals \
\!\(TraditionalForm\`II[{\*SubscriptBox[\(a\), \(n\)], \*SubscriptBox[\(a\), \
\(n - 1\)], \*SubscriptBox[\(\[Ellipsis]a\), \(1\)]}, x] = \
\(\*UnderscriptBox[\(\[Integral]\[Ellipsis] \[Integral]\), \
\(\*SubscriptBox[\(x\), \(0\)] < \*SubscriptBox[\(x\), \(1\)] < \
\*SubscriptBox[\(\[Ellipsis]x\), \(n\)] < x\)] \*FractionBox[\(\
\[DifferentialD]\*SubscriptBox[\(x\), \(n\)]\), \(\*SubscriptBox[\(x\), \
\(n\)] - \*SubscriptBox[\(a\), \(n\)]\)] \(\[Ellipsis]\) \*FractionBox[\(\
\[DifferentialD]\*SubscriptBox[\(x\), \(1\)]\), \(\*SubscriptBox[\(x\), \
\(1\)] - \*SubscriptBox[\(a\), \(1\)]\)]\(\\\ \)\)\), where \
\!\(TraditionalForm\`\*SubscriptBox[\(x\), \(0\)]\) is arbitrary \
(\!\(TraditionalForm\`with\\\ convention\\\ II[{}, x] = 1\)).\>\""}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Pexp", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"M_", "?", "MatrixQ"}], ",", "n_Integer"}], "}"}], ",", 
    "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"p", "=", 
       RowBox[{"PolesInfo", "[", 
        RowBox[{"M", ",", "x"}], "]"}]}], ",", "op", ",", "res", ",", "w", 
      ",", 
      RowBox[{"i", "=", "0"}], ",", "t"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"MatchQ", "[", 
         RowBox[{"p", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"_", ",", "0"}], "}"}], "..."}], "}"}]}], "]"}], "]"}], 
       ",", 
       RowBox[{"Abort", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"p", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"First", "/@", "p"}], ",", "\[Infinity]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"op", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"SeriesCoefficient", "[", 
            RowBox[{"M", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "#", ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}], 
           RowBox[{"w", "[", "#", "]"}]}], "&"}], "/@", "p"}], ")"}]}]}], ";",
      " ", 
     RowBox[{"(*", "operator", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"res", "=", 
        RowBox[{"NestList", "[", 
         RowBox[{
          RowBox[{"Function", "[", 
           RowBox[{"pr", ",", 
            RowBox[{
             RowBox[{"i", "++"}], ";", 
             RowBox[{"t", "=", 
              RowBox[{"Expand", "[", 
               RowBox[{"op", ".", "pr"}], "]"}]}], ";", 
             RowBox[{"Plus", "@@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Coefficient", "[", 
                    RowBox[{"t", ",", 
                    RowBox[{"w", "[", "#", "]"}]}], "]"}], "/.", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"II", "[", 
                    RowBox[{
                    RowBox[{"{", "a___", "}"}], ",", "x"}], "]"}], ":>", 
                    RowBox[{"II", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", "a"}], "}"}], ",", "x"}], "]"}]}], 
                    "}"}]}], ")"}], "&"}], "/@", "p"}], ")"}]}]}]}], "]"}], 
          ",", 
          RowBox[{
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"Length", "@", "M"}], "]"}], "*", 
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", "x"}], "]"}]}], ",", "n"}], "]"}]}], 
       ",", "\[IndentingNewLine]", "i"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{3.688627609165856*^9, 3.722927706380597*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Pexp", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"M_", "?", "MatrixQ"}], ",", "n_Integer"}], "}"}], ",", 
    "x_Symbol", ",", "x0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"p", "=", 
       RowBox[{"PolesInfo", "[", 
        RowBox[{"M", ",", "x"}], "]"}]}], ",", "op", ",", "res", ",", "w", 
      ",", 
      RowBox[{"i", "=", "0"}], ",", "t"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"MatchQ", "[", 
         RowBox[{"p", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"_", ",", "0"}], "}"}], "..."}], "}"}]}], "]"}], "]"}], 
       ",", 
       RowBox[{"Abort", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"p", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"First", "/@", "p"}], ",", "\[Infinity]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"op", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"SeriesCoefficient", "[", 
            RowBox[{"M", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "#", ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}], 
           RowBox[{"w", "[", "#", "]"}]}], "&"}], "/@", "p"}], ")"}]}]}], ";",
      " ", 
     RowBox[{"(*", "operator", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"res", "=", 
        RowBox[{"NestList", "[", 
         RowBox[{
          RowBox[{"Function", "[", 
           RowBox[{"pr", ",", 
            RowBox[{
             RowBox[{"i", "++"}], ";", 
             RowBox[{"t", "=", 
              RowBox[{"Expand", "[", 
               RowBox[{"op", ".", "pr"}], "]"}]}], ";", 
             RowBox[{"Plus", "@@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Coefficient", "[", 
                    RowBox[{"t", ",", 
                    RowBox[{"w", "[", "#", "]"}]}], "]"}], "/.", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"II", "[", 
                    RowBox[{
                    RowBox[{"{", "a___", "}"}], ",", "x", ",", "x0"}], "]"}], 
                    ":>", 
                    RowBox[{"II", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", "a"}], "}"}], ",", "x", ",", "x0"}], 
                    "]"}]}], "}"}]}], ")"}], "&"}], "/@", "p"}], ")"}]}]}]}], 
           "]"}], ",", 
          RowBox[{
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"Length", "@", "M"}], "]"}], "*", 
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", "x", ",", "x0"}], "]"}]}], ",", "n"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "i"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.724635829096835*^9, 3.724635851970018*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Transformations", "Subsection",
 CellChangeTimes->{{3.719625063544799*^9, 3.719625093593342*^9}}],

Cell[CellGroupData[{

Cell["Transform", "Subsubsection",
 CellChangeTimes->{{3.719625098265142*^9, 3.7196251000569*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "::", "usage"}], "=", "\"\<Transform[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"t\", \"TI\"]\)] gives the matrix Inverse[\!\(\*
StyleBox[\"t\", \"TI\"]\)].\!\(\*
StyleBox[\"m\", \"TI\"]\).\!\(\*
StyleBox[\"t\", \"TI\"]\).\\nTransform[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"t\", \"TI\",
FontSize->12]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] gives the matrix Inverse[\!\(\*
StyleBox[\"t\", \"TI\"]\)].(\!\(\*
StyleBox[\"m\", \"TI\"]\).\!\(\*
StyleBox[\"t\", \"TI\"]\)-D[\!\(\*
StyleBox[\"t\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)]).\\nTransform[\!\(\*
StyleBox[\"ds\", \"TI\"]\),\!\(\*
StyleBox[\"t\", \"TI\",
FontSize->12]\)] transforms the differential system.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.6241193067348537`*^9, 3.62411947432415*^9}, {
   3.6248634015535283`*^9, 3.6248634028874145`*^9}, 3.719735107645936*^9, {
   3.719735376631898*^9, 3.719735501319456*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "Transform", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Simplify", "\[Rule]", "Factor"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721483414275229*^9, 3.721483467072748*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "t_", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Factor", "[", 
    RowBox[{
     RowBox[{"InvertBlockTriangular", "@", "t"}], ".", 
     RowBox[{"Factor", "[", 
      RowBox[{"m", ".", "t"}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "t_", ",", "x_Symbol", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Factor", "[", 
    RowBox[{
     RowBox[{"InvertBlockTriangular", "@", "t"}], ".", 
     RowBox[{"Factor", "[", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"m", ".", "t"}], "-", 
        RowBox[{"D", "[", 
         RowBox[{"t", ",", "x"}], "]"}]}], ")"}], "]"}]}], "]"}]}], 
  ";"}]}], "Code",
 CellChangeTimes->{{3.6815607314098253`*^9, 3.681560732640131*^9}, 
   3.681560781682559*^9, {3.688219597862361*^9, 3.6882196008450737`*^9}, {
   3.6995735250441837`*^9, 3.699573553060525*^9}, {3.7197351828234453`*^9, 
   3.719735193158778*^9}, {3.719735321016797*^9, 3.719735356752213*^9}, {
   3.719740294405547*^9, 3.719740298285572*^9}, {3.72015607716747*^9, 
   3.720156078643066*^9}, {3.720185674158463*^9, 3.720185686304554*^9}, {
   3.72121798590963*^9, 3.721217993542419*^9}, {3.721256337085271*^9, 
   3.7212563405543213`*^9}, {3.721542970513906*^9, 3.721542973048395*^9}, {
   3.7215430377310343`*^9, 3.721543065279414*^9}, {3.721543136256091*^9, 
   3.721543148834846*^9}, {3.721543223225543*^9, 3.72154322461392*^9}, {
   3.721543316455496*^9, 3.7215433381935453`*^9}, {3.721543452575382*^9, 
   3.721543463970635*^9}, {3.721543526079637*^9, 3.721543542482067*^9}, {
   3.7230497131601963`*^9, 3.723049732046091*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "t_", ",", "x_Symbol", ",", 
     RowBox[{"ii", ":", 
      RowBox[{"{", "__Integer", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"mt", "=", "m"}], ",", "jj", ",", 
       RowBox[{"ti", "=", 
        RowBox[{"InvertBlockTriangular", "@", "t"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"mt", "[", 
        RowBox[{"[", 
         RowBox[{"ii", ",", "ii"}], "]"}], "]"}], "=", 
       RowBox[{"Factor", "[", 
        RowBox[{"ti", ".", 
         RowBox[{"Factor", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"mt", "[", 
             RowBox[{"[", 
              RowBox[{"ii", ",", "ii"}], "]"}], "]"}], ".", "t"}], "-", 
           RowBox[{"D", "[", 
            RowBox[{"t", ",", "x"}], "]"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"jj", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"DependentColumnIndices", "[", 
          RowBox[{"m", ",", "ii"}], "]"}], ",", "ii"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"jj", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{
         RowBox[{"mt", "[", 
          RowBox[{"[", 
           RowBox[{"jj", ",", "ii"}], "]"}], "]"}], "=", 
         RowBox[{"Factor", "[", 
          RowBox[{
           RowBox[{"mt", "[", 
            RowBox[{"[", 
             RowBox[{"jj", ",", "ii"}], "]"}], "]"}], ".", "t"}], "]"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"jj", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"DependentRowIndices", "[", 
          RowBox[{"mt", ",", "ii"}], "]"}], ",", "ii"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"jj", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{
         RowBox[{"mt", "[", 
          RowBox[{"[", 
           RowBox[{"ii", ",", "jj"}], "]"}], "]"}], "=", 
         RowBox[{"Factor", "[", 
          RowBox[{"ti", ".", 
           RowBox[{"mt", "[", 
            RowBox[{"[", 
             RowBox[{"ii", ",", "jj"}], "]"}], "]"}]}], "]"}]}]}], "]"}], ";",
       "\[IndentingNewLine]", "mt"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.720185570275117*^9, 3.720185580608985*^9}, {
   3.7201856474956417`*^9, 3.720185655554455*^9}, {3.720185707573469*^9, 
   3.720186044726626*^9}, 3.720186114098737*^9, {3.7212179946329317`*^9, 
   3.72121799862738*^9}, 3.721256344617486*^9, {3.721483535827744*^9, 
   3.721483554941432*^9}, {3.721542536863422*^9, 3.7215425417583723`*^9}, 
   3.721542957775893*^9, 3.721543469672751*^9, {3.721543505271758*^9, 
   3.7215435194237223`*^9}, {3.722042010051371*^9, 3.7220420450511227`*^9}, {
   3.723049761675005*^9, 3.723049766127157*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Transform", "[", 
   RowBox[{"as_Association", ",", 
    RowBox[{"t_", "?", "SquareMatrixQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", "=", "as"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m", "[", "#", "]"}], "=", 
         RowBox[{"Transform", "[", 
          RowBox[{
           RowBox[{"m", "[", "#", "]"}], ",", "t", ",", "#"}], "]"}]}], ")"}],
        "&"}], "/@", 
      RowBox[{"Keys", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", "m"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.720185181379047*^9, 3.7201851975812817`*^9}, {
  3.720185235826391*^9, 3.72018525470667*^9}, {3.721543479975932*^9, 
  3.721543502118628*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Transform", "[", 
   RowBox[{"as_Association", ",", 
    RowBox[{"t_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"ii", ":", 
     RowBox[{"{", "__Integer", "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", "=", "as"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m", "[", "#", "]"}], "=", 
         RowBox[{"Transform", "[", 
          RowBox[{
           RowBox[{"m", "[", "#", "]"}], ",", "t", ",", "#", ",", "ii"}], 
          "]"}]}], ")"}], "&"}], "/@", 
      RowBox[{"Keys", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", "m"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.7220422326030407`*^9, 3.722042243427289*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Transform", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"t_", "?", "SquareMatrixQ"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", "=", 
      RowBox[{"ds", "[", 
       RowBox[{"[", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m", "[", "#", "]"}], "=", 
         RowBox[{"Transform", "[", 
          RowBox[{
           RowBox[{"m", "[", "#", "]"}], ",", "t", ",", "#"}], "]"}]}], ")"}],
        "&"}], "/@", 
      RowBox[{"Keys", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"HistoryAppend", "[", 
      RowBox[{"ds", ",", 
       RowBox[{"{", 
        RowBox[{"m", ",", 
         RowBox[{"{", 
          RowBox[{"Transform", ",", "ds", ",", "t"}], "}"}]}], "}"}]}], "]"}],
      ";", "\[IndentingNewLine]", "m"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.719735223396736*^9, 3.719735259907769*^9}, {
   3.719735312345055*^9, 3.719735315305272*^9}, {3.7197355211750183`*^9, 
   3.7197355640958557`*^9}, {3.719735674728415*^9, 3.7197357863550053`*^9}, 
   3.719740300293317*^9, {3.7201411239993143`*^9, 3.720141134999669*^9}, {
   3.720184797462756*^9, 3.720184798374112*^9}, 3.7213544145767307`*^9, {
   3.7220422631321774`*^9, 3.722042265227564*^9}, {3.722046083369658*^9, 
   3.722046084073625*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Transform", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"t_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"ii", ":", 
     RowBox[{"{", "__Integer", "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"m", "=", 
       RowBox[{"ds", "[", 
        RowBox[{"[", "]"}], "]"}]}], ",", 
      RowBox[{"tf", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "ds"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Check", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"tf", "[", 
          RowBox[{"[", 
           RowBox[{"ii", ",", "ii"}], "]"}], "]"}], "=", "t"}], ";"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"Transform", "::", "wrng"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m", "[", "#", "]"}], "=", 
         RowBox[{"Transform", "[", 
          RowBox[{
           RowBox[{"m", "[", "#", "]"}], ",", "t", ",", "#", ",", "ii"}], 
          "]"}]}], ")"}], "&"}], "/@", 
      RowBox[{"Keys", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"HistoryAppend", "[", 
      RowBox[{"ds", ",", 
       RowBox[{"{", 
        RowBox[{"m", ",", 
         RowBox[{"{", 
          RowBox[{"Transform", ",", "ds", ",", "tf"}], "}"}]}], "}"}]}], 
      "]"}], ";", "\[IndentingNewLine]", "m"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.720186107135697*^9, 3.720186122750183*^9}, {
   3.720186177563759*^9, 3.720186286838661*^9}, 3.721354416433528*^9, {
   3.72204607720251*^9, 3.722046078329948*^9}}],

Cell["apply transformation to indices ii", "Text",
 CellChangeTimes->{{3.720184670359459*^9, 3.7201846837399178`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["ChangeVar", "Subsubsection",
 CellChangeTimes->{
  3.720049040796907*^9, {3.720049528522545*^9, 3.7200495292422533`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ChangeVar", "::", "usage"}], "=", 
   "\"\<ChangeVar[ds,{rules},{vars}] changes variable in the matrix.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7200490307179737`*^9, 3.720049057101372*^9}, {
   3.7201500171871643`*^9, 3.720150052250917*^9}, 3.721394862529975*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ChangeVar", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_", "\[Rule]", "xviay_"}], ",", "y_"}], "]"}], ":=", 
  RowBox[{"Factor", "[", 
   RowBox[{
    RowBox[{"m", " ", 
     RowBox[{"D", "[", 
      RowBox[{"xviay", ",", "y"}], "]"}]}], "/.", 
    RowBox[{"x", "\[Rule]", "xviay"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.720049266414578*^9, 3.720049335912871*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ChangeVar", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"rs", ":", 
     RowBox[{"{", "__Rule", "}"}]}], ",", 
    RowBox[{"ys", ":", 
     RowBox[{"{", "__", "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"keys", "=", 
       RowBox[{"Keys", "[", 
        RowBox[{"ds", "[", 
         RowBox[{"[", "]"}], "]"}], "]"}]}], ",", "M"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"M", "=", 
      RowBox[{"Association", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{"y", ",", 
           RowBox[{"y", "\[Rule]", 
            RowBox[{"Plus", "@@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"D", "[", 
                    RowBox[{
                    RowBox[{"#1", "/.", "rs"}], ",", "y"}], "]"}], 
                   RowBox[{"ds", "[", "#1", "]"}]}], "/.", "rs"}], ")"}], 
                "&"}], "/@", "keys"}], ")"}]}]}]}], "]"}], "/@", "ys"}], 
        ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"HistoryAppend", "[", 
      RowBox[{"ds", ",", 
       RowBox[{"{", 
        RowBox[{"M", ",", 
         RowBox[{"{", 
          RowBox[{"ChangeVar", ",", "ds", ",", "rs", ",", "ys"}], "}"}]}], 
        "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Protect", "/@", "ys"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ds", "[", 
      RowBox[{"[", "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.720049172509068*^9, 3.720049177085397*^9}, {
   3.72004935972816*^9, 3.720049403617365*^9}, {3.7200494376584473`*^9, 
   3.720049518529355*^9}, {3.7200496809709253`*^9, 3.720049704625965*^9}, {
   3.720141149019167*^9, 3.720141183071988*^9}, 3.721354418144759*^9, {
   3.721725732454885*^9, 3.721725732725091*^9}, {3.723161710214497*^9, 
   3.723161715284008*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["A0ToSubspaces", "Subsubsection",
 CellChangeTimes->{{3.721360998471558*^9, 3.721360999389097*^9}, {
   3.721361076360333*^9, 3.721361081804851*^9}, 3.7213615766059017`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0ToSubspaces", "::", "usage"}], "=", 
   "\"\<A0ToSubspaces[A0,\[Epsilon]\[Rule]0,Left|Right] gives the subspaces \
which may be used for the construction of the projectors for the balances \
with positive gains.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721361000170269*^9, 3.721361007685678*^9}, {
   3.721361064718129*^9, 3.721361069149362*^9}, {3.721361140008924*^9, 
   3.721361144206258*^9}, {3.721361554105781*^9, 3.721361556999352*^9}, {
   3.721362373317321*^9, 3.7213623848003883`*^9}, {3.721370151103218*^9, 
   3.721370155319121*^9}, 3.722554987608057*^9, {3.722555154203495*^9, 
   3.722555154339348*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"A0ToSubspaces", "[", 
   RowBox[{
    RowBox[{"A0_", "?", "SquareMatrixQ"}], ",", "rules_", ",", 
    RowBox[{"side", ":", 
     RowBox[{"(", 
      RowBox[{"Left", "|", "Right"}], ")"}], ":", "Left"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"l", "=", 
       RowBox[{"Length", "@", "A0"}]}], ",", "jdata"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"jdata", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Factor", "[", "#1", "]"}], "/.", "rules"}], ",", "##2"}], 
         "}"}], "&"}], "@@@", 
       RowBox[{"JDecompositionData", "@", "A0"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"side", "===", "Right"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"jdata", ",", 
            RowBox[{
             RowBox[{"TrueQ", "[", 
              RowBox[{"Positive", "[", 
               RowBox[{"First", "@", "#"}], "]"}], "]"}], "&"}]}], "]"}], ",",
           "First"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Transpose", "/@"}], "*)"}], 
       RowBox[{
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"jdata", ",", 
            RowBox[{
             RowBox[{"TrueQ", "[", 
              RowBox[{"Negative", "[", 
               RowBox[{"First", "@", "#"}], "]"}], "]"}], "&"}]}], "]"}], ",",
           "First"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.721363166786539*^9, 3.7213631736998463`*^9}, {
   3.72136445479079*^9, 3.7213646630148077`*^9}, {3.721364730438281*^9, 
   3.721364757494755*^9}, {3.721364789202026*^9, 3.721364865999148*^9}, {
   3.721364922785144*^9, 3.721364965203183*^9}, 3.72136501902316*^9, {
   3.721370217416032*^9, 3.7213702828663054`*^9}, {3.721682792197624*^9, 
   3.721682801272009*^9}, 3.7216828931554947`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["A0A1ToSubspaces", "Subsubsection",
 CellChangeTimes->{{3.721360998471558*^9, 3.721360999389097*^9}, {
  3.721361076360333*^9, 3.721361081804851*^9}}],

Cell[TextData[{
 "Let us consider Laurent expansion of the matrix ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    RowBox[{"M", "(", "x", ")"}], "TI"], TraditionalForm]]],
 " in the vicinity of singular point ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["x", "0"], TraditionalForm]]],
 " (for simplicity we assume that ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["x", "0"], "=", "0"}], TraditionalForm]], "TI"],
 "):"
}], "Text",
 CellChangeTimes->{{3.689317466485443*^9, 3.68931757667124*^9}}],

Cell[BoxData[
 FormBox[
  RowBox[{
   RowBox[{"M", "(", "x", ")"}], "=", 
   RowBox[{
    RowBox[{
     FractionBox[
      StyleBox[
       SubscriptBox["A", "0"],
       FontColor->RGBColor[0, 0, 1]], 
      SuperscriptBox["x", 
       RowBox[{"p", "+", "1"}]]], "+", 
     FractionBox[
      StyleBox[
       SubscriptBox["A", "1"],
       FontColor->RGBColor[0., 0.6666666666666666, 1.]], 
      SuperscriptBox["x", "p"]], "+", 
     RowBox[{"\[Ellipsis]", "   ", "with", " ", "p"}]}], ">", "0"}]}], 
  TraditionalForm]], "DisplayFormula",
 CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
   3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
   3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
   3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
   3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
   3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
   3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
   3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
   3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
   3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
   3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
   3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
   3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
   3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
   3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
   3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
   3.689318439104671*^9}, 3.689320101557584*^9},
 TextAlignment->Center],

Cell[TextData[{
 "A simple necessary criterion of possibility to lower the Poincare rank",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["", 
    StyleBox["*",
     FontColor->RGBColor[1, 0, 0]]], TraditionalForm]],
  FontSize->24],
 " ",
 Cell[BoxData[
  FormBox["p", TraditionalForm]], "TI"],
 " is the requirement that ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["A", "0"],
    FontColor->RGBColor[0, 0, 1]], TraditionalForm]], "TI"],
 " is nilpotent.\nJ. Moser in his 1960 paper gave a more subtle necessary \
criterion:"
}], "Text",
 CellChangeTimes->{{3.6893188947553873`*^9, 3.689318963938943*^9}, {
   3.689319015651376*^9, 3.689319026483388*^9}, {3.6893191315989227`*^9, 
   3.689319147185334*^9}, {3.6893193165877047`*^9, 3.689319326474041*^9}, 
   3.689405925419014*^9}],

Cell[BoxData[
 FormBox[
  RowBox[{
   RowBox[{
    UnderscriptBox["lim", 
     RowBox[{"x", "\[Rule]", "0"}]], 
    RowBox[{
     SuperscriptBox["x", "r"], 
     RowBox[{"det", "[", 
      RowBox[{
       FractionBox[
        StyleBox[
         SubscriptBox["A", "0"],
         FontColor->RGBColor[0, 0, 1]], "x"], "+", 
       StyleBox[
        SubscriptBox["A", "1"],
        FontColor->RGBColor[0., 0.6666666666666666, 1.]], "-", 
       "\[DoubleStruckCapitalI]\[Lambda]"}], "]"}]}]}], "=", "0"}], 
  TraditionalForm]], "DisplayFormula",
 CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
   3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
   3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
   3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
   3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
   3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
   3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
   3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
   3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
   3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
   3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
   3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
   3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
   3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
   3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
   3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
   3.689318439104671*^9}, {3.689318572100049*^9, 3.689318696203093*^9}, {
   3.689318836608609*^9, 3.6893188372646017`*^9}, 3.689319534194511*^9, 
   3.689319648067197*^9, 3.721370593351315*^9},
 TextAlignment->Center],

Cell[TextData[{
 "for any ",
 Cell[BoxData[
  FormBox["\[Lambda]", TraditionalForm]], "TI"],
 ". Here ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"r", "=", "rank"}], "\[InvisibleComma]", 
    StyleBox[
     SubscriptBox["A", "0"],
     FontColor->RGBColor[0, 0, 1]]}], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, {3.689318572100049*^9, 3.689318696203093*^9}, {
    3.689318836608609*^9, 3.6893188372646017`*^9}},
  TextAlignment->Center],
 " is the matrix rank of the matrix ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["A", "0"],
    FontColor->RGBColor[0, 0, 1]], TraditionalForm]], "TI"],
 "."
}], "Text",
 CellChangeTimes->{{3.689319161908135*^9, 3.689319216187067*^9}, {
   3.6893192818460093`*^9, 3.689319353195269*^9}, {3.689319537289925*^9, 
   3.6893195527705183`*^9}, 3.689405928515492*^9}],

Cell["It can be reformulated as the requirement", "Text",
 CellChangeTimes->{{3.689318668813882*^9, 3.689318675929102*^9}, 
   3.689318928784409*^9, {3.689319390400855*^9, 3.689319464345278*^9}}],

Cell[BoxData[
 FormBox[
  RowBox[{
   RowBox[{
    RowBox[{"dim", "\[ThinSpace]", 
     RowBox[{"ker", "(", "\[NoBreak]", GridBox[{
        {
         StyleBox[
          SubscriptBox["A", "0"],
          FontColor->RGBColor[0, 0, 1]], 
         RowBox[{
          StyleBox[
           SubscriptBox["A", "1"],
           FontColor->RGBColor[0., 0.6666666666666666, 1.]], "-", 
          "\[DoubleStruckCapitalI]\[Lambda]"}]},
        {"0", 
         StyleBox[
          SubscriptBox["A", "0"],
          FontColor->RGBColor[0, 0, 1]]}
       }], "\[NoBreak]", ")"}]}], 
    StyleBox[">",
     FontColor->RGBColor[1, 0.5, 0]], 
    RowBox[{"dim", "\[ThinSpace]", "ker", " ", 
     StyleBox[
      SubscriptBox["A", "0"],
      FontColor->RGBColor[0, 0, 1]]}]}], "=", 
   RowBox[{"n", "-", 
    RowBox[{"r", "."}]}]}], TraditionalForm]], "DisplayFormula",
 CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
   3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
   3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
   3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
   3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
   3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
   3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
   3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
   3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
   3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
   3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
   3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
   3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
   3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
   3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
   3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
   3.689318439104671*^9}, {3.689318572100049*^9, 3.689318696203093*^9}, {
   3.689318836608609*^9, 3.6893188372646017`*^9}, {3.689319474977869*^9, 
   3.689319516195022*^9}, {3.6893195737226*^9, 3.689319589033684*^9}, 
   3.689319663626377*^9, {3.689340080360899*^9, 3.689340095448152*^9}, 
   3.721370595078619*^9},
 TextAlignment->Center],

Cell[TextData[{
 " Here ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"r", "=", "rank"}], "\[InvisibleComma]", 
    StyleBox[
     SubscriptBox["A", "0"],
     FontColor->RGBColor[0, 0, 1]]}], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, {3.689318572100049*^9, 3.689318696203093*^9}, {
    3.689318836608609*^9, 3.6893188372646017`*^9}},
  TextAlignment->Center],
 " and ",
 Cell[BoxData[
  FormBox["n", TraditionalForm]], "TI"],
 " is the size of ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["A", "0"],
    FontColor->RGBColor[0, 0, 1]], TraditionalForm]], "TI"],
 ". In simple words, ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        StyleBox[
         SubscriptBox["A", "0"],
         FontColor->RGBColor[0, 0, 1]], 
        RowBox[{
         StyleBox[
          SubscriptBox["A", "1"],
          FontColor->RGBColor[0., 0.6666666666666666, 1.]], "-", 
         "\[DoubleStruckCapitalI]\[Lambda]"}]},
       {"0", 
        StyleBox[
         SubscriptBox["A", "0"],
         FontColor->RGBColor[0, 0, 1]]}
      }], "\[NoBreak]", ")"}],
    FontSize->18], TraditionalForm]], "TI"],
 " should have more null vectors than ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["A", "0"],
    FontColor->RGBColor[0, 0, 1]], TraditionalForm]]],
 "."
}], "Text",
 CellChangeTimes->{{3.721370596375841*^9, 3.721370596376281*^9}}],

Cell[TextData[{
 "Once the criterion is fulfilled, we may easily prove that there exists ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    StyleBox["\[ScriptCapitalU]",
     FontColor->RGBColor[1, 0, 0]], "\[Subset]", 
    SuperscriptBox["\[DoubleStruckCapitalC]", "n"]}], TraditionalForm]], 
  "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, 3.689320101557584*^9, {3.689341411061653*^9, 
    3.689341527749502*^9}, {3.689341622045527*^9, 3.6893416322695227`*^9}, {
    3.689341738909597*^9, 3.6893418854620132`*^9}, {3.689342621393784*^9, 
    3.689342630801785*^9}, {3.6894049688619013`*^9, 3.689404969901799*^9}},
  TextAlignment->Center],
 " such that"
}], "Text",
 CellChangeTimes->{{3.689405340839839*^9, 3.689405435433226*^9}, {
  3.689405479352332*^9, 3.689405500306015*^9}, {3.689405952267582*^9, 
  3.68940596499582*^9}, {3.689759092676614*^9, 3.689759095804098*^9}, {
  3.72136111219069*^9, 3.721361116518539*^9}}],

Cell[TextData[Cell[BoxData[
 FormBox[GridBox[{
    {
     RowBox[{GridBox[{
        {
         RowBox[{
          RowBox[{"1.", "\[AlignmentMarker] ", 
           StyleBox["\[ScriptCapitalU]",
            FontColor->RGBColor[1, 0, 0]]}], "\[Subset]", 
          RowBox[{"ker", " ", 
           FormBox[
            StyleBox[
             SubscriptBox["A", "0"],
             FontColor->RGBColor[0, 0, 1]],
            TraditionalForm]}]}]},
        {
         RowBox[{
          RowBox[{"2.", "\[AlignmentMarker] ", 
           StyleBox[
            SubscriptBox["A", "1"],
            FontColor->RGBColor[0., 0.6666666666666666, 1.]], 
           StyleBox["\[ScriptCapitalU]",
            FontColor->RGBColor[1, 0, 0]]}], "\[Subset]", 
          RowBox[{
           RowBox[{"im", " ", 
            FormBox[
             StyleBox[
              RowBox[{
               SubscriptBox["A", "0"], "\[ImplicitPlus]"}],
              FontColor->RGBColor[0, 0, 1]],
             TraditionalForm]}], "+", " ", 
           StyleBox["\[ScriptCapitalU]",
            FontColor->RGBColor[1, 0, 0]]}]}]}
       },
       GridBoxAlignment->{"Columns" -> {{"\[AlignmentMarker]"}}}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"3.", "im", " ", 
         FormBox[
          StyleBox[
           RowBox[{
            SubscriptBox["A", "0"], "\[ImplicitPlus]"}],
           FontColor->RGBColor[0, 0, 1]],
          TraditionalForm]}], "\[Intersection]", 
        StyleBox["\[ScriptCapitalU]",
         FontColor->RGBColor[1, 0, 0]]}], ">", "\[EmptySet]"}]}]}
   },
   GridBoxItemSize->{"Columns" -> {{
        Scaled[0.96]}}}], TraditionalForm]]]], "Text",
 CellChangeTimes->{{3.689405713312866*^9, 3.689405841569871*^9}, {
  3.689405872098209*^9, 3.6894059032194443`*^9}, {3.6894059414697857`*^9, 
  3.689405941470138*^9}, {3.689406137563404*^9, 3.689406137563795*^9}, {
  3.689759100894661*^9, 3.689759103957357*^9}, {3.719755583012623*^9, 
  3.7197555830126667`*^9}, {3.721361122929981*^9, 3.721361130935796*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0A1ToSubspaces", "::", "usage"}], "=", 
   "\"\<A0A1ToSubspaces[{A0,A1},Left|Right] gives the subspaces which may be \
used for the construction of the projectors for the balances.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.721361000170269*^9, 3.721361007685678*^9}, {
   3.721361064718129*^9, 3.721361069149362*^9}, {3.721361140008924*^9, 
   3.721361144206258*^9}, {3.721361554105781*^9, 3.721361556999352*^9}, {
   3.7214487967141933`*^9, 3.721448798170446*^9}, 3.722554989886345*^9, {
   3.722555180676075*^9, 3.72255518080054*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0A1ToSubspaces", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"A0_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"A1_", "?", "SquareMatrixQ"}]}], "}"}], ",", 
     RowBox[{"side", ":", 
      RowBox[{"(", 
       RowBox[{"Left", "|", "Right"}], ")"}], ":", "Left"}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "@", "A0"}], "==", 
    RowBox[{"Length", "@", "A1"}]}]}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"l", "=", 
       RowBox[{"Length", "@", "A1"}]}], ",", "\[Lambda]", ",", "ns", ",", 
      "A"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "=", 
      RowBox[{"ArrayFlatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"A0", ",", 
           RowBox[{"A1", "-", 
            RowBox[{"\[Lambda]", "*", 
             RowBox[{"IdentityMatrix", "[", "l", "]"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "A0"}], "}"}]}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"side", "===", "Left"}], ",", 
       RowBox[{"A", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{"#", ",", 
            RowBox[{"-", "l"}]}], "]"}], "&"}], "/@", 
         RowBox[{"NullSpace", "[", "A", "]"}]}]}], ",", 
       RowBox[{"A", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{"#", ",", "l"}], "]"}], "&"}], "/@", 
         RowBox[{"NullSpace", "[", 
          RowBox[{"Transpose", "@", "A"}], "]"}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Get", " ", "rid", " ", "of", " ", "denominators"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ns", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Collect", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"PolynomialLCM", "@@", 
            RowBox[{"Denominator", "[", "#", "]"}]}], "*", "#"}], ",", 
          "\[Lambda]", ",", "Factor"}], "]"}], "&"}], "/@", 
       RowBox[{"Factor", "@", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"A", ",", 
          RowBox[{"{", 
           RowBox[{"0", ".."}], "}"}]}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ns", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"RowReduce", "[", 
             RowBox[{
              RowBox[{"FixedPointList", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"D", "[", 
                  RowBox[{"#", ",", "\[Lambda]"}], "]"}], "&"}], ",", "#"}], 
               "]"}], "/.", 
              RowBox[{"\[Lambda]", "\[Rule]", "0"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ".."}], "}"}]}], "]"}], "&"}], "/@", "ns"}], ",", 
        "Length"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"side", "===", "Left"}], ",", 
        RowBox[{"Transpose", "/@", "ns"}], ",", "ns"}], "]"}], "*)"}], 
     "ns"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.7213608610715647`*^9, 3.721360875431026*^9}, 
   3.721360911905794*^9, 3.7213610919371033`*^9, 3.72136407946924*^9, {
   3.7214487906428757`*^9, 3.72144879341887*^9}, {3.721448828450253*^9, 
   3.72144883407584*^9}, {3.7216829347352667`*^9, 3.72168293719143*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", 
   "\"\<improve A0A1ToSubspaces \[LongDash] calculate Groebner basis of \
\!\(\*SubscriptBox[\(u\), \(1\)]\)(\[Lambda]),\[Ellipsis],\!\(\*SubscriptBox[\
\(u\), \(k\)]\)(\[Lambda]).\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.721361151637081*^9, 3.7213612051182423`*^9}}],

Cell[TextData[{
 "The idea is to somehow describe all possibilities to choose ",
 Cell[BoxData[
  FormBox[
   StyleBox["\[ScriptCapitalU]",
    FontColor->RGBColor[1, 0, 0]], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, 3.689320101557584*^9, {3.689341411061653*^9, 
    3.689341527749502*^9}, {3.689341622045527*^9, 3.6893416322695227`*^9}, {
    3.689341738909597*^9, 3.6893418854620132`*^9}, {3.689342621393784*^9, 
    3.689342630801785*^9}, {3.6894049688619013`*^9, 3.689404969901799*^9}},
  TextAlignment->Center],
 ". The subspace ",
 Cell[BoxData[
  FormBox[
   StyleBox["\[ScriptCapitalU]",
    FontColor->RGBColor[1, 0, 0]], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, 3.689320101557584*^9, {3.689341411061653*^9, 
    3.689341527749502*^9}, {3.689341622045527*^9, 3.6893416322695227`*^9}, {
    3.689341738909597*^9, 3.6893418854620132`*^9}, {3.689342621393784*^9, 
    3.689342630801785*^9}, {3.6894049688619013`*^9, 3.689404969901799*^9}},
  TextAlignment->Center],
 " is defined by ",
 Cell[BoxData[
  FormBox[
   RowBox[{"u", "(", "\[Lambda]", ")"}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 ", so we can consider any polynomial vector ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["c", "i"], "(", "\[Lambda]", ")"}], 
    RowBox[{
     SubscriptBox["u", "i"], "(", "\[Lambda]", ")"}]}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 ". Therefore, it is natural to find Gr\[ODoubleDot]bner basis of ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     SubscriptBox["u", "i"], "(", "\[Lambda]", ")"}], 
    "\[RightAngleBracket]"}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 "."
}], "Text",
 CellChangeTimes->{{3.721361229532247*^9, 3.721361496231019*^9}, {
  3.72136153320741*^9, 3.721361541454616*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Projector", "Subsubsection",
 CellChangeTimes->{{3.721365785815591*^9, 3.7213657885434427`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Projector", "::", "usage"}], "=", 
   "\"\<Projector[image,coimage] constructs projector with prescribed image \
and coimage.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721365900431781*^9, 3.721365947592453*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Projector", "[", 
   RowBox[{"u_", ",", "v_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ut", "=", 
      RowBox[{"Transpose", "@", "u"}]}], "}"}], ",", 
    RowBox[{"Check", "[", 
     RowBox[{
      RowBox[{"ut", ".", 
       RowBox[{"Inverse", "[", 
        RowBox[{"v", ".", "ut"}], "]"}], ".", "v"}], ",", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Length", "@", 
           RowBox[{"First", "[", "v", "]"}]}], ",", 
          RowBox[{"Length", "@", "ut"}]}], "}"}]}], "]"}]}], "]"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721365791957514*^9, 3.721365882259264*^9}, 
   3.7213662361211977`*^9, {3.72144926966628*^9, 3.721449331259104*^9}, {
   3.721682953645527*^9, 3.721682983574337*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Balance", "Subsubsection",
 CellChangeTimes->{{3.721448569751981*^9, 3.721448572255968*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Balance", "::", "usage"}], "=", 
   "\"\<A balance transformation matrix. Balance[\!\(\*
StyleBox[\"c\[DoubleStruckCapitalP]\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\),\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"2\"]\)}]=\!\(\*
StyleBox[\"\[DoubleStruckCapitalI]\", \"TI\"]\)-\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\)+\!\(\*
StyleBox[\"c\", \"TI\"]\)\!\(\*FractionBox[
RowBox[{
StyleBox[\"x\", \"TI\"], 
StyleBox[\"-\", \"TI\"], SubscriptBox[
StyleBox[\"x\", \"TI\"], \"2\"]}], 
RowBox[{
StyleBox[\"x\", \"TI\"], 
StyleBox[\"-\", \"TI\"], SubscriptBox[
StyleBox[\"x\", \"TI\"], \"1\"]}]]\)\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\), Balance[\!\(\*
StyleBox[\"c\[DoubleStruckCapitalP]\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\),\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"1\"]\),\[Infinity]}]=\!\(\*
StyleBox[\"\[DoubleStruckCapitalI]\", \"TI\"]\)-\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\)+\!\(\*
StyleBox[\"c\", \"TI\"]\)\!\(\*FractionBox[\"1\", 
RowBox[{
StyleBox[\"x\", \"TI\"], 
StyleBox[\"-\", \"TI\"], SubscriptBox[
StyleBox[\"x\", \"TI\"], \"1\"]}]]\)\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\), and Balance[\!\(\*
StyleBox[\"c\[DoubleStruckCapitalP]\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\),\[Infinity],\!\(\*SubscriptBox[\(x\), \(2\)]\)}]=\!\
\(\*
StyleBox[\"\[DoubleStruckCapitalI]\", \"TI\"]\)-\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\)+\!\(\*
StyleBox[\"c\", \"TI\"]\)(\!\(\*
StyleBox[\" \", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"-\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"2\"]\))\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\). The constant \!\(\*
StyleBox[\"c\", \"TI\"]\) is defined from the condition \!\(\*SuperscriptBox[
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"], \"2\"]\)=\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7214485824979877`*^9, 3.721448586514839*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Balance", "::", "notprojector"}], "=", 
   "\"\<Warning: `1` is not a projector. Returning identity matrix\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.624864528783125*^9, 3.6248645624504824`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Balance", "[", 
   RowBox[{"p_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x1_", ",", "\[Infinity]"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"cs", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"List", "/@", 
            RowBox[{"Dimensions", "[", "p", "]"}]}]}], "]"}]}], "]"}]}], ",", 
      "pcs", ",", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pcs", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{"cs", "*", "p"}], "]"}]}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pcs", "===", "0"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"IdentityMatrix", "@", 
         RowBox[{"Length", "@", "p"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{
        RowBox[{"Plus", "@@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"cs", "*", 
           RowBox[{"p", ".", "p"}]}], "]"}]}], "/", "pcs"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"c", ",", 
          RowBox[{"Alternatives", "@@", "cs"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Balance", "::", "notprojector"}], ",", "p"}], "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Factor", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "-", 
         RowBox[{"p", "/", "c"}]}], "]"}], "+", 
       RowBox[{"p", " ", 
        FractionBox["1", 
         RowBox[{"x", "-", "x1"}]]}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.6248645976498594`*^9, 3.624864598703559*^9}, {
  3.624864691243015*^9, 3.624864704029507*^9}, {3.62495262594692*^9, 
  3.624952631797806*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Balance", "[", 
   RowBox[{"p_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "\[Infinity]", ",", "x2_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"cs", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"List", "/@", 
            RowBox[{"Dimensions", "[", "p", "]"}]}]}], "]"}]}], "]"}]}], ",", 
      "pcs", ",", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pcs", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{"cs", "*", "p"}], "]"}]}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pcs", "===", "0"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"IdentityMatrix", "@", 
         RowBox[{"Length", "@", "p"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{
        RowBox[{"Plus", "@@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"cs", "*", 
           RowBox[{"p", ".", "p"}]}], "]"}]}], "/", "pcs"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"c", ",", 
          RowBox[{"Alternatives", "@@", "cs"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Balance", "::", "notprojector"}], ",", "p"}], "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Factor", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "-", 
         RowBox[{"p", "/", "c"}]}], "]"}], "+", 
       RowBox[{"p", " ", 
        RowBox[{"(", 
         RowBox[{"x", "-", "x2"}], ")"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.6248647223556767`*^9, 3.624864732433369*^9}, {
  3.624952638966566*^9, 3.6249526456119795`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Balance", "[", 
   RowBox[{"p_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x1_", ",", "x2_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"cs", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"List", "/@", 
            RowBox[{"Dimensions", "[", "p", "]"}]}]}], "]"}]}], "]"}]}], ",", 
      "pcs", ",", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pcs", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{"cs", "*", "p"}], "]"}]}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pcs", "===", "0"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"IdentityMatrix", "@", 
         RowBox[{"Length", "@", "p"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{
        RowBox[{"Plus", "@@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"cs", "*", 
           RowBox[{"p", ".", "p"}]}], "]"}]}], "/", "pcs"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"c", ",", 
          RowBox[{"Alternatives", "@@", "cs"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Balance", "::", "notprojector"}], ",", "p"}], "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Factor", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "-", 
         RowBox[{"p", "/", "c"}]}], "]"}], "+", 
       RowBox[{"p", " ", 
        FractionBox[
         RowBox[{"x", "-", "x2"}], 
         RowBox[{"x", "-", "x1"}]]}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.6248641044773426`*^9, 3.6248641570812774`*^9}, {
  3.6248641967666316`*^9, 3.624864525679064*^9}, {3.6248646140547543`*^9, 
  3.624864680916157*^9}, {3.6249526490102367`*^9, 3.624952653972533*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["VisBalancing", "Subsubsection",
 CellChangeTimes->{3.6253280633182087`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VisBalancing", "::", "usage"}], "=", "\"\<VisBalancing[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] is a visual tool for the balancing.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{3.7215495819491863`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"VisBalancing", "[", 
   RowBox[{"ds_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "poles_"}], "}"}], ",", 
    RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}]}], "]"}], ":=", 
  RowBox[{"VisBalancing", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", 
    "poles"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.72325007829632*^9, 3.723250117018811*^9}, {
  3.7232502260687037`*^9, 3.723250239580832*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VisBalancing", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol", ",", 
     RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
     RowBox[{"poles", ":", 
      RowBox[{"All", "|", 
       RowBox[{"{", "__", "}"}]}], ":", "All"}]}], "]"}], ":=", 
   RowBox[{"VisBalancing", "[", 
    RowBox[{
     RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", 
     "poles"}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721450868372929*^9, 3.721450892181036*^9}, {
   3.7215493507928534`*^9, 3.721549354953006*^9}, {3.72154947147303*^9, 
   3.721549472952837*^9}, {3.721715237722169*^9, 3.721715237890087*^9}, 
   3.7232501202352877`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VisBalancing", "[", 
    RowBox[{"as_Association", ",", "x_Symbol", ",", 
     RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
     RowBox[{"poles", ":", 
      RowBox[{"All", "|", 
       RowBox[{"{", "__", "}"}]}], ":", "All"}]}], "]"}], ":=", 
   RowBox[{"VisBalancing", "[", 
    RowBox[{
     RowBox[{"as", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", 
     "poles"}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721450868372929*^9, 3.721450892181036*^9}, {
   3.7215493507928534`*^9, 3.721549354953006*^9}, {3.72154947147303*^9, 
   3.721549472952837*^9}, {3.721715237722169*^9, 3.721715237890087*^9}, 
   3.7232501202352877`*^9, {3.7232501516126213`*^9, 3.723250163164311*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"VisBalancing", "[", 
   RowBox[{
    RowBox[{"matr_", "?", "SquareMatrixQ"}], ",", "x_Symbol", ",", 
    RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
    RowBox[{"poles", ":", 
     RowBox[{"All", "|", 
      RowBox[{"{", "__", "}"}]}], ":", "All"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Basic", " ", 
      RowBox[{"idea", ":", " ", "first"}]}], ",", " ", 
     RowBox[{
     "find", " ", "JDecompositionData", " ", "for", " ", "all", " ", "points",
       " ", "of", " ", "the", " ", 
      RowBox[{"matrix", ".", "\[IndentingNewLine]", "Then"}], " ", 
      "construct", " ", "a", " ", "graphics", " ", "control"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ttt", ",", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "matr"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"m", "=", "matr"}], ",", "\[IndentingNewLine]", "polesData", 
      ",", "\[IndentingNewLine]", "indices", ",", "index", ",", 
      "\[IndentingNewLine]", "prevu", ",", "prevv", ",", 
      "\[IndentingNewLine]", "psetu", ",", "psetv", ",", 
      "\[IndentingNewLine]", "clickedu", ",", "clickedv", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"buttons", "=", 
       RowBox[{"Grid", "[", 
        RowBox[{"{", 
         RowBox[{"{", "\"\<Wait\>\"", "}"}], "}"}], "]"}]}], ",", 
      "\[IndentingNewLine]", "us", ",", "vs", ",", "x1", ",", "x2", ",", 
      "\[IndentingNewLine]", "lu", ",", "lv", ",", "\[IndentingNewLine]", 
      "gram", ",", "goodBalance", ",", "colorMark", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"statusline", "=", "\"\<Ready\>\""}], ",", "balance", ",", 
      "\[IndentingNewLine]", "transformation", ",", "\[IndentingNewLine]", 
      "updateInteface", ",", "\[IndentingNewLine]", "apply", ",", 
      "\[IndentingNewLine]", "validate"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"transformation", "=", 
      RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Calculate", " ", "poles"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"forming", " ", "polesData", " ", "and", " ", "indices"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"polesData", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"poles", "===", "All"}], ",", 
            RowBox[{"PolesInfo", "[", 
             RowBox[{"m", ",", "x"}], "]"}], ",", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#", ",", 
                  RowBox[{"PoincareRank", "[", 
                   RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#"}], "}"}]}], "]"}]}], "}"}], "&"}], "/@",
                "poles"}], ",", 
              RowBox[{"{", 
               RowBox[{"_", ",", 
                RowBox[{"_", "?", "Negative"}]}], "}"}]}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"polesData", "=", "\[IndentingNewLine]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#1", ",", "#2", ",", 
               RowBox[{"JDecompositionData", "@", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"#1", "=!=", "\[Infinity]"}], ",", 
                  RowBox[{"SeriesCoefficient", "[", 
                   RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "-", "#2"}]}], "}"}]}], "]"}], ",", 
                  RowBox[{"-", 
                   RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{"1", "-", "#2"}]}], "}"}]}], "]"}]}]}], "]"}]}], 
               ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"#2", ">", "0"}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Prepend", "[", 
                    RowBox[{"#", ",", "\"\<M\>\""}], "]"}], "&"}], "/@", 
                  RowBox[{"Transpose", "[", 
                   RowBox[{"{", 
                    RowBox[{"(*", 
                    RowBox[{"Transpose", "/@"}], "*)"}], 
                    RowBox[{
                    RowBox[{"Union", "@", 
                    RowBox[{"A0A1ToSubspaces", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", "1"}], "}"}]}], "]"}], "]"}],
                     ",", "Left"}], "]"}]}], ",", 
                    RowBox[{"Union", "@", 
                    RowBox[{"A0A1ToSubspaces", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", "1"}], "}"}]}], "]"}], "]"}],
                     ",", "Right"}], "]"}]}]}], "}"}], "]"}]}], ",", 
                 RowBox[{"{", "}"}]}], "]"}]}], "}"}], "&"}], "@@@", 
            "polesData"}], ")"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"indices", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2", ",", 
                  RowBox[{"{", "i3", "}"}], ",", 
                  RowBox[{
                   RowBox[{"i3", "==", "1"}], "||", "prevu"}], 
                  RowBox[{"(*", 
                   RowBox[{"\"\<allowed to press?\>\"", " ", "flag"}], "*)"}],
                   ",", 
                  RowBox[{"prevu", "=", 
                   RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}], 
                  RowBox[{"(*", 
                   RowBox[{"\"\<pressed?\>\"", " ", "flag"}], "*)"}], ",", 
                  RowBox[{
                   RowBox[{"i3", "==", "1"}], "||", "prevv"}], ",", 
                  RowBox[{"prevv", "=", 
                   RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}]}], "}"}]}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i2", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i3", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "3", ",", "i2", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{
                   RowBox[{"Length", "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"i1", ",", "3"}], "]"}], "]"}]}], "+", "i2"}], 
                  ",", "All", ",", "True", ",", 
                  RowBox[{"Unique", "[", "\"\<p\>\"", "]"}], ",", "True", ",", 
                  RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}], "}"}]}], "]"}],
               ",", 
              RowBox[{"{", 
               RowBox[{"i2", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "4"}], "]"}], "]"}]}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "@", "polesData"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"polesData", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", 
              RowBox[{"Join", "[", 
               RowBox[{"#3", ",", "#4"}], "]"}]}], "}"}], "&"}], "@@@", 
           "polesData"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "forming"}], " ", "polesData", " ", "and", " ", 
           "indices"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"functions", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetu", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "5"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"psetv", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "7"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{"write", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"psetu", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", "True", "]"}], " ", "and", 
           " ", 
           RowBox[{
            RowBox[{"psetv", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", "True", "]"}]}], " ", 
          "*)"}], 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "for", " ", "the", " ", "naive", " ", "effect", " ", "of", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"indices", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "5"}], "]"}], "]"}]}], "=", 
           RowBox[{
            RowBox[{"True", " ", "and", " ", 
             RowBox[{"indices", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "7"}], "]"}], "]"}]}], "=", "True"}]}], " ", 
          "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "functions"}], " ", "to", " ", "set", " ", 
           "variables"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"forming", " ", "interface"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"buttons", "=", 
          RowBox[{"Grid", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Grid", "[", 
                RowBox[{
                 RowBox[{"ArrayFlatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"PadRight", "[", 
                    RowBox[{"Apply", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", "#"}], 
                    "]"}], "&"}], "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "1"}], "]"}], 
                    "]"}]}], ",", 
                    RowBox[{"clickedu", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#4", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{"#5", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<FramedPalette\>\"", ",", "\"\<Pressed\>\""}],
                     "}"}], ",", "\"\<FramedPalette\>\""}], "]"}], "]"}]}]}], 
                    "]"}], "&"}], ",", 
                    RowBox[{"SplitBy", "[", 
                    RowBox[{"indices", ",", "First"}], "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}], "\[IndentingNewLine]", 
                    "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#2", ">", "0"}], ",", "Style", ",", 
                    RowBox[{"#", "&"}]}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<   \>\"", ",", "x", ",", "\"\<=\>\"", ",", "#1", 
                    ",", "\"\<, pr=\>\"", ",", "#2", ",", "\"\<   \>\""}], 
                    "}"}], "]"}], ",", "Bold"}], "]"}], "}"}], "&"}], "@@@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"PadLeft", "[", 
                    RowBox[{"Reverse", "/@", 
                    RowBox[{"Apply", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", "#"}], 
                    "]"}], "&"}], "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "1"}], "]"}], 
                    "]"}]}], ",", 
                    RowBox[{"clickedv", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#6", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{"#7", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<FramedPalette\>\"", ",", "\"\<Pressed\>\""}],
                     "}"}], ",", "\"\<FramedPalette\>\""}], "]"}], "]"}]}]}], 
                    "]"}], "&"}], ",", 
                    RowBox[{"SplitBy", "[", 
                    RowBox[{"indices", ",", "First"}], "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}]}], "\[IndentingNewLine]",
                     "]"}]}], "\[IndentingNewLine]", "}"}], "}"}], "]"}], ",", 
                 RowBox[{"Spacings", "\[Rule]", "0"}], ",", 
                 RowBox[{"ItemSize", "\[Rule]", "All"}], ",", 
                 RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Apply balance transformation\>\"", ",", 
                 RowBox[{"apply", "[", "]"}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", "goodBalance", "]"}]}], ",", 
                 RowBox[{"Background", "\[Rule]", 
                  RowBox[{"Dynamic", "[", "colorMark", "]"}]}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Paste overall transformation\>\"", ",", 
                 RowBox[{"DialogReturn", "[", "transformation", "]"}]}], 
                "]"}], "\[IndentingNewLine]", "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Dynamic", "[", "statusline", "]"}], 
               "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}], 
            ",", 
            RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "forming"}], " ", "interface"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"unsetting", " ", "buttons"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"Through", "[", 
          RowBox[{"psetu", "[", "False", "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Through", "[", 
          RowBox[{"psetv", "[", "False", "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "unsetting"}], " ", "buttons"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"apply", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"apply", " ", "transformation"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"balance", "=", 
          RowBox[{"Balance", "[", 
           RowBox[{
            RowBox[{"Projector", "[", 
             RowBox[{"(*", 
              RowBox[{"Transpose", "@"}], "*)"}], 
             RowBox[{"us", ",", "vs"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "x1", ",", "x2"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", "\"\<balance constructed\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"m", "=", 
          RowBox[{"Transform", "[", 
           RowBox[{"m", ",", "balance", ",", "x"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", "\"\<transformation applied\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"transformation", "=", 
          RowBox[{"Factor", "[", 
           RowBox[{"transformation", ".", "balance"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
         "statusline", "=", "\"\<overall transformation calculated\>\""}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"updateInteface", "[", "]"}], ";"}], "\[IndentingNewLine]", 
        ")"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"validate", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "pick", " ", "right", " ", "and", " ", "left", " ", "vectors"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"us", "=", 
          RowBox[{"vs", "=", 
           RowBox[{"{", "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"#5", ",", 
               RowBox[{
                RowBox[{"us", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"us", ",", 
                   RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "2", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}]}], ";", 
                RowBox[{"x1", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{"#7", ",", 
               RowBox[{
                RowBox[{"vs", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"vs", ",", 
                   RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "3", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}]}], ";", 
                RowBox[{"x2", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}]}], 
            ")"}], "&"}], "@@@", "indices"}], ";", "\[IndentingNewLine]", 
         RowBox[{"gram", "=", 
          RowBox[{"Factor", "@", 
           RowBox[{"Outer", "[", 
            RowBox[{"Dot", ",", "us", ",", "vs", ",", "1"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lu", "=", 
          RowBox[{"Length", "@", "us"}]}], ";", 
         RowBox[{"lv", "=", 
          RowBox[{"Length", "@", "vs"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"goodBalance", "=", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"lu", "+", "lv"}], ">", "0"}], "&&", 
            RowBox[{"lu", "\[Equal]", "lv"}], "&&", 
            RowBox[{"lv", "\[Equal]", 
             RowBox[{"MatrixRank", "[", "gram", "]"}]}]}], ")"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"colorMark", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"lu", "\[Equal]", "0"}], "||", 
             RowBox[{"lv", "\[Equal]", "0"}], "||", 
             RowBox[{
              RowBox[{"MatrixRank", "[", "gram", "]"}], "\[Equal]", "lu"}]}], 
            ",", 
            RowBox[{"If", "[", 
             RowBox[{"goodBalance", ",", "Green", ",", "Automatic"}], "]"}], 
            ",", "Red"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", 
          RowBox[{
           RowBox[{"ToString", "[", "lu", "]"}], "<>", 
           "\"\<-dimensional u-space and \>\"", "<>", 
           RowBox[{"ToString", "[", "lv", "]"}], "<>", 
           "\"\<-dimensional v-space\>\""}]}], ";"}], "\[IndentingNewLine]", 
        ")"}], "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"clickedu", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "5"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetu", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{"{", 
                RowBox[{"#1", ",", "#2", ",", 
                 RowBox[{
                  RowBox[{"{", "k_", "}"}], "/;", 
                  RowBox[{"k", "\[GreaterEqual]", " ", 
                   RowBox[{"First", "[", "#3", "]"}]}]}], ",", "__"}], "}"}], 
               ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetu", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedv", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "7"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetv", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{"{", 
                RowBox[{"#1", ",", "#2", ",", 
                 RowBox[{
                  RowBox[{"{", "k_", "}"}], "/;", 
                  RowBox[{"k", "\[GreaterEqual]", " ", 
                   RowBox[{"First", "[", "#3", "]"}]}]}], ",", "__"}], "}"}], 
               ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetv", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "[", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"DialogInput", "[", 
      RowBox[{"Dynamic", "[", "buttons", 
       RowBox[{"(*", 
        RowBox[{"Refresh", "[", 
         RowBox[{"buttons", ",", 
          RowBox[{"UpdateInterval", "\[Rule]", "1"}]}], "]"}], "*)"}], "]"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.6252099434388247`*^9, 3.6252099509508104`*^9}, {
   3.625220907567676*^9, 3.6252209930734243`*^9}, {3.6252211176701155`*^9, 
   3.6252211442437525`*^9}, {3.625221186024481*^9, 3.6252211868770466`*^9}, {
   3.625221235065028*^9, 3.6252212752547007`*^9}, {3.6252213230544243`*^9, 
   3.6252213777217054`*^9}, {3.6252214205771475`*^9, 
   3.6252215590490484`*^9}, {3.6252217588196306`*^9, 3.625221914712093*^9}, {
   3.625221948184307*^9, 3.6252219816014853`*^9}, {3.625222521642317*^9, 
   3.6252225383263893`*^9}, {3.625222588967373*^9, 3.625222681946081*^9}, {
   3.625222714992013*^9, 3.6252227332321177`*^9}, {3.625222794481768*^9, 
   3.625222839315524*^9}, {3.625222907477761*^9, 3.6252230926606617`*^9}, {
   3.625223184295478*^9, 3.6252232197309957`*^9}, {3.6252232817971883`*^9, 
   3.6252232854566154`*^9}, 3.62522337378924*^9, {3.6252234629324017`*^9, 
   3.6252235577103033`*^9}, {3.62522359706042*^9, 3.6252236712926855`*^9}, {
   3.6252238237958984`*^9, 3.6252239950405483`*^9}, {3.6252241893855305`*^9, 
   3.6252243402056265`*^9}, {3.6252243728763094`*^9, 
   3.6252244042451277`*^9}, {3.6252244471676135`*^9, 
   3.6252246106180935`*^9}, {3.6252246520325785`*^9, 
   3.6252246536036205`*^9}, {3.625224743458256*^9, 3.6252249275534353`*^9}, {
   3.625225008354061*^9, 3.625225072903901*^9}, {3.625225128443761*^9, 
   3.625225168139106*^9}, {3.6252252546995525`*^9, 3.625225256077468*^9}, {
   3.625225301260455*^9, 3.6252253022741275`*^9}, {3.6252253778873105`*^9, 
   3.6252255105773726`*^9}, {3.6252256060497355`*^9, 3.625225627822194*^9}, {
   3.6252257753110704`*^9, 3.6252257994741073`*^9}, {3.6252258754835525`*^9, 
   3.625225925858985*^9}, {3.625225965294157*^9, 3.625226024630537*^9}, 
   3.6252262701284685`*^9, {3.6252263006147013`*^9, 3.62522632917966*^9}, {
   3.6252264124219046`*^9, 3.625226453418113*^9}, {3.6252268112066483`*^9, 
   3.625226813460144*^9}, {3.625226863316232*^9, 3.6252269152216806`*^9}, {
   3.625226976589409*^9, 3.6252269999689255`*^9}, {3.625227034485833*^9, 
   3.625227084050728*^9}, {3.625227118916868*^9, 3.6252271723583355`*^9}, {
   3.625227202643436*^9, 3.625227380171256*^9}, {3.6252274921725893`*^9, 
   3.6252275139270267`*^9}, {3.6252280002838097`*^9, 3.625228035747345*^9}, {
   3.6252280712769265`*^9, 3.625228096524682*^9}, {3.6252282604824967`*^9, 
   3.6252282715978737`*^9}, 3.625228301725869*^9, {3.625228340612677*^9, 
   3.625228392339007*^9}, {3.6252284442704725`*^9, 3.625228515052449*^9}, 
   3.6252286143103237`*^9, {3.6252289303181696`*^9, 3.625228937377855*^9}, {
   3.625228993464077*^9, 3.625229098124537*^9}, {3.625229131852923*^9, 
   3.6252291503031683`*^9}, {3.6252292342332*^9, 3.625229274022607*^9}, {
   3.6252293115435095`*^9, 3.6252293342806*^9}, {3.625229384734084*^9, 
   3.62522946479622*^9}, {3.625229501146344*^9, 3.625229608442554*^9}, 
   3.625230700548358*^9, {3.62523116978878*^9, 3.62523117075142*^9}, {
   3.6252312022513247`*^9, 3.6252312213119745`*^9}, {3.625231325923403*^9, 
   3.6252313741233926`*^9}, {3.6252314241626024`*^9, 3.625231424802027*^9}, {
   3.625231479533351*^9, 3.62523149093892*^9}, {3.6252934707774324`*^9, 
   3.6252935806373425`*^9}, {3.6252936903982744`*^9, 3.625293738887455*^9}, 
   3.625293788274232*^9, {3.6252938282087345`*^9, 3.6252938302490897`*^9}, {
   3.6252938760815077`*^9, 3.625293896624141*^9}, {3.6252940470329638`*^9, 
   3.625294132312562*^9}, {3.625294221468732*^9, 3.6252942529536276`*^9}, {
   3.625299187233882*^9, 3.625299255483177*^9}, 3.6252996148717003`*^9, {
   3.6252996617818284`*^9, 3.6252996648358545`*^9}, {3.6252996948657846`*^9, 
   3.6252998052140207`*^9}, {3.625306151737014*^9, 3.625306158784691*^9}, {
   3.6253062773053503`*^9, 3.6253063245437026`*^9}, {3.6253064016768928`*^9, 
   3.625306422551747*^9}, {3.625306499510823*^9, 3.6253065140384645`*^9}, {
   3.6253065833924932`*^9, 3.6253067200842113`*^9}, {3.6253067854896193`*^9, 
   3.6253068008187933`*^9}, {3.6253069188541307`*^9, 3.625306959211915*^9}, {
   3.625307006063009*^9, 3.625307145222369*^9}, {3.625307181337335*^9, 
   3.6253072203332157`*^9}, {3.625307260956175*^9, 3.625307277602223*^9}, {
   3.625307322429974*^9, 3.6253073339926476`*^9}, {3.6253080943822994`*^9, 
   3.6253081350432854`*^9}, {3.6253081683073616`*^9, 3.62530820097104*^9}, {
   3.6253082545636077`*^9, 3.6253083424839582`*^9}, {3.625308446930277*^9, 
   3.6253084618391714`*^9}, {3.6253084990408616`*^9, 
   3.6253085281501803`*^9}, {3.6253085650176487`*^9, 3.62530858481779*^9}, {
   3.625308636357995*^9, 3.625308640151513*^9}, {3.6253086721537523`*^9, 
   3.625308716458156*^9}, {3.625308759467701*^9, 3.62530887957041*^9}, {
   3.6253090216416993`*^9, 3.6253090263288093`*^9}, {3.625309094304923*^9, 
   3.625309139477904*^9}, {3.625309201620146*^9, 3.6253095155104666`*^9}, {
   3.625309548134118*^9, 3.6253095854018517`*^9}, {3.6253096574606757`*^9, 
   3.6253097660577497`*^9}, {3.6253098630170984`*^9, 3.625309981437691*^9}, {
   3.6253104107145915`*^9, 3.6253104938787856`*^9}, {3.6253106171095705`*^9, 
   3.6253106224761324`*^9}, {3.6253106787404747`*^9, 
   3.6253107592208867`*^9}, {3.62531080712568*^9, 3.6253108940653796`*^9}, {
   3.6253126180333414`*^9, 3.6253126291527205`*^9}, {3.6253128388108654`*^9, 
   3.625312876932165*^9}, {3.625313020689575*^9, 3.6253130435977774`*^9}, {
   3.6253131725603676`*^9, 3.6253133804153147`*^9}, {3.6253135049659758`*^9, 
   3.6253135410389166`*^9}, {3.6253135959743757`*^9, 
   3.6253135969680357`*^9}, {3.6253136367164154`*^9, 
   3.6253137363595457`*^9}, {3.62531377370233*^9, 3.625313851559001*^9}, {
   3.62531396063139*^9, 3.625313980623658*^9}, {3.625314033741912*^9, 
   3.625314050844262*^9}, {3.625314170539702*^9, 3.6253142083858175`*^9}, {
   3.6253142595097485`*^9, 3.6253142982964907`*^9}, {3.6253143764543605`*^9, 
   3.6253145120493684`*^9}, {3.6253145993923197`*^9, 3.625314758244746*^9}, {
   3.625314794303677*^9, 3.6253148132602577`*^9}, {3.625314845696786*^9, 
   3.625314861606344*^9}, {3.625314894841402*^9, 3.625314987551932*^9}, {
   3.6253150648622403`*^9, 3.6253151170338655`*^9}, {3.625315208318449*^9, 
   3.6253152389517794`*^9}, {3.6253153826201286`*^9, 3.625315469431743*^9}, {
   3.625315521639392*^9, 3.6253157770098753`*^9}, {3.6253158731997137`*^9, 
   3.6253158842570524`*^9}, {3.625316277193835*^9, 3.6253163095102825`*^9}, {
   3.6253163671325245`*^9, 3.625316389383292*^9}, {3.625316674367082*^9, 
   3.6253166997749443`*^9}, {3.625316781461158*^9, 3.625316885114951*^9}, {
   3.625317246428745*^9, 3.6253173146910486`*^9}, {3.6253173674300504`*^9, 
   3.6253173719140263`*^9}, {3.6253174245079336`*^9, 3.625317451730999*^9}, {
   3.6253174843976793`*^9, 3.6253175610935802`*^9}, {3.625317595909687*^9, 
   3.625317615139449*^9}, {3.6253176675432286`*^9, 3.6253176995644803`*^9}, {
   3.625317736078713*^9, 3.625317829106454*^9}, {3.6253179992003407`*^9, 
   3.6253180113964357`*^9}, {3.625318186706785*^9, 3.6253182049629*^9}, {
   3.625318334796068*^9, 3.625318365091174*^9}, {3.6253184206860714`*^9, 
   3.6253184469264865`*^9}, {3.625318694346693*^9, 3.625318694867038*^9}, {
   3.62532455395868*^9, 3.625324660275241*^9}, {3.6253247023101377`*^9, 
   3.6253247631793623`*^9}, {3.6253249544893312`*^9, 
   3.6253249670786853`*^9}, {3.6253252770043745`*^9, 3.6253252774216523`*^9}, 
   3.625325550073282*^9, {3.625326054079874*^9, 3.625326072814307*^9}, {
   3.625326284280653*^9, 3.6253263200523944`*^9}, {3.6253280219547586`*^9, 
   3.6253280543112316`*^9}, {3.625556263874431*^9, 3.6255562911845565`*^9}, {
   3.625556339291484*^9, 3.6255563402581253`*^9}, {3.625556738426379*^9, 
   3.6255567634659977`*^9}, {3.6255568708172445`*^9, 3.625556901822822*^9}, {
   3.6255569379648085`*^9, 3.6255569472219524`*^9}, {3.6255571159079046`*^9, 
   3.6255571210973487`*^9}, {3.626496329078463*^9, 3.626496348269456*^9}, {
   3.626496379721356*^9, 3.626496415781577*^9}, {3.626496478532096*^9, 
   3.626496563759957*^9}, {3.626496600500637*^9, 3.6264966381368914`*^9}, {
   3.626496710018921*^9, 3.6264967140335884`*^9}, {3.6264968806980886`*^9, 
   3.6264968811453857`*^9}, 3.6273670020107174`*^9, {3.630969812033251*^9, 
   3.630969812084284*^9}, {3.636430411248167*^9, 3.636430464258616*^9}, {
   3.636430574297887*^9, 3.636430580833844*^9}, {3.636430638053337*^9, 
   3.636430649250955*^9}, {3.636430690650444*^9, 3.63643075182899*^9}, {
   3.6364309119462013`*^9, 3.6364311474783583`*^9}, 3.63643120509418*^9, 
   3.636431244291082*^9, {3.63643138828611*^9, 3.636431403158126*^9}, {
   3.636431437063333*^9, 3.636431441662833*^9}, {3.6364528790116587`*^9, 
   3.636452880559298*^9}, {3.6365152871021748`*^9, 3.6365153084871073`*^9}, 
   3.636515527303523*^9, {3.636515597953497*^9, 3.636515603840073*^9}, {
   3.636515678764413*^9, 3.636515697572631*^9}, {3.636515755241622*^9, 
   3.636515794547304*^9}, {3.636515839166169*^9, 3.636515858257346*^9}, {
   3.6365164752070713`*^9, 3.636516485243099*^9}, {3.636518361579351*^9, 
   3.6365184086158247`*^9}, {3.636518678454998*^9, 3.636518725484923*^9}, {
   3.636518861029854*^9, 3.6365188811744223`*^9}, 3.636518950846974*^9, {
   3.63652020080538*^9, 3.6365202332875633`*^9}, {3.636693107034112*^9, 
   3.636693127482608*^9}, {3.648691984359164*^9, 3.648691994086624*^9}, {
   3.64869203151248*^9, 3.648692050495085*^9}, {3.6486924632091703`*^9, 
   3.648692480578706*^9}, {3.6486925153127728`*^9, 3.6486925248971367`*^9}, 
   3.6489611139486513`*^9, {3.7214473263362513`*^9, 3.7214473318713017`*^9}, {
   3.721447444102982*^9, 3.7214474475664663`*^9}, {3.721447526540522*^9, 
   3.721447533841584*^9}, {3.721447603737103*^9, 3.721447609169169*^9}, {
   3.7214476854085703`*^9, 3.721447789177582*^9}, 3.721447829537491*^9, {
   3.7214479029146557`*^9, 3.7214479291942453`*^9}, {3.721447985801834*^9, 
   3.7214479996741734`*^9}, {3.721448091314249*^9, 3.721448105274411*^9}, {
   3.721448137947218*^9, 3.721448167720804*^9}, 3.721448200166924*^9, {
   3.721448269257345*^9, 3.7214484780493393`*^9}, 3.721448680651931*^9, {
   3.7214487365214987`*^9, 3.721448736810614*^9}, {3.721448777634062*^9, 
   3.7214487778906612`*^9}, {3.721449038869617*^9, 3.721449039008786*^9}, {
   3.721449535796804*^9, 3.721449536886242*^9}, {3.721449690813941*^9, 
   3.721449698316024*^9}, {3.721450320453661*^9, 3.721450325399003*^9}, {
   3.721450548985427*^9, 3.721450557025943*^9}, {3.721535355626676*^9, 
   3.721535362580887*^9}, {3.721535437106536*^9, 3.721535444066293*^9}, {
   3.721536344956002*^9, 3.721536469990004*^9}, {3.72153650509198*^9, 
   3.721536525840782*^9}, 3.72153695247892*^9, {3.721536982671049*^9, 
   3.7215369926771917`*^9}, {3.721537061982338*^9, 3.721537139126383*^9}, {
   3.7215372169497757`*^9, 3.7215372211583977`*^9}, {3.7215372586429377`*^9, 
   3.721537258862175*^9}, {3.721537312575194*^9, 3.721537314278328*^9}, {
   3.7215373800881453`*^9, 3.721537404961217*^9}, {3.721537561143448*^9, 
   3.721537567615698*^9}, {3.721538074010146*^9, 3.721538075745229*^9}, 
   3.721538221053665*^9, {3.721538293272788*^9, 3.721538301722578*^9}, {
   3.721538336610917*^9, 3.7215383730822363`*^9}, {3.7215384222664337`*^9, 
   3.721538431530609*^9}, {3.721538529348304*^9, 3.721538531014943*^9}, {
   3.721538653368702*^9, 3.7215386898700666`*^9}, {3.721538884371725*^9, 
   3.7215388896669407`*^9}, {3.721539017811357*^9, 3.7215390187796803`*^9}, {
   3.721539172907362*^9, 3.721539175080374*^9}, 3.7215392055559673`*^9, {
   3.721539240604484*^9, 3.721539240650786*^9}, {3.721539284900098*^9, 
   3.7215392867233047`*^9}, {3.721539387665976*^9, 3.7215393922513*^9}, {
   3.721539465827445*^9, 3.721539475307624*^9}, {3.7215395286194363`*^9, 
   3.721539531148964*^9}, {3.721539565107641*^9, 3.72153962031645*^9}, {
   3.721539668602569*^9, 3.721539724419104*^9}, {3.721539929472146*^9, 
   3.72153998550895*^9}, {3.721540027316372*^9, 3.721540035475153*^9}, {
   3.721540107479157*^9, 3.721540108028328*^9}, {3.721540149259766*^9, 
   3.721540182076437*^9}, {3.721540305053804*^9, 3.721540361991475*^9}, 
   3.721540409293315*^9, 3.721540451836176*^9, {3.721540698483708*^9, 
   3.721540719268879*^9}, {3.7215408301870604`*^9, 3.72154083164571*^9}, {
   3.721540915294046*^9, 3.721540948440506*^9}, {3.721541028961238*^9, 
   3.721541088680798*^9}, {3.72154112633816*^9, 3.7215411276477013`*^9}, {
   3.721541165081546*^9, 3.721541166209483*^9}, {3.7215413095622473`*^9, 
   3.72154136368285*^9}, {3.7215413975484953`*^9, 3.7215413986423893`*^9}, {
   3.721541432780566*^9, 3.721541459057889*^9}, {3.721541505105554*^9, 
   3.7215415085812197`*^9}, {3.721541596426148*^9, 3.721541597450316*^9}, 
   3.721541654606058*^9, {3.721541764411859*^9, 3.721541984260467*^9}, {
   3.7215420404133387`*^9, 3.721542046461207*^9}, {3.7215420959322042`*^9, 
   3.721542135093568*^9}, {3.721542172590725*^9, 3.72154221219762*^9}, {
   3.7215422620560102`*^9, 3.721542333556528*^9}, {3.721543857247108*^9, 
   3.7215439090931063`*^9}, {3.7215439439204597`*^9, 3.721544050853189*^9}, {
   3.721544114987495*^9, 3.72154411853834*^9}, {3.7215442830790453`*^9, 
   3.721544294407791*^9}, {3.721544328895501*^9, 3.721544329471312*^9}, {
   3.7215443772156267`*^9, 3.7215444692066307`*^9}, {3.721544553604619*^9, 
   3.7215445918386173`*^9}, {3.7215446440803537`*^9, 3.7215446566696243`*^9}, 
   3.721544710625917*^9, 3.721544899361423*^9, 3.721544947065699*^9, {
   3.7215450639055157`*^9, 3.7215450722497663`*^9}, {3.721545324278236*^9, 
   3.721545470159284*^9}, {3.721545530984136*^9, 3.721545655725999*^9}, {
   3.7215457152737217`*^9, 3.721545765940682*^9}, {3.7215459371976147`*^9, 
   3.721546003668597*^9}, {3.721546094990394*^9, 3.721546112636248*^9}, {
   3.721546198046873*^9, 3.7215462261152487`*^9}, {3.72154626840592*^9, 
   3.7215462950297728`*^9}, {3.721546328558613*^9, 3.721546378318513*^9}, {
   3.72154667746979*^9, 3.7215467166261883`*^9}, {3.7215467689504023`*^9, 
   3.721546772350131*^9}, {3.7215468370393887`*^9, 3.721546845931924*^9}, {
   3.721546918582851*^9, 3.7215469225669394`*^9}, {3.7215469760143147`*^9, 
   3.721546994059718*^9}, {3.7215471029767647`*^9, 3.721547150537036*^9}, {
   3.721547183443326*^9, 3.721547218725759*^9}, {3.721547390295579*^9, 
   3.721547391173326*^9}, {3.7215475150117817`*^9, 3.721547518931198*^9}, {
   3.7215476236998577`*^9, 3.7215476253945913`*^9}, {3.721547839525997*^9, 
   3.721547849050775*^9}, {3.721547913410977*^9, 3.721547916285412*^9}, {
   3.7215482841096907`*^9, 3.721548303964943*^9}, {3.721548348014762*^9, 
   3.721548369275957*^9}, {3.72154855702341*^9, 3.7215485571663723`*^9}, {
   3.721548966367491*^9, 3.72154906744058*^9}, {3.721549102218388*^9, 
   3.721549237879533*^9}, {3.7216830209094677`*^9, 3.721683040229981*^9}, {
   3.721715241218113*^9, 3.72171524140779*^9}, {3.7217154149381943`*^9, 
   3.7217154222373037`*^9}, {3.72171550931501*^9, 3.721715509872978*^9}, {
   3.721715629538952*^9, 3.721715632224145*^9}, {3.722227038877988*^9, 
   3.7222270608605433`*^9}, {3.7222271083651447`*^9, 3.722227122312729*^9}, 
   3.722585024785892*^9, 3.7232501221286907`*^9}],

Cell[BoxData[{
 RowBox[{"todo", "[", 
  "\"\<VisBalancing: block simultaneus pressing buttons for nonzero Poincare \
rank singularities\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"todo", "[", 
  "\"\<VisBalancing: for simple poles allow same-line pressing on left and \
right\>\"", "]"}]}], "Code",
 CellChangeTimes->{{3.721547272361312*^9, 3.72154735198608*^9}, {
  3.721548077461067*^9, 3.721548120165266*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"VisBalancing", "[", 
   RowBox[{
    RowBox[{"matr_", "?", "SquareMatrixQ"}], ",", "x_", ",", 
    RowBox[{"\[Epsilon]_:", "Indeterminate"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Basic", " ", 
      RowBox[{"idea", ":", " ", "first"}]}], ",", " ", 
     RowBox[{
     "find", " ", "JDecompositionData", " ", "for", " ", "all", " ", "points",
       " ", "of", " ", "the", " ", 
      RowBox[{"matrix", ".", "\[IndentingNewLine]", "Then"}], " ", 
      "construct", " ", "a", " ", "graphics", " ", "control"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ttt", ",", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "matr"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"m", "=", "matr"}], ",", "\[IndentingNewLine]", "polesData", 
      ",", "\[IndentingNewLine]", "indices", ",", "indices1", ",", "index", 
      ",", "\[IndentingNewLine]", "prevu", ",", "prevv", ",", 
      "\[IndentingNewLine]", "psetu", ",", "psetv", ",", 
      "\[IndentingNewLine]", "psetu1", ",", "psetv1", ",", 
      "\[IndentingNewLine]", "clickedu", ",", "clickedv", ",", 
      "\[IndentingNewLine]", "clickedu1", ",", "clickedv1", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"buttons", "=", 
       RowBox[{"Grid", "[", 
        RowBox[{"{", 
         RowBox[{"{", "\"\<Wait\>\"", "}"}], "}"}], "]"}]}], ",", 
      "\[IndentingNewLine]", "len", ",", "\[IndentingNewLine]", "validate", 
      ",", "\[IndentingNewLine]", "us", ",", "vs", ",", "x1", ",", "x2", ",", 
      "\[IndentingNewLine]", "lu", ",", "lv", ",", "\[IndentingNewLine]", 
      "gram", ",", "goodBalance", ",", "colorMark", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"statusline", "=", "\"\<Ready\>\""}], ",", 
      "\[IndentingNewLine]", "apply", ",", "balance", ",", "\n", 
      "transformation", ",", "\[IndentingNewLine]", "updateInteface"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"transformation", "=", 
      RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Calculate", " ", "poles"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"polesData", "=", "\[IndentingNewLine]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#1", ",", "#2", ",", 
               RowBox[{"{", "}"}], ",", 
               RowBox[{"{", "}"}], ",", 
               RowBox[{"JDecompositionData", "@", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"#1", "=!=", "\[Infinity]"}], ",", 
                  RowBox[{"SeriesCoefficient", "[", 
                   RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "-", "#2"}]}], "}"}]}], "]"}], ",", 
                  RowBox[{"-", 
                   RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{"1", "-", "#2"}]}], "}"}]}], "]"}]}]}], "]"}]}]}],
               "}"}], "&"}], "@@@", 
            RowBox[{"PolesInfo", "[", 
             RowBox[{"m", ",", "x"}], "]"}]}], ")"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"polesData", ":", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               SubscriptBox["x", "1"], ",", 
               SubscriptBox["r", "1"], ",", 
               SubscriptBox["JDecompositionData", "1"]}], "}"}], ",", 
             "\[Ellipsis]"}], "}"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Now", " ", "I", " ", "have", " ", "to", " ", "generate", " ", "a", 
           " ", "list", " ", "of", " ", "indices", " ", "of", " ", "the", " ",
            "form", " ", 
           RowBox[{"{", 
            RowBox[{"#pole", ",", "#JC", ",", "depth"}], "}"}], " ", "to", 
           " ", "access", " ", "to", " ", "any", " ", "vector"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"indices", "=", 
          RowBox[{"{", "}"}]}], ";", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"indices", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2", ",", "i3", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"i3", "==", "1"}], ",", "True", ",", "prevu"}], 
                "]"}], ",", 
               RowBox[{"prevu", "=", 
                RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}], ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"i3", "==", "1"}], ",", "True", ",", "prevv"}], 
                "]"}], ",", 
               RowBox[{"prevv", "=", 
                RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}]}], "}"}]}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "@", "polesData"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", 
             RowBox[{"Length", "@", 
              RowBox[{"polesData", "[", 
               RowBox[{"[", 
                RowBox[{"i1", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i3", ",", 
             RowBox[{"Length", "@", 
              RowBox[{"polesData", "[", 
               RowBox[{"[", 
                RowBox[{"i1", ",", 
                 RowBox[{"-", "1"}], ",", "i2", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"indices1", "=", 
          RowBox[{"{", "}"}]}], ";", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"indices1", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Unique", "[", "\"\<p\>\"", "]"}], ",", 
               RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "@", "polesData"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"buttons", "=", 
          RowBox[{"Grid", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Grid", "[", 
                RowBox[{
                 RowBox[{"ArrayFlatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SplitBy", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", "#"}], 
                    "]"}], "&"}], "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", 
                    RowBox[{"-", "1"}], ",", "#2", ",", "1"}], "]"}], "]"}]}],
                     ",", 
                    RowBox[{"clickedu", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#4", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "#5", ",", "\"\<Pressed\>\"", ",", 
                    "\"\<DefaultButton\>\""}], "]"}], "]"}]}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "2"}], "]"}], "]"}], ">", "0"}], ",", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.4823529411764706`", ",", "0.6509803921568628`", ",", 
                    "0.8352941176470589`"}], "]"}], ",", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.`", ",", "0.7098039215686275`", ",", 
                    "0.7450980392156863`"}], "]"}]}], "]"}]}]}], "]"}], ",", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "&"}], "@@@", "indices"}], ",", "Last"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"len", "=", 
                    RowBox[{"Max", "[", 
                    RowBox[{"Length", "/@", "#"}], "]"}]}], ";", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PadRight", "[", 
                    RowBox[{"#", ",", "len", ",", "\"\<\>\""}], "]"}], "&"}], 
                    "/@", "#"}]}], ")"}], "&"}], "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "2"}], "]"}], "]"}], ">", "0"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Button", "[", 
                    RowBox[{"\"\<auto\>\"", ",", 
                    RowBox[{"clickedu1", "[", "#1", "]"}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.4823529411764706`", ",", "0.6509803921568628`", ",", 
                    "0.8352941176470589`"}], "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "#2", ",", "\"\<Pressed\>\"", ",", 
                    "\"\<DefaultButton\>\""}], "]"}], "]"}]}]}], "]"}], "}"}],
                     ",", 
                    RowBox[{"{", "}"}]}], "]"}], "&"}], "@@@", "indices1"}], 
                    "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#2", ">", "0"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"x", "\[Equal]", "#1"}], ",", "#2"}], "}"}], ",", 
                    "Red"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"x", "\[Equal]", "#1"}], ",", 
                    RowBox[{"#2", "-", "1"}]}], "}"}]}], "]"}], "}"}], "&"}], 
                    "@@@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "2"}], "]"}], "]"}], ">", "0"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Button", "[", 
                    RowBox[{"\"\<auto\>\"", ",", 
                    RowBox[{"clickedv1", "[", "#1", "]"}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.4823529411764706`", ",", "0.6509803921568628`", ",", 
                    "0.8352941176470589`"}], "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "#3", ",", "\"\<Pressed\>\"", ",", 
                    "\"\<DefaultButton\>\""}], "]"}], "]"}]}]}], "]"}], "}"}],
                     ",", 
                    RowBox[{"{", "\"\<\>\"", "}"}]}], "]"}], "&"}], "@@@", 
                    "indices1"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"SplitBy", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", "#"}], 
                    "]"}], "&"}], "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#", ",", 
                    RowBox[{"-", "1"}], ",", "#2", ",", "1"}], "]"}], "]"}]}],
                     ",", 
                    RowBox[{"clickedv", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#6", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "#7", ",", "\"\<Pressed\>\"", ",", 
                    "\"\<DefaultButton\>\""}], "]"}], "]"}]}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "2"}], "]"}], "]"}], ">", "0"}], ",", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.4823529411764706`", ",", "0.6509803921568628`", ",", 
                    "0.8352941176470589`"}], "]"}], ",", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.`", ",", "0.7098039215686275`", ",", 
                    "0.7450980392156863`"}], "]"}]}], "]"}]}]}], "]"}], ",", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "&"}], "@@@", "indices"}], ",", "Last"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}]}], 
                    "\[IndentingNewLine]", "}"}], "}"}], "]"}], ",", 
                 RowBox[{"Spacings", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"n", "+", "1"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", "3"}], "}"}], ",", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"n", "+", "1"}]}], "]"}]}], "]"}], ",", "0"}], 
                   "}"}]}], ",", 
                 RowBox[{"ItemSize", "\[Rule]", "All"}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Apply balance transformation\>\"", ",", 
                 RowBox[{"apply", "[", "]"}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", "goodBalance", "]"}]}], ",", 
                 RowBox[{"Background", "\[Rule]", 
                  RowBox[{"Dynamic", "[", "colorMark", "]"}]}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Paste overall transformation\>\"", ",", 
                 RowBox[{"DialogReturn", "[", "transformation", "]"}]}], 
                "]"}], "\[IndentingNewLine]", "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Dynamic", "[", "statusline", "]"}], 
               "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}], 
            ",", 
            RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"psetu", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "5"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "a", " ", "function", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetv", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "7"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "a", " ", "function", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetu1", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices1", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "a", " ", "function", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetv1", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices1", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "a", " ", "function", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetu"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetv"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetu1"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetv1"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"apply", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"apply", " ", "transformation"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"balance", "=", 
          RowBox[{"Balance", "[", 
           RowBox[{
            RowBox[{"Projector", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", "us"}], ",", "vs"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "x1", ",", "x2"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", "\"\<balance constructed\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"m", "=", 
          RowBox[{"Transform", "[", 
           RowBox[{"m", ",", "balance", ",", "x"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", "\"\<transformation applied\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"transformation", "=", 
          RowBox[{"Factor", "[", 
           RowBox[{"transformation", ".", "balance"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
         "statusline", "=", "\"\<overall transformation calculated\>\""}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"updateInteface", "[", "]"}], ";"}], "\[IndentingNewLine]", 
        ")"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"validate", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "pick", " ", "right", " ", "and", " ", "left", " ", "vectors"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"us", "=", 
          RowBox[{"vs", "=", 
           RowBox[{"{", "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"#5", ",", 
               RowBox[{
                RowBox[{"AppendTo", "[", 
                 RowBox[{"us", ",", 
                  RowBox[{"polesData", "[", 
                   RowBox[{"[", 
                    RowBox[{"#1", ",", "5", ",", "#2", ",", "2", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}], ";", 
                RowBox[{"x1", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{"#7", ",", 
               RowBox[{
                RowBox[{"AppendTo", "[", 
                 RowBox[{"vs", ",", 
                  RowBox[{"polesData", "[", 
                   RowBox[{"[", 
                    RowBox[{"#1", ",", "5", ",", "#2", ",", "3", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}], ";", 
                RowBox[{"x2", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}]}], 
            ")"}], "&"}], "@@@", "indices"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"#2", ",", 
               RowBox[{
                RowBox[{"us", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "3"}], "]"}], "]"}]}], ";", 
                RowBox[{"x1", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{"#3", ",", 
               RowBox[{
                RowBox[{"vs", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "4"}], "]"}], "]"}]}], ";", 
                RowBox[{"x2", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}]}], 
            ")"}], "&"}], "@@@", "indices1"}], ";", "\[IndentingNewLine]", 
         RowBox[{"gram", "=", 
          RowBox[{"Factor", "@", 
           RowBox[{"Outer", "[", 
            RowBox[{"Dot", ",", "us", ",", "vs", ",", "1"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lu", "=", 
          RowBox[{"Length", "@", "us"}]}], ";", 
         RowBox[{"lv", "=", 
          RowBox[{"Length", "@", "vs"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"goodBalance", "=", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"lu", ">", "0"}], "&&", 
            RowBox[{"lu", "\[Equal]", "lv"}], "&&", 
            RowBox[{"lv", "\[Equal]", 
             RowBox[{"MatrixRank", "[", "gram", "]"}]}]}], ")"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"colorMark", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"lu", "\[Equal]", "0"}], "||", 
             RowBox[{"lv", "\[Equal]", "0"}], "||", 
             RowBox[{
              RowBox[{"MatrixRank", "[", "gram", "]"}], "\[Equal]", "lu"}]}], 
            ",", 
            RowBox[{"If", "[", 
             RowBox[{"goodBalance", ",", "Green", ",", "Automatic"}], "]"}], 
            ",", "Red"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", 
          RowBox[{
           RowBox[{"ToString", "[", "lu", "]"}], "<>", 
           "\"\<-dimensional u-space and \>\"", "<>", 
           RowBox[{"ToString", "[", "lv", "]"}], "<>", 
           "\"\<-dimensional v-space\>\""}]}]}], "\[IndentingNewLine]", ")"}],
        "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"clickedu", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"if", " ", "pressed"}], ",", " ", 
          RowBox[{"unpress", " ", "and", " ", "vice", " ", "versa"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "5"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetu", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#1", ",", "#2", ",", "k_", ",", "__"}], "}"}], "/;", 
                RowBox[{"k", "\[GreaterEqual]", " ", "#3"}]}], ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetu1"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv1", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices1", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetu", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedv", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"if", " ", "pressed"}], ",", " ", 
          RowBox[{"unpress", " ", "and", " ", "vice", " ", "versa"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "7"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetv", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#1", ",", "#2", ",", "k_", ",", "__"}], "}"}], "/;", 
                RowBox[{"k", "\[GreaterEqual]", " ", "#3"}]}], ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetv1"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu1", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices1", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetv", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedu1", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "argument", " ", "is", " ", "just", " ", "the", " ", "#", " ", "of", 
          " ", "the", " ", "pole"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices1", "[", 
            RowBox[{"[", 
             RowBox[{"#", ",", "2"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"psetu1", "[", 
             RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Clear", " ", "all", " ", "auto", " ", "and", " ", "buttons", " ",
              "on", " ", "the", " ", "same", " ", "side"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Join", "[", 
              RowBox[{"psetu", ",", "psetu1"}], 
              RowBox[{"(*", 
               RowBox[{",", "psetv1"}], "*)"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetu1", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "[", "True", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"calculation", " ", "of", " ", "the", " ", "space"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"polesData", "[", 
                RowBox[{"[", 
                 RowBox[{"#1", ",", "3"}], "]"}], "]"}], "===", 
               RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Calculate", " ", "PRLoweringSpace"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"polesData", "[", 
                RowBox[{"[", 
                 RowBox[{"#1", ",", "3"}], "]"}], "]"}], "=", 
               RowBox[{"Transpose", "[", 
                RowBox[{
                 RowBox[{"A0A1ToSubspaces", "[", 
                  RowBox[{
                   RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "1"}], "]"}], "]"}], ",", "1"}], 
                    "}"}]}], "]"}], "]"}], ",", "Left"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedv1", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices1", "[", 
            RowBox[{"[", 
             RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"psetv1", "[", 
             RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Clear", " ", "all", " ", "auto", " ", "and", " ", "buttons", " ",
              "on", " ", "the", " ", "same", " ", "side"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Join", "[", 
              RowBox[{"psetv", ",", 
               RowBox[{"(*", 
                RowBox[{"psetu1", ","}], "*)"}], "psetv1"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetv1", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "[", "True", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"polesData", "[", 
                RowBox[{"[", 
                 RowBox[{"#1", ",", "4"}], "]"}], "]"}], "===", 
               RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Calculate", " ", "PRLoweringSpace"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"polesData", "[", 
                RowBox[{"[", 
                 RowBox[{"#1", ",", "4"}], "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"A0A1ToSubspaces", "[", 
                 RowBox[{
                  RowBox[{"Factor", "[", 
                   RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "1"}], "]"}], "]"}], ",", "1"}], 
                    "}"}]}], "]"}], "]"}], ",", "Right"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "[", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"DialogInput", "[", 
      RowBox[{"Dynamic", "[", 
       RowBox[{"Refresh", "[", 
        RowBox[{"buttons", ",", 
         RowBox[{"UpdateInterval", "\[Rule]", "1"}]}], "]"}], "]"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellOpen->False,
 CellChangeTimes->{{3.6252099434388247`*^9, 3.6252099509508104`*^9}, {
   3.625220907567676*^9, 3.6252209930734243`*^9}, {3.6252211176701155`*^9, 
   3.6252211442437525`*^9}, {3.625221186024481*^9, 3.6252211868770466`*^9}, {
   3.625221235065028*^9, 3.6252212752547007`*^9}, {3.6252213230544243`*^9, 
   3.6252213777217054`*^9}, {3.6252214205771475`*^9, 
   3.6252215590490484`*^9}, {3.6252217588196306`*^9, 3.625221914712093*^9}, {
   3.625221948184307*^9, 3.6252219816014853`*^9}, {3.625222521642317*^9, 
   3.6252225383263893`*^9}, {3.625222588967373*^9, 3.625222681946081*^9}, {
   3.625222714992013*^9, 3.6252227332321177`*^9}, {3.625222794481768*^9, 
   3.625222839315524*^9}, {3.625222907477761*^9, 3.6252230926606617`*^9}, {
   3.625223184295478*^9, 3.6252232197309957`*^9}, {3.6252232817971883`*^9, 
   3.6252232854566154`*^9}, 3.62522337378924*^9, {3.6252234629324017`*^9, 
   3.6252235577103033`*^9}, {3.62522359706042*^9, 3.6252236712926855`*^9}, {
   3.6252238237958984`*^9, 3.6252239950405483`*^9}, {3.6252241893855305`*^9, 
   3.6252243402056265`*^9}, {3.6252243728763094`*^9, 
   3.6252244042451277`*^9}, {3.6252244471676135`*^9, 
   3.6252246106180935`*^9}, {3.6252246520325785`*^9, 
   3.6252246536036205`*^9}, {3.625224743458256*^9, 3.6252249275534353`*^9}, {
   3.625225008354061*^9, 3.625225072903901*^9}, {3.625225128443761*^9, 
   3.625225168139106*^9}, {3.6252252546995525`*^9, 3.625225256077468*^9}, {
   3.625225301260455*^9, 3.6252253022741275`*^9}, {3.6252253778873105`*^9, 
   3.6252255105773726`*^9}, {3.6252256060497355`*^9, 3.625225627822194*^9}, {
   3.6252257753110704`*^9, 3.6252257994741073`*^9}, {3.6252258754835525`*^9, 
   3.625225925858985*^9}, {3.625225965294157*^9, 3.625226024630537*^9}, 
   3.6252262701284685`*^9, {3.6252263006147013`*^9, 3.62522632917966*^9}, {
   3.6252264124219046`*^9, 3.625226453418113*^9}, {3.6252268112066483`*^9, 
   3.625226813460144*^9}, {3.625226863316232*^9, 3.6252269152216806`*^9}, {
   3.625226976589409*^9, 3.6252269999689255`*^9}, {3.625227034485833*^9, 
   3.625227084050728*^9}, {3.625227118916868*^9, 3.6252271723583355`*^9}, {
   3.625227202643436*^9, 3.625227380171256*^9}, {3.6252274921725893`*^9, 
   3.6252275139270267`*^9}, {3.6252280002838097`*^9, 3.625228035747345*^9}, {
   3.6252280712769265`*^9, 3.625228096524682*^9}, {3.6252282604824967`*^9, 
   3.6252282715978737`*^9}, 3.625228301725869*^9, {3.625228340612677*^9, 
   3.625228392339007*^9}, {3.6252284442704725`*^9, 3.625228515052449*^9}, 
   3.6252286143103237`*^9, {3.6252289303181696`*^9, 3.625228937377855*^9}, {
   3.625228993464077*^9, 3.625229098124537*^9}, {3.625229131852923*^9, 
   3.6252291503031683`*^9}, {3.6252292342332*^9, 3.625229274022607*^9}, {
   3.6252293115435095`*^9, 3.6252293342806*^9}, {3.625229384734084*^9, 
   3.62522946479622*^9}, {3.625229501146344*^9, 3.625229608442554*^9}, 
   3.625230700548358*^9, {3.62523116978878*^9, 3.62523117075142*^9}, {
   3.6252312022513247`*^9, 3.6252312213119745`*^9}, {3.625231325923403*^9, 
   3.6252313741233926`*^9}, {3.6252314241626024`*^9, 3.625231424802027*^9}, {
   3.625231479533351*^9, 3.62523149093892*^9}, {3.6252934707774324`*^9, 
   3.6252935806373425`*^9}, {3.6252936903982744`*^9, 3.625293738887455*^9}, 
   3.625293788274232*^9, {3.6252938282087345`*^9, 3.6252938302490897`*^9}, {
   3.6252938760815077`*^9, 3.625293896624141*^9}, {3.6252940470329638`*^9, 
   3.625294132312562*^9}, {3.625294221468732*^9, 3.6252942529536276`*^9}, {
   3.625299187233882*^9, 3.625299255483177*^9}, 3.6252996148717003`*^9, {
   3.6252996617818284`*^9, 3.6252996648358545`*^9}, {3.6252996948657846`*^9, 
   3.6252998052140207`*^9}, {3.625306151737014*^9, 3.625306158784691*^9}, {
   3.6253062773053503`*^9, 3.6253063245437026`*^9}, {3.6253064016768928`*^9, 
   3.625306422551747*^9}, {3.625306499510823*^9, 3.6253065140384645`*^9}, {
   3.6253065833924932`*^9, 3.6253067200842113`*^9}, {3.6253067854896193`*^9, 
   3.6253068008187933`*^9}, {3.6253069188541307`*^9, 3.625306959211915*^9}, {
   3.625307006063009*^9, 3.625307145222369*^9}, {3.625307181337335*^9, 
   3.6253072203332157`*^9}, {3.625307260956175*^9, 3.625307277602223*^9}, {
   3.625307322429974*^9, 3.6253073339926476`*^9}, {3.6253080943822994`*^9, 
   3.6253081350432854`*^9}, {3.6253081683073616`*^9, 3.62530820097104*^9}, {
   3.6253082545636077`*^9, 3.6253083424839582`*^9}, {3.625308446930277*^9, 
   3.6253084618391714`*^9}, {3.6253084990408616`*^9, 
   3.6253085281501803`*^9}, {3.6253085650176487`*^9, 3.62530858481779*^9}, {
   3.625308636357995*^9, 3.625308640151513*^9}, {3.6253086721537523`*^9, 
   3.625308716458156*^9}, {3.625308759467701*^9, 3.62530887957041*^9}, {
   3.6253090216416993`*^9, 3.6253090263288093`*^9}, {3.625309094304923*^9, 
   3.625309139477904*^9}, {3.625309201620146*^9, 3.6253095155104666`*^9}, {
   3.625309548134118*^9, 3.6253095854018517`*^9}, {3.6253096574606757`*^9, 
   3.6253097660577497`*^9}, {3.6253098630170984`*^9, 3.625309981437691*^9}, {
   3.6253104107145915`*^9, 3.6253104938787856`*^9}, {3.6253106171095705`*^9, 
   3.6253106224761324`*^9}, {3.6253106787404747`*^9, 
   3.6253107592208867`*^9}, {3.62531080712568*^9, 3.6253108940653796`*^9}, {
   3.6253126180333414`*^9, 3.6253126291527205`*^9}, {3.6253128388108654`*^9, 
   3.625312876932165*^9}, {3.625313020689575*^9, 3.6253130435977774`*^9}, {
   3.6253131725603676`*^9, 3.6253133804153147`*^9}, {3.6253135049659758`*^9, 
   3.6253135410389166`*^9}, {3.6253135959743757`*^9, 
   3.6253135969680357`*^9}, {3.6253136367164154`*^9, 
   3.6253137363595457`*^9}, {3.62531377370233*^9, 3.625313851559001*^9}, {
   3.62531396063139*^9, 3.625313980623658*^9}, {3.625314033741912*^9, 
   3.625314050844262*^9}, {3.625314170539702*^9, 3.6253142083858175`*^9}, {
   3.6253142595097485`*^9, 3.6253142982964907`*^9}, {3.6253143764543605`*^9, 
   3.6253145120493684`*^9}, {3.6253145993923197`*^9, 3.625314758244746*^9}, {
   3.625314794303677*^9, 3.6253148132602577`*^9}, {3.625314845696786*^9, 
   3.625314861606344*^9}, {3.625314894841402*^9, 3.625314987551932*^9}, {
   3.6253150648622403`*^9, 3.6253151170338655`*^9}, {3.625315208318449*^9, 
   3.6253152389517794`*^9}, {3.6253153826201286`*^9, 3.625315469431743*^9}, {
   3.625315521639392*^9, 3.6253157770098753`*^9}, {3.6253158731997137`*^9, 
   3.6253158842570524`*^9}, {3.625316277193835*^9, 3.6253163095102825`*^9}, {
   3.6253163671325245`*^9, 3.625316389383292*^9}, {3.625316674367082*^9, 
   3.6253166997749443`*^9}, {3.625316781461158*^9, 3.625316885114951*^9}, {
   3.625317246428745*^9, 3.6253173146910486`*^9}, {3.6253173674300504`*^9, 
   3.6253173719140263`*^9}, {3.6253174245079336`*^9, 3.625317451730999*^9}, {
   3.6253174843976793`*^9, 3.6253175610935802`*^9}, {3.625317595909687*^9, 
   3.625317615139449*^9}, {3.6253176675432286`*^9, 3.6253176995644803`*^9}, {
   3.625317736078713*^9, 3.625317829106454*^9}, {3.6253179992003407`*^9, 
   3.6253180113964357`*^9}, {3.625318186706785*^9, 3.6253182049629*^9}, {
   3.625318334796068*^9, 3.625318365091174*^9}, {3.6253184206860714`*^9, 
   3.6253184469264865`*^9}, {3.625318694346693*^9, 3.625318694867038*^9}, {
   3.62532455395868*^9, 3.625324660275241*^9}, {3.6253247023101377`*^9, 
   3.6253247631793623`*^9}, {3.6253249544893312`*^9, 
   3.6253249670786853`*^9}, {3.6253252770043745`*^9, 3.6253252774216523`*^9}, 
   3.625325550073282*^9, {3.625326054079874*^9, 3.625326072814307*^9}, {
   3.625326284280653*^9, 3.6253263200523944`*^9}, {3.6253280219547586`*^9, 
   3.6253280543112316`*^9}, {3.625556263874431*^9, 3.6255562911845565`*^9}, {
   3.625556339291484*^9, 3.6255563402581253`*^9}, {3.625556738426379*^9, 
   3.6255567634659977`*^9}, {3.6255568708172445`*^9, 3.625556901822822*^9}, {
   3.6255569379648085`*^9, 3.6255569472219524`*^9}, {3.6255571159079046`*^9, 
   3.6255571210973487`*^9}, {3.626496329078463*^9, 3.626496348269456*^9}, {
   3.626496379721356*^9, 3.626496415781577*^9}, {3.626496478532096*^9, 
   3.626496563759957*^9}, {3.626496600500637*^9, 3.6264966381368914`*^9}, {
   3.626496710018921*^9, 3.6264967140335884`*^9}, {3.6264968806980886`*^9, 
   3.6264968811453857`*^9}, 3.6273670020107174`*^9, {3.630969812033251*^9, 
   3.630969812084284*^9}, {3.636430411248167*^9, 3.636430464258616*^9}, {
   3.636430574297887*^9, 3.636430580833844*^9}, {3.636430638053337*^9, 
   3.636430649250955*^9}, {3.636430690650444*^9, 3.63643075182899*^9}, {
   3.6364309119462013`*^9, 3.6364311474783583`*^9}, 3.63643120509418*^9, 
   3.636431244291082*^9, {3.63643138828611*^9, 3.636431403158126*^9}, {
   3.636431437063333*^9, 3.636431441662833*^9}, {3.6364528790116587`*^9, 
   3.636452880559298*^9}, {3.6365152871021748`*^9, 3.6365153084871073`*^9}, 
   3.636515527303523*^9, {3.636515597953497*^9, 3.636515603840073*^9}, {
   3.636515678764413*^9, 3.636515697572631*^9}, {3.636515755241622*^9, 
   3.636515794547304*^9}, {3.636515839166169*^9, 3.636515858257346*^9}, {
   3.6365164752070713`*^9, 3.636516485243099*^9}, {3.636518361579351*^9, 
   3.6365184086158247`*^9}, {3.636518678454998*^9, 3.636518725484923*^9}, {
   3.636518861029854*^9, 3.6365188811744223`*^9}, 3.636518950846974*^9, {
   3.63652020080538*^9, 3.6365202332875633`*^9}, {3.636693107034112*^9, 
   3.636693127482608*^9}, {3.648691984359164*^9, 3.648691994086624*^9}, {
   3.64869203151248*^9, 3.648692050495085*^9}, {3.6486924632091703`*^9, 
   3.648692480578706*^9}, {3.6486925153127728`*^9, 3.6486925248971367`*^9}, 
   3.6489611139486513`*^9, {3.7214473263362513`*^9, 3.7214473318713017`*^9}, {
   3.721447444102982*^9, 3.7214474475664663`*^9}, {3.721447526540522*^9, 
   3.721447533841584*^9}, {3.721447603737103*^9, 3.721447609169169*^9}, {
   3.7214476854085703`*^9, 3.721447789177582*^9}, 3.721447829537491*^9, {
   3.7214479029146557`*^9, 3.7214479291942453`*^9}, {3.721447985801834*^9, 
   3.7214479996741734`*^9}, {3.721448091314249*^9, 3.721448105274411*^9}, {
   3.721448137947218*^9, 3.721448167720804*^9}, 3.721448200166924*^9, {
   3.721448269257345*^9, 3.7214484780493393`*^9}, 3.721448680651931*^9, {
   3.7214487365214987`*^9, 3.721448736810614*^9}, {3.721448777634062*^9, 
   3.7214487778906612`*^9}, {3.721449038869617*^9, 3.721449039008786*^9}, {
   3.721449535796804*^9, 3.721449536886242*^9}, {3.721449690813941*^9, 
   3.721449698316024*^9}, {3.721450320453661*^9, 3.721450325399003*^9}, {
   3.721450548985427*^9, 3.721450557025943*^9}, {3.721535355626676*^9, 
   3.721535362580887*^9}, {3.721535437106536*^9, 3.721535444066293*^9}, {
   3.721536344956002*^9, 3.721536469990004*^9}, {3.72153650509198*^9, 
   3.721536525840782*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["FactorOut", "Subsubsection",
 CellChangeTimes->{{3.721451730181402*^9, 3.721451733061451*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "::", "usage"}], "=", 
   "\"\<FactorOut[m,x,\[Epsilon],\[Mu]] returns a transformation which \
reduces m to a factorized form.\>\""}], ";"}]], "Code"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "::", "notfuchsian"}], "=", 
   "\"\<Not Fuchsian matrix...\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "::", "notnormalized"}], "=", 
   "\"\<Eigenvalues of the matrix residues are not normalized...\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FactorOut", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"DependentRowIndices", "\[Rule]", "Automatic"}], ",", 
     RowBox[{"Solve", "\[Rule]", "True"}]}], "}"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.6253279815119176`*^9, 3.6253279823424683`*^9}, {
   3.6253282372536464`*^9, 3.625328256242247*^9}, {3.62532828821647*^9, 
   3.6253283738362927`*^9}, {3.6253284129722652`*^9, 3.62532844785942*^9}, {
   3.625328478441716*^9, 3.625328479057125*^9}, {3.6253289261178412`*^9, 
   3.625328959835209*^9}, {3.6253290055805655`*^9, 3.625329488837291*^9}, {
   3.62532952614205*^9, 3.6253296483329935`*^9}, {3.625329687642082*^9, 
   3.625329690137742*^9}, {3.6253297578837*^9, 3.6253300370629845`*^9}, {
   3.625330083973117*^9, 3.62533016369903*^9}, {3.6253302504975204`*^9, 
   3.625330254389104*^9}, {3.6253305102278976`*^9, 3.625330586282373*^9}, {
   3.625330627313605*^9, 3.6253306426277685`*^9}, {3.6253307256938972`*^9, 
   3.625330764002321*^9}, {3.625331772413579*^9, 3.625331837835998*^9}, {
   3.6255554236457925`*^9, 3.625555429400611*^9}, 3.636862761365727*^9, {
   3.636862802513592*^9, 3.636862802794469*^9}, {3.6816103356962137`*^9, 
   3.681610335845941*^9}, {3.6816103839804583`*^9, 3.681610497927836*^9}, {
   3.681613681267647*^9, 3.681613693064554*^9}, {3.6816137421577272`*^9, 
   3.68161384066824*^9}, {3.681614045343399*^9, 3.681614046478931*^9}, {
   3.705891671092375*^9, 3.7058918817318497`*^9}, {3.705892929866144*^9, 
   3.705892941050314*^9}, {3.721451842386711*^9, 3.721451863369669*^9}, {
   3.7214522524357777`*^9, 3.721452328837083*^9}, 3.721452507845632*^9, {
   3.721452574746566*^9, 3.7214525764696302`*^9}, 3.721452606641981*^9, {
   3.7214527629343767`*^9, 3.721452781221694*^9}, {3.721452825693466*^9, 
   3.72145286030191*^9}, {3.721452965375201*^9, 3.721452972511736*^9}, 
   3.721953765052177*^9, 3.7219538975323*^9, {3.722576554134058*^9, 
   3.722576557078549*^9}, {3.722576697502305*^9, 3.7225767081658583`*^9}, {
   3.722576756390956*^9, 3.722576790014408*^9}, {3.723250276245151*^9, 
   3.723250287332571*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_", ",", "\[Epsilon]_", ",", 
     "\[Mu]_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"FactorOut", "[", 
    RowBox[{
     RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", "\[Mu]",
      ",", "opts"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "[", 
    RowBox[{
    "as_Association", ",", "x_", ",", "\[Epsilon]_", ",", "\[Mu]_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"FactorOut", "[", 
    RowBox[{
     RowBox[{"as", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", "\[Mu]",
      ",", "opts"}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.6253279815119176`*^9, 3.6253279823424683`*^9}, {
   3.6253282372536464`*^9, 3.625328256242247*^9}, {3.62532828821647*^9, 
   3.6253283738362927`*^9}, {3.6253284129722652`*^9, 3.62532844785942*^9}, {
   3.625328478441716*^9, 3.625328479057125*^9}, {3.6253289261178412`*^9, 
   3.625328959835209*^9}, {3.6253290055805655`*^9, 3.625329488837291*^9}, {
   3.62532952614205*^9, 3.6253296483329935`*^9}, {3.625329687642082*^9, 
   3.625329690137742*^9}, {3.6253297578837*^9, 3.6253300370629845`*^9}, {
   3.625330083973117*^9, 3.62533016369903*^9}, {3.6253302504975204`*^9, 
   3.625330254389104*^9}, {3.6253305102278976`*^9, 3.625330586282373*^9}, {
   3.625330627313605*^9, 3.6253306426277685`*^9}, {3.6253307256938972`*^9, 
   3.625330764002321*^9}, {3.625331772413579*^9, 3.625331837835998*^9}, {
   3.6255554236457925`*^9, 3.625555429400611*^9}, 3.636862761365727*^9, {
   3.636862802513592*^9, 3.636862802794469*^9}, {3.6816103356962137`*^9, 
   3.681610335845941*^9}, {3.6816103839804583`*^9, 3.681610497927836*^9}, {
   3.681613681267647*^9, 3.681613693064554*^9}, {3.6816137421577272`*^9, 
   3.68161384066824*^9}, {3.681614045343399*^9, 3.681614046478931*^9}, {
   3.705891671092375*^9, 3.7058918817318497`*^9}, {3.705892929866144*^9, 
   3.705892941050314*^9}, {3.721451842386711*^9, 3.721451863369669*^9}, {
   3.7214522524357777`*^9, 3.721452328837083*^9}, 3.721452507845632*^9, {
   3.721452574746566*^9, 3.7214525764696302`*^9}, 3.721452606641981*^9, {
   3.7214527629343767`*^9, 3.721452781221694*^9}, {3.721452825693466*^9, 
   3.72145286030191*^9}, {3.721452965375201*^9, 3.721452972511736*^9}, 
   3.721953765052177*^9, 3.7219538975323*^9, {3.722576554134058*^9, 
   3.722576557078549*^9}, {3.722576697502305*^9, 3.7225767081658583`*^9}, {
   3.722576756390956*^9, 3.722576790014408*^9}, {3.723250276245151*^9, 
   3.723250280613402*^9}, {3.7232503472067966`*^9, 3.723250357262085*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FactorOut", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "x_", ",", "\[Epsilon]_", ",", 
    "\[Mu]_", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "m"}]}], ",", "mres", ",", "t", ",", "vars", 
      ",", "eqs", ",", "sol", ",", "ms"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"FuchsianQ", "[", 
         RowBox[{"m", ",", "x"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FactorOut", "::", "notfuchsian"}], "]"}], ";", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     RowBox[{"ms", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "DependentRowIndices", "]"}], ",", 
        RowBox[{"Automatic", "\[Rule]", 
         RowBox[{"TClosure", "[", "m", "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mres", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"LeadingSeriesCoefficient", "[", 
         RowBox[{
          FractionBox["m", "\[Epsilon]"], ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "#1", ",", "0"}], "}"}]}], "]"}], "&"}], "@@@", 
       RowBox[{"PolesInfo", "[", 
        RowBox[{"m", ",", "x"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"FactorDependence", "[", 
      RowBox[{"mres", ",", "\[Epsilon]", ",", "\[Mu]", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "\[Rule]", 
             RowBox[{"OptionValue", "[", "#", "]"}]}], "&"}], "@@@", 
           RowBox[{"Options", "[", "FactorOut", "]"}]}], ",", 
          RowBox[{"Options", "[", "FactorDependence", "]"}]}], "]"}]}]}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.6253279815119176`*^9, 3.6253279823424683`*^9}, {
   3.6253282372536464`*^9, 3.625328256242247*^9}, {3.62532828821647*^9, 
   3.6253283738362927`*^9}, {3.6253284129722652`*^9, 3.62532844785942*^9}, {
   3.625328478441716*^9, 3.625328479057125*^9}, {3.6253289261178412`*^9, 
   3.625328959835209*^9}, {3.6253290055805655`*^9, 3.625329488837291*^9}, {
   3.62532952614205*^9, 3.6253296483329935`*^9}, {3.625329687642082*^9, 
   3.625329690137742*^9}, {3.6253297578837*^9, 3.6253300370629845`*^9}, {
   3.625330083973117*^9, 3.62533016369903*^9}, {3.6253302504975204`*^9, 
   3.625330254389104*^9}, {3.6253305102278976`*^9, 3.625330586282373*^9}, {
   3.625330627313605*^9, 3.6253306426277685`*^9}, {3.6253307256938972`*^9, 
   3.625330764002321*^9}, {3.625331772413579*^9, 3.625331837835998*^9}, {
   3.6255554236457925`*^9, 3.625555429400611*^9}, 3.636862761365727*^9, {
   3.636862802513592*^9, 3.636862802794469*^9}, {3.6816103356962137`*^9, 
   3.681610335845941*^9}, {3.6816103839804583`*^9, 3.681610497927836*^9}, {
   3.681613681267647*^9, 3.681613693064554*^9}, {3.6816137421577272`*^9, 
   3.68161384066824*^9}, {3.681614045343399*^9, 3.681614046478931*^9}, {
   3.705891671092375*^9, 3.7058918817318497`*^9}, {3.705892929866144*^9, 
   3.705892941050314*^9}, {3.721451842386711*^9, 3.721451863369669*^9}, {
   3.7214522524357777`*^9, 3.721452328837083*^9}, 3.721452507845632*^9, {
   3.721452574746566*^9, 3.7214525764696302`*^9}, 3.721452606641981*^9, {
   3.7214527629343767`*^9, 3.721452781221694*^9}, {3.721452825693466*^9, 
   3.72145286030191*^9}, {3.721452965375201*^9, 3.721452972511736*^9}, 
   3.721953765052177*^9, 3.7219538975323*^9, {3.722576554134058*^9, 
   3.722576557078549*^9}, {3.722576697502305*^9, 3.7225767081658583`*^9}, {
   3.722576756390956*^9, 3.72257677301479*^9}, {3.72257688607679*^9, 
   3.722576888244738*^9}, {3.722576932944145*^9, 3.722576946088687*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "::", "notfuchsian"}], "=", 
   "\"\<Not Fuchsian matrix...\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "::", "notnormalized"}], "=", 
   "\"\<Eigenvalues of the matrix residues are not normalized...\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FactorOut", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"DependentRowIndices", "\[Rule]", "Automatic"}], ",", 
     RowBox[{"Run", "\[Rule]", "True"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_", ",", "\[Epsilon]_", ",", 
     "\[Mu]_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"FactorOut", "[", 
    RowBox[{
     RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", "\[Mu]",
      ",", "opts"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FactorOut", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "x_", ",", "\[Epsilon]_", ",", 
    "\[Mu]_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "m"}]}], ",", "mres", ",", "t", ",", "vars", 
      ",", "eqs", ",", "sol", ",", "ms"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"FuchsianQ", "[", 
         RowBox[{"m", ",", "x"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FactorOut", "::", "notfuchsian"}], "]"}], ";", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     RowBox[{"ms", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "DependentRowIndices", "]"}], ",", 
        RowBox[{"Automatic", "\[Rule]", 
         RowBox[{"TClosure", "[", "m", "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mres", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"LeadingSeriesCoefficient", "[", 
         RowBox[{
          FractionBox["m", "\[Epsilon]"], ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "#1", ",", "0"}], "}"}]}], "]"}], "&"}], "@@@", 
       RowBox[{"PolesInfo", "[", 
        RowBox[{"m", ",", "x"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "insert", " ", "here", " ", "check", " ", "for", " ", "normalization"}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"t", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vars", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"t", "[", 
           RowBox[{"[", "##", "]"}], "]"}], "=", 
          RowBox[{"Unique", "[", "\"\<t\>\"", "]"}]}], ")"}], "&"}], "@@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Outer", "[", 
            RowBox[{"List", ",", 
             RowBox[{"{", "#", "}"}], ",", 
             RowBox[{"DependentRowIndices", "[", 
              RowBox[{"ms", ",", 
               RowBox[{"{", "#", "}"}]}], "]"}]}], "]"}], "&"}], "/@", 
          RowBox[{"Range", "[", "n", "]"}]}], ",", "2"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"eqs", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"#", ".", "t"}], "-", 
           RowBox[{"t", ".", 
            RowBox[{"(", 
             RowBox[{"#", "/.", 
              RowBox[{"\[Epsilon]", "\[Rule]", "\[Mu]"}]}], ")"}]}]}], ")"}], 
         "&"}], "/@", "mres"}], "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"OptionValue", "[", "Run", "]"}]}], ",", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Returning a pair {eqs,t}. To find the transformation one should \
solve eqs\[Equal]0 with respect to Variables[t] and substitute the solution \
to t.\>\"", "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"eqs", ",", "t"}], "}"}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Quiet", "[", 
      RowBox[{"sol", "=", 
       RowBox[{"GaussSolve", "[", 
        RowBox[{"eqs", ",", "vars"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "/.", "sol"}], "/.", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", 
          RowBox[{"C", "@@", "#2"}]}], "&"}], ",", 
        RowBox[{"Complement", "[", 
         RowBox[{"vars", ",", 
          RowBox[{"First", "/@", "sol"}]}], "]"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.6253279815119176`*^9, 3.6253279823424683`*^9}, {
   3.6253282372536464`*^9, 3.625328256242247*^9}, {3.62532828821647*^9, 
   3.6253283738362927`*^9}, {3.6253284129722652`*^9, 3.62532844785942*^9}, {
   3.625328478441716*^9, 3.625328479057125*^9}, {3.6253289261178412`*^9, 
   3.625328959835209*^9}, {3.6253290055805655`*^9, 3.625329488837291*^9}, {
   3.62532952614205*^9, 3.6253296483329935`*^9}, {3.625329687642082*^9, 
   3.625329690137742*^9}, {3.6253297578837*^9, 3.6253300370629845`*^9}, {
   3.625330083973117*^9, 3.62533016369903*^9}, {3.6253302504975204`*^9, 
   3.625330254389104*^9}, {3.6253305102278976`*^9, 3.625330586282373*^9}, {
   3.625330627313605*^9, 3.6253306426277685`*^9}, {3.6253307256938972`*^9, 
   3.625330764002321*^9}, {3.625331772413579*^9, 3.625331837835998*^9}, {
   3.6255554236457925`*^9, 3.625555429400611*^9}, 3.636862761365727*^9, {
   3.636862802513592*^9, 3.636862802794469*^9}, {3.6816103356962137`*^9, 
   3.681610335845941*^9}, {3.6816103839804583`*^9, 3.681610497927836*^9}, {
   3.681613681267647*^9, 3.681613693064554*^9}, {3.6816137421577272`*^9, 
   3.68161384066824*^9}, {3.681614045343399*^9, 3.681614046478931*^9}, {
   3.705891671092375*^9, 3.7058918817318497`*^9}, {3.705892929866144*^9, 
   3.705892941050314*^9}, {3.721451842386711*^9, 3.721451863369669*^9}, {
   3.7214522524357777`*^9, 3.721452328837083*^9}, 3.721452507845632*^9, {
   3.721452574746566*^9, 3.7214525764696302`*^9}, 3.721452606641981*^9, {
   3.7214527629343767`*^9, 3.721452781221694*^9}, {3.721452825693466*^9, 
   3.72145286030191*^9}, {3.721452965375201*^9, 3.721452972511736*^9}, 
   3.721953765052177*^9, 3.7219538975323*^9, {3.722576554134058*^9, 
   3.722576557078549*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", "\"\<rewrite FactorOut in the spirit of SimplifyFuchsian\>\"", 
   "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.7219782811805468`*^9, 3.7219783244393473`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["FactorDependence", "Subsubsection",
 CellChangeTimes->{{3.721451730181402*^9, 3.721451733061451*^9}, {
  3.7225586958231983`*^9, 3.72255877230505*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FactorDependence", "::", "usage"}], "=", 
   "\"\<FactorDependence[{m1,m2,\[Ellipsis]},\[Epsilon],\[Mu]] returns a \
transformation which reduces m1,m2,... to \[Epsilon]\[LongDash]independent \
matrices.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.72255878207178*^9, 3.722558868020969*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FactorDependence", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"DependentRowIndices", "\[Rule]", "Automatic"}], ",", 
     RowBox[{"Solve", "\[Rule]", "True"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FactorDependence", "[", 
   RowBox[{
    RowBox[{"m", ":", 
     RowBox[{"{", 
      RowBox[{"__", "?", "SquareMatrixQ"}], "}"}]}], ",", "\[Epsilon]_", ",", 
    "\[Mu]_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"First", "@", "m"}], "]"}]}], ",", "t", ",", "vars", ",", 
      "eqs", ",", "sol", ",", "ms"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ms", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "DependentRowIndices", "]"}], ",", 
        RowBox[{"Automatic", "\[Rule]", 
         RowBox[{"tclosure", "[", 
          RowBox[{
           RowBox[{"Transpose", "[", 
            RowBox[{"m", ",", 
             RowBox[{"{", 
              RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", "1", 
           ",", 
           RowBox[{"Except", "[", 
            RowBox[{"{", 
             RowBox[{"0", ".."}], "}"}], "]"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "insert", " ", "here", " ", "check", " ", "for", " ", "normalization"}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"t", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vars", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"t", "[", 
           RowBox[{"[", "##", "]"}], "]"}], "=", 
          RowBox[{"Unique", "[", "\"\<t\>\"", "]"}]}], ")"}], "&"}], "@@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Outer", "[", 
            RowBox[{"List", ",", 
             RowBox[{"{", "#", "}"}], ",", 
             RowBox[{"DependentRowIndices", "[", 
              RowBox[{"ms", ",", 
               RowBox[{"{", "#", "}"}]}], "]"}]}], "]"}], "&"}], "/@", 
          RowBox[{"Range", "[", "n", "]"}]}], ",", "2"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"eqs", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"#", ".", "t"}], "-", 
           RowBox[{"t", ".", 
            RowBox[{"(", 
             RowBox[{"#", "/.", 
              RowBox[{"\[Epsilon]", "\[Rule]", "\[Mu]"}]}], ")"}]}]}], ")"}], 
         "&"}], "/@", "m"}], "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"OptionValue", "[", "Solve", "]"}]}], ",", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Returning a pair {eqs,t}. To find the transformation one should \
solve eqs\[Equal]0 with respect to Variables[t] and substitute the solution \
to t.\>\"", "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"eqs", ",", "t"}], "}"}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Quiet", "[", 
      RowBox[{"sol", "=", 
       RowBox[{"GaussSolve", "[", 
        RowBox[{"eqs", ",", "vars"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "/.", "sol"}], "/.", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", 
          RowBox[{"C", "@@", "#2"}]}], "&"}], ",", 
        RowBox[{"Complement", "[", 
         RowBox[{"vars", ",", 
          RowBox[{"First", "/@", "sol"}]}], "]"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.6253279815119176`*^9, 3.6253279823424683`*^9}, {
   3.6253282372536464`*^9, 3.625328256242247*^9}, {3.62532828821647*^9, 
   3.6253283738362927`*^9}, {3.6253284129722652`*^9, 3.62532844785942*^9}, {
   3.625328478441716*^9, 3.625328479057125*^9}, {3.6253289261178412`*^9, 
   3.625328959835209*^9}, {3.6253290055805655`*^9, 3.625329488837291*^9}, {
   3.62532952614205*^9, 3.6253296483329935`*^9}, {3.625329687642082*^9, 
   3.625329690137742*^9}, {3.6253297578837*^9, 3.6253300370629845`*^9}, {
   3.625330083973117*^9, 3.62533016369903*^9}, {3.6253302504975204`*^9, 
   3.625330254389104*^9}, {3.6253305102278976`*^9, 3.625330586282373*^9}, {
   3.625330627313605*^9, 3.6253306426277685`*^9}, {3.6253307256938972`*^9, 
   3.625330764002321*^9}, {3.625331772413579*^9, 3.625331837835998*^9}, {
   3.6255554236457925`*^9, 3.625555429400611*^9}, 3.636862761365727*^9, {
   3.636862802513592*^9, 3.636862802794469*^9}, {3.6816103356962137`*^9, 
   3.681610335845941*^9}, {3.6816103839804583`*^9, 3.681610497927836*^9}, {
   3.681613681267647*^9, 3.681613693064554*^9}, {3.6816137421577272`*^9, 
   3.68161384066824*^9}, {3.681614045343399*^9, 3.681614046478931*^9}, {
   3.705891671092375*^9, 3.7058918817318497`*^9}, {3.705892929866144*^9, 
   3.705892941050314*^9}, {3.721451842386711*^9, 3.721451863369669*^9}, {
   3.7214522524357777`*^9, 3.721452328837083*^9}, 3.721452507845632*^9, {
   3.721452574746566*^9, 3.7214525764696302`*^9}, 3.721452606641981*^9, {
   3.7214527629343767`*^9, 3.721452781221694*^9}, {3.721452825693466*^9, 
   3.72145286030191*^9}, {3.721452965375201*^9, 3.721452972511736*^9}, 
   3.721953765052177*^9, 3.7219538975323*^9, {3.722558878615649*^9, 
   3.72255899092308*^9}, 3.722559050676868*^9, {3.722559091028425*^9, 
   3.722559098294598*^9}, {3.7225591786640987`*^9, 3.722559214417663*^9}, {
   3.722559246872656*^9, 3.7225592732400217`*^9}, {3.72255932582837*^9, 
   3.722559325956849*^9}, {3.722559484806509*^9, 3.722559494816758*^9}, {
   3.722559632856444*^9, 3.722559637240152*^9}, {3.723250311413713*^9, 
   3.723250319581985*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["BlockTriangularToFuchsian", "Subsubsection",
 CellChangeTimes->{
  3.7185784431616087`*^9, {3.719597588805992*^9, 3.719597599101102*^9}, {
   3.7217290573432302`*^9, 3.721729150011833*^9}, {3.721729676481063*^9, 
   3.721729694087757*^9}, {3.7225770311508007`*^9, 3.7225770331751432`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BlockTriangularToFuchsian", "::", "usage"}], "=", 
   "\"\<BlockTriangularToFuchsian[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] gets rid of multiple poles in off-diagonal \
elements.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.625389554485264*^9, 3.625389668360841*^9}, {
  3.6253907600833893`*^9, 3.6253907606147423`*^9}, {3.6278829977877383`*^9, 
  3.6278830369077015`*^9}, {3.7225650225607443`*^9, 3.722565022737211*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "BlockTriangularToFuchsian", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Simplify", "\[Rule]", "False"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.7225652030752573`*^9, 3.722565221519306*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BlockTriangularToFuchsian", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_", ",", 
     RowBox[{"p", ":", 
      RowBox[{"(", 
       RowBox[{"_List", "|", "All"}], ")"}], ":", "All"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"BlockTriangularToFuchsian", "[", 
    RowBox[{
     RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "p", ",", "opts"}], 
    "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.722576385956354*^9, 3.722576428596874*^9}, 
   3.722754126340829*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BlockTriangularToFuchsian", "[", 
    RowBox[{"as_Association", ",", "x_", ",", 
     RowBox[{"p", ":", 
      RowBox[{"(", 
       RowBox[{"_List", "|", "All"}], ")"}], ":", "All"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"BlockTriangularToFuchsian", "[", 
    RowBox[{
     RowBox[{"as", "[", "x", "]"}], ",", "x", ",", "p", ",", "opts"}], 
    "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.722576385956354*^9, 3.722576428596874*^9}, 
   3.722754126340829*^9, {3.723250387533922*^9, 3.72325040207794*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"BlockTriangularToFuchsian", "::", "blocks"}], "=", 
   "\"\<Diagonal blocks are not Fuchsian...\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlockTriangularToFuchsian", "[", 
   RowBox[{"matr_", ",", "x_", ",", 
    RowBox[{"p", ":", 
     RowBox[{"(", 
      RowBox[{"_List", "|", "All"}], ")"}], ":", "All"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "matr"}]}], ",", "order", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"m", "=", "matr"}], ",", "mt", ",", "i1", ",", "i2", ",", 
      "\[IndentingNewLine]", "ind1", ",", "ind2", ",", "t", ",", "o", ",", 
      "vars", ",", "sol", ",", "\[IndentingNewLine]", "transform", ",", "c", 
      ",", "\[IndentingNewLine]", "poles", ",", 
      RowBox[{"oc", "=", 
       RowBox[{"Boole", "[", 
        RowBox[{"Not", "[", 
         RowBox[{"TrueQ", "@", 
          RowBox[{"OptionValue", "[", "Simplify", "]"}]}], "]"}], "]"}]}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"blocks", "=", 
       RowBox[{"EntangledBlocksIndices", "[", "matr", "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"poles", "=", 
      RowBox[{"Reverse", "@", 
       RowBox[{"SortBy", "[", 
        RowBox[{
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"Replace", "[", 
            RowBox[{"p", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"All", ":>", 
                RowBox[{"PolesInfo", "[", 
                 RowBox[{"matr", ",", "x"}], "]"}]}], ",", 
               RowBox[{"_", "\[RuleDelayed]", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"#", ",", 
                    RowBox[{"PoincareRank", "[", 
                    RowBox[{"matr", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#"}], "}"}]}], "]"}]}], "}"}], "&"}], "/@",
                   "p"}], ")"}]}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"_", ",", 
             RowBox[{"_", "?", "Negative"}]}], "}"}]}], "]"}], ",", "Last"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"transform", "=", 
      RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"poles", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", "transform", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"And", "@@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"FuchsianQ", "[", 
             RowBox[{
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{"#", ",", "#"}], "]"}], "]"}], ",", "x"}], "]"}], 
            "&"}], "/@", "blocks"}], ")"}]}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"BlockTriangularToFuchsian", "::", "blocks"}], "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"IdentityMatrix", "[", "n", "]"}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", "x0", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Cycle", " ", "over", " ", 
          RowBox[{"blocks", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"First", ",", " ", 
             RowBox[{"generate", " ", "matrix"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"c", "=", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"0", ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ind1", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"blocks", "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], ";", 
             RowBox[{"ind2", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"blocks", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", 
                  RowBox[{"(", 
                   RowBox[{"i1", "-", "1"}], ")"}]}], "]"}], "]"}], "]"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"vars", "=", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Unique", "[", "\"\<c\>\"", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Length", "@", "ind1"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Length", "@", "ind2"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], "=", "vars"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"vars", "=", 
              RowBox[{"Flatten", "@", "vars"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"matrix", " ", "generated"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"order", "=", 
              RowBox[{"PoincareRank", "[", 
               RowBox[{
                RowBox[{"m", "[", 
                 RowBox[{"[", 
                  RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "Now", " ", "cycle", " ", "over", " ", "pole", " ", "order"}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"x0", "=!=", "\[Infinity]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t", "=", 
                    RowBox[{
                    RowBox[{"IdentityMatrix", "[", "n", "]"}], "+", 
                    RowBox[{"c", "/", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x", "-", "x0"}], ")"}], "^", "i2"}]}]}]}], ";", 
                   RowBox[{"o", "=", 
                    RowBox[{"-", "1"}]}]}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t", "=", 
                    RowBox[{
                    RowBox[{"IdentityMatrix", "[", "n", "]"}], "+", 
                    RowBox[{"c", "*", 
                    RowBox[{
                    RowBox[{"(", "x", ")"}], "^", "i2"}]}]}]}], ";", 
                   RowBox[{"o", "=", "1"}]}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"mt", "=", 
                 RowBox[{"Transform", "[", 
                  RowBox[{"m", ",", "t", ",", "x"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Quiet", "[", 
                 RowBox[{
                  RowBox[{"Check", "[", 
                   RowBox[{
                    RowBox[{"sol", "=", 
                    RowBox[{"GaussSolve", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{
                    RowBox[{"mt", "[", 
                    RowBox[{"[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "x0", ",", 
                    RowBox[{"o", "-", "i2"}]}], "}"}]}], "]"}], "]"}], ",", 
                    "vars"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i2", ">", "0"}], ",", 
                    RowBox[{"Print", "[", "\"\<Problem\>\"", "]"}]}], "]"}], 
                    ";", 
                    RowBox[{"Continue", "[", "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"GaussSolve", "::", "inconsistent"}], "}"}]}], 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"GaussSolve", "::", "inconsistent"}], "}"}]}], 
                 "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"m", "=", 
                 RowBox[{"Factor", "[", 
                  RowBox[{
                   RowBox[{"mt", "/.", "sol"}], "/.", 
                   RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "@", "c"}], "\[Rule]", "0"}], "]"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"transform", "=", 
                 RowBox[{"Factor", "[", 
                  RowBox[{"transform", ".", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"t", "/.", "sol"}], "/.", 
                    RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "@", "c"}], "\[Rule]", "0"}], "]"}]}], 
                    ")"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i2", ",", "order", ",", "oc", ",", 
                 RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", "2", ",", 
              RowBox[{"Length", "@", "blocks"}]}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{
            "x0", ",", "\"\<:\>\"", ",", "i1", ",", "\"\<\[LeftArrow]\>\"", 
             ",", "i2"}], "}"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
       "]"}], "/@", 
      RowBox[{"First", "/@", "poles"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "transform", "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.625378712674498*^9, 3.625378972668049*^9}, {
   3.625379019330018*^9, 3.6253791308640404`*^9}, {3.6253793118251395`*^9, 
   3.6253793259975457`*^9}, {3.625379370174864*^9, 3.625379375779585*^9}, {
   3.625379411205097*^9, 3.6253795419668784`*^9}, {3.625380216321431*^9, 
   3.6253802943882427`*^9}, {3.6253803247984247`*^9, 
   3.6253804168114915`*^9}, {3.6253807586753774`*^9, 3.625380892367106*^9}, {
   3.6253814177845078`*^9, 3.6253817359276514`*^9}, {3.6253817844948835`*^9, 
   3.6253818856520195`*^9}, {3.6253825433395095`*^9, 
   3.6253828422849126`*^9}, {3.625382917682953*^9, 3.625382979571026*^9}, {
   3.6253830148034086`*^9, 3.6253830852671747`*^9}, {3.6253831222056894`*^9, 
   3.6253831668463163`*^9}, {3.6253834044930363`*^9, 
   3.6253834191157417`*^9}, {3.6253835080647745`*^9, 
   3.6253835104863815`*^9}, {3.625383562265746*^9, 3.625383567175004*^9}, {
   3.6253837402155776`*^9, 3.625383753349295*^9}, {3.6253838154533157`*^9, 
   3.6253838185503716`*^9}, {3.6253839748190823`*^9, 3.625383978005197*^9}, {
   3.6253841103230133`*^9, 3.625384116866356*^9}, {3.62538428029482*^9, 
   3.625384388354536*^9}, {3.625384487435293*^9, 3.6253844973548765`*^9}, {
   3.625388601183956*^9, 3.6253886077443094`*^9}, 3.625388788919552*^9, {
   3.6253888232983675`*^9, 3.6253888260111675`*^9}, 3.6253899755076866`*^9, {
   3.6253906054777813`*^9, 3.6253906095114584`*^9}, {3.6253907509283123`*^9, 
   3.625390751070408*^9}, {3.636779847212949*^9, 3.63677994757589*^9}, {
   3.636780082944087*^9, 3.6367801026530247`*^9}, {3.636782512021681*^9, 
   3.636782524415447*^9}, {3.636782650830504*^9, 3.636782653088087*^9}, {
   3.636809723410131*^9, 3.636809729579875*^9}, {3.636814886573309*^9, 
   3.6368148901306543`*^9}, {3.636815176813446*^9, 3.6368151991542263`*^9}, {
   3.636815300137587*^9, 3.6368153016901913`*^9}, {3.636815987687482*^9, 
   3.636815994918272*^9}, {3.68161405189056*^9, 3.681614052850561*^9}, {
   3.70106099525415*^9, 3.701060995910063*^9}, {3.7010612241663427`*^9, 
   3.70106122553883*^9}, {3.701061260500371*^9, 3.701061296518874*^9}, {
   3.701061429807447*^9, 3.701061462207486*^9}, {3.701061577415759*^9, 
   3.701061591816835*^9}, {3.701061666544174*^9, 3.701061682550577*^9}, {
   3.721751248503564*^9, 3.721751284284225*^9}, {3.7219537599557123`*^9, 
   3.721953759962091*^9}, {3.72195389755941*^9, 3.7219538975645733`*^9}, {
   3.7219784347008257`*^9, 3.721978461446856*^9}, {3.7219785234607573`*^9, 
   3.721978550209847*^9}, 3.721978590045052*^9, {3.721978696853903*^9, 
   3.721978726782259*^9}, {3.721978760918068*^9, 3.721978827645509*^9}, {
   3.721978862153886*^9, 3.721978900918065*^9}, {3.721978959655129*^9, 
   3.721979228582507*^9}, {3.721981777998444*^9, 3.721981805285931*^9}, {
   3.721981889349906*^9, 3.721981905374929*^9}, {3.7219819790063887`*^9, 
   3.721981983853489*^9}, {3.721982098631998*^9, 3.72198210087181*^9}, {
   3.7219823151841516`*^9, 3.721982315336897*^9}, {3.722062217667783*^9, 
   3.72206222128535*^9}, {3.722062326421666*^9, 3.722062335381789*^9}, 
   3.722062376545657*^9, {3.722062529566758*^9, 3.722062534326943*^9}, {
   3.7220626067757797`*^9, 3.722062634872116*^9}, {3.722115931734398*^9, 
   3.722115950685521*^9}, 3.72212239041348*^9, {3.7221224210701027`*^9, 
   3.722122428189169*^9}, {3.722125379597105*^9, 3.7221253946785727`*^9}, {
   3.72222674133607*^9, 3.722226963608832*^9}, {3.72256019550611*^9, 
   3.722560208202252*^9}, {3.722565229180984*^9, 3.722565303493278*^9}, 
   3.722565375423127*^9, {3.722754105395754*^9, 3.722754117179433*^9}}]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Extra information", "Subsection",
 CellChangeTimes->{{3.719625063544799*^9, 3.719625067337255*^9}}],

Cell[CellGroupData[{

Cell["Denominators", "Subsubsection",
 CellChangeTimes->{
  3.7185784431616087`*^9, {3.719597588805992*^9, 3.719597599101102*^9}, {
   3.7217290573432302`*^9, 3.721729058225082*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Denominators", "::", "usage"}], "=", "\"\<Denominators[\!\(\*
StyleBox[\"m\", \"TI\"]\)|\!\(\*
StyleBox[\"ds\", \"TI\"]\)] tries to define denominators in the \
system.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719597605100361*^9, 3.719597607809556*^9}, {
  3.71960027405249*^9, 3.719600306629243*^9}, {3.719736929151567*^9, 
  3.719736942518878*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Denominators", "[", 
   RowBox[{"m_List", ",", 
    RowBox[{"excl_:", 
     RowBox[{"_", "?", "NumericQ"}]}]}], "]"}], ":=", 
  RowBox[{"DeleteCases", "[", 
   RowBox[{
    RowBox[{"Union", "@@", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"First", "/@", 
          RowBox[{"FactorList", "[", "#", "]"}]}], ")"}], "&"}], "/@", 
       RowBox[{"Denominator", "/@", 
        RowBox[{"Flatten", "[", "m", "]"}]}]}], ")"}]}], ",", "excl"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Denominators", "[", 
   RowBox[{"ex_", ",", 
    RowBox[{"excl_:", 
     RowBox[{"_", "?", "NumericQ"}]}]}], "]"}], ":=", 
  RowBox[{"DeleteCases", "[", 
   RowBox[{
    RowBox[{"First", "/@", 
     RowBox[{"FactorList", "[", 
      RowBox[{"Denominator", "@", "ex"}], "]"}]}], ",", "excl"}], 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.719736979223723*^9, 3.7197370963939323`*^9}, {
  3.719737141498554*^9, 3.719737156138322*^9}, {3.719737196555374*^9, 
  3.719737213387659*^9}, {3.719739556214695*^9, 3.719739556895228*^9}, {
  3.7219765641782227`*^9, 3.721976617151422*^9}, {3.721976736923223*^9, 
  3.721976739294664*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Denominators", "[", 
   RowBox[{"ds_", "?", "DSystemQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "dens", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dens", "=", 
      RowBox[{"Denominators", "/.", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", "2"}],
         "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"dens", "===", "Denominators"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dens", "=", 
         RowBox[{"Denominators", "[", 
          RowBox[{
           RowBox[{"Values", "[", 
            RowBox[{
             RowBox[{"History", "[", "ds", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], 
             "]"}], "]"}], ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"FreeQ", "[", 
               RowBox[{"#", ",", 
                RowBox[{"Alternatives", "@@", 
                 RowBox[{"Variables", "[", "ds", "]"}]}]}], "]"}], "&"}], 
             ")"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"HistoryAddExtra", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"Denominators", "\[Rule]", "dens"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Read Denominators from extras.\>\"", ",", "Small"}], 
         "]"}], "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "dens"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.719739273660943*^9, 3.719739343502132*^9}, {
   3.71973939476729*^9, 3.7197394794307613`*^9}, 3.7197395324401283`*^9, {
   3.719739567592842*^9, 3.7197396052156553`*^9}, {3.7197396500726433`*^9, 
   3.7197396607606077`*^9}, {3.7197567098197803`*^9, 3.719756750010198*^9}, 
   3.721354420145203*^9, 3.721381329565214*^9, {3.7232504707835407`*^9, 
   3.7232504844710627`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Denominators", "[", "as_Assiciation", "]"}], ":=", 
  RowBox[{"Denominators", "[", 
   RowBox[{
    RowBox[{"Values", "[", 
     RowBox[{
      RowBox[{"History", "[", "as", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "as", "]"}], ",", "1"}], "]"}], "]"}], 
     "]"}], ",", 
    RowBox[{"_", "?", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"FreeQ", "[", 
        RowBox[{"#", ",", 
         RowBox[{"Alternatives", "@@", 
          RowBox[{"Variables", "[", "as", "]"}]}]}], "]"}], "&"}], ")"}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.723250512343438*^9, 3.723250567967629*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Denominators", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "excl_"}], "]"}], ":=", 
  RowBox[{"Denominators", "[", 
   RowBox[{
    RowBox[{"Values", "[", 
     RowBox[{
      RowBox[{"History", "[", "ds", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}], 
     "]"}], ",", "excl"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.719739273660943*^9, 3.719739343502132*^9}, {
   3.71973939476729*^9, 3.7197394794307613`*^9}, 3.7197395324401283`*^9, {
   3.719739567592842*^9, 3.7197396052156553`*^9}, {3.7197396500726433`*^9, 
   3.7197396607606077`*^9}, {3.7197567098197803`*^9, 3.719756750010198*^9}, {
   3.71975681604849*^9, 3.719756844962936*^9}, 3.721354422168474*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["DenominatorOrder", "Subsubsection",
 CellChangeTimes->{{3.721976901002058*^9, 3.721976907290285*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DenominatorOrder", "::", "usage"}], "=", 
   "\"\<DenominatorOrder[m|ds,den] tries to define the power of the \
denominator. Negative values correspond to numerators.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721977034499267*^9, 3.721977109251379*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DenominatorOrder", "[", 
    RowBox[{"0", ",", "den_"}], "]"}], ":=", 
   RowBox[{"-", "\[Infinity]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DenominatorOrder", "[", 
    RowBox[{"ex_", ",", "den_"}], "]"}], ":=", 
   RowBox[{"Plus", "@@", 
    RowBox[{"Cases", "[", 
     RowBox[{
      RowBox[{"FactorList", "[", 
       RowBox[{"Denominator", "@", "ex"}], "]"}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"den", ",", "n_"}], "}"}], "\[RuleDelayed]", "n"}]}], 
     "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DenominatorOrder", "[", 
    RowBox[{"m_List", ",", "den_"}], "]"}], ":=", 
   RowBox[{"Max", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"DenominatorOrder", "[", 
       RowBox[{"#", ",", "den"}], "]"}], "&"}], "/@", 
     RowBox[{"Flatten", "[", "m", "]"}]}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.7219769260513144`*^9, 3.721977021490905*^9}, {
   3.721977243052451*^9, 3.7219772526602697`*^9}, 3.7220344398076468`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DenominatorOrder", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "den_"}], "]"}], ":=", 
  RowBox[{"DenominatorOrder", "[", 
   RowBox[{
    RowBox[{"Values", "[", 
     RowBox[{
      RowBox[{"History", "[", "ds", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}], 
     "]"}], ",", "den"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.7219773444077044`*^9, 3.7219773755458612`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["PolesPosition,PoincareRank,PolesInfo", "Subsubsection",
 CellChangeTimes->{{3.719736554330112*^9, 3.719736556618268*^9}, {
   3.719736660651943*^9, 3.719736666874962*^9}, 3.721347165912397*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolesPosition", "::", "usage"}], "=", "\"\<PolesPosition[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] tries to determine all singular points of the \
matrix \!\(\*
StyleBox[\"m\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719736704108397*^9, 3.719736705123682*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PolesPosition", "[", 
   RowBox[{"m_List", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"xf", ",", "t", ",", "mr"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"xf", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"x", "/.", "#"}], "&"}], "/@", 
       RowBox[{"Union", "@", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Solve", "[", 
            RowBox[{
             RowBox[{"#", "==", "0"}], ",", "x"}], "]"}], "&"}], "/@", 
          RowBox[{"Denominators", "[", 
           RowBox[{
            RowBox[{"{", "m", "}"}], ",", 
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"FreeQ", "[", 
                RowBox[{"#", ",", "x"}], "]"}], "&"}], ")"}]}]}], "]"}]}], 
         "]"}]}]}]}], ";", "\n", 
     RowBox[{"mr", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{
        RowBox[{"m", "/", 
         RowBox[{"t", "^", "2"}]}], "/.", 
        RowBox[{"x", "->", 
         RowBox[{"1", "/", "t"}]}]}], "]"}]}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Quiet", "[", 
        RowBox[{"Check", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"mr", "/.", 
            RowBox[{"t", "->", "0"}]}], ";", "False"}], ",", "True", ",", 
          RowBox[{"Power", "::", "infy"}]}], "]"}], "]"}], ",", 
       RowBox[{"Sort", "[", 
        RowBox[{"Append", "[", 
         RowBox[{"xf", ",", "\[Infinity]"}], "]"}], "]"}], ",", 
       RowBox[{"Sort", "[", "xf", "]"}]}], "]"}]}]}], "\n", "]"}]}]], "Code",
 CellChangeTimes->{{3.719736677996518*^9, 3.719736681067746*^9}, {
   3.719736796861615*^9, 3.719736799341333*^9}, {3.719737425433752*^9, 
   3.719737439536669*^9}, {3.719737481561388*^9, 3.719737501386426*^9}, {
   3.719737535102695*^9, 3.719737535244396*^9}, {3.719738178275887*^9, 
   3.719738197978187*^9}, {3.7197382627759027`*^9, 3.7197382767438726`*^9}, {
   3.719738380699574*^9, 3.7197383815550003`*^9}, 3.71974030262138*^9, {
   3.719740334420204*^9, 3.719740335031684*^9}, {3.719740374899373*^9, 
   3.719740378611689*^9}, {3.72134945235882*^9, 3.721349453006645*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PolesPosition", "[", 
   RowBox[{"ds_Association", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesPosition", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolesPosition", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesPosition", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.721349470158216*^9, 3.721349516490541*^9}, 
   3.72135442548881*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PoincareRank", "::", "usage"}], "=", "\"\<PoincareRank[\!\(\*
StyleBox[\"m\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\),\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"0\"]\)}] gives the Poincare rank \!\(\*
StyleBox[\"r\", \"TI\"]\) of the singular point \!\(\*
StyleBox[\"x\", \"TI\"]\)=\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"0\"]\) of \!\(\*
StyleBox[\"m\", \"TI\"]\). When \!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"0\"]\)\[NotEqual]\[Infinity] the Poincare rank is \
the pole order minus 1 (by convention, we put \!\(\*
StyleBox[\"r\", \"TI\"]\)=-1 for regular point). For \
\!\(\*SubscriptBox[\(x\), \(0\)]\)=\[Infinity] the Poincare rank is 1 minus \
the leading series order.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721346202040065*^9, 3.721346398389421*^9}, 
   3.721346429046461*^9, {3.7213469490178432`*^9, 3.721346989273954*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PoincareRank", "[", 
   RowBox[{"m_List", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Max", "[", 
   RowBox[{
    RowBox[{"-", "1"}], ",", 
    RowBox[{
     RowBox[{"2", "*", 
      RowBox[{"Boole", "[", 
       RowBox[{"x0", "===", "\[Infinity]"}], "]"}]}], "-", "1", "-", 
     RowBox[{"LeadingOrder", "[", 
      RowBox[{"m", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.6060104322261157`*^9, 3.606010433280815*^9}, {
   3.606010794843848*^9, 3.6060107983871937`*^9}, {3.636452713578679*^9, 
   3.6364527589755373`*^9}, 3.6364537390104094`*^9, {3.719737559467444*^9, 
   3.719737583875655*^9}, {3.7197387621489964`*^9, 3.71973877283679*^9}, {
   3.719738810405044*^9, 3.7197388577660933`*^9}, {3.719738889964478*^9, 
   3.719738971732685*^9}, {3.719739031860281*^9, 3.719739052652994*^9}, {
   3.7197390888280697`*^9, 3.719739090508568*^9}, {3.7213464644795017`*^9, 
   3.721346549557172*^9}, 3.721346647794207*^9, {3.721346696386647*^9, 
   3.721346712981488*^9}, {3.721346761507785*^9, 3.7213467744992247`*^9}, {
   3.7213495512639713`*^9, 3.721349551880341*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PoincareRank", "[", 
   RowBox[{"ds_Association", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"PoincareRank", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PoincareRank", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"PoincareRank", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.6060104322261157`*^9, 3.606010433280815*^9}, {
   3.606010794843848*^9, 3.6060107983871937`*^9}, {3.636452713578679*^9, 
   3.6364527589755373`*^9}, 3.6364537390104094`*^9, {3.719737559467444*^9, 
   3.719737583875655*^9}, {3.7197387621489964`*^9, 3.71973877283679*^9}, {
   3.719738810405044*^9, 3.7197388577660933`*^9}, {3.719738889964478*^9, 
   3.719738971732685*^9}, {3.719739031860281*^9, 3.719739052652994*^9}, {
   3.7197390888280697`*^9, 3.719739090508568*^9}, {3.7213464644795017`*^9, 
   3.721346549557172*^9}, 3.721346647794207*^9, {3.721346696386647*^9, 
   3.721346712981488*^9}, {3.721346761507785*^9, 3.7213467744992247`*^9}, {
   3.7213495512639713`*^9, 3.721349551880341*^9}, {3.721349592686908*^9, 
   3.721349620397695*^9}, 3.721354427344561*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{"ds_Association", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.721349470158216*^9, 3.72134953699432*^9}, 
   3.721354428888761*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolesInfo", "::", "usage"}], "=", "\"\<PolesInfo[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] gives a list of pairs {\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"i\"]\),\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], \"i\"]\)}, where \!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"i\"]\) is the position of the pole, and \
\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], \"i\"]\) is its Poincare rank.\>\""}], ";"}]], "Code",
 CellChangeTimes->{
  3.7197365605941353`*^9, {3.721347111973639*^9, 3.721347114445216*^9}, {
   3.721347197030368*^9, 3.721347214415675*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{"m_List", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"xs", ",", "n"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"xs", "=", 
      RowBox[{"PolesPosition", "[", 
       RowBox[{"m", ",", "x"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#", ",", 
         RowBox[{"PoincareRank", "[", 
          RowBox[{"m", ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "#"}], "}"}]}], "]"}]}], "}"}], "&"}], "/@", 
      "xs"}]}]}], "\n", "]"}]}]], "Code",
 CellChangeTimes->{{3.719736607475049*^9, 3.719736611291503*^9}, {
   3.719738641382263*^9, 3.719738680285675*^9}, 3.719740305637042*^9, {
   3.719740341595805*^9, 3.719740343459861*^9}, 3.719740384834916*^9, 
   3.7213470266041317`*^9, {3.7213471288688993`*^9, 3.721347129221262*^9}, {
   3.721347191166375*^9, 3.721347191302505*^9}, 3.7213495596023006`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{"ds_Association", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.721349470158216*^9, 3.72134953699432*^9}, 
   3.721354430784215*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Internal functions", "Subsection",
 CellChangeTimes->{{3.719634263608427*^9, 3.7196342671958313`*^9}, 
   3.719656274546493*^9}],

Cell["\<\
bsqr is a boolean version of the matrix square m.m, where \[Times] and + are \
replaced by \[And] and \[Or], respectively.
Looks like it is not needed yet.\
\>", "Text",
 CellChangeTimes->{{3.719634319009001*^9, 3.719634377969325*^9}, {
  3.71963694173005*^9, 3.719637066778029*^9}, {3.719637429974394*^9, 
  3.719637447334557*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bsqr", ":=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"m", ",", "_Integer", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mc", "=", "m"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mc", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "\[Equal]", "1"}], "&&", 
             RowBox[{
              RowBox[{"mc", "[", 
               RowBox[{"[", 
                RowBox[{"j", ",", "k"}], "]"}], "]"}], "\[Equal]", "1"}]}], 
            ",", 
            RowBox[{
             RowBox[{"mc", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "k"}], "]"}], "]"}], "=", "1"}]}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"Length", "@", "mc"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "mc"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", 
            RowBox[{"Length", "@", "mc"}]}], "}"}]}], "]"}], ";", "mc"}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7196343020585814`*^9, 3.7196343098696404`*^9}, {
  3.719636938900462*^9, 3.71963696847867*^9}, {3.71963721238832*^9, 
  3.7196372141228456`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ker", "=", 
   RowBox[{"Function", "[", 
    RowBox[{"m", ",", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"#", "===", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"0", ",", 
            RowBox[{"Length", "@", "m"}]}], "]"}], "}"}], ",", "#"}], "]"}], 
       "&"}], "[", 
      RowBox[{"NullSpace", "[", "m", "]"}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"im", "=", 
   RowBox[{"ker", "@*", "ker", "@*", "Transpose"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.721439314751301*^9, 3.721439421748402*^9}, 
   3.721693424070169*^9, {3.721695363519683*^9, 3.7216953666797028`*^9}, 
   3.721695483442234*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"ns", "=", 
     RowBox[{"Function", "[", 
      RowBox[{"m", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"#", "===", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{"0", ",", 
              RowBox[{"Length", "@", "m"}]}], "]"}], "}"}], ",", "#"}], "]"}],
          "&"}], "[", 
        RowBox[{"NullSpace", "[", "m", "]"}], "]"}]}], "]"}]}], ";"}], "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"ker", "=", 
     RowBox[{"Transpose", "@*", "ns"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"coker", "=", 
     RowBox[{"ns", "@*", "Transpose"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"im", "=", 
     RowBox[{"ker", "@*", "coker"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"coim", "=", 
     RowBox[{"coker", "@*", "ker"}]}], ";"}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.7213693089166*^9, 3.721369331164702*^9}, {
   3.721439435340481*^9, 3.7214394408276873`*^9}, 3.721683103667425*^9, 
   3.72168314664146*^9, {3.7216934016043177`*^9, 3.721693415648487*^9}, {
   3.7216950106123962`*^9, 3.721695035436893*^9}, 3.721695361959712*^9, {
   3.72169550337118*^9, 3.721695511379306*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"preim", "[", 
       RowBox[{"matrix", ",", "space"}], "]"}], " ", "--"}], "-", " ", 
     RowBox[{
     "preimage", " ", "of", " ", "space", " ", "wrt", " ", "matrix"}]}], ",", 
    " ", 
    RowBox[{
     RowBox[{"i", ".", "e", ".", " ", "matrix", ".", 
      RowBox[{"preim", "[", 
       RowBox[{"matrix", ",", "space"}], "]"}]}], "=", "space"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"similarly", ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"copreim", "[", 
       RowBox[{"matrix", ",", "space"}], "]"}], ".", "matrix"}], "=", 
     "space"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"preim", "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ker", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"coker", "@", "#2"}], ".", "#1"}], ")"}]}], "&"}], 
      "\[IndentingNewLine]", "copreim"}], "=", 
     RowBox[{
      RowBox[{"coker", "@", 
       RowBox[{"(", 
        RowBox[{"#1", ".", 
         RowBox[{"ker", "@", "#2"}]}], ")"}]}], "&"}]}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.7213693089166*^9, 3.721369550750214*^9}, 
   3.721695351253429*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"bjf", "::", "usage"}], "=", "\"\<bjf[\!\(\*
StyleBox[\"A\", \"TI\"]\),\!\(\*
StyleBox[\"B\", \"TI\"]\),\!\(\*
StyleBox[\"k\", \"TI\"]\)] constructs block matrix of the form \
\!\(\*Cell[TextData[Cell[BoxData[
FormBox[
RowBox[{\"(\", \"\[NoBreak]\", GridBox[{
{
StyleBox[\"A\", \"TI\"], 
StyleBox[\"B\", \"TI\"], \"0\"},
{\"0\", 
StyleBox[\"A\", \"TI\"], 
StyleBox[\"B\", \"TI\"]},
{\"0\", \"0\", 
StyleBox[\"A\", \"TI\"]}
}], \"\[NoBreak]\", \")\"}], TraditionalForm]]]]]\) where \!\(\*
StyleBox[\"A\", \"TI\"]\) is repeated \!\(\*
StyleBox[\"k\", \"TI\"]\)\!\(\*
StyleBox[\" \", \"TI\"]\)times. In particular, blockMatrix[\[Lambda],1,\!\(\*
StyleBox[\"k\", \"TI\"]\)] gives \!\(\*
StyleBox[\"k\", \"TI\"]\)\[Times]\!\(\*
StyleBox[\"k\", \"TI\"]\) Jordan cell.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"bjf", "[", 
    RowBox[{"a_", ",", "b_", ",", "k_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ap", ",", "bp"}], "}"}], ",", 
     RowBox[{"ArrayFlatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "k", "]"}], "*", "ap"}], "+", 
        RowBox[{
         RowBox[{"Rest", "[", 
          RowBox[{"Transpose", "[", 
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{"k", "+", "1"}]}], "}"}], "]"}], "]"}], "]"}], "*", 
         "bp"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ap", "\[Rule]", "a"}], ",", 
         RowBox[{"bp", "\[Rule]", "b"}]}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}]}], "Code"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Missing system tools", "Subsection",
 CellChangeTimes->{{3.721218087822298*^9, 3.721218090629321*^9}}],

Cell[CellGroupData[{

Cell["Factors,FactorPlus,FactorListPlus", "Subsubsection",
 CellChangeTimes->{{3.72121812606629*^9, 3.721218138809308*^9}, {
  3.7212577743235197`*^9, 3.721257774665484*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FactorPlus", "::", "usage"}], "=", 
   "\"\<FactorPlus[expr] factors expr iff it has head \\\"Plus\\\"\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7201569301182413`*^9, 3.720156963814578*^9}, {
   3.721217950727635*^9, 3.7212179540357018`*^9}, 3.72121803285843*^9, 
   3.721255680360464*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"FactorPlus", ",", "Listable"}], "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.7201604711240253`*^9, 3.720160489131838*^9}, 
   3.721218038959566*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FactorPlus", "[", "expr_Plus", "]"}], ":=", 
   RowBox[{"Factor", "[", "expr", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorPlus", "[", "expr_", "]"}], ":=", "expr"}], ";"}]}], "Code",
 CellChangeTimes->{{3.720156901182169*^9, 3.7201569031104116`*^9}, {
  3.720156974135043*^9, 3.72015700130232*^9}, {3.721218041024757*^9, 
  3.721218042173778*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FactorListPlus", "::", "usage"}], "=", 
   "\"\<FactorListPlus[expr] factors expr iff it has head \\\"Plus\\\" and \
gives a list of the factors, together with their exponents.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7201569301182413`*^9, 3.720156963814578*^9}, {
   3.721217950727635*^9, 3.7212179540357018`*^9}, 3.72121803285843*^9, {
   3.721255673455359*^9, 3.721255674800858*^9}, {3.721255790986165*^9, 
   3.7212558085368643`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FactorListPlus", "[", "expr_Plus", "]"}], ":=", 
   RowBox[{"FactorList", "[", "expr", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorListPlus", "[", "expr_", "]"}], ":=", 
   RowBox[{"Factors", "[", "expr", "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.720156901182169*^9, 3.7201569031104116`*^9}, {
   3.720156974135043*^9, 3.72015700130232*^9}, {3.721218044402382*^9, 
   3.7212180467970657`*^9}, {3.7212556329173717`*^9, 3.7212556602155323`*^9}, 
   3.721257928501527*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Factors", "::", "usage"}], "=", 
   "\"\<Factors[expr] returns the list of expr factors not trying to \
factorize it.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721216305176919*^9, 3.721216333021512*^9}, {
  3.7212579009307003`*^9, 3.721257913769446*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Factors", "[", "expr_", "]"}], ":=", 
  RowBox[{"Replace", "[", 
   RowBox[{
    RowBox[{"Replace", "[", 
     RowBox[{
      RowBox[{"{", "expr", "}"}], ",", 
      RowBox[{"Times", "\[Rule]", "Sequence"}], ",", 
      RowBox[{"{", "2", "}"}], ",", 
      RowBox[{"Heads", "\[Rule]", "True"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"x_", "^", "n_Integer"}], "\[RuleDelayed]", 
       RowBox[{"{", 
        RowBox[{"x", ",", "n"}], "}"}]}], ",", 
      RowBox[{"x_", "\[RuleDelayed]", 
       RowBox[{"{", 
        RowBox[{"x", ",", "1"}], "}"}]}]}], "}"}], ",", 
    RowBox[{"{", "1", "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{3.721257910984249*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Timing", "[", 
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"FactorList", "@", "#"}], ",", 
       RowBox[{"{", "1000", "}"}]}], "]"}], ";"}], "]"}], "&"}], "[", 
  RowBox[{"Factor", "[", 
   RowBox[{"Hypergeometric2F1", "[", 
    RowBox[{
     RowBox[{"-", "6"}], ",", 
     RowBox[{
      FractionBox["1", "2"], "+", 
      RowBox[{"I", " ", 
       RowBox[{"(", 
        RowBox[{"x", "+", "u"}], ")"}]}]}], ",", "1", ",", "2"}], "]"}], 
   "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Timing", "[", 
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"Factors", "@", "#"}], ",", 
       RowBox[{"{", "1000", "}"}]}], "]"}], ";"}], "]"}], "&"}], "[", 
  RowBox[{"Factor", "[", 
   RowBox[{"Hypergeometric2F1", "[", 
    RowBox[{
     RowBox[{"-", "6"}], ",", 
     RowBox[{
      FractionBox["1", "2"], "+", 
      RowBox[{"I", " ", 
       RowBox[{"(", 
        RowBox[{"x", "+", "u"}], ")"}]}]}], ",", "1", ",", "2"}], "]"}], 
   "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.7212161386638412`*^9, 3.721216141969819*^9}, 
   3.721257915432176*^9}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.172`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.721216148369034*^9, {3.7212579487829247`*^9, 3.721257953719537*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.008`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.721216148369034*^9, {3.7212579487829247`*^9, 3.721257953733552*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["PartitionByLengths", "Subsubsection",
 CellChangeTimes->{3.721218154488092*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"System`PartitionByLengths", "::", "usage"}], "=", 
   "\"\<PartitionByLengths[list,lengths] splits lest into chunks of the given \
leghts.\\nExample:PartitionByLengths[{a,b,c,d,e,f},{3,1,2}] \[LongRightArrow] \
{{a,b,c},{d},{e,f}}\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7212181608659897`*^9, 3.721218175967696*^9}, {
  3.721218233587694*^9, 3.721218329719858*^9}, {3.721364136684396*^9, 
  3.721364161804344*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"System`PartitionByLengths", "[", 
   RowBox[{"a_List", ",", "b_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"es", "=", 
       RowBox[{"Accumulate", "[", "b", "]"}]}], ",", "bs"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"bs", "=", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Most", "@", "es"}], "+", "1"}], ",", "1"}], "]"}]}], ";", 
     "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"Take", "[", 
        RowBox[{"a", ",", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"bs", ",", "es"}], "}"}], "]"}]}]}]}], "\n", "]"}]}]], "Code",
 CellChangeTimes->{3.721364164806407*^9}]
}, Open  ]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["End", "Section",
 CellChangeTimes->{{3.718578431606361*^9, 3.718578432129777*^9}}],

Cell["Print issues", "Text",
 CellChangeTimes->{{3.721113210345653*^9, 3.721113213625433*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"CellPrint", "[", 
   RowBox[{"Cell", "[", 
    RowBox[{"\"\<TODO list:\>\"", ",", " ", "\"\<Text\>\"", ",", " ", 
     RowBox[{"CellFrame", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "0"}], "}"}], ",", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "1"}], "}"}]}], "}"}]}]}], "]"}], "]"}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Print", "[", 
     RowBox[{"Style", "[", 
      RowBox[{
       RowBox[{"\"\<\[FilledSmallCircle] \>\"", "<>", "#"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Text\>\"", ",", "Small"}], "}"}]}], "]"}], "]"}], "&"}], 
   "/@", "todolist"}], ";"}]}], "Code",
 CellChangeTimes->{{3.721113774614596*^9, 3.7211137785561857`*^9}, {
  3.7211138390549803`*^9, 3.721113848133545*^9}, {3.7211138790936604`*^9, 
  3.721113908166081*^9}, {3.7211153773938103`*^9, 3.7211153809493313`*^9}}],

Cell["TODO list:", "Text",
 CellFrame->{{0, 0}, {0, 1}},
 GeneratedCell->True,
 CellAutoOverwrite->True,
 CellChangeTimes->{3.721262471502458*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 StyleBox["\<\"\[FilledSmallCircle] rewrite JDecomposition and JFormQ: should \
preserve block-triangular structure is possible.\"\>", "Text",
  StripOnInput->False,
  FontSize->Small]], "Print",
 CellChangeTimes->{3.721262471530098*^9}],

Cell[BoxData[
 StyleBox["\<\"\[FilledSmallCircle] NB: Series redefined!\"\>", "Text",
  StripOnInput->False,
  FontSize->Small]], "Print",
 CellChangeTimes->{3.72126247153271*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.718577835840699*^9, 3.7185778372135468`*^9}, 
   3.7225550002331467`*^9}],

Cell[BoxData[
 RowBox[{"EndPackage", "[", "]"}]], "Code",
 CellChangeTimes->{{3.7185778094737587`*^9, 3.718577815669742*^9}}]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
Evaluator->"Local1",
WindowSize->{2578, 2082},
WindowMargins->{{Automatic, 0}, {0, Automatic}},
Magnification:>2. Inherited,
FrontEndVersion->"11.0 for Linux x86 (64-bit) (September 21, 2016)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Stylesheet.nb"]]}, Visible -> False, 
  FrontEndVersion -> "11.0 for Linux x86 (64-bit) (September 21, 2016)", 
  StyleDefinitions -> "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "Queries"->{
  Cell[4905, 119, 701, 12, 226, "Code",
   CellTags->"Queries"],
  Cell[114778, 2899, 1461, 26, 266, "Code",
   CellTags->"Queries"],
  Cell[119510, 3016, 1323, 24, 275, "Input",
   CellTags->"Queries"],
  Cell[123660, 3117, 1370, 25, 7232, "Code",
   CellTags->"Queries"],
  Cell[126000, 3173, 453, 11, 146, "Code",
   CellTags->"Queries"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"Queries", 420529, 10172}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 222, 3, 187, "Title"],
Cell[647, 20, 292, 6, 99, "Text"],
Cell[942, 28, 437, 6, 105, "Code"],
Cell[1382, 36, 412, 8, 187, "Input"],
Cell[1797, 46, 525, 12, 105, "Code"],
Cell[2325, 60, 538, 9, 105, "Code"],
Cell[2866, 71, 852, 14, 186, "Code"],
Cell[3721, 87, 273, 4, 226, "Code"],
Cell[3997, 93, 125, 2, 105, "Code"],
Cell[4125, 97, 231, 4, 105, "Code"],
Cell[4359, 103, 162, 3, 105, "Code"],
Cell[4524, 108, 142, 3, 105, "Code"],
Cell[4669, 113, 233, 4, 105, "Code"],
Cell[4905, 119, 701, 12, 226, "Code",
 CellTags->"Queries"],
Cell[5609, 133, 149, 2, 105, "Code"],
Cell[5761, 137, 130, 2, 105, "Code"],
Cell[5894, 141, 210, 3, 105, "Code"],
Cell[6107, 146, 217, 4, 105, "Code"],
Cell[6327, 152, 343, 6, 105, "Code"],
Cell[6673, 160, 171, 4, 105, "Code"],
Cell[6847, 166, 142, 3, 105, "Code"],
Cell[6992, 171, 135, 2, 105, "Code"],
Cell[7130, 175, 136, 2, 105, "Code"],
Cell[7269, 179, 168, 3, 105, "Code"],
Cell[7440, 184, 193, 3, 105, "Code"],
Cell[7636, 189, 118, 2, 105, "Code"],
Cell[7757, 193, 85, 1, 105, "Code"],
Cell[7845, 196, 102, 2, 105, "Code"],
Cell[7950, 200, 109, 2, 105, "Code"],
Cell[8062, 204, 96, 2, 105, "Code"],
Cell[8161, 208, 191, 4, 105, "Code"],
Cell[8355, 214, 1735, 28, 295, "Code"],
Cell[10093, 244, 319, 5, 105, "Code"],
Cell[CellGroupData[{
Cell[10437, 253, 100, 1, 162, "Section"],
Cell[10540, 256, 140, 2, 105, "Code"],
Cell[10683, 260, 389, 10, 146, "Code"],
Cell[CellGroupData[{
Cell[11097, 274, 121, 2, 89, "Subsection"],
Cell[11221, 278, 378, 8, 100, "Text"],
Cell[CellGroupData[{
Cell[11624, 290, 111, 1, 71, "Subsubsection"],
Cell[11738, 293, 333, 8, 1560281088, "Code"],
Cell[12074, 303, 247, 6, 880803840, "Code"],
Cell[12324, 311, 226, 5, 880803840, "Code"],
Cell[12553, 318, 217, 5, 880803840, "Code"],
Cell[12773, 325, 208, 5, 880803840, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[13018, 335, 213, 2, 55, "Subsubsection"],
Cell[13234, 339, 414, 9, 4672, "Code"],
Cell[13651, 350, 296, 7, 3360, "Code"],
Cell[13950, 359, 2355, 55, 12352, "Code"],
Cell[16308, 416, 353, 7, 4672, "Code"],
Cell[16664, 425, 362, 7, 5952, "Code"],
Cell[17029, 434, 2126, 49, 13632, "Code"],
Cell[19158, 485, 349, 7, 5952, "Code"],
Cell[19510, 494, 1393, 35, 22144, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[20940, 534, 161, 2, 55, "Subsubsection"],
Cell[21104, 538, 1756, 41, 532, "Code"],
Cell[22863, 581, 952, 25, 532, "Code"],
Cell[23818, 608, 1709, 41, 452, "Code"],
Cell[25530, 651, 1171, 29, 452, "Code"],
Cell[26704, 682, 282, 6, 292, "Code"],
Cell[26989, 690, 581, 15, 452, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[27607, 710, 109, 1, 55, "Subsubsection"],
Cell[27719, 713, 378, 7, 105, "Code"],
Cell[28100, 722, 458, 10, 186, "Code"],
Cell[28561, 734, 326, 8, 105, "Code"],
Cell[28890, 744, 9525, 217, 1470, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[38452, 966, 154, 2, 55, "Subsubsection"],
Cell[38609, 970, 413, 8, 143, "Input"],
Cell[39025, 980, 358, 7, 98, "Input"],
Cell[39386, 989, 7436, 165, 1199, "Input"],
Cell[46825, 1156, 174, 4, 105, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[47036, 1165, 128, 2, 55, "Subsubsection"],
Cell[47167, 1169, 369, 8, 9344, "Code"],
Cell[47539, 1179, 4100, 101, 47744, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[51676, 1285, 204, 3, 55, "Subsubsection"],
Cell[51883, 1290, 196, 5, 105, "Code"],
Cell[52082, 1297, 3484, 88, 550, "Code"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[55615, 1391, 124, 2, 89, "Subsection"],
Cell[CellGroupData[{
Cell[55764, 1397, 152, 2, 71, "Subsubsection"],
Cell[55919, 1401, 881, 18, 266, "Code"],
Cell[56803, 1421, 237, 6, 105, "Code"],
Cell[57043, 1429, 7407, 161, 1106, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[64487, 1595, 87, 1, 55, "Subsubsection"],
Cell[64577, 1598, 7651, 203, 986, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[72265, 1806, 126, 2, 71, "Subsubsection"],
Cell[72394, 1810, 400, 10, 146, "Code"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[72843, 1826, 102, 1, 69, "Subsection"],
Cell[CellGroupData[{
Cell[72970, 1831, 85, 1, 71, "Subsubsection"],
Cell[73058, 1834, 550, 10, 11904, "Code"],
Cell[73611, 1846, 1326, 34, 11904, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[74974, 1885, 152, 2, 55, "Subsubsection"],
Cell[75129, 1889, 878, 17, 14464, "Code"],
Cell[76010, 1908, 3235, 69, 29824, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[79282, 1982, 85, 1, 55, "Subsubsection"],
Cell[79370, 1985, 1116, 22, 241664, "Code"],
Cell[80489, 2009, 2882, 71, 857088, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[83408, 2085, 127, 2, 55, "Subsubsection"],
Cell[83538, 2089, 617, 11, 81920, "Code"],
Cell[84158, 2102, 222, 5, 27648, "Code"],
Cell[84383, 2109, 902, 16, 27648, "Code"],
Cell[85288, 2127, 4615, 105, 158976, "Code"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[89952, 2238, 107, 1, 89, "Subsection"],
Cell[CellGroupData[{
Cell[90084, 2243, 87, 1, 71, "Subsubsection"],
Cell[90174, 2246, 299, 6, 5952, "Code"],
Cell[90476, 2254, 910, 25, 9600, "Code"],
Cell[91389, 2281, 345, 7, 5952, "Code"],
Cell[91737, 2290, 1003, 26, 7232, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[92777, 2321, 25, 0, 55, "Subsubsection"],
Cell[92805, 2323, 1498, 40, 12192, "Code"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[94352, 2369, 164, 2, 89, "Subsection"],
Cell[CellGroupData[{
Cell[94541, 2375, 100, 1, 71, "Subsubsection"],
Cell[94644, 2378, 1005, 26, 226, "Code"],
Cell[95652, 2406, 893, 24, 186, "Code"],
Cell[96548, 2432, 2000, 54, 510, "Code"],
Cell[98551, 2488, 2032, 54, 510, "Code"],
Cell[100586, 2544, 2622, 72, 546, "Code"],
Cell[103211, 2618, 1250, 32, 186, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[104498, 2655, 201, 3, 71, "Subsubsection"],
Cell[104702, 2660, 713, 13, 5952, "Code"],
Cell[105418, 2675, 296, 7, 3360, "Code"],
Cell[105717, 2684, 4348, 100, 26560, "Code"],
Cell[110068, 2786, 2629, 59, 14912, "Code"],
Cell[112700, 2847, 1897, 43, 8512, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[114634, 2895, 141, 2, 55, "Subsubsection"],
Cell[114778, 2899, 1461, 26, 266, "Code",
 CellTags->"Queries"],
Cell[116242, 2927, 1930, 48, 229, "Code"],
Cell[118175, 2977, 1332, 37, 186, "Code"],
Cell[119510, 3016, 1323, 24, 275, "Input",
 CellTags->"Queries"],
Cell[120836, 3042, 1371, 34, 189, "Input"],
Cell[122210, 3078, 1191, 28, 143, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[123438, 3111, 88, 1, 71, "Subsubsection"],
Cell[123529, 3114, 128, 1, 1952, "Text"],
Cell[123660, 3117, 1370, 25, 7232, "Code",
 CellTags->"Queries"],
Cell[125033, 3144, 767, 20, 4672, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[125837, 3169, 160, 2, 55, "Subsubsection"],
Cell[126000, 3173, 453, 11, 146, "Code",
 CellTags->"Queries"],
Cell[126456, 3186, 1116, 27, 149, "Code"],
Cell[127575, 3215, 977, 23, 146, "Code"],
Cell[128555, 3240, 342, 8, 146, "Code"],
Cell[128900, 3250, 331, 8, 105, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[129268, 3263, 306, 4, 71, "Subsubsection"],
Cell[129577, 3269, 412, 8, 146, "Code"],
Cell[129992, 3279, 250, 6, 105, "Code"],
Cell[130245, 3287, 5013, 113, 786, "Code"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[135307, 3406, 203, 3, 69, "Subsection"],
Cell[CellGroupData[{
Cell[135535, 3413, 252, 3, 71, "Subsubsection"],
Cell[135790, 3418, 227, 5, 1952, "Text"],
Cell[CellGroupData[{
Cell[136042, 3427, 1395, 36, 8512, "Code"],
Cell[137440, 3465, 246, 5, 4576, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[137723, 3475, 306, 7, 3136, "Input"],
Cell[138032, 3484, 459, 13, 3136, "Output"]
}, Open  ]],
Cell[138506, 3500, 426, 5, 1952, "Text"],
Cell[138935, 3507, 428, 9, 5952, "Code"],
Cell[139366, 3518, 1545, 39, 9792, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[140948, 3562, 391, 6, 55, "Subsubsection"],
Cell[141342, 3570, 417, 9, 186, "Code"],
Cell[141762, 3581, 2872, 71, 466, "Code"],
Cell[144637, 3654, 336, 7, 186, "Code"],
Cell[144976, 3663, 1122, 29, 266, "Code"],
Cell[146101, 3694, 411, 5, 61, "Text"],
Cell[146515, 3701, 420, 8, 186, "Code"],
Cell[146938, 3711, 1674, 43, 306, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[148649, 3759, 81, 1, 55, "Subsubsection"],
Cell[148733, 3762, 235, 5, 110592, "Code"],
Cell[148971, 3769, 1599, 33, 154624, "Code"],
Cell[150573, 3804, 3823, 103, 418816, "Code"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[154445, 3913, 106, 1, 89, "Subsection"],
Cell[CellGroupData[{
Cell[154576, 3918, 135, 2, 71, "Subsubsection"],
Cell[154714, 3922, 3727, 61, 386, "Code"],
Cell[158444, 3985, 13502, 338, 1736, "Code"],
Cell[171949, 4325, 4817, 108, 393, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[176803, 4438, 163, 2, 71, "Subsubsection"],
Cell[176969, 4442, 2623, 41, 466, "Code"],
Cell[179595, 4485, 339, 9, 105, "Code"],
Cell[179937, 4496, 5959, 136, 641, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[185933, 4637, 97, 1, 71, "Subsubsection"],
Cell[186033, 4640, 1099, 17, 282, "Code"],
Cell[187135, 4659, 3138, 88, 466, "Code"],
Cell[190276, 4749, 3209, 89, 466, "Code"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[193534, 4844, 103, 1, 89, "Subsection"],
Cell[CellGroupData[{
Cell[193662, 4849, 98, 1, 71, "Subsubsection"],
Cell[193763, 4852, 958, 23, 186, "Code"],
Cell[194724, 4877, 242, 6, 105, "Code"],
Cell[194969, 4885, 1831, 40, 186, "Code"],
Cell[196803, 4927, 3020, 80, 426, "Code"],
Cell[199826, 5009, 837, 23, 226, "Code"],
Cell[200666, 5034, 824, 23, 226, "Code"],
Cell[201493, 5059, 1463, 37, 266, "Code"],
Cell[202959, 5098, 1802, 51, 346, "Code"],
Cell[204764, 5151, 118, 1, 61, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[204919, 5157, 127, 2, 55, "Subsubsection"],
Cell[205049, 5161, 319, 7, 105, "Code"],
Cell[205371, 5170, 441, 12, 105, "Code"],
Cell[205815, 5184, 2055, 54, 306, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[207907, 5243, 178, 2, 71, "Subsubsection"],
Cell[208088, 5247, 670, 12, 186, "Code"],
Cell[208761, 5261, 2312, 61, 349, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[211110, 5327, 155, 2, 71, "Subsubsection"],
Cell[211268, 5331, 505, 17, 62, "Text"],
Cell[211776, 5350, 1782, 36, 96, "DisplayFormula"],
Cell[213561, 5388, 794, 23, 122, "Text"],
Cell[214358, 5413, 1927, 38, 93, "DisplayFormula"],
Cell[216288, 5453, 2026, 41, 62, "Text"],
Cell[218317, 5496, 195, 2, 61, "Text"],
Cell[218515, 5500, 2361, 49, 85, "DisplayFormula"],
Cell[220879, 5551, 2603, 65, 120, "Text"],
Cell[223485, 5618, 2100, 35, 61, "Text"],
Cell[225588, 5655, 2032, 54, 143, "Text"],
Cell[227623, 5711, 590, 11, 186, "Code"],
Cell[228216, 5724, 3558, 99, 429, "Code"],
Cell[231777, 5825, 328, 7, 105, "Code"],
Cell[232108, 5834, 4210, 78, 103, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[236355, 5917, 102, 1, 71, "Subsubsection"],
Cell[236460, 5920, 262, 6, 105, "Code"],
Cell[236725, 5928, 860, 24, 146, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[237622, 5957, 98, 1, 71, "Subsubsection"],
Cell[237723, 5960, 2069, 46, 156672, "Code"],
Cell[239795, 6008, 248, 6, 53760, "Code"],
Cell[240046, 6016, 2320, 66, 232448, "Code"],
Cell[242369, 6084, 2276, 65, 197632, "Code"],
Cell[244648, 6151, 2398, 67, 232448, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[247083, 6223, 81, 1, 55, "Subsubsection"],
Cell[247167, 6226, 275, 7, 105, "Code"],
Cell[247445, 6235, 484, 12, 105, "Code"],
Cell[247932, 6249, 721, 17, 149, "Code"],
Cell[248656, 6268, 747, 16, 149, "Code"],
Cell[249406, 6286, 45139, 891, 6029, "Code"],
Cell[294548, 7179, 415, 8, 146, "Code"],
Cell[294966, 7189, 52304, 1114, 38, "Input",
 CellOpen->False]
}, Open  ]],
Cell[CellGroupData[{
Cell[347307, 8308, 100, 1, 71, "Subsubsection"],
Cell[347410, 8311, 210, 5, 146, "Code"],
Cell[347623, 8318, 2458, 42, 186, "Code"],
Cell[350084, 8362, 2765, 49, 146, "Code"],
Cell[352852, 8413, 3973, 79, 488, "Code"],
Cell[356828, 8494, 6767, 165, 1130, "Input"],
Cell[363598, 8661, 209, 5, 105, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[363844, 8671, 157, 2, 71, "Subsubsection"],
Cell[364004, 8675, 339, 7, 186, "Code"],
Cell[364346, 8684, 6060, 142, 786, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[370443, 8831, 295, 4, 71, "Subsubsection"],
Cell[370741, 8837, 497, 10, 146, "Code"],
Cell[371241, 8849, 259, 6, 105, "Code"],
Cell[371503, 8857, 626, 17, 149, "Code"],
Cell[372132, 8876, 649, 16, 149, "Code"],
Cell[372784, 8894, 13989, 298, 1990, "Code"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[386822, 9198, 105, 1, 69, "Subsection"],
Cell[CellGroupData[{
Cell[386952, 9203, 182, 3, 71, "Subsubsection"],
Cell[387137, 9208, 402, 9, 105, "Code"],
Cell[387542, 9219, 1204, 33, 146, "Code"],
Cell[388749, 9254, 2230, 54, 426, "Code"],
Cell[390982, 9310, 672, 20, 146, "Code"],
Cell[391657, 9332, 794, 18, 105, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[392488, 9355, 107, 1, 71, "Subsubsection"],
Cell[392598, 9358, 303, 6, 186, "Code"],
Cell[392904, 9366, 1069, 30, 186, "Code"],
Cell[393976, 9398, 504, 14, 146, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[394517, 9417, 199, 2, 71, "Subsubsection"],
Cell[394719, 9421, 349, 8, 105, "Code"],
Cell[395071, 9431, 2225, 56, 266, "Code"],
Cell[397299, 9489, 572, 15, 146, "Code"],
Cell[397874, 9506, 907, 17, 226, "Code"],
Cell[398784, 9525, 1233, 26, 105, "Code"],
Cell[400020, 9553, 1476, 32, 146, "Code"],
Cell[401499, 9587, 556, 15, 146, "Code"],
Cell[402058, 9604, 633, 13, 186, "Code"],
Cell[402694, 9619, 988, 25, 226, "Code"],
Cell[403685, 9646, 556, 15, 146, "Code"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[404290, 9667, 134, 2, 89, "Subsection"],
Cell[404427, 9671, 342, 7, 100, "Text"],
Cell[404772, 9680, 1526, 44, 231, "Input"],
Cell[406301, 9726, 797, 23, 146, "Code"],
Cell[407101, 9751, 1441, 40, 319, "Input"],
Cell[408545, 9793, 1245, 39, 275, "Input"],
Cell[409793, 9834, 1659, 50, 421, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[411489, 9889, 108, 1, 89, "Subsection"],
Cell[CellGroupData[{
Cell[411622, 9894, 174, 2, 73728, "Subsubsection"],
Cell[411799, 9898, 343, 8, 110592, "Code"],
Cell[412145, 9908, 217, 5, 110592, "Code"],
Cell[412365, 9915, 431, 10, 154624, "Code"],
Cell[412799, 9927, 493, 10, 110592, "Code"],
Cell[413295, 9939, 558, 12, 154624, "Code"],
Cell[413856, 9953, 305, 7, 110592, "Code"],
Cell[414164, 9962, 728, 21, 110592, "Code"],
Cell[CellGroupData[{
Cell[414917, 9987, 1166, 38, 225280, "Input"],
Cell[416086, 10027, 174, 4, 101376, "Output"],
Cell[416263, 10033, 174, 4, 101376, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[416486, 10043, 85, 1, 73728, "Subsubsection"],
Cell[416574, 10046, 467, 9, 197632, "Code"],
Cell[417044, 10057, 774, 24, 241664, "Code"]
}, Open  ]]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[417879, 10088, 88, 1, 162, "Section"],
Cell[417970, 10091, 94, 1, 60, "Text"],
Cell[418067, 10094, 939, 25, 146, "Code"],
Cell[419009, 10121, 146, 4, 78, "Text"],
Cell[CellGroupData[{
Cell[419180, 10129, 251, 5, 39, "Print"],
Cell[419434, 10136, 179, 4, 37, "Print"]
}, Open  ]],
Cell[419628, 10143, 164, 4, 105, "Code"],
Cell[419795, 10149, 125, 2, 105, "Code"]
}, Open  ]]
}, Open  ]]
}
]
*)

