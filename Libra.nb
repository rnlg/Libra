(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[   1031132,      24561]
NotebookOptionsPosition[    998589,      23667]
NotebookOutlinePosition[    999517,      23700]
CellTagsIndexPosition[    999444,      23695]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Libra package", "Title",
 CellChangeTimes->{{3.6175177940295467`*^9, 3.6175178003557425`*^9}, {
   3.718577609719571*^9, 3.718577611722925*^9}, {3.722555109426653*^9, 
   3.722555110429866*^9}, 3.722577045598638*^9, {3.762409651586933*^9, 
   3.762409652552618*^9}},
 ExpressionUUID -> "428fe337-85c3-4bb6-bab0-b51546f4095a"],

Cell["\<\
Libra is a package for manipulation with the differential systems
\[Copyright] Roman N. Lee 2017-\
\>", "Text",
 CellChangeTimes->{{3.718577617070098*^9, 3.7185776298553953`*^9}, {
  3.718577686304055*^9, 3.7185777470438423`*^9}, {3.7225551027678347`*^9, 
  3.7225551135386047`*^9}, {3.760855007396968*^9, 3.760855008685994*^9}, {
  3.768112042211379*^9, 3.768112043013506*^9}, {3.7681745513869333`*^9, 
  3.768174561586941*^9}, {3.7707981151232357`*^9, 3.770798116415276*^9}},
 ExpressionUUID -> "5dd1e604-3f32-49ff-811e-91ad6b6cf262"],

Cell[CellGroupData[{

Cell["Possible extensions", "Subsection",
 CellChangeTimes->{{3.7482116661833143`*^9, 3.748211684959375*^9}, {
  3.7685150291922493`*^9, 3.768515032614231*^9}},
 ExpressionUUID -> "84262c6b-c6c8-45af-8151-fad37176be19"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FullTransformation", "[", 
   RowBox[{"h_", ",", 
    RowBox[{"t_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"ii_:", 
     RowBox[{"(", ";;", ")"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tf", "=", 
      RowBox[{"IdentityMatrix", "[", 
       RowBox[{"Length", "@", "h"}], "]"}]}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"tf", "[", 
       RowBox[{"[", 
        RowBox[{"ii", ",", "ii"}], "]"}], "]"}], "=", "t"}], ";", "tf"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7482110519247828`*^9, 3.7482111484097443`*^9}, {
  3.748211250805497*^9, 3.748211253163266*^9}, {3.748211316428648*^9, 
  3.748211321597381*^9}},
 ExpressionUUID -> "acd61ae0-3345-450b-8bb7-4b0187047ada"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SubTransformation", "::", "err"}], "=", 
   "\"\<Transformation mix subsystem with the complement.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SubTransformation", "[", 
   RowBox[{
    RowBox[{"tf_", "?", "SquareMatrixQ"}], ",", "ii_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"tf", "[", 
        RowBox[{"[", 
         RowBox[{"ii", ",", "ii"}], "]"}], "]"}]}], ",", 
      RowBox[{"jj", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Length", "@", "tf"}], "]"}], ",", "ii"}], "]"}]}]}], "}"}],
     ",", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"jj", "===", 
        RowBox[{"{", "}"}]}], "||", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Union", "@@", 
          RowBox[{"tf", "[", 
           RowBox[{"[", 
            RowBox[{"ii", ",", "jj"}], "]"}], "]"}]}], ")"}], "\[Equal]", 
        RowBox[{"{", "0", "}"}]}]}], ",", 
      RowBox[{"Return", "[", "t", "]"}], ",", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"SubTransformation", "::", "err"}], "]"}], ";", 
       RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.74821118816398*^9, 3.748211474708291*^9}, 
   3.748211549944406*^9},
 ExpressionUUID -> "14f74059-af8a-4e9b-b93c-fc924be10274"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ReconstructEigenvalues", "::", "usage"}], "=", 
   "\"\<ReconstructEigenvalues[r_,{ep_,n_}] is suppose to find fast the \
eigenvalues of the matrix r depending on ep by first putting ep to 1/n and \
then recunstructing the ep dependence using Round[]. The parameter n should \
be large enough.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ReconstructEigenvalues", "[", 
   RowBox[{"r_", ",", 
    RowBox[{"{", 
     RowBox[{"ep_", ",", "n_Integer"}], "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"Round", "[", "#", "]"}], "+", 
     RowBox[{"n", " ", "ep", 
      RowBox[{"(", 
       RowBox[{"#", "-", 
        RowBox[{"Round", "[", "#", "]"}]}], ")"}]}]}], "&"}], "/@", 
   RowBox[{"Flatten", "[", 
    RowBox[{"Eigenvalues", "[", 
     RowBox[{"r", "/.", 
      RowBox[{"ep", "\[Rule]", 
       RowBox[{"1", "/", "n"}]}]}], "]"}], "]"}]}]}]}], "Input",
 CellChangeTimes->{3.768605373507749*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Begin", "Section",
 CellChangeTimes->{{3.724804131891656*^9, 3.724804132660699*^9}, {
  3.7688780251795273`*^9, 3.768878025746746*^9}},
 ExpressionUUID -> "480fd511-054c-410a-98ac-0836e037d0a1"],

Cell[BoxData[
 RowBox[{"BeginPackage", "[", "\"\<Libra`\>\"", "]"}]], "Code",
 CellChangeTimes->{{3.718577782966878*^9, 3.7185777978508177`*^9}, {
  3.720137667121503*^9, 3.7201376752027187`*^9}, {3.722554966518113*^9, 
  3.722554967486833*^9}, {3.722555231349399*^9, 3.722555232925305*^9}, {
  3.722555340735598*^9, 3.722555341679596*^9}, {3.7225555707287903`*^9, 
  3.722555574336773*^9}, {3.722557816477088*^9, 3.722557817388624*^9}},
 ExpressionUUID -> "af13b0a8-dc06-438c-a2a8-da12c436241d"],

Cell[CellGroupData[{

Cell["Unsorted", "Subsubsection",
 CellChangeTimes->{{3.768785518795857*^9, 3.7687855285883923`*^9}, {
  3.7705917924186287`*^9, 3.770591793818161*^9}},
 ExpressionUUID -> "9054e8d7-39e8-4298-b1fb-4a0040fc50e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"$LibraHomeDirectory", "=", 
   RowBox[{"DirectoryName", "[", "$InputFileName", "]"}]}], ";"}]], "Code",
 CellChangeTimes->{3.770784482586362*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$LibraUseFermat", "=", "False"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$LibraVersion", "=", "\"\<1.0\[Beta]\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$LibraInputFileName", "=", "$InputFileName"}], ";"}]}], "Code",
 CellChangeTimes->{{3.7277480304145393`*^9, 3.727748062046611*^9}, 
   3.728001538210946*^9, {3.76240956102244*^9, 3.76240956484695*^9}, {
   3.762954208858734*^9, 3.7629542334389467`*^9}, {3.7629627123606997`*^9, 
   3.762962712579051*^9}, {3.7632128485669193`*^9, 3.763212929124774*^9}, {
   3.768610579044319*^9, 3.768610579962049*^9}, {3.770024624046505*^9, 
   3.7700246398833838`*^9}},
 ExpressionUUID -> "d71240bd-5f74-4ff7-b5d1-885975c00b38"],

Cell[BoxData[
 RowBox[{"NewDSystem", ";"}]], "Code",
 CellChangeTimes->{
  3.718578412013706*^9, {3.718579520178177*^9, 3.718579590608918*^9}, {
   3.719595985790648*^9, 3.719595986602619*^9}, {3.719596023669298*^9, 
   3.719596025030671*^9}, {3.71959642939603*^9, 3.71959644336932*^9}, {
   3.7195969814126787`*^9, 3.7195969989258327`*^9}, 3.7195973441125402`*^9, {
   3.719598446009367*^9, 3.71959845604491*^9}, 3.719625702227388*^9, {
   3.7213546492080936`*^9, 3.721354651103321*^9}, {3.721354906394627*^9, 
   3.721354928088849*^9}},
 ExpressionUUID -> "43c5d4f5-2224-4f59-8fbd-17788858d2e6"],

Cell[BoxData[{
 RowBox[{"History", ";", "HistoryIndex", ";", "Undo", ";", "Redo", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"HistoryAppend", ";", "HistoryAddExtra", ";", "HistoryDeleteExtra", 
  ";", "HistoryConsolidate", ";"}], "\[IndentingNewLine]", 
 RowBox[{"HistoryBurn", ";"}]}], "Code",
 CellChangeTimes->{
  3.718578412013706*^9, {3.718579520178177*^9, 3.718579590608918*^9}, {
   3.719595985790648*^9, 3.719595986602619*^9}, {3.719596023669298*^9, 
   3.719596025030671*^9}, {3.71959642939603*^9, 3.71959644336932*^9}, {
   3.7195969814126787`*^9, 3.7195969989258327`*^9}, 3.7195973441125402`*^9, {
   3.719598446009367*^9, 3.71959845604491*^9}, 3.719625702227388*^9, 
   3.721381322936898*^9, {3.721381366366564*^9, 3.721381372610132*^9}, {
   3.721459193764492*^9, 3.721459195457589*^9}, {3.721459838218947*^9, 
   3.7214598390747347`*^9}},
 ExpressionUUID -> "2ba9dd5e-dbe7-40f6-9da7-35b437ce2744"],

Cell[BoxData[{
 RowBox[{"Notations", ";", "AddNotation", ";"}], "\[IndentingNewLine]", 
 RowBox[{"RuleToNotation", ";", "NotationToRule"}]}], "Code",
 CellChangeTimes->{{3.72990256137351*^9, 3.729902572630321*^9}, {
  3.768190750880958*^9, 3.76819078455881*^9}, {3.770602868943615*^9, 
  3.7706028770163097`*^9}},
 ExpressionUUID -> "2e63d12c-3aa9-403f-8008-eef40aff0025"],

Cell[BoxData[{
 RowBox[{"SubsystemsIndices", ";"}], "\[IndentingNewLine]", 
 RowBox[{"LargestSubsystemsIndices", ";"}], "\[IndentingNewLine]", 
 RowBox[{"EntangledBlocksIndices", ";"}], "\[IndentingNewLine]", 
 RowBox[{"DependentRowIndices", ";"}], "\[IndentingNewLine]", 
 RowBox[{"DependentColumnIndices", ";"}], "\[IndentingNewLine]", 
 RowBox[{"OffDiagonalBlocksIndices", ";", "DiagonalBlocksIndices", 
  ";"}]}], "Code",
 CellChangeTimes->{{3.719627208605134*^9, 3.719627218107347*^9}, {
  3.721111984767797*^9, 3.7211119857993803`*^9}, {3.7682884074983997`*^9, 
  3.7682884080639668`*^9}, {3.768543398524004*^9, 3.768543411684173*^9}, {
  3.768543473180037*^9, 3.768543479115974*^9}, {3.768543542084374*^9, 
  3.7685435520533257`*^9}, {3.768543590018599*^9, 3.7685435913808393`*^9}},
 ExpressionUUID -> "ea9bc33b-fffe-4c91-9d82-303cb7a96be4"],

Cell[BoxData[
 RowBox[{"PickBasis", ";"}]], "Code",
 CellChangeTimes->{{3.721436678741048*^9, 3.7214366800031*^9}, 
   3.7687426378716908`*^9, 3.768872158345749*^9},
 ExpressionUUID -> "d90b851b-75e9-4f44-aefc-822fcbcc80df"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"UseFermat", "::", "usage"}], "=", 
   "\"\<UseFermat is an option for many procedures which determines whether \
to use Fermat (Fermatica package required)\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.76819017091538*^9, 3.768190248956229*^9}},
 ExpressionUUID -> "e6bd98cb-4ff4-4e49-b297-843fe791998a"],

Cell[BoxData[
 RowBox[{"ODot", ";", "OInverse", ";", "ODet", ";", "OKer", ";"}]], "Code",
 CellChangeTimes->{{3.7201559866524343`*^9, 3.7201559914045267`*^9}, {
   3.720156055484242*^9, 3.720156070349401*^9}, {3.721256298325274*^9, 
   3.721256304461762*^9}, {3.727745146475566*^9, 3.727745166139215*^9}, 
   3.727745729453724*^9, {3.768973940335676*^9, 3.768973941702346*^9}, {
   3.768975629408267*^9, 3.768975630710279*^9}},
 ExpressionUUID -> "bf70f08e-ef45-4dc4-b1a5-5c6d266947d3"],

Cell[BoxData[
 RowBox[{"Transform", ";", "ChangeVar", ";"}]], "Code",
 CellChangeTimes->{
  3.719735816219767*^9, {3.720150078714465*^9, 
   3.7201500797305517`*^9}},ExpressionUUID->"cf699c5f-d43c-4340-8595-\
17eca17e91ea"],

Cell[BoxData[
 RowBox[{"TClosure", ";"}]], "Code",
 CellChangeTimes->{{3.719660007230115*^9, 3.719660021387529*^9}, 
   3.719736770676527*^9},
 ExpressionUUID -> "5b2b5ae3-e827-4e0b-b7ac-2a1d2a4f1e35"],

Cell[BoxData[
 RowBox[{"PolesPosition", ";", "PoincareRank", ";", "PolesInfo", 
  ";"}]], "Code",
 CellChangeTimes->{{3.7197367567811413`*^9, 3.7197367680445004`*^9}, 
   3.719737400432942*^9, 3.721260276889592*^9, {3.726438642276731*^9, 
   3.7264386424041567`*^9}, {3.7681897128037252`*^9, 3.76818971419343*^9}, {
   3.7704727562499733`*^9, 3.770472791955723*^9}},
 ExpressionUUID -> "e233c408-c216-47d5-a428-575375d14947"],

Cell[BoxData[
 RowBox[{"Denominators", ";", "PolyPoincareRank", ";", "DenominatorsInfo", 
  ";"}]], "Code",
 CellChangeTimes->{{3.7197367567811413`*^9, 3.7197367680445004`*^9}, 
   3.719737400432942*^9, 3.721260276889592*^9, {3.726438642276731*^9, 
   3.7264386424041567`*^9}, {3.7681897128037252`*^9, 3.76818971419343*^9}, {
   3.7704727562499733`*^9, 3.770472793087562*^9}},
 ExpressionUUID -> "e233c408-c216-47d5-a428-575375d14947"],

Cell[BoxData[{
 RowBox[{"DiagonalQ", ";"}], "\[IndentingNewLine]", 
 RowBox[{"NilpotentQ", ";"}], "\[IndentingNewLine]", 
 RowBox[{"FuchsianQ", ";"}], "\[IndentingNewLine]", 
 RowBox[{"JFormQ", ";"}]}], "Code",
 CellChangeTimes->{{3.5946962031649194`*^9, 3.5946962033500443`*^9}, {
   3.5946964648589287`*^9, 3.594696476782811*^9}, {3.594697189537241*^9, 
   3.594697190571929*^9}, 3.594768409230133*^9, {3.5948156181441107`*^9, 
   3.59481568531152*^9}, 3.5958489045143733`*^9, 3.624119329112715*^9, 
   3.6248139109718237`*^9, {3.6248293280009055`*^9, 3.6248293425445395`*^9}, {
   3.625031012030669*^9, 3.625031062693838*^9}, {3.721110504020259*^9, 
   3.721110514234618*^9}, 3.7705037530447483`*^9},
 CellTags->"Queries",
 ExpressionUUID -> "95f563a5-baa9-4340-9250-6f8e85e44b6a"],

Cell[BoxData[
 RowBox[{"JDecomposition", ";", "JDecompositionData", ";"}]], "Code",
 CellChangeTimes->{{3.721114069229454*^9, 3.721114071837435*^9}, 
   3.763212126603928*^9, 3.763299509611382*^9},
 ExpressionUUID -> "e66207f7-d1dd-45bd-8fdb-db23bff3a0a8"],

Cell[BoxData[
 RowBox[{"JDTowers", ";", "JDSpace", ";", "JDData", ";"}]], "Code",
 CellChangeTimes->{{3.768875037290428*^9, 
  3.768875047102977*^9}},ExpressionUUID->"1da54803-c175-42e4-ba9e-\
694f423c3b4b"],

Cell[BoxData[
 RowBox[{"RatFuncQ", ";", "PolyQ", ";"}]], "Code",
 CellChangeTimes->{{3.721175553818005*^9, 3.721175559819407*^9}, 
   3.768135675470083*^9},
 ExpressionUUID -> "01eea3bc-6494-4612-93fc-a99753d07fe5"],

Cell[BoxData[
 RowBox[{"Factors", ";", "FactorPlus", ";", "FactorListPlus", ";"}]], "Code",
 CellChangeTimes->{{3.721255878614786*^9, 3.721255886125231*^9}, {
  3.7212579673698378`*^9, 3.7212579706326847`*^9}},
 ExpressionUUID -> "916343d8-4794-4176-93b2-76d89c0e6c13"],

Cell[BoxData[
 RowBox[{"LeadingOrder", ";"}]], "Code",
 CellChangeTimes->{
  3.721260235011323*^9, {3.721262492876348*^9, 3.721262493992638*^9}, {
   3.721378583257607*^9, 3.721378587137632*^9}, 3.721386275919363*^9},
 ExpressionUUID -> "2ccbfd95-bd6d-44b2-b240-57dba2390b68"],

Cell[BoxData[
 RowBox[{"SeriesCoefficients", ";", "LeadingSeries", ";", 
  "LeadingSeriesCoefficient", ";", "LeadingSeriesCoefficients", ";"}]], "Code",
 CellChangeTimes->{
  3.721260235011323*^9, {3.721262492876348*^9, 3.721262493992638*^9}, {
   3.721378583257607*^9, 3.721378587137632*^9}, {3.721386275919363*^9, 
   3.721386281328573*^9}},
 ExpressionUUID -> "962ab4d7-dfe3-4c0e-a510-b82eaaf4a24d"],

Cell[BoxData[
 RowBox[{"DSystemQ", ";"}]], "Code",
 CellChangeTimes->{{3.721354244714307*^9, 3.721354251471333*^9}, 
   3.721354394585951*^9},
 ExpressionUUID -> "dd9685a2-0fb1-4ae7-b84a-c1304f4a534f"],

Cell[BoxData[{
 RowBox[{"Balance", ";", "VisBalancing", ";"}], "\[IndentingNewLine]", 
 RowBox[{"VisTransformation", ";"}]}], "Code",
 CellChangeTimes->{{3.721448644161029*^9, 3.721448649073791*^9}, {
   3.727701280109972*^9, 3.727701285853115*^9}, 3.727701325192012*^9, {
   3.768897905395348*^9, 3.768897907275146*^9}},
 ExpressionUUID -> "b74a2e14-f793-4311-860c-73e93647f469"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"A0ToSubspaces", ";"}], "*)"}], 
  RowBox[{
  "A0A1ToSubspaces", ";", "GetSubspaces", ";", "Projector", ";"}]}]], "Code",
 CellChangeTimes->{{3.7225551752109423`*^9, 3.722555220076285*^9}, {
   3.726442806019845*^9, 3.726442807193869*^9}, 3.770961734353372*^9},
 ExpressionUUID -> "aa7683b4-8611-4e12-acb9-490649f2f86e"],

Cell[BoxData[
 RowBox[{"FactorOut", ";", "FactorDependence", ";"}]], "Code",
 CellChangeTimes->{{3.721452086763105*^9, 3.7214520890475817`*^9}, {
  3.722559428531679*^9, 3.722559429962291*^9}},
 ExpressionUUID -> "2186674e-38ed-48ad-b285-9f1aecf01b83"],

Cell[BoxData[
 RowBox[{"GaussSolve", ";"}]], "Code",
 CellChangeTimes->{{3.721953882841181*^9, 
  3.721953888217627*^9}},ExpressionUUID->"836f763f-3e50-468c-be78-\
d5e25432828b"],

Cell[BoxData[
 RowBox[{"BlockTriangularToFuchsian", ";"}]], "Code",
 CellChangeTimes->{
  3.721981157766115*^9, {3.768719647548656*^9, 3.76871964834055*^9}},
 ExpressionUUID -> "f27beaca-2d96-4560-b347-dfeb99ec1fe7"],

Cell[BoxData[
 RowBox[{"FuchsifyBlock", ";", "Fuchsify", ";"}]], "Code",
 CellChangeTimes->{{3.7683035969812737`*^9, 3.768303602652343*^9}, {
  3.7709646436861877`*^9, 3.770964644803277*^9}},
 ExpressionUUID -> "87d487a5-5084-414f-95d4-3386c8f76bf1"],

Cell[BoxData[
 RowBox[{"ToOneDE", ";", "ToCompanionDS", ";"}]], "Code",
 CellChangeTimes->{
  3.738540521037217*^9, {3.7386373634501963`*^9, 
   3.7386373644215937`*^9}},ExpressionUUID->"fccc79af-c893-48b2-ab59-\
e3f174f547a6"],

Cell[BoxData[
 RowBox[{"BTSolve", ";"}]], "Code",
 CellChangeTimes->{
  3.72696345529597*^9},ExpressionUUID->"1aa21303-7332-4667-bc3a-8241877ea23c"],

Cell[BoxData[
 RowBox[{"RadicalsUp", ";"}]], "Code",
 CellChangeTimes->{3.7221647443730373`*^9},
 ExpressionUUID -> "7e680339-0170-4631-887f-6ef085ce0704"],

Cell[BoxData[
 RowBox[{"HistoryCheck", ";", "HistoryChop", ";"}]], "Code",
 CellChangeTimes->{
  3.722653277296607*^9, 3.722653401533276*^9, {3.722653900880968*^9, 
   3.722653901766403*^9}},
 ExpressionUUID -> "2956d093-e792-4132-8137-7a8438a960ab"],

Cell[BoxData[{
 RowBox[{"PexpExpansion", ";"}], "\[IndentingNewLine]", 
 RowBox[{"II", ";", 
  RowBox[{"Protect", "[", "II", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"II", "::", "usage"}], "=", 
  "\"\<II[{\!\(\*SubscriptBox[\(a\), \(n\)]\),\!\(\*SubscriptBox[\(a\), \(n - \
1\)]\),\!\(\*SubscriptBox[\(\[Ellipsis]a\), \(1\)]\)},x] denotes iterated \
integral, \!\(TraditionalForm\`II[{\*SubscriptBox[\(a\), \(n\)], \
\*SubscriptBox[\(a\), \(n - 1\)], \*SubscriptBox[\(\[Ellipsis]a\), \(1\)]}, \
x] = \(\*UnderscriptBox[\(\[Integral]\[Ellipsis] \[Integral]\), \
\(\*SubscriptBox[\(x\), \(0\)] < \*SubscriptBox[\(x\), \(1\)] < \
\*SubscriptBox[\(\[Ellipsis]x\), \(n\)] < x\)] \*FractionBox[\(\
\[DifferentialD]\*SubscriptBox[\(x\), \(n\)]\), \(\*SubscriptBox[\(x\), \
\(n\)] - \*SubscriptBox[\(a\), \(n\)]\)] \(\[Ellipsis]\) \*FractionBox[\(\
\[DifferentialD]\*SubscriptBox[\(x\), \(1\)]\), \(\*SubscriptBox[\(x\), \
\(1\)] - \*SubscriptBox[\(a\), \(1\)]\)]\(\\\ \)\)\), where \
\!\(TraditionalForm\`\*SubscriptBox[\(x\), \(0\)]\) is arbitrary (with \
convention II[{},x]=1). II[{\!\(\*SubscriptBox[\(a\), \
\(n\)]\),\!\(\*SubscriptBox[\(a\), \(n - 1\)]\),\!\(\*SubscriptBox[\(\
\[Ellipsis]a\), \(1\)]\)},x,\!\(\*SubscriptBox[\(x\), \(0\)]\)] specifies \
\!\(\*SubscriptBox[\(x\), \(0\)]\). By definition, II[{\!\(\*SubscriptBox[\(x\
\), \(0\)]\),\[Ellipsis],\!\(\*SubscriptBox[\(x\), \
\(0\)]\)},x,\!\(\*SubscriptBox[\(x\), \
\(0\)]\)]=Log[x-\!\(\*SubscriptBox[\(x\), \(0\)]\)\!\(\*SuperscriptBox[\(]\), \
\(n\)]\)/n!.\>\""}]}], "Code",
 CellChangeTimes->{{3.722927658397004*^9, 3.722927677137918*^9}, {
   3.72457159992666*^9, 3.724571601171032*^9}, 3.724634624473295*^9, {
   3.724643363289102*^9, 3.724643382464204*^9}, {3.724643422905127*^9, 
   3.7246436148438263`*^9}, {3.7247462121269093`*^9, 3.724746212750595*^9}, {
   3.724842699931883*^9, 3.7248427069541388`*^9}, {3.7258566572133217`*^9, 
   3.725856658060699*^9}},
 ExpressionUUID -> "364c4c67-a891-4264-bca0-fbd56e15c34a"],

Cell[BoxData[
 RowBox[{"SeriesSolutionData", ";", "ConstructSeriesSolution", ";"}]], "Code",
 CellChangeTimes->{{3.722927658397004*^9, 3.722927677137918*^9}, {
   3.72457159992666*^9, 3.724571601171032*^9}, {3.724634624473295*^9, 
   3.724634646049954*^9}, {3.724643365396096*^9, 3.7246433673607607`*^9}, 
   3.724746210181429*^9},
 ExpressionUUID -> "aae2ce5b-1a37-46fa-a14f-6ce0ad65b0d5"],

Cell[BoxData[
 RowBox[{"SpotCoefficients", ";"}]], "Code",
 CellChangeTimes->{
  3.752905157708708*^9},ExpressionUUID->"4903ec16-8a16-46ef-a13a-\
942606c04914"],

Cell[BoxData[
 RowBox[{"FactorLeadingLetter", ";", "FactorTrailingLetter", ";"}]], "Code",
 CellChangeTimes->{{3.724746171550886*^9, 3.724746175396654*^9}},
 ExpressionUUID -> "522f7859-bccf-468a-b288-d8708f30f3be"],

Cell[BoxData[
 RowBox[{"EValues", ";", "ESpace", ";"}]], "Code",
 CellChangeTimes->{{3.7688067586049147`*^9, 3.768806765585272*^9}},
 ExpressionUUID -> "d998004f-488d-4ff9-b820-191aed046fab"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Modding", "Subsubsection",
 CellChangeTimes->{{3.768785518795857*^9, 3.7687855285883923`*^9}},
 ExpressionUUID -> "9054e8d7-39e8-4298-b1fb-4a0040fc50e8"],

Cell[BoxData[{
 RowBox[{"InvertMod", ";", "QuolyMod", ";", "OQuolyMod", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ExtendedQuolyMod", ";"}], "\[IndentingNewLine]", 
 RowBox[{"ModNotation", "=", 
  RowBox[{"Libra`Private`obsolete", "[", 
   RowBox[{"OQuolyMod", ",", 
    RowBox[{
    "\"\<ModNotation[\[Ellipsis]]\>\"", "\[Rule]", 
     "\"\<OQuolyMod[\[Ellipsis]]\>\""}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"PolyLeadingTerm", ";"}], "*)"}]}]}], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.768786316128252*^9, 
   3.7687863309065533`*^9}, {3.7705912279279613`*^9, 3.770591260986025*^9}, {
   3.7706015421019583`*^9, 3.770601543221863*^9}, {3.77060288688787*^9, 
   3.770602920367867*^9}},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{"PolyLeadingOrder", ";", "PolyKer", ";", "PolyPickBasis", ";", 
  "PolyMatrixRank", ";", "PolyInverse", ";", "PolyEValues", ";", "PolyESpace",
   ";", "PolyProjector", ";", "PolySeriesRules", ";", "PolySeriesCoefficient",
   ";", "PolyJDTowers", ";", "PolyJDSpace", ";", "PolyJDData", ";"}]], "Code",
 CellChangeTimes->{{3.770603554810399*^9, 3.770603623938875*^9}}],

Cell[BoxData[
 RowBox[{"LeadingOrderMod", ";", "KerMod", ";", "PickBasisMod", ";", 
  "MatrixRankMod", ";", "InverseMod", ";", "EValuesMod", ";", "ESpaceMod", 
  ";", "ProjectorMod", ";", "SeriesRulesMod", ";", "SeriesCoefficientMod", 
  ";", "JDTowersMod", ";", "JDSpaceMod", ";", "JDDataMod", ";"}]], "Code",
 CellChangeTimes->{{3.7706015605019007`*^9, 3.770601575694478*^9}, {
  3.770603705108809*^9, 3.7706037632435493`*^9}, {3.7706067515218077`*^9, 
  3.7706068029046593`*^9}, {3.770606861121188*^9, 3.7706068636568813`*^9}}],

Cell[BoxData[
 RowBox[{"$LibraNotations", ";"}]], "Code",
 CellChangeTimes->{3.7706014732707148`*^9}],

Cell[BoxData[
 RowBox[{"NotationsBlock", ";"}]], "Code",
 CellChangeTimes->{3.7706014732707148`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Private Section", "Section",
 CellChangeTimes->{{3.718578424129755*^9, 3.718578427906485*^9}},
 ExpressionUUID -> "a5bb4a22-6da5-4f6c-95a9-d1eba8ad74e3"],

Cell[BoxData[
 RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}]], "Code",
 CellChangeTimes->{{3.7185778213164663`*^9, 3.71857782938163*^9}},
 ExpressionUUID -> "340b5d22-551e-4d69-bc50-5fba3b4768a3"],

Cell[CellGroupData[{

Cell["Missing system tools", "Subsection",
 CellChangeTimes->{{3.721218087822298*^9, 3.721218090629321*^9}},
 ExpressionUUID -> "09b1ffc8-2a1a-4878-97a2-956ef666d81c"],

Cell[CellGroupData[{

Cell["GenCoefficientRules,GenCoefficient", "Subsubsection",
 CellChangeTimes->{{3.770812219045294*^9, 3.770812223004084*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"System`GenCoefficientRules", "::", "usage"}], "=", 
   "\"\<GenCoefficientRules[expr,vars] does the same as \
CoefficientRules[expr,vars], but applies also to noninteger powers.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.748921950663769*^9, 3.748922008483482*^9}},
 ExpressionUUID -> "17bd8385-44ef-4de6-8b8a-e7c35a259f97"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"System`GenCoefficient", "::", "usage"}], "=", 
   "\"\<GenCoefficient[expr,vars, pows] returns coefficient in front of the \
Times@@(vars^pows).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.748921950663769*^9, 3.748922019179706*^9}, {
  3.748922121193478*^9, 3.748922159748518*^9}},
 ExpressionUUID -> "52550054-39b4-45f5-b66b-54e45166f16e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"System`GenCoefficientRules", "[", 
    RowBox[{"expr_", ",", "var_"}], "]"}], ":=", 
   RowBox[{"System`GenCoefficientRules", "[", 
    RowBox[{"expr", ",", 
     RowBox[{"{", "var", "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"System`GenCoefficientRules", "[", 
    RowBox[{"expr_List", ",", "vars_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"System`GenCoefficientRules", "[", 
      RowBox[{"#", ",", "vars"}], "]"}], "&"}], "/@", "expr"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"System`GenCoefficientRules", "[", 
    RowBox[{"expr_", ",", "vars_List"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ps", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Unique", "[", "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"Length", "@", "vars"}], "}"}]}], "]"}]}], ",", "expanded",
        ",", "tov", ",", "v"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"expanded", "=", 
       RowBox[{"Expand", "[", 
        RowBox[{"expr", "*", 
         RowBox[{"Times", "@@", 
          RowBox[{"(", 
           RowBox[{"vars", "^", "ps"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tov", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Cases", "[", 
         RowBox[{"expanded", ",", 
          RowBox[{
           RowBox[{
            RowBox[{"(", "_.", ")"}], 
            RowBox[{"(", 
             RowBox[{"Times", "@@", 
              RowBox[{"(", 
               RowBox[{"vars", "^", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Pattern", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Blank", "[", "]"}]}], "]"}], "&"}], "/@", "ps"}],
                  ")"}]}], ")"}]}], ")"}]}], "\[RuleDelayed]", 
           RowBox[{"Evaluate", "[", 
            RowBox[{
             RowBox[{"Times", "@@", 
              RowBox[{"(", 
               RowBox[{"vars", "^", "ps"}], ")"}]}], "\[Rule]", 
             RowBox[{"v", "@@", "ps"}]}], "]"}]}], ",", "All"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Last", "/@", "tov"}], " ", "\[Rule]", 
          RowBox[{"Last", "/@", 
           RowBox[{"CoefficientRules", "[", 
            RowBox[{
             RowBox[{"expanded", "/.", "tov"}], ",", 
             RowBox[{"Last", "/@", "tov"}]}], "]"}]}]}], "]"}], "/.", 
        RowBox[{"v", "\[Rule]", "List"}]}], "/.", 
       RowBox[{"Thread", "[", 
        RowBox[{"ps", "\[Rule]", "0"}], "]"}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"System`GenCoefficient", "[", 
    RowBox[{"expr_", ",", "var_", ",", "pow_"}], "]"}], ":=", 
   RowBox[{"System`GenCoefficient", "[", 
    RowBox[{"expr", ",", 
     RowBox[{"{", "var", "}"}], ",", 
     RowBox[{"{", "pow", "}"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"System`GenCoefficient", "[", 
   RowBox[{"expr_", ",", "vars_List", ",", "pows_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ps", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"Length", "@", "vars"}], "}"}]}], "]"}]}], ",", "expanded", 
      ",", "v"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"expanded", "=", 
      RowBox[{"Expand", "[", 
       RowBox[{"expr", "*", 
        RowBox[{"Times", "@@", 
         RowBox[{"(", 
          RowBox[{"vars", "^", "ps"}], ")"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Coefficient", "[", 
      RowBox[{
       RowBox[{"expanded", "/.", 
        RowBox[{
         RowBox[{"Times", "@@", 
          RowBox[{"(", 
           RowBox[{"vars", "^", 
            RowBox[{"Expand", "[", 
             RowBox[{"ps", "+", "pows"}], "]"}]}], ")"}]}], "\[RuleDelayed]", 
         "v"}]}], ",", "v"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.74892203337822*^9, 3.748922067325349*^9}, {
   3.748922400878785*^9, 3.748922426623148*^9}, {3.749864708629479*^9, 
   3.749864709301103*^9}, 3.7498648888059196`*^9, 3.763273092247614*^9, 
   3.767998316723827*^9},
 ExpressionUUID -> "4c644329-c7db-4a6f-b6d1-9eb2024329bf"]
}, Closed]],

Cell[CellGroupData[{

Cell["PartitionByLengths", "Subsubsection",
 CellChangeTimes->{3.721218154488092*^9},
 ExpressionUUID -> "c3251fbd-fd7d-4637-b6f2-ca202deee2e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"System`PartitionByLengths", "::", "usage"}], "=", 
   "\"\<PartitionByLengths[list,lengths] splits list into chunks of the given \
leghts.\\nExample:PartitionByLengths[{a,b,c,d,e,f},{3,1,2}] \[LongRightArrow] \
{{a,b,c},{d},{e,f}}\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7212181608659897`*^9, 3.721218175967696*^9}, {
  3.721218233587694*^9, 3.721218329719858*^9}, {3.721364136684396*^9, 
  3.721364161804344*^9}, {3.749866158779541*^9, 3.7498661592354813`*^9}},
 ExpressionUUID -> "da5a4441-36c8-4f23-aed4-850b17ae4ef3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"System`PartitionByLengths", "[", 
   RowBox[{"a_List", ",", "b_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"es", "=", 
       RowBox[{"Accumulate", "[", "b", "]"}]}], ",", "bs"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"bs", "=", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Most", "@", "es"}], "+", "1"}], ",", "1"}], "]"}]}], ";", 
     "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"Take", "[", 
        RowBox[{"a", ",", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"bs", ",", "es"}], "}"}], "]"}]}]}]}], "\n", "]"}]}]], "Code",
 CellChangeTimes->{3.721364164806407*^9},
 ExpressionUUID -> "27096cc1-3488-487e-9278-1e83ce421656"]
}, Closed]],

Cell[CellGroupData[{

Cell["ShuffleProduct, StuffleProduct", "Subsubsection",
 CellChangeTimes->{
  3.721218154488092*^9, {3.763299462289385*^9, 3.763299472135516*^9}},
 ExpressionUUID -> "c3251fbd-fd7d-4637-b6f2-ca202deee2e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"System`ShuffleProduct", "::", "usage"}], "=", 
   "\"\<ShuffleProduct[l1,l2] implements the shuffle product, e.g., \
ShuffleProduct[{a,b},{c,d}] \[LongRightArrow] \
{{a,b,c,d},{a,c,b,d},{a,c,d,b},{c,a,b,d},{c,a,d,b},{c,d,a,b}}.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.724745818682981*^9, 3.724745984940402*^9}},
 ExpressionUUID -> "b5f7c273-60ee-44f0-b355-c59ffb5ed3cc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"System`ShuffleProduct", "[", 
   RowBox[{"a_List", ",", "b_List"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"chrs", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"a", ",", "b"}], "]"}]}], ",", "nums"}], "}"}], ",", 
    RowBox[{
     RowBox[{"nums", "=", 
      RowBox[{"Range", "[", 
       RowBox[{"Length", "[", "chrs", "]"}], "]"}]}], ";", 
     RowBox[{
      RowBox[{
       RowBox[{"Join", "@", 
        RowBox[{"(", 
         RowBox[{"Permute", "[", 
          RowBox[{"chrs", ",", "#"}], "]"}], ")"}]}], "&"}], "/@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{"#", ",", 
           RowBox[{"Complement", "[", 
            RowBox[{"nums", ",", "#"}], "]"}]}], "]"}], "&"}], "/@", 
        RowBox[{"Subsets", "[", 
         RowBox[{"nums", ",", 
          RowBox[{"{", 
           RowBox[{"Length", "[", "a", "]"}], "}"}]}], "]"}]}], ")"}]}]}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.724745783223205*^9, 3.724745800853633*^9}, 
   3.732835725357811*^9},
 ExpressionUUID -> "ffa6849e-baed-4330-ad86-1cfb71ff9bb1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"System`StuffleProduct", "::", "usage"}], "=", 
   "\"\<StuffleProduct[l1,l2] implements the stuffle product, e.g., \
StuffleProduct[{a,b},{c,d}] \
\[LongRightArrow]{{a,b,c,d},{a,b+c,d},{a,c,b,d},{a,c,b+d},{a+c,b,d},{a+c,b+d},\
{a,c,d,b},{a+c,d,b},{c,a,b,d},{c,a,b+d},{c,a,d,b},{c,a+d,b},{c,d,a,b}}.\\nTo \
replace '+' in the above expression with function f, use the option Function\
\[Rule]f. E.g. StuffleProduct[{a,b},{c,d},Function\[Rule]f] \
\[LongRightArrow]{{a,b,c,d},{a,f[b,c],d},{a,c,b,d},{a,c,f[b,d]},{f[a,c],b,d},{\
f[a,c],f[b,d]},{a,c,d,b},{f[a,c],d,b},{c,a,b,d},{c,a,f[b,d]},{c,a,d,b},{c,f[a,\
d],b},{c,d,a,b}}.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7328372657828283`*^9, 3.732837301419201*^9}, {
  3.732837432499957*^9, 3.732837463430982*^9}, {3.732837530964724*^9, 
  3.732837570563849*^9}, {3.732837634277945*^9, 3.732837660733425*^9}, {
  3.732841344915843*^9, 3.732841350087343*^9}},
 ExpressionUUID -> "bb7cd340-2e9a-4c69-b85b-eb1188d4a326"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "System`StuffleProduct", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{"Function", "\[Rule]", "Plus"}], "}"}]}]], "Code",
 CellChangeTimes->{{3.732837375486126*^9, 3.732837398435771*^9}},
 ExpressionUUID -> "1ecaf81f-8a2a-4cfd-b83f-379c0163199e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"System`StuffleProduct", "[", 
   RowBox[{"alist_List", ",", "blist_List", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"res", ",", 
      RowBox[{"ar", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"Length", "@", "alist"}], "]"}]}], ",", 
      RowBox[{"br", "=", 
       RowBox[{"-", 
        RowBox[{"Reverse", "@", 
         RowBox[{"Range", "[", 
          RowBox[{"Length", "@", "blist"}], "]"}]}]}]}], ",", "p", ",", "s", 
      ",", "l"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"res", "=", 
      RowBox[{"ShuffleProduct", "[", 
       RowBox[{"ar", ",", "br"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"res", "=", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Outer", "[", 
             RowBox[{"l", ",", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"List", "/@", "#"}], "//.", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"pre___", ",", 
                    RowBox[{"{", 
                    RowBox[{"a", ":", 
                    RowBox[{"Alternatives", "@@", "ar"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"b", ":", 
                    RowBox[{"Alternatives", "@@", "br"}]}], "}"}], ",", 
                    "post___"}], "}"}], "\[RuleDelayed]", 
                  RowBox[{"{", 
                   RowBox[{"pre", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"s", "[", 
                    RowBox[{"a", ",", "b"}], "]"}], ",", 
                    RowBox[{"p", "[", 
                    RowBox[{"a", ",", "b"}], "]"}]}], "}"}], ",", "post"}], 
                   "}"}]}]}], ")"}]}]}], "]"}], "&"}], "/@", "res"}], "]"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"s", "\[Rule]", "Sequence"}], ",", 
           RowBox[{"l", "\[Rule]", "List"}]}], "}"}]}], "/.", 
        RowBox[{"Thread", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{"ar", ",", "br"}], "]"}], "->", 
          RowBox[{"Join", "[", 
           RowBox[{"alist", ",", "blist"}], "]"}]}], "]"}]}], "/.", 
       RowBox[{"p", "\[Rule]", 
        RowBox[{"OptionValue", "[", "Function", "]"}]}]}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.73283671610452*^9, 3.7328368051372557`*^9}, {
   3.732836922665111*^9, 3.732837186036172*^9}, 3.732837259134088*^9, {
   3.732837406411635*^9, 3.732837421431406*^9}},
 ExpressionUUID -> "fa72408e-13af-4ecd-9a16-9697f78e843d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"System`TransposeYoungTableau", "::", "usage"}], "=", 
   "\"\<TransposeYoungTableau[{\!\(\*SubscriptBox[
StyleBox[\"list\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"list\", \"TI\"], \"2\"]\),\[Ellipsis]}] transposes list of lists \
of non-increasing lengths.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"System`TransposeYoungTableau", "[", "yt_List", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"l", "=", 
       RowBox[{"Length", "@", 
        RowBox[{"First", "[", "yt", "]"}]}]}], ",", "sq"}], "}"}], ",", 
    RowBox[{"Replace", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"PadRight", "[", 
          RowBox[{"#", ",", "l", ",", "sq"}], "]"}], "&"}], "/@", "yt"}], 
       "]"}], ",", 
      RowBox[{"sq", "\[RuleDelayed]", 
       RowBox[{"Sequence", "[", "]"}]}], ",", 
      RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.768869521405908*^9, 3.7688695816085367`*^9}, {
  3.768869667925396*^9, 3.768869731035022*^9}, {3.7688699909361477`*^9, 
  3.768870045616509*^9}, {3.768870282822784*^9, 3.768870283797697*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"System`TransposePadRight", "::", "usage"}], "=", 
   "\"\<TransposePadRight[{\!\(\*SubscriptBox[
StyleBox[\"list\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"list\", \"TI\"], \"2\"]\),\[Ellipsis]},\!\(\*
StyleBox[\"x\", \"TI\"]\)] transposes list of lists appending some of them \
with \!\(\*
StyleBox[\"x\", \"TI\"]\) if necessary.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"System`TransposePadRight", "[", 
   RowBox[{"yt_List", ",", "x_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"l", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Length", "/@", "yt"}], "]"}]}], ",", "sq"}], "}"}], ",", 
    RowBox[{"Replace", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"PadRight", "[", 
          RowBox[{"#", ",", "l", ",", "sq"}], "]"}], "&"}], "/@", "yt"}], 
       "]"}], ",", 
      RowBox[{"sq", "\[RuleDelayed]", "x"}], ",", 
      RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.768869521405908*^9, 3.7688695816085367`*^9}, {
  3.768869667925396*^9, 3.768869731035022*^9}, {3.7688699909361477`*^9, 
  3.768870045616509*^9}, {3.768870282822784*^9, 3.768870283797697*^9}, {
  3.770799540759263*^9, 3.770799621313056*^9}, {3.7708001456270123`*^9, 
  3.770800171272991*^9}}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Greeting", "Subsection",
 CellChangeTimes->{{3.770812300942295*^9, 3.7708123017628736`*^9}, {
  3.770812334434325*^9, 3.7708123451284227`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"FCStaticMonitor", ",", 
    RowBox[{"{", "HoldAll", "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FCStaticMonitor", "[", 
    RowBox[{"code_", ",", "msg_", ",", 
     RowBox[{"delay_:", "0"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{"$Notebooks", ",", "\[IndentingNewLine]", 
     RowBox[{"Monitor", "[", 
      RowBox[{"code", ",", "msg", ",", "delay"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"WriteString", "[", 
       RowBox[{"\"\<stdout\>\"", ",", 
        RowBox[{"\"\<\\n[\>\"", "<>", 
         RowBox[{"ToString", "[", "msg", "]"}]}]}], "]"}], ";", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"WriteString", "[", 
           RowBox[{"\"\<stdout\>\"", ",", "\"\<]\>\""}], "]"}], ";", "#"}], 
         ")"}], "&"}], "[", "code", "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
   ";"}]}], "Code",
 CellChangeTimes->{{3.768682829477463*^9, 3.768682829479333*^9}, {
   3.76869050231207*^9, 3.7686905024887543`*^9}, {3.76869074213619*^9, 
   3.768690776068286*^9}, 3.768691017718012*^9, {3.7686910680310993`*^9, 
   3.768691068704439*^9}, {3.7686919373999043`*^9, 3.768691988433538*^9}, {
   3.7686920402908297`*^9, 3.7686920817845373`*^9}, {3.768693980848888*^9, 
   3.768694004129974*^9}, {3.7687017042802687`*^9, 3.768701746959838*^9}, {
   3.7687017965975513`*^9, 3.7687018131683683`*^9}, {3.768895427643385*^9, 
   3.768895428683044*^9}, {3.7688955614200583`*^9, 3.768895611955949*^9}, 
   3.770114597255851*^9, {3.7701162681488028`*^9, 3.770116275657916*^9}, 
   3.7705911675968*^9},
 ExpressionUUID -> "7581a774-d0b9-4094-8248-f006e78bcc27"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"FCMonitor", ",", 
    RowBox[{"{", "HoldAll", "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FCMonitor", "[", 
    RowBox[{"code_", ",", "mon_", ",", 
     RowBox[{"delay_:", "0"}], ",", 
     RowBox[{"msg_String:", "\"\<\>\""}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{"$Notebooks", ",", "\[IndentingNewLine]", 
     RowBox[{"Monitor", "[", 
      RowBox[{"code", ",", "mon", ",", "delay"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"msg", "=!=", "\"\<\>\""}], ",", 
        RowBox[{"WriteString", "[", 
         RowBox[{"\"\<stdout\>\"", ",", 
          RowBox[{"\"\<\\n[\>\"", "<>", "msg"}]}], "]"}]}], "]"}], ";", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"msg", "=!=", "\"\<\>\""}], ",", 
            RowBox[{"WriteString", "[", 
             RowBox[{"\"\<stdout\>\"", ",", "\"\<]\>\""}], "]"}]}], "]"}], 
          ";", "#"}], ")"}], "&"}], "[", "code", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{
  3.768691023449111*^9, {3.768691072578537*^9, 3.768691118203417*^9}, {
   3.768691450275229*^9, 3.768691450674857*^9}, {3.768691779555355*^9, 
   3.768691852325221*^9}, {3.768692158566321*^9, 3.7686921608380337`*^9}, {
   3.7686921951804047`*^9, 3.7686922310515757`*^9}, 3.768692272977202*^9, {
   3.768692328052038*^9, 3.7686923284708147`*^9}, {3.768693964849196*^9, 
   3.7686939658333607`*^9}, 3.76869400636235*^9, {3.768701762648354*^9, 
   3.76870181776488*^9}},
 ExpressionUUID -> "874a4f59-48c1-43ab-b5ac-b213f8a9df75"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FCPrint", "[", "ex__", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{"$Notebooks", ",", 
     RowBox[{"Print", "[", "ex", "]"}], ",", 
     RowBox[{"Print", "@@", 
      RowBox[{"(", 
       RowBox[{"ToString", "/@", 
        RowBox[{"{", "ex", "}"}]}], ")"}]}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FCPrintTemporary", "[", "ex__", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{"$Notebooks", ",", 
     RowBox[{"PrintTemporary", "[", "ex", "]"}], ",", 
     RowBox[{"Print", "@@", 
      RowBox[{"(", 
       RowBox[{"ToString", "/@", 
        RowBox[{"{", "ex", "}"}]}], ")"}]}]}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.768682829477463*^9, 3.768682829479333*^9}, {
   3.76869050231207*^9, 3.7686905024887543`*^9}, {3.76869074213619*^9, 
   3.768690776068286*^9}, 3.768691017718012*^9},
 ExpressionUUID -> "fdce056f-266f-4215-82c5-834344564408"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FCPrint", "[", 
   RowBox[{"\"\<\\n******************** \>\"", ",", 
    RowBox[{"Style", "[", 
     RowBox[{
      RowBox[{"\"\<Libra v\>\"", "<>", 
       RowBox[{"ToString", "[", "$LibraVersion", "]"}]}], ",", 
      RowBox[{"{", "Bold", "}"}]}], "]"}], ",", 
    RowBox[{
    "\"\< ********************\\nLibra (\:2696) is a package for the \
manipulation with differential systems.\\n\[Copyright] Roman N. Lee, \
2018.\\nRead from: \>\"", "<>", "$InputFileName", "<>", "\"\<\\nMD5: \>\"", "<>", 
     RowBox[{"ToString", "[", 
      RowBox[{"FileHash", "[", 
       RowBox[{"$InputFileName", ",", "\"\<MD5\>\""}], "]"}], "]"}]}]}], 
   "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.718577847228801*^9, 3.718577848537767*^9}, {
   3.718578012752762*^9, 3.71857813208257*^9}, {3.718578181330419*^9, 
   3.718578182222333*^9}, 3.718578267288775*^9, 3.722554979382238*^9, {
   3.727700158227707*^9, 3.727700264463379*^9}, {3.727701109760561*^9, 
   3.727701139020905*^9}, {3.727701216112652*^9, 3.727701225155036*^9}, {
   3.768690462209918*^9, 3.7686904823295*^9}, {3.76869085284336*^9, 
   3.7686908534211273`*^9}, {3.768690918964682*^9, 3.768690931342901*^9}, {
   3.7687131410323467`*^9, 3.768713186494327*^9}, {3.770096662231015*^9, 
   3.770096668319412*^9}, {3.770117754249042*^9, 3.770117754497282*^9}, {
   3.770117809097744*^9, 3.770117810600758*^9}, {3.7701178854492207`*^9, 
   3.7701179737550793`*^9}, 3.770119513566626*^9, 3.770119579821258*^9},
 ExpressionUUID -> "dd00e6e4-2467-4938-8d78-de0d72876247"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CWrite", "[", "msg_String", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"!", "$Notebooks"}], ",", 
     RowBox[{"WriteString", "[", 
      RowBox[{"\"\<stdout\>\"", ",", "msg"}], "]"}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.768691744616*^9, 3.7686917690914097`*^9}, {
  3.768692308551235*^9, 3.768692357998212*^9}},
 ExpressionUUID -> "b5845a78-932f-434b-a555-438e2b795766"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"todolist", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"donelist", "=", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"todo", "[", "s_String", "]"}], ":=", 
   RowBox[{"AppendTo", "[", 
    RowBox[{"todolist", ",", "s"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"done", "[", "s_String", "]"}], ":=", 
   RowBox[{"AppendTo", "[", 
    RowBox[{"donelist", ",", "s"}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.7211130068526487`*^9, 3.7211130158979883`*^9}, {
  3.7211131126562*^9, 3.7211131544581833`*^9}, {3.763212438472269*^9, 
  3.763212509596697*^9}},
 ExpressionUUID -> "593f17d1-e8a3-4cdc-9bf4-fafdbc6ff390"],

Cell[BoxData[
 RowBox[{"todo", "[", "\"\<OffDiagonalBlocksIndices[_?DSystemQ]\>\"", 
  "]"}]], "Code",
 CellChangeTimes->{{3.768541640238887*^9, 3.768541659005172*^9}},
 ExpressionUUID -> "bf536108-15e6-444b-9ce9-19017715dd5e"]
}, Closed]],

Cell[CellGroupData[{

Cell["Obsolete", "Subsection",
 CellChangeTimes->{{3.770603671105084*^9, 3.770603673827362*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyLeadingOrder", "[", 
    RowBox[{"m_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"LeadingOrderMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyLeadingOrder[m,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<LeadingOrderMod[m,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7706015605019007`*^9, 3.770601575694478*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyKer", "[", 
    RowBox[{"m_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"KerMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyKer[m,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<KerMod[m,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.7687828434821787`*^9, 
   3.768782844761715*^9}, {3.768784761266204*^9, 3.768784768185701*^9}, {
   3.768784960570943*^9, 3.768784961066244*^9}, {3.768785471725792*^9, 
   3.7687854730924063`*^9}, 3.7688060046123743`*^9, 3.768806606808228*^9, 
   3.76887215837704*^9, {3.770591267887205*^9, 3.770591396285016*^9}, {
   3.770591587523213*^9, 3.770591603383788*^9}, 3.770591643707244*^9, {
   3.770591807543869*^9, 3.770591833255047*^9}, 3.7705918979305477`*^9, 
   3.770591929651222*^9, {3.770592397021337*^9, 3.7705925501857843`*^9}, {
   3.770592587851859*^9, 3.7705926486085453`*^9}, {3.770600528961048*^9, 
   3.770600611898267*^9}, {3.770600645587646*^9, 3.770600699425621*^9}},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyPickBasis", "[", 
    RowBox[{"vs_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"PickBasisMod", "[", 
      RowBox[{"vs", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyPickBasis[vs,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<PickBasisMod[vs,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.7687828434821787`*^9, 
   3.768782844761715*^9}, {3.768784761266204*^9, 3.768784768185701*^9}, {
   3.768784960570943*^9, 3.768784961066244*^9}, {3.768785471725792*^9, 
   3.7687854730924063`*^9}, 3.7688060046123743`*^9, 3.768806606808228*^9, 
   3.76887215837704*^9, {3.770591267887205*^9, 3.770591396285016*^9}, {
   3.770591587523213*^9, 3.770591603383788*^9}, 3.770591643707244*^9, {
   3.770591807543869*^9, 3.770591833255047*^9}, 3.7705918979305477`*^9, 
   3.770591929651222*^9, {3.770592397021337*^9, 3.7705925501857843`*^9}, {
   3.770592587851859*^9, 3.7705926486085453`*^9}, {3.770600528961048*^9, 
   3.770600611898267*^9}, {3.770600645587646*^9, 3.770600704729065*^9}},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyMatrixRank", "[", 
    RowBox[{"m_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"MatrixRankMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyMatrixRank[m,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<MatrixRankMod[m,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.7687828434821787`*^9, 
   3.768782844761715*^9}, {3.768784761266204*^9, 3.768784768185701*^9}, {
   3.768784960570943*^9, 3.768784961066244*^9}, {3.768785471725792*^9, 
   3.7687854730924063`*^9}, 3.7688060046123743`*^9, 3.768806606808228*^9, 
   3.76887215837704*^9, {3.770591267887205*^9, 3.770591396285016*^9}, {
   3.770591587523213*^9, 3.770591603383788*^9}, 3.770591643707244*^9, {
   3.770591807543869*^9, 3.770591833255047*^9}, 3.7705918979305477`*^9, 
   3.770591929651222*^9, {3.770592397021337*^9, 3.7705925501857843`*^9}, {
   3.770592587851859*^9, 3.7705926486085453`*^9}, {3.770600528961048*^9, 
   3.770600611898267*^9}, {3.770600645587646*^9, 3.770600762228142*^9}, {
   3.770601134308785*^9, 3.7706011358166428`*^9}},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyInverse", "[", 
    RowBox[{"m_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"InverseMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyInverse[m,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<InverseMod[m,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.7687828434821787`*^9, 
   3.768782844761715*^9}, {3.768784761266204*^9, 3.768784768185701*^9}, {
   3.768784960570943*^9, 3.768784961066244*^9}, {3.768785471725792*^9, 
   3.7687854730924063`*^9}, 3.7688060046123743`*^9, 3.768806606808228*^9, 
   3.76887215837704*^9, {3.770591267887205*^9, 3.770591396285016*^9}, {
   3.770591587523213*^9, 3.770591603383788*^9}, 3.770591643707244*^9, {
   3.770591807543869*^9, 3.770591833255047*^9}, 3.7705918979305477`*^9, 
   3.770591929651222*^9, {3.770592397021337*^9, 3.7705925501857843`*^9}, {
   3.770592587851859*^9, 3.7705926486085453`*^9}, {3.770600528961048*^9, 
   3.770600611898267*^9}, {3.770600645587646*^9, 3.7706007182170277`*^9}, {
   3.770600783069682*^9, 3.770600794169664*^9}, {3.7706010878388567`*^9, 
   3.77060109169947*^9}, 3.7706011410535097`*^9},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyEValues", "[", 
    RowBox[{"m_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"EValuesMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyEValues[m,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<EValuesMod[m,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.7687828434821787`*^9, 
   3.768782844761715*^9}, {3.768784761266204*^9, 3.768784768185701*^9}, {
   3.768784960570943*^9, 3.768784961066244*^9}, {3.768785471725792*^9, 
   3.7687854730924063`*^9}, 3.7688060046123743`*^9, 3.768806606808228*^9, 
   3.76887215837704*^9, {3.770591267887205*^9, 3.770591396285016*^9}, {
   3.770591587523213*^9, 3.770591603383788*^9}, 3.770591643707244*^9, {
   3.770591807543869*^9, 3.770591833255047*^9}, 3.7705918979305477`*^9, 
   3.770591929651222*^9, {3.770592397021337*^9, 3.7705925501857843`*^9}, {
   3.770592587851859*^9, 3.7705926486085453`*^9}, {3.770600528961048*^9, 
   3.770600611898267*^9}, {3.770600645587646*^9, 3.7706007182170277`*^9}, {
   3.770600783069682*^9, 3.7706007987455873`*^9}, 3.770601045174082*^9, 
   3.770601098766368*^9, 3.7706011443469963`*^9},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyESpace", "[", 
    RowBox[{"m_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"ESpaceMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyESpace[m,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<ESpaceMod[m,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.7687828434821787`*^9, 
   3.768782844761715*^9}, {3.768784761266204*^9, 3.768784768185701*^9}, {
   3.768784960570943*^9, 3.768784961066244*^9}, {3.768785471725792*^9, 
   3.7687854730924063`*^9}, 3.7688060046123743`*^9, 3.768806606808228*^9, 
   3.76887215837704*^9, {3.770591267887205*^9, 3.770591396285016*^9}, {
   3.770591587523213*^9, 3.770591603383788*^9}, 3.770591643707244*^9, {
   3.770591807543869*^9, 3.770591833255047*^9}, 3.7705918979305477`*^9, 
   3.770591929651222*^9, {3.770592397021337*^9, 3.7705925501857843`*^9}, {
   3.770592587851859*^9, 3.7705926486085453`*^9}, {3.770600528961048*^9, 
   3.770600611898267*^9}, {3.770600645587646*^9, 3.7706007182170277`*^9}, {
   3.770600783069682*^9, 3.770600803185499*^9}, 3.7706010512926702`*^9, 
   3.770601102947804*^9, 3.770601152296302*^9},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyProjector", "[", 
    RowBox[{"us_", ",", "vs_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], 
   ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"ProjectorMod", "[", 
      RowBox[{"us", ",", "vs", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyProjector[us,vs,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<ProjectorMod[us,vs,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.7687828434821787`*^9, 
   3.768782844761715*^9}, {3.768784761266204*^9, 3.768784768185701*^9}, {
   3.768784960570943*^9, 3.768784961066244*^9}, {3.768785471725792*^9, 
   3.7687854730924063`*^9}, 3.7688060046123743`*^9, 3.768806606808228*^9, 
   3.76887215837704*^9, {3.770591267887205*^9, 3.770591396285016*^9}, {
   3.770591587523213*^9, 3.770591603383788*^9}, 3.770591643707244*^9, {
   3.770591807543869*^9, 3.770591833255047*^9}, 3.7705918979305477`*^9, 
   3.770591929651222*^9, {3.770592397021337*^9, 3.7705925501857843`*^9}, {
   3.770592587851859*^9, 3.7705926486085453`*^9}, {3.770600528961048*^9, 
   3.770600611898267*^9}, {3.770600645587646*^9, 3.7706007182170277`*^9}, {
   3.770600783069682*^9, 3.770600844658634*^9}, {3.77060097782742*^9, 
   3.7706009828908577`*^9}, {3.77060105794074*^9, 3.7706010734996223`*^9}, {
   3.770601110131467*^9, 3.770601113530322*^9}, {3.7706012787876*^9, 
   3.770601288309086*^9}},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolySeriesRules", "[", 
    RowBox[{"m_", ",", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "poly_", ",", "o_"}], "}"}], ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"SeriesRulesMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"x", "\[Rule]", "poly"}], ",", "o"}], "}"}], ",", "a"}], 
      "]"}], ",", 
     RowBox[{
     "\"\<PolySeriesRules[m,{x,poly,o},\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<SeriesRulesMod[m,{x\[Rule]poly,o},\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.7687828434821787`*^9, 
   3.768782844761715*^9}, {3.768784761266204*^9, 3.768784768185701*^9}, {
   3.768784960570943*^9, 3.768784961066244*^9}, {3.768785471725792*^9, 
   3.7687854730924063`*^9}, 3.7688060046123743`*^9, 3.768806606808228*^9, 
   3.76887215837704*^9, {3.770591267887205*^9, 3.770591396285016*^9}, {
   3.770591587523213*^9, 3.770591603383788*^9}, 3.770591643707244*^9, {
   3.770591807543869*^9, 3.770591833255047*^9}, 3.7705918979305477`*^9, 
   3.770591929651222*^9, {3.770592397021337*^9, 3.7705925501857843`*^9}, {
   3.770592587851859*^9, 3.7705926486085453`*^9}, {3.770600528961048*^9, 
   3.770600611898267*^9}, {3.770600645587646*^9, 3.7706007182170277`*^9}, {
   3.770600783069682*^9, 3.770600844658634*^9}, {3.77060097782742*^9, 
   3.7706009828908577`*^9}, {3.77060105794074*^9, 3.7706010734996223`*^9}, {
   3.770601110131467*^9, 3.7706011159939003`*^9}, 3.770601161994905*^9, {
   3.770607741077402*^9, 3.770607803245781*^9}},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolySeriesCoefficient", "[", 
    RowBox[{"m_", ",", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "poly_", ",", "o_"}], "}"}], ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"SeriesCoefficientMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"x", "\[Rule]", "poly"}], ",", "o"}], "}"}], ",", "a"}], 
      "]"}], ",", 
     RowBox[{
     "\"\<PolySeriesCoefficient[m,{x,poly,o},\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<SeriesCoefficientMod[m,{x\[Rule]poly,o},\[Ellipsis]]\>\""}]}], 
    "]"}]}], ";"}]], "Code",
 CellChangeTimes->{
  3.729897381467332*^9, {3.729897418966661*^9, 3.7298974391780863`*^9}, {
   3.729903579344138*^9, 3.729903580438281*^9}, {3.768114202348*^9, 
   3.7681142047079487`*^9}, {3.768114576661207*^9, 3.768114577741858*^9}, {
   3.7681352306285877`*^9, 3.7681352835764017`*^9}, {3.768135665719928*^9, 
   3.768135666721814*^9}, 3.76813571377127*^9, {3.768514859604295*^9, 
   3.768514885524332*^9}, {3.768524231132852*^9, 3.768524233055168*^9}, {
   3.7687195030601397`*^9, 3.768719514411993*^9}, {3.7687249243869143`*^9, 
   3.768724925799879*^9}, {3.7687406446523848`*^9, 3.7687406466179256`*^9}, {
   3.76874302070638*^9, 3.7687430330961018`*^9}, {3.7687828434821787`*^9, 
   3.768782844761715*^9}, {3.768784761266204*^9, 3.768784768185701*^9}, {
   3.768784960570943*^9, 3.768784961066244*^9}, {3.768785471725792*^9, 
   3.7687854730924063`*^9}, 3.7688060046123743`*^9, 3.768806606808228*^9, 
   3.76887215837704*^9, {3.770591267887205*^9, 3.770591396285016*^9}, {
   3.770591587523213*^9, 3.770591603383788*^9}, 3.770591643707244*^9, {
   3.770591807543869*^9, 3.770591833255047*^9}, 3.7705918979305477`*^9, 
   3.770591929651222*^9, {3.770592397021337*^9, 3.7705925501857843`*^9}, {
   3.770592587851859*^9, 3.7705926486085453`*^9}, {3.770600528961048*^9, 
   3.770600611898267*^9}, {3.770600645587646*^9, 3.7706007182170277`*^9}, {
   3.770600783069682*^9, 3.770600844658634*^9}, {3.77060097782742*^9, 
   3.7706009828908577`*^9}, {3.77060105794074*^9, 3.7706010734996223`*^9}, {
   3.770601110131467*^9, 3.770601120507619*^9}, 3.770601166467122*^9, {
   3.770607808977069*^9, 3.770607838789559*^9}},
 ExpressionUUID -> "d778b495-38a8-4af3-a672-c4bbfd5c011c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyJDTowers", "[", 
    RowBox[{"m_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"JDTowersMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyJDTowers[m,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<JDTowersMod[m,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.768947398991559*^9, 3.768947408471614*^9}, {
  3.769204529815151*^9, 3.769204530725245*^9}, {3.770591398949141*^9, 
  3.770591462999346*^9}, {3.770592557008871*^9, 3.770592581330255*^9}, {
  3.7705926564422417`*^9, 3.770592668512844*^9}, {3.770600991526842*^9, 
  3.7706009938512907`*^9}, {3.770601173482881*^9, 3.770601220725152*^9}, {
  3.770609298659973*^9, 3.770609300284203*^9}},
 ExpressionUUID -> "9b99d05c-eac8-4bfc-92db-4533d6486048"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyJDSpace", "[", 
    RowBox[{"m_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"JDSpaceMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyJDSpace[m,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<JDSpaceMod[m,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.768947398991559*^9, 3.768947408471614*^9}, {
   3.769204529815151*^9, 3.769204530725245*^9}, {3.770591398949141*^9, 
   3.770591462999346*^9}, {3.770592557008871*^9, 3.770592581330255*^9}, {
   3.7705926564422417`*^9, 3.770592668512844*^9}, {3.770600991526842*^9, 
   3.770600998475235*^9}, {3.770601176962302*^9, 3.770601193810841*^9}, 
   3.770601226427153*^9},
 ExpressionUUID -> "9b99d05c-eac8-4bfc-92db-4533d6486048"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyJDData", "[", 
    RowBox[{"m_", ",", "poly_", ",", "x_", ",", "a___"}], "]"}], ":=", 
   RowBox[{"Libra`Private`obsolete", "[", 
    RowBox[{
     RowBox[{"JDDataMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}], ",", 
     RowBox[{
     "\"\<PolyJDData[m,poly,x,\[Ellipsis]]\>\"", "\[Rule]", 
      "\"\<JDDataMod[m,x\[Rule]poly,\[Ellipsis]]\>\""}]}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.768947398991559*^9, 3.768947408471614*^9}, {
  3.769204529815151*^9, 3.769204530725245*^9}, {3.770591398949141*^9, 
  3.770591462999346*^9}, {3.770592557008871*^9, 3.770592581330255*^9}, {
  3.7705926564422417`*^9, 3.770592668512844*^9}, {3.770600991526842*^9, 
  3.770600999836295*^9}, {3.770601195570466*^9, 3.770601229177928*^9}},
 ExpressionUUID -> "9b99d05c-eac8-4bfc-92db-4533d6486048"]
}, Closed]],

Cell[CellGroupData[{

Cell["History", "Subsection",
 CellChangeTimes->{{3.719595957786281*^9, 3.719595982902207*^9}, 
   3.719596028807907*^9},
 ExpressionUUID -> "5cdf10af-57a7-47a1-b0a2-e9b8f3627a0e"],

Cell["\<\
History[ds] is the central object. It is a list with the elements of the \
following form:
{M,\[OpenCurlyDoubleQuote]Operation\[CloseCurlyDoubleQuote],extra1\[Rule]\
\[Ellipsis],\[Ellipsis]}\
\>", "Text",
 CellChangeTimes->{{3.719596032160843*^9, 3.719596150135215*^9}, {
  3.719596390046036*^9, 3.719596393780437*^9}, {3.719596458997857*^9, 
  3.719596460563396*^9}},
 ExpressionUUID -> "08bdf968-229b-47cd-8822-00d8335a0e5b"],

Cell[CellGroupData[{

Cell["History, HistoryIndex", "Subsubsection",
 CellChangeTimes->{{3.71962498999254*^9, 3.719625011177001*^9}},
 ExpressionUUID -> "190974ec-198a-42f5-b9af-3c3af9ce1029"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"History", "::", "usage"}], "=", 
   "\"\<History[ds] is the central object. It is a list with the elements of \
the following form:\n\
{M,\\\"Operation\\\",extra1\[Rule]\[Ellipsis],\[Ellipsis]}\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.719596467204249*^9, 3.719596490892064*^9}},
 ExpressionUUID -> "d566b4bc-947e-4a8a-9c69-347038f7b62a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryIndex", "::", "usage"}], "=", 
   "\"\<HistoryIndex[ds] is the current position in the History[ds]\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7195965054224033`*^9, 3.719596553896739*^9}},
 ExpressionUUID -> "72a87874-99a2-435b-8434-f8d83dbf903f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"History", "::", "first"}], "=", 
   "\"\<Undo can not be done. Already at the beginning.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.71959691579707*^9, 3.7195969507370987`*^9}},
 ExpressionUUID -> "cf7fae9a-b64f-4a44-add0-d7bb5a295124"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"History", "::", "last"}], "=", 
   "\"\<Redo can not be done. Already at the end.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.71959691579707*^9, 3.719596969102137*^9}},
 ExpressionUUID -> "7fc38eb0-6d9a-4b70-beef-e50b0a3ccf28"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"History", "::", "nothing"}], "=", 
   "\"\<History change not required.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719598676797695*^9, 3.719598755350388*^9}},
 ExpressionUUID -> "cdcd86aa-3aaf-4ebd-8e05-a3f46573ab79"]
}, Closed]],

Cell[CellGroupData[{

Cell["HistoryAppend, HistoryAddExtra,HistoryDeleteExtra", "Subsubsection",
 CellChangeTimes->{{3.71962498999254*^9, 3.719625036395739*^9}, 
   3.7213813242010307`*^9, {3.721381387007059*^9, 3.721381387386506*^9}},
 ExpressionUUID -> "daa1d8c2-ebb6-4b2a-8a23-40bd6459daf2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryAppend", "::", "usage"}], "=", 
   "\"\<HistoryAppend[ds,{M,{func,arg1,\[Ellipsis]},extra1\[Rule]\[Ellipsis],\
\[Ellipsis]}] adds the most recent entry to the history.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7195978529732943`*^9, 3.719597960908473*^9}, {
  3.71959809275099*^9, 3.7195980944839907`*^9}, {3.720137855672104*^9, 
  3.72013787666775*^9}},
 ExpressionUUID -> "2c29ab7e-d9e0-482e-822e-e02da6c725fd"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "HistoryAppend", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"HistoryChop", "\[Rule]", "False"}], ",", 
     RowBox[{"Print", "\[Rule]", "True"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.722653951613639*^9, 3.722653995670396*^9}, {
  3.72265437715664*^9, 3.722654380045867*^9}, {3.768291739170846*^9, 
  3.7682917431034327`*^9}},
 ExpressionUUID -> "83bef60c-aff9-4aaf-b112-d53d430913cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryAppend", "::", "chop"}], "=", 
  "\"\<Did not change history to avoid overwriting forward entries. Use \
HistoryChop[`1`] first or execute \
SetOptions[HistoryAppend,HistoryChop\[Rule]False].\>\""}]], "Code",
 CellChangeTimes->{{3.72265357343967*^9, 3.72265360323105*^9}, {
  3.722654192845683*^9, 3.7226542671016417`*^9}, {3.7226543609047413`*^9, 
  3.722654367156735*^9}, {3.768189942130849*^9, 3.768189974075264*^9}},
 ExpressionUUID -> "2781d32c-220d-4a8b-b0b0-33b940e2fe44"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryAppend", "[", 
    RowBox[{
     RowBox[{"ds_Symbol", "?", "DSystemQ"}], ",", 
     RowBox[{"event", ":", 
      RowBox[{"{", 
       RowBox[{"_Association", ",", "_List", ",", "___"}], "}"}]}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"If", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"TrueQ", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "HistoryChop", "]"}], "||", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"History", "[", "ds", "]"}], "]"}], "<=", 
        RowBox[{"HistoryIndex", "[", "ds", "]"}]}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "^=", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"History", "[", "ds", "]"}], ",", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}]}], "]"}], ",", "event"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], "+", "1"}]}], ";", 
      RowBox[{"Protect", "[", "ds", "]"}], ";", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Print", "]"}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{"Style", "[", 
          RowBox[{
           RowBox[{"\"\<History length for \>\"", "<>", 
            RowBox[{"SymbolName", "[", "ds", "]"}], "<>", "\"\< is \>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "<>", 
            "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}]}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"HistoryAppend", "::", "chop"}], ",", "ds"}], "]"}]}], "]"}]}],
   ";"}]], "Code",
 CellChangeTimes->{{3.719597974639216*^9, 3.719598096215912*^9}, {
   3.719599239286027*^9, 3.7195993024611073`*^9}, {3.7195997582763863`*^9, 
   3.719599763628571*^9}, {3.719619626377492*^9, 3.719619639849568*^9}, {
   3.71962487860917*^9, 3.719624922088863*^9}, {3.720137848299488*^9, 
   3.720137848939308*^9}, {3.7201421469631844`*^9, 3.720142190599379*^9}, 
   3.720142225107325*^9, {3.720150272576716*^9, 3.7201502824753237`*^9}, 
   3.721354400409285*^9, {3.7226543962382727`*^9, 3.72265453666673*^9}, {
   3.768291758625513*^9, 3.7682917751736317`*^9}},
 ExpressionUUID -> "5e99a1bc-d36f-49f0-ac3b-6675da08b0f3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryAddExtra", "::", "usage"}], "=", 
   "\"\<HistoryAddExtra[ds_Symbol,extra1\[Rule]\[Ellipsis],\[Ellipsis]] adds \
some optional information to the current history event.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719598140798427*^9, 3.7195981935482817`*^9}, {
  3.721381325361005*^9, 3.72138132629139*^9}},
 ExpressionUUID -> "9de68246-3bbe-48fb-911d-d4add39569e3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "HistoryAddExtra", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Print", "\[Rule]", "True"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.768291794900982*^9, 3.768291797040682*^9}},
 ExpressionUUID -> "01fd8c76-8cf3-4561-a503-eec945c82697"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryAddExtra", "[", 
   RowBox[{
    RowBox[{"ds_Symbol", "?", "DSystemQ"}], ",", "rules__Rule", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
    RowBox[{
     RowBox[{"History", "[", "ds", "]"}], "^=", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], ",", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], "\[Rule]", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"History", "[", "ds", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"Alternatives", "@@", 
              RowBox[{"First", "/@", 
               RowBox[{"{", "rules", "}"}]}]}], "\[Rule]", "_"}]}], "]"}], 
          ",", 
          RowBox[{"{", "rules", "}"}]}], "]"}]}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"OptionValue", "[", "Print", "]"}], ",", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{
         RowBox[{"\"\<Added extra(s) \>\"", "<>", 
          RowBox[{"StringRiffle", "[", 
           RowBox[{
            RowBox[{"ToString", "/@", 
             RowBox[{"First", "/@", 
              RowBox[{"{", "rules", "}"}]}]}], ",", "\"\<,\>\""}], "]"}], 
          "<>", "\"\< to current history entry.\>\""}], ",", "Small"}], "]"}],
        "]"}]}], "]"}], ";"}], ")"}]}]], "Code",
 CellChangeTimes->{{3.719598107692502*^9, 3.719598125258328*^9}, {
   3.7195982039758997`*^9, 3.719598235488505*^9}, {3.71959833069168*^9, 
   3.719598430216449*^9}, {3.7196662767930737`*^9, 3.719666305759068*^9}, {
   3.719699706075268*^9, 3.719699731115158*^9}, 3.71969981596187*^9, 
   3.719699879148592*^9, {3.719730859966421*^9, 3.719730959957045*^9}, {
   3.719731016694643*^9, 3.7197310293843718`*^9}, {3.7197310708873653`*^9, 
   3.7197311040710087`*^9}, {3.720142176701212*^9, 3.720142218803358*^9}, 
   3.7213544019604893`*^9, 3.721381327049756*^9, {3.7682918027724752`*^9, 
   3.768291841029812*^9}, {3.768291916835044*^9, 3.768291923444607*^9}},
 ExpressionUUID -> "84c8ab28-6543-41f4-bad0-17bc10c4f305"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryDeleteExtra", "::", "usage"}], "=", 
   "\"\<HistoryDeleteExtra[ds_Symbol,extra1,\[Ellipsis]] removes optional \
information from the current history event.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721381398296479*^9, 3.721381417435027*^9}, {
  3.721385636912373*^9, 3.721385645176796*^9}},
 ExpressionUUID -> "801ae495-3908-4ddf-aa2f-b186da5e8444"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "HistoryDeleteExtra", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Print", "\[Rule]", "True"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{3.7682918606110897`*^9},
 ExpressionUUID -> "ead28514-f3b5-4131-8243-bdd0f3a39ba6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryDeleteExtra", "[", 
   RowBox[{
    RowBox[{"ds_Symbol", "?", "DSystemQ"}], ",", "extras___", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
    RowBox[{
     RowBox[{"History", "[", "ds", "]"}], "^=", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], ",", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], "\[Rule]", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"History", "[", "ds", "]"}], "[", 
           RowBox[{"[", 
            RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"Alternatives", "@@", "extras"}], "\[Rule]", "_"}]}], 
         "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"OptionValue", "[", "Print", "]"}], ",", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{
         RowBox[{"\"\<Deleted extra(s) \>\"", "<>", 
          RowBox[{"StringRiffle", "[", 
           RowBox[{
            RowBox[{"ToString", "/@", "extras"}], ",", "\"\<,\>\""}], "]"}], 
          "<>", "\"\< from current history entry.\>\""}], ",", "Small"}], 
        "]"}], "]"}]}], "]"}]}], ")"}]}]], "Code",
 CellChangeTimes->{{3.7213814372205257`*^9, 3.721381486995615*^9}, 
   3.722664969572916*^9, {3.768190012820107*^9, 3.768190018948037*^9}, {
   3.768291831381316*^9, 3.768291851714432*^9}},
 ExpressionUUID -> "50e5bfac-4c98-4934-aab8-c32be2cdb7e0"]
}, Closed]],

Cell[CellGroupData[{

Cell["Undo, Redo,HistoryChop", "Subsubsection",
 CellChangeTimes->{{3.71962498999254*^9, 3.719625022352832*^9}, {
  3.722653719565228*^9, 3.722653719760894*^9}},
 ExpressionUUID -> "93011f4a-9dce-4cbc-a7df-bf652bd1b4e9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Undo", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", 
     RowBox[{"n_Integer:", "1"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"HistoryIndex", "[", "ds", "]"}], ">", "n"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{
         RowBox[{"\"\<History length for \>\"", "<>", 
          RowBox[{"SymbolName", "[", "ds", "]"}], "<>", "\"\< is \>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{
            RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
            RowBox[{
             RowBox[{"HistoryIndex", "[", "ds", "]"}], "-", "n"}]}], "]"}], 
          "<>", "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}]}],
      ",", 
     RowBox[{"Message", "[", 
      RowBox[{"History", "::", "first"}], "]"}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.719596607734528*^9, 3.7195966123448*^9}, {
   3.719596751136837*^9, 3.719596901625928*^9}, {3.719599833923675*^9, 
   3.719599942378243*^9}, 3.719600006847765*^9, {3.719600063164566*^9, 
   3.7196000897520857`*^9}, {3.7196566307837887`*^9, 
   3.7196566949714317`*^9}, {3.720150820146731*^9, 3.720150867302041*^9}, {
   3.7214573302328253`*^9, 3.7214573381271544`*^9}, 3.7214574692105103`*^9, {
   3.7214576304319363`*^9, 3.7214576329840593`*^9}, {3.721542703672428*^9, 
   3.721542705989113*^9}, {3.721542828511777*^9, 3.72154283128865*^9}, {
   3.7686431149867077`*^9, 3.768643124718113*^9}},
 ExpressionUUID -> "f7e830a8-ba27-4f7c-af47-c9dcbf001cef"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Undo", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "All"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
    RowBox[{"Print", "[", 
     RowBox[{"Style", "[", 
      RowBox[{
       RowBox[{"\"\<History length for \>\"", "<>", 
        RowBox[{"SymbolName", "[", "ds", "]"}], "<>", "\"\< is \>\"", "<>", 
        RowBox[{"ToString", "[", 
         RowBox[{
          RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", "1"}], "]"}], "<>", 
        "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{"Protect", "[", "ds", "]"}], ";", 
    RowBox[{
     RowBox[{"History", "[", "ds", "]"}], "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}]}], 
   ")"}]}]], "Code",
 CellChangeTimes->{{3.7214573452306957`*^9, 3.7214573501273947`*^9}, {
   3.721457390879311*^9, 3.7214574316630993`*^9}, 3.7214576365312366`*^9, 
   3.768643100186029*^9},
 ExpressionUUID -> "cfe8389c-d3a2-47ce-8524-74df34c9451d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Redo", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", 
     RowBox[{"n_Integer:", "1"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"HistoryIndex", "[", "ds", "]"}], "\[LessEqual]", 
      RowBox[{
       RowBox[{"Length", "@", 
        RowBox[{"History", "[", "ds", "]"}]}], "-", "n"}]}], ",", 
     RowBox[{
      RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
      RowBox[{"Print", "[", 
       RowBox[{"Style", "[", 
        RowBox[{
         RowBox[{"\"\<History length for \>\"", "<>", 
          RowBox[{"SymbolName", "[", "ds", "]"}], "<>", "\"\< is \>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{
            RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
            RowBox[{
             RowBox[{"HistoryIndex", "[", "ds", "]"}], "+", "n"}]}], "]"}], 
          "<>", "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}], ";", 
      RowBox[{"Protect", "[", "ds", "]"}], ";", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}]}],
      ",", 
     RowBox[{"Message", "[", 
      RowBox[{"History", "::", "last"}], "]"}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.719596607734528*^9, 3.7195966123448*^9}, {
   3.719596751136837*^9, 3.719596901625928*^9}, {3.719599833923675*^9, 
   3.719599942378243*^9}, 3.719600006847765*^9, {3.719600063164566*^9, 
   3.7196000897520857`*^9}, {3.7196566307837887`*^9, 
   3.7196566949714317`*^9}, {3.720150820146731*^9, 3.720150867302041*^9}, {
   3.7214573302328253`*^9, 3.7214573381271544`*^9}, {3.72145745758414*^9, 
   3.7214574649035387`*^9}, 3.721457638352008*^9, 3.7215428253607883`*^9, 
   3.768643091376213*^9},
 ExpressionUUID -> "480db062-04bd-4d71-830a-1130717b1e66"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Redo", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "All"}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
     RowBox[{"Print", "[", 
      RowBox[{"Style", "[", 
       RowBox[{
        RowBox[{"\"\<History length for \>\"", "<>", 
         RowBox[{"SymbolName", "[", "ds", "]"}], "<>", "\"\< is \>\"", "<>", 
         RowBox[{"ToString", "[", 
          RowBox[{
           RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
           RowBox[{"Length", "@", 
            RowBox[{"History", "[", "ds", "]"}]}]}], "]"}], "<>", 
         "\"\<.\>\""}], ",", "Small"}], "]"}], "]"}], ";", 
     RowBox[{"Protect", "[", "ds", "]"}], ";", 
     RowBox[{
      RowBox[{"History", "[", "ds", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}]}], 
    ")"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.7214573452306957`*^9, 3.7214573501273947`*^9}, {
   3.721457390879311*^9, 3.7214574316630993`*^9}, {3.72145747525998*^9, 
   3.7214575156983213`*^9}, 3.7214576399356318`*^9, {3.721542710614259*^9, 
   3.721542713935669*^9}, {3.721542792929023*^9, 3.7215428182320547`*^9}, 
   3.768643133701695*^9},
 ExpressionUUID -> "e1f4ed1c-d030-41ee-85a2-429eea3e2218"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryChop", "::", "usage"}], "=", 
   "\"\<HistoryChop[ds_] chops off forward entries in history. Use before \
applying HistoryConsolidate.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7226538151025257`*^9, 3.7226538933260307`*^9}},
 ExpressionUUID -> "21a09479-8baa-4181-91cd-13a218370d3f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryChop", "[", 
   RowBox[{"ds_", "?", "DSystemQ"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
    RowBox[{
     RowBox[{"History", "[", "ds", "]"}], "^=", 
     RowBox[{"Take", "[", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], ",", 
       RowBox[{"HistoryIndex", "[", "ds", "]"}]}], "]"}]}], ";", 
    RowBox[{"Protect", "[", "ds", "]"}], ";", 
    RowBox[{"HistoryIndex", "[", "ds", "]"}]}], ")"}]}]], "Code",
 CellChangeTimes->{{3.722653687653651*^9, 3.722653796217017*^9}},
 ExpressionUUID -> "ba083e14-a015-4035-abe4-8855b0e73c66"]
}, Open  ]],

Cell[CellGroupData[{

Cell["HistoryConsolidate", "Subsubsection",
 CellChangeTimes->{{3.721456971187381*^9, 3.721456983629878*^9}},
 ExpressionUUID -> "1010e9bf-4bdb-4138-b873-73728c7e5d13"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryConsolidate", "::", "usage"}], "=", 
   "\"\<HistoryConsolidate[ds] consolidates history\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7214571852793694`*^9, 3.721457216030945*^9}, {
  3.72145752660787*^9, 3.721457532615746*^9}, {3.7214576031519957`*^9, 
  3.72145760811141*^9}, {3.723160339048361*^9, 3.723160339183856*^9}},
 ExpressionUUID -> "98f5b6f9-23d9-42a9-95ce-4ac1f14a5d3e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"HistoryConsolidate", "::", "err"}], "=", 
   "\"\<Undo history entry is met.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HistoryConsolidate", "::", "chop"}], "=", 
  "\"\<Did not change history to avoid overwriting forward entries. Use \
HistoryChop[`1`] first.\>\""}]}], "Code",
 CellChangeTimes->{{3.72265357343967*^9, 3.72265360323105*^9}, {
  3.722654192845683*^9, 3.7226542671016417`*^9}},
 ExpressionUUID -> "781b7851-740c-4c73-b5d5-e32deeaabc12"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "HistoryConsolidate", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"HistoryChop", "\[Rule]", "False"}], ",", 
     RowBox[{"HistoryAppend", "\[Rule]", "False"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Inverse", "\[Rule]", "False"}]}], 
    RowBox[{"(*", 
     RowBox[{
     "whether", " ", "to", " ", "calculate", " ", "inverse", " ", 
      "transformation", " ", "matrix"}], "*)"}], "\[IndentingNewLine]", 
    "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.722653951613639*^9, 3.722653995670396*^9}, {
  3.727484968839073*^9, 3.727484972135507*^9}, {3.7274850145518217`*^9, 
  3.7274850377206984`*^9}, {3.7681903762366962`*^9, 3.768190396168529*^9}, {
  3.76853047651855*^9, 3.768530476968727*^9}, {3.768607121248598*^9, 
  3.7686071389577827`*^9}, {3.770965047997058*^9, 3.770965051691135*^9}},
 ExpressionUUID -> "dce8907e-35ca-40eb-ac0d-88a9da9273c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryConsolidate", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "ds"}], "]"}]}], ",", 
      RowBox[{"Ti", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "ds"}], "]"}]}], ",", "i", ",", "ii", ",", "t",
       ",", "start", ",", "end", ",", "val", ",", "old", ",", "new", ",", 
      "subs", ",", 
      RowBox[{"inv", "=", 
       RowBox[{"OptionValue", "[", "Inverse", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"First", ",", " ", 
      RowBox[{"calculate", " ", 
       RowBox[{"transformation", ".", " ", "We"}], " ", "move", " ", "in", 
       " ", "history", " ", "up", " ", "to", " ", "the", " ", "first", " ", 
       RowBox[{"Undo", "[", 
        RowBox[{"ds", ",", "All"}], "]"}], " ", "or", " ", "first", " ", 
       "entry"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"starting", " ", 
      RowBox[{"index", ":", " ", 
       RowBox[{
       "either", " ", "1", " ", "or", " ", "index", " ", "of", " ", "first", 
        " ", "full", " ", "undo"}]}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"start", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"History", "[", "ds", "]"}], ",", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Undo", ",", "ds", ",", "_"}], "}"}], "|", 
            RowBox[{"{", 
             RowBox[{"NewDSystem", ",", "ds", ",", "__"}], "}"}]}], ",", 
           "___"}], "}"}], ",", 
         RowBox[{"{", "1", "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"val", "=", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"start", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"old", "=", 
      RowBox[{"new", "=", 
       RowBox[{"subs", "=", 
        RowBox[{"Keys", "[", "val", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"end", "=", 
      RowBox[{"HistoryIndex", "[", "ds", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"CWrite", "[", 
      RowBox[{"\"\<\\n[\>\"", "<>", 
       RowBox[{"ToString", "[", 
        RowBox[{"end", "-", "start"}], "]"}], "<>", "\"\<|\>\""}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"FCMonitor", "[", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"CWrite", "[", "\"\<.\>\"", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Replace", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"History", "[", "ds", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Transform", ",", "ds", ",", 
                 RowBox[{"tt_", "?", "SquareMatrixQ"}]}], "}"}], 
               "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"T", "=", 
                  RowBox[{"ODot", "[", 
                   RowBox[{"T", ",", "tt"}], "]"}]}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{"inv", ",", 
                   RowBox[{"Ti", "=", 
                    RowBox[{"ODot", "[", 
                    RowBox[{
                    RowBox[{"OInverse", "[", "tt", "]"}], ",", "Ti"}], 
                    "]"}]}]}], "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Transform", ",", "ds", ",", 
                 RowBox[{"tt_", "?", "SquareMatrixQ"}], ",", "ii_"}], "}"}], 
               "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{"(*", 
                 RowBox[{"Modified", " ", "14.05", ".2019"}], "*)"}], 
                RowBox[{"(*", 
                 RowBox[{"(*", 
                  RowBox[{"Deleted", " ", "14.05", ".2019"}], "*)"}], 
                 RowBox[{
                  RowBox[{"t", "=", 
                   RowBox[{"IdentityMatrix", "[", 
                    RowBox[{"Length", "@", "ds"}], "]"}]}], ";", 
                  RowBox[{
                   RowBox[{"t", "[", 
                    RowBox[{"[", 
                    RowBox[{"ii", ",", "ii"}], "]"}], "]"}], "=", "tt"}], ";", 
                  RowBox[{"T", "=", 
                   RowBox[{"ODot", "[", 
                    RowBox[{"T", ",", "t"}], "]"}]}], ";", 
                  RowBox[{"If", "[", 
                   RowBox[{"inv", ",", 
                    RowBox[{"Ti", "=", 
                    RowBox[{"ODot", "[", 
                    RowBox[{
                    RowBox[{"OInverse", "[", "t", "]"}], ",", "Ti"}], 
                    "]"}]}]}], "]"}]}], 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"/", "Deleted"}], " ", "14.05", ".2019"}], "*)"}], 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{"Added", " ", "14.05", ".2019"}], "*)"}], 
                RowBox[{
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "ii"}], "]"}], "]"}], "=", 
                  RowBox[{"ODot", "[", 
                   RowBox[{
                    RowBox[{"T", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "ii"}], "]"}], "]"}], ",", "tt"}], 
                   "]"}]}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{"inv", ",", 
                   RowBox[{
                    RowBox[{"Ti", "[", 
                    RowBox[{"[", "ii", "]"}], "]"}], "=", 
                    RowBox[{"ODot", "[", 
                    RowBox[{
                    RowBox[{"OInverse", "[", "tt", "]"}], ",", 
                    RowBox[{"Ti", "[", 
                    RowBox[{"[", "ii", "]"}], "]"}]}], "]"}]}]}], "]"}]}], 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"/", "Added"}], " ", "14.05", ".2019"}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"/", "Modified"}], " ", "14.05", ".2019"}], "*)"}], 
                ")"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Transform", ",", "ds", ",", 
                 RowBox[{"tt", ":", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"_", "?", "SquareMatrixQ"}], ",", 
                    RowBox[{"_", "?", "SquareMatrixQ"}]}], "}"}]}]}], "}"}], 
               "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"T", "=", 
                  RowBox[{"ODot", "[", 
                   RowBox[{"T", ",", 
                    RowBox[{"tt", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{"inv", ",", 
                   RowBox[{"Ti", "=", 
                    RowBox[{"ODot", "[", 
                    RowBox[{
                    RowBox[{"tt", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "Ti"}], "]"}]}]}], 
                  "]"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Transform", ",", "ds", ",", 
                 RowBox[{"tt", ":", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"_", "?", "SquareMatrixQ"}], ",", 
                    RowBox[{"_", "?", "SquareMatrixQ"}]}], "}"}]}], ",", 
                 "ii_"}], "}"}], "\[RuleDelayed]", 
               RowBox[{"(", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{"Modified", " ", "14.05", ".2019"}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"T", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "ii"}], "]"}], "]"}], "=", 
                  RowBox[{"ODot", "[", 
                   RowBox[{
                    RowBox[{"T", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "ii"}], "]"}], "]"}], ",", 
                    RowBox[{"tt", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{"inv", ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"Ti", "[", 
                    RowBox[{"[", "ii", "]"}], "]"}], "=", 
                    RowBox[{"ODot", "[", 
                    RowBox[{
                    RowBox[{"tt", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"Ti", "[", 
                    RowBox[{"[", "ii", "]"}], "]"}]}], "]"}]}]}], "]"}]}], 
                "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"/", "Modified"}], " ", "14.05", ".2019"}], "*)"}], 
                ")"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "ChangeVar", ",", "ds", ",", "tt_", ",", "nw_", ",", "___"}], 
                "}"}], "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"T", "=", 
                  RowBox[{"Factor", "[", 
                   RowBox[{"T", "/.", "tt"}], "]"}]}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{"inv", ",", 
                   RowBox[{"Ti", "=", 
                    RowBox[{"Factor", "[", 
                    RowBox[{"Ti", "/.", "tt"}], "]"}]}]}], "]"}], ";", 
                 RowBox[{"subs", "=", 
                  RowBox[{"Factor", "[", 
                   RowBox[{"subs", "/.", "tt"}], "]"}]}], ";", 
                 RowBox[{"new", "=", "nw"}]}], ")"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Factor", ",", "ds"}], "}"}], "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"T", "=", 
                  RowBox[{"Factor", "[", "T", "]"}]}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{"inv", ",", 
                   RowBox[{"Ti", "=", 
                    RowBox[{"Factor", "[", "Ti", "]"}]}]}], "]"}]}], ")"}]}], 
              ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Simplify", ",", "ds", ",", "tt___"}], "}"}], 
               "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"T", "=", 
                  RowBox[{"Simplify", "[", 
                   RowBox[{"T", ",", "tt"}], "]"}]}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{"inv", ",", 
                   RowBox[{"Ti", "=", 
                    RowBox[{"Simplify", "[", 
                    RowBox[{"Ti", ",", "tt"}], "]"}]}]}], "]"}], ";", 
                 RowBox[{"subs", "=", 
                  RowBox[{"Simplify", "[", 
                   RowBox[{"subs", ",", "tt"}], "]"}]}]}], ")"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Map", ",", "f_", ",", "ds", ",", "tt___"}], "}"}], 
               "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"T", "=", 
                  RowBox[{"Map", "[", 
                   RowBox[{"f", ",", "T", ",", "tt"}], "]"}]}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{"inv", ",", 
                   RowBox[{"Ti", "=", 
                    RowBox[{"Map", "[", 
                    RowBox[{"f", ",", "Ti", ",", "tt"}], "]"}]}]}], "]"}], 
                 ";"}], ")"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"MapAt", ",", "f_", ",", "ds", ",", "tt___"}], "}"}], 
               "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"T", "=", 
                  RowBox[{"MapAt", "[", 
                   RowBox[{"f", ",", "T", ",", "tt"}], "]"}]}], ";", 
                 RowBox[{"If", "[", 
                  RowBox[{"inv", ",", 
                   RowBox[{"Ti", "=", 
                    RowBox[{"MapAt", "[", 
                    RowBox[{"f", ",", "Ti", ",", "tt"}], "]"}]}]}], "]"}]}], 
                ")"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Undo", ",", "__"}], "}"}], "\[RuleDelayed]", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Message", "[", 
                  RowBox[{"HistoryConsolidate", "::", "err"}], "]"}], ";", 
                 RowBox[{"Abort", "[", "]"}]}], ")"}]}]}], 
             "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"start", "+", "1"}], ",", "end"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Overlay", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"start", ",", "end"}], "}"}]}], "]"}], ",", 
           RowBox[{
            RowBox[{"ToString", "[", 
             RowBox[{"i", "-", "start"}], "]"}], "<>", "\"\</\>\"", "<>", 
            RowBox[{"ToString", "[", 
             RowBox[{"end", "-", "start"}], "]"}]}]}], "}"}], ",", 
         RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"CWrite", "[", "\"\<]\>\"", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"TrueQ", "@", 
        RowBox[{"OptionValue", "[", "HistoryAppend", "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"TrueQ", "@", 
           RowBox[{"OptionValue", "[", "HistoryChop", "]"}]}], "||", 
          RowBox[{
           RowBox[{"Length", "@", 
            RowBox[{"History", "[", "ds", "]"}]}], "\[LessEqual]", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}]}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"HistoryAppend", "[", 
           RowBox[{"ds", ",", 
            RowBox[{"{", 
             RowBox[{"val", ",", 
              RowBox[{"{", 
               RowBox[{"Undo", ",", "ds", ",", 
                RowBox[{"end", "-", "start"}]}], "}"}]}], "}"}]}], "]"}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"ChangeVar", "[", 
           RowBox[{"ds", ",", 
            RowBox[{"Thread", "[", 
             RowBox[{"old", "\[Rule]", "subs"}], "]"}], ",", "new"}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"inv", ",", "\[IndentingNewLine]", 
            RowBox[{"Transform", "[", 
             RowBox[{"ds", ",", 
              RowBox[{"{", 
               RowBox[{"T", ",", "Ti"}], "}"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Transform", "[", 
             RowBox[{"ds", ",", "T"}], "]"}]}], "\[IndentingNewLine]", 
           "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"HistoryConsolidate", "::", "chop"}], ",", "ds"}], "]"}]}],
         "\[IndentingNewLine]", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "T"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.721368137908499*^9, 3.721368161678334*^9}, 
   3.721436409387233*^9, {3.721457616105809*^9, 3.721457682679695*^9}, {
   3.7214578707521057`*^9, 3.721458414338336*^9}, {3.721458445905623*^9, 
   3.721458447481927*^9}, {3.721458509394725*^9, 3.721458641987094*^9}, {
   3.721458682978167*^9, 3.721458800858676*^9}, {3.7214588368269167`*^9, 
   3.721458871354396*^9}, {3.7214589093789053`*^9, 3.7214590199714823`*^9}, {
   3.7214590657229433`*^9, 3.721459117863152*^9}, {3.721459148067765*^9, 
   3.721459171723463*^9}, 3.721459326676236*^9, {3.721482672765971*^9, 
   3.7214826732402067`*^9}, {3.7217256200087957`*^9, 3.721725630621688*^9}, {
   3.72172567385791*^9, 3.7217257121238403`*^9}, {3.722653479202548*^9, 
   3.722653566129753*^9}, {3.722653918488049*^9, 3.722653945400576*^9}, {
   3.722654013887039*^9, 3.7226541056926517`*^9}, {3.722654140455698*^9, 
   3.722654211552306*^9}, {3.722654274967917*^9, 3.722654276674596*^9}, {
   3.722654866527734*^9, 3.722655003968033*^9}, {3.722655119416403*^9, 
   3.7226551228081636`*^9}, 3.7226551652317743`*^9, {3.722655522034258*^9, 
   3.722655523380074*^9}, {3.7226556904265842`*^9, 3.722655698949789*^9}, {
   3.722655966363982*^9, 3.722655976460588*^9}, {3.722656042282106*^9, 
   3.722656093852879*^9}, {3.7226640790988894`*^9, 3.722664085586831*^9}, 
   3.722753615121805*^9, {3.7229278108063793`*^9, 3.722927881174464*^9}, {
   3.722928008350833*^9, 3.722928008543133*^9}, {3.723158815059164*^9, 
   3.72315890778859*^9}, {3.723159598481081*^9, 3.723159608337343*^9}, {
   3.723159682569602*^9, 3.723159733617086*^9}, {3.723160109363722*^9, 
   3.723160112427266*^9}, {3.723160144155411*^9, 3.723160146162744*^9}, {
   3.723160234187562*^9, 3.723160239439637*^9}, {3.7231605876156473`*^9, 
   3.7231606395816317`*^9}, {3.723160678588085*^9, 3.723160683859207*^9}, {
   3.723160734668433*^9, 3.723160734799479*^9}, {3.7274839008116293`*^9, 
   3.7274840549041357`*^9}, {3.7274842286321497`*^9, 3.727484234657455*^9}, {
   3.727484938634904*^9, 3.727485008892288*^9}, {3.7274850705487757`*^9, 
   3.72748526083165*^9}, {3.727485302090248*^9, 3.727485340701179*^9}, {
   3.727485395155798*^9, 3.727485500463135*^9}, {3.727485541500121*^9, 
   3.727485563852828*^9}, {3.7277430226903687`*^9, 3.727743026051694*^9}, {
   3.727743085152769*^9, 3.727743140351807*^9}, {3.727743184671427*^9, 
   3.727743187159288*^9}, {3.727743292503014*^9, 3.727743294849305*^9}, 
   3.727745051920627*^9, {3.727745196237031*^9, 3.727745196241579*^9}, {
   3.727745226894014*^9, 3.727745254662074*^9}, {3.7277457294972067`*^9, 
   3.727745729518433*^9}, {3.727794658550102*^9, 3.727794684064288*^9}, {
   3.749260970823011*^9, 3.7492609738311443`*^9}, {3.7492610213525267`*^9, 
   3.7492610843522787`*^9}, {3.7492611162477293`*^9, 
   3.7492611354719353`*^9}, {3.7492611953446083`*^9, 
   3.7492611986237917`*^9}, {3.749275292214473*^9, 3.7492753012871933`*^9}, {
   3.766801757898243*^9, 3.766802017124852*^9}, 3.766802290157954*^9, {
   3.768530498517118*^9, 3.768530583974124*^9}, {3.7685306183577347`*^9, 
   3.768530638414094*^9}, {3.768530707741714*^9, 3.768530710246324*^9}, {
   3.768607199914996*^9, 3.76860723401814*^9}, {3.768692387387351*^9, 
   3.768692387558488*^9}, {3.768692423305472*^9, 3.768692702748294*^9}, 
   3.768693046792926*^9, {3.76869394009348*^9, 3.768693941767404*^9}, {
   3.770095784365582*^9, 3.7700957845240707`*^9}, {3.770164163878785*^9, 
   3.770164197861959*^9}},
 ExpressionUUID -> "bbf2d34b-d045-40ea-8a16-80427e10ba6e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", 
   "\"\<HistoryConsolidate: make the procedure more flexible to allow for \
replacing parts of the history, both idex- and labels-based. (labels probably \
via HistoryAddExtra)\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.769572621273714*^9, 3.7695727567729387`*^9}},
 ExpressionUUID -> "727a9569-efcf-45e3-b76c-46e0939e89f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", "\"\<Think about better strategy of option UseFermat\>\"", 
   "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.769583277774329*^9, 3.769583306873714*^9}},
 ExpressionUUID -> "b91791f5-3cb5-4e12-881a-dd386001ef14"]
}, Open  ]],

Cell[CellGroupData[{

Cell["HistoryCheck", "Subsubsection",
 CellChangeTimes->{
  3.7226531526263227`*^9, {3.722653341327401*^9, 3.7226533421069*^9}},
 ExpressionUUID -> "b582c5de-ea0c-47d9-b6f2-d4548727cbe5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryCheck", "::", "usage"}], "=", 
   "\"\<HistoryCheck[ds_] checks history consistency. It simply redoes all \
transformations and checks whether the same result is obtained.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7226531670464*^9, 3.7226532609539413`*^9}, {
  3.7226533462877197`*^9, 3.722653346992751*^9}},
 ExpressionUUID -> "e71afde6-574b-4416-ac50-eafbefdde5b7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"HistoryCheck", "::", "inconsistent"}], "=", 
   "\"\<History[`1`] is inconsistent at index `2`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"HistoryCheck", "[", "des_", "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", ",", "i", ",", 
      RowBox[{"hi", "=", 
       RowBox[{"HistoryIndex", "[", "des", "]"}]}], ",", "mn", ",", 
      "action"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"CWrite", "[", 
      RowBox[{"\"\<\\n[\>\"", "<>", 
       RowBox[{"ToString", "[", "hi", "]"}], "<>", "\"\<|\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"FCMonitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"CWrite", "[", "\"\<.\>\"", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"mn", "=", 
           RowBox[{
            RowBox[{"History", "[", "des", "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"action", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"History", "[", "des", "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "2"}], "]"}], "]"}], "/.", 
            RowBox[{"des", "\[Rule]", "m"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"#1", "[", "##2", "]"}], "&"}], "@@", "action"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", "m", "]"}], ";", 
            RowBox[{"Print", "[", "mn", "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"TrueQ", "@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Union", "[", 
                  RowBox[{"Keys", "[", "mn", "]"}], "]"}], "===", 
                 RowBox[{"Union", "[", 
                  RowBox[{"Keys", "[", 
                   RowBox[{"m", "[", "]"}], "]"}], "]"}]}], "&&", 
                RowBox[{"(", 
                 RowBox[{"And", "@@", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"MatchQ", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{
                    RowBox[{"mn", "[", "#", "]"}], "-", 
                    RowBox[{"m", "[", "#", "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", "..."}], "}"}], "..."}], "}"}]}], "]"}], 
                    "&"}], "/@", 
                    RowBox[{"Keys", "[", "mn", "]"}]}], ")"}]}], ")"}]}], 
               ")"}]}]}], ",", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{
               RowBox[{"HistoryCheck", "::", "inconsistent"}], ",", "des", 
               ",", "i"}], "]"}], ";", 
             RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "hi"}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Overlay", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "hi"}], "}"}]}], "]"}], ",", "i"}], "}"}], 
         ",", 
         RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"CWrite", "[", "\"\<]\>\"", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "\"\<History is consistent!\>\"", "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.722645585868342*^9, 3.7226456814667664`*^9}, {
  3.722645733842559*^9, 3.722645957114786*^9}, {3.722646020859342*^9, 
  3.7226462943190737`*^9}, {3.722646518532654*^9, 3.722646525108231*^9}, {
  3.7226467478768578`*^9, 3.7226467602448187`*^9}, {3.72264701372639*^9, 
  3.7226471424442377`*^9}, {3.722647229928184*^9, 3.722647230248801*^9}, {
  3.7226533490769053`*^9, 3.7226533839707117`*^9}, {3.768692737360444*^9, 
  3.768692737560144*^9}, {3.7686927786560383`*^9, 3.768692847184854*^9}, {
  3.7686930392895927`*^9, 3.768693063753539*^9}, {3.768693929336989*^9, 
  3.768693931322084*^9}, {3.770095788128593*^9, 3.770095788266366*^9}, {
  3.770164212972755*^9, 3.770164236670658*^9}},
 ExpressionUUID -> "0913090a-d7db-428b-96b2-ab921fc1c1ab"]
}, Closed]],

Cell[CellGroupData[{

Cell["HistoryBurn", "Subsubsection",
 CellChangeTimes->{{3.721456971187381*^9, 3.721456983629878*^9}, {
  3.721457229470092*^9, 3.721457230966455*^9}, {3.7214594411533957`*^9, 
  3.7214594417214108`*^9}},
 ExpressionUUID -> "ab1d6766-8d0f-448a-bd61-145259b22e27"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HistoryBurn", "::", "err"}], "=", "\"\<Can not burn!\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7214596755977497`*^9, 3.7214596841064177`*^9}},
 ExpressionUUID -> "76be0056-e152-4816-99b2-622c2d9b5cbf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryBurn", "::", "usage"}], "=", 
  "\"\<HistoryBurn[ds] \>\""}]], "Code",
 CellChangeTimes->{{3.7632996912515574`*^9, 3.763299700189611*^9}},
 ExpressionUUID -> "3f95b6c5-cffa-40c9-9a79-9eae1d6a2a29"],

Cell[BoxData[
 RowBox[{
  RowBox[{"HistoryBurn", "[", 
   RowBox[{"ds_", "?", "DSystemQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "ds"}], "]"}]}], ",", "i", ",", "t", ",", 
      "start", ",", "end", ",", "val"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"First", ",", " ", 
      RowBox[{"calculate", " ", 
       RowBox[{"transformation", ".", " ", "We"}], " ", "move", " ", "in", 
       " ", "history", " ", "up", " ", "to", " ", "the", " ", "first", " ", 
       RowBox[{"Undo", "[", 
        RowBox[{"ds", ",", "All"}], "]"}], " ", "or", " ", "first", " ", 
       "entry"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"starting", " ", 
      RowBox[{"index", ":", " ", 
       RowBox[{
       "either", " ", "1", " ", "or", " ", "index", " ", "of", " ", "first", 
        " ", "full", " ", "undo"}]}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"start", "=", 
      RowBox[{
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Undo", ",", "ds", ",", "_"}], "}"}], "|", 
            RowBox[{"{", 
             RowBox[{"NewDSystem", ",", "ds", ",", "__"}], "}"}]}], ",", 
           "___"}], "}"}], ",", 
         RowBox[{"{", "1", "}"}]}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"val", "=", 
      RowBox[{
       RowBox[{"History", "[", "ds", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"start", ",", "1"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"end", "=", 
      RowBox[{"HistoryIndex", "[", "ds", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"val", "=!=", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"HistoryBurn", "::", "err"}], "]"}], ";", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Unprotect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"History", "[", "ds", "]"}], "^=", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"start", "+", "1"}], ";;", "end"}], "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", 
      RowBox[{"Length", "@", 
       RowBox[{"History", "[", "ds", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", "ds", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721456971187381*^9, 3.721456983629878*^9}, {
   3.721457229470092*^9, 3.721457230966455*^9}, {3.7214594411533957`*^9, 
   3.7214594593384647`*^9}, 3.721459529912527*^9, {3.7214596126923*^9, 
   3.7214598225806427`*^9}, {3.7214824765515633`*^9, 3.721482548253634*^9}, 
   3.727484506329937*^9},
 ExpressionUUID -> "793910f3-2fcf-4638-aaca-bd6b4e0b7aa8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"todo", "[", "\"\<rethink how HistoryBurn should work\>\"", "]"}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.727484603441204*^9, 3.727484631936883*^9}},
 ExpressionUUID -> "490b7971-5ac4-4d18-ab30-ad57235d7f56"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["DE system", "Subsection",
 CellChangeTimes->{
  3.7185784431616087`*^9, {3.719660172691893*^9, 3.719660174033565*^9}},
 ExpressionUUID -> "4297f7b5-e07f-4138-9086-c0de2fa4bcd7"],

Cell[CellGroupData[{

Cell["NewDSystem", "Subsubsection",
 CellChangeTimes->{{3.71966017905875*^9, 3.7196602055731897`*^9}, 
   3.719734539264958*^9, 3.7213546623135757`*^9},
 ExpressionUUID -> "007edf13-b11e-43a5-b639-07d7575d2e4f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NewDSystem", "::", "usage"}], "=", 
   "\"\<NewDSystem[ds,{x->Mx, y->My,\[Ellipsis]}] defines a new differential \
system associated with the variable ds.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NewDSystem", "::", "size"}], "=", 
   "\"\<Size of the systems mismatch.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NewDSystem", "::", "error"}], "=", 
   "\"\<Something went wrong. Aborting...\>\""}], ";"}]}], "Code",
 CellChangeTimes->{{3.718578444160791*^9, 3.7185785979371853`*^9}, {
  3.7185787264251337`*^9, 3.718578758227241*^9}, {3.718578913756291*^9, 
  3.718579130804022*^9}, {3.718579276127596*^9, 3.718579292233103*^9}, {
  3.71857965987282*^9, 3.718579680367364*^9}, {3.719583305545381*^9, 
  3.7195833252522383`*^9}, {3.721354663277278*^9, 3.721354665072289*^9}},
 ExpressionUUID -> "6b8752cb-dc94-486d-a2e8-7cc430f4c5ac"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "NewDSystem", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Print", "\[Rule]", "True"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.72264661039853*^9, 3.722646626150292*^9}},
 ExpressionUUID -> "468d324a-eb0b-429c-922b-4c8d61cd3251"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Notations", "::", "usage"}], "=", 
  "\"\<Notations[ds] is a list of notations used.\>\""}]], "Code",
 CellChangeTimes->{{3.72960837076641*^9, 3.729608447627256*^9}},
 ExpressionUUID -> "59cfef84-34cd-42d4-9824-640480ab89e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Notations", "[", 
    RowBox[{"ds_", "?", "DSystemQ"}], "]"}], ":=", 
   RowBox[{"Association", "[", "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.7296085552231283`*^9, 3.729608572410585*^9}},
 ExpressionUUID -> "99c96bba-5fa8-4cdb-9af1-51f5fe12814a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds_", ",", "def_Rule", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds", ",", 
    RowBox[{"{", "def", "}"}], ",", "opts"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds_Symbol", ",", "defs_Association", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds", ",", 
    RowBox[{"defs", "/.", 
     RowBox[{"Association", "\[Rule]", "List"}]}], ",", "opts"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NewDSystem", "[", 
   RowBox[{"ds_Symbol", ",", 
    RowBox[{"defs", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"_Symbol", "\[Rule]", 
         RowBox[{"_", "?", "SquareMatrixQ"}]}], ")"}], ".."}], "}"}]}], ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "l", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Quiet", "[", 
      RowBox[{
       RowBox[{"Unprotect", "[", "ds", "]"}], ";", 
       RowBox[{"Clear", "[", "ds", "]"}]}], "]"}], ";", 
     RowBox[{"(*", 
      RowBox[{
      "in", " ", "case", " ", "ds", " ", "was", " ", "defined", " ", 
       "earlier"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Check", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "^=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{
         RowBox[{"HistoryIndex", "[", "ds", "]"}], "^=", "0"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"DSystemQ", "[", "ds", "]"}], "^=", "True"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Notations", "[", "ds", "]"}], "^=", 
         RowBox[{"Association", "[", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "will", " ", "be", " ", "used", " ", "in", " ", "arguments", " ", 
          "patterns"}], "*)"}], 
        RowBox[{"l", "=", 
         RowBox[{"Length", "/@", 
          RowBox[{"Last", "/@", "defs"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"(", 
            RowBox[{"SameQ", "@@", "l"}], ")"}]}], ",", 
          RowBox[{"Message", "[", 
           RowBox[{"NewDSystem", "::", "size"}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Length", "[", "ds", "]"}], "^=", 
         RowBox[{"First", "@", "l"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"HistoryAppend", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Association", "[", "defs", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"NewDSystem", ",", "ds", ",", 
              RowBox[{"Association", "[", "defs", "]"}]}], "}"}]}], "}"}], 
          ",", 
          RowBox[{"Print", "\[Rule]", 
           RowBox[{"OptionValue", "[", "Print", "]"}]}]}], "]"}], ";"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"ToExpression", "[", 
           RowBox[{
           "#", "<>", "\"\<$M:=History[\>\"", "<>", "#", "<>", 
            "\"\<][[HistoryIndex[\>\"", "<>", "#", "<>", 
            "\"\<],1]];Protect[\>\"", "<>", "#", "<>", "\"\<$M]\>\""}], "]"}],
           "&"}], "[", 
         RowBox[{"SymbolName", "[", "ds", "]"}], "]"}], "*)"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"NewDSystem", "::", "error"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Unprotect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"redefineOperations", "[", "ds", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"TrueQ", "@", 
        RowBox[{"OptionValue", "[", "Print", "]"}]}], ",", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<Successfully created differential system for \>\"", "<>", 
          RowBox[{"ToString", "@", 
           RowBox[{"Length", "@", "ds"}]}], "<>", "\"\< functions of \>\"", "<>", 
          RowBox[{"StringRiffle", "[", 
           RowBox[{
            RowBox[{"ToString", "/@", 
             RowBox[{"First", "/@", "defs"}]}], ",", "\"\<,\>\""}], "]"}], 
          "<>", "\"\<.\>\""}], "]"}], ";"}]}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Next, you might want to find denominators appearing. See \!\(\*
StyleBox[\"?\",
FontWeight->\"Bold\"]\)\!\(\*
StyleBox[\"Denominators\",
FontWeight->\"Bold\"]\).\>\"", "]"}], ";"}], "*)"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ds", "::", "usage"}], "=", 
      RowBox[{"\"\<Differential system for \>\"", "<>", 
       RowBox[{"ToString", "@", 
        RowBox[{"Length", "@", "ds"}]}], "<>", "\"\< functions of \>\"", "<>", 
       RowBox[{"StringJoin", "@@", 
        RowBox[{"Riffle", "[", 
         RowBox[{
          RowBox[{"ToString", "/@", 
           RowBox[{"First", "/@", "defs"}]}], ",", "\"\<,\>\""}], "]"}]}], 
       "<>", "\"\<.\>\""}]}], ";"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.718579300815147*^9, 3.718579382666951*^9}, {
   3.718579445732171*^9, 3.718579510346806*^9}, {3.7185795713303967`*^9, 
   3.718579655667205*^9}, {3.718579686415147*^9, 3.718579741720283*^9}, {
   3.719583121415666*^9, 3.719583289192506*^9}, {3.7195833313334303`*^9, 
   3.719583436553649*^9}, {3.719595363137726*^9, 3.719595492915167*^9}, {
   3.719595585594792*^9, 3.719595587493594*^9}, 3.719595674915206*^9, {
   3.719597012387968*^9, 3.719597118861285*^9}, {3.719597174117198*^9, 
   3.719597231142548*^9}, {3.719597302570046*^9, 3.7195973228559637`*^9}, {
   3.719597381769662*^9, 3.7195974253902273`*^9}, {3.719597531444923*^9, 
   3.719597569944098*^9}, {3.719597655077704*^9, 3.719597693896027*^9}, {
   3.7195991335242367`*^9, 3.719599136943551*^9}, {3.719600150695073*^9, 
   3.719600174091508*^9}, {3.719619553524702*^9, 3.719619581545991*^9}, {
   3.719619876876605*^9, 3.7196198773446712`*^9}, {3.719621789562789*^9, 
   3.7196218153390417`*^9}, {3.719621927523898*^9, 3.719622024913827*^9}, {
   3.719622064995522*^9, 3.719622131767776*^9}, {3.7196602925586643`*^9, 
   3.719660301236218*^9}, {3.7196656106933203`*^9, 3.719665638989236*^9}, 
   3.719731044799958*^9, {3.719736404538786*^9, 3.719736413123609*^9}, 
   3.719740275918*^9, {3.719756587122817*^9, 3.719756605106944*^9}, {
   3.720016086101871*^9, 3.7200160899275103`*^9}, {3.720017064743177*^9, 
   3.72001709999369*^9}, {3.720017189184111*^9, 3.720017201841878*^9}, 
   3.720017444707818*^9, {3.7200174858651543`*^9, 3.7200174992240562`*^9}, {
   3.720017590222838*^9, 3.7200176002304*^9}, {3.7200176984883127`*^9, 
   3.7200178277210083`*^9}, 3.720017905642529*^9, {3.7200186242785597`*^9, 
   3.7200186272560787`*^9}, {3.720137903598793*^9, 3.720137908304805*^9}, {
   3.720142024125119*^9, 3.7201420992527857`*^9}, 3.720142129925112*^9, {
   3.720142297796999*^9, 3.720142299887911*^9}, {3.720150231787264*^9, 
   3.720150238578167*^9}, {3.720150350267871*^9, 3.720150353306981*^9}, {
   3.7201503882101803`*^9, 3.7201503940501013`*^9}, 3.721354404386806*^9, {
   3.721354665786091*^9, 3.721354672585949*^9}, {3.7226466365911083`*^9, 
   3.722646676447404*^9}, {3.7226468900192337`*^9, 3.722646925542104*^9}, {
   3.729608289746458*^9, 3.729608310307027*^9}, {3.7299025148100863`*^9, 
   3.729902516688778*^9}, {3.738120523895382*^9, 3.73812054053423*^9}, {
   3.7682944427969*^9, 3.768294527429344*^9}},
 ExpressionUUID -> "47920ddb-8700-4bad-90cf-bb180226ec9c"]
}, Closed]],

Cell[CellGroupData[{

Cell["SetDSystem", "Subsubsection",
 CellChangeTimes->{{3.71966017905875*^9, 3.7196602055731897`*^9}, 
   3.719734539264958*^9, 3.7213546623135757`*^9, {3.7357856151957407`*^9, 
   3.735785641950493*^9}},
 ExpressionUUID -> "007edf13-b11e-43a5-b639-07d7575d2e4f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetDSystem", "[", 
   RowBox[{"new_Symbol", ",", "old_Symbol"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Unprotect", "[", "new", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"UpValues", "[", "new", "]"}], "=", 
      RowBox[{
       RowBox[{"UpValues", "[", "old", "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{"old", "\[Rule]", "new"}], "}"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", "new", "]"}], ";"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.735785627523429*^9, 3.735785670178604*^9}, {
  3.73578575801268*^9, 3.735785801746017*^9}, {3.735785839132182*^9, 
  3.735785840756629*^9}, {3.735785918923892*^9, 3.7357859385298243`*^9}},
 ExpressionUUID -> "028f9ac3-c797-42ce-a481-ab329b73b7d7"]
}, Closed]],

Cell[CellGroupData[{

Cell["redefineOperations", "Subsubsection",
 CellChangeTimes->{3.7221632996136007`*^9},
 ExpressionUUID -> "2f54243c-b785-48db-b8d8-6330e60eaca4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"redefineOperations", "[", "ds_Symbol", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t1", ",", "i", ",", "keys", ",", "l"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"ds", ",", "opts___"}], "]"}], "^:=", 
           RowBox[{
            RowBox[{"Function", "[", 
             RowBox[{"ds$M", ",", 
              RowBox[{
               RowBox[{"t1", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"ds$M", ",", "opts"}], "]"}]}], ";", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"t1", "===", "ds$M"}], ",", 
                 RowBox[{"Message", "[", 
                  RowBox[{"History", "::", "nothing"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"HistoryAppend", "[", 
                   RowBox[{"ds", ",", 
                    RowBox[{"{", 
                    RowBox[{"t1", ",", 
                    RowBox[{"{", 
                    RowBox[{"#", ",", "ds", ",", "opts"}], "}"}]}], "}"}]}], 
                   "]"}], ";", "t1"}]}], "]"}]}]}], "]"}], "[", 
            RowBox[{"ds", "[", "]"}], "]"}]}], ";"}], ")"}], "&"}], "/@", 
       RowBox[{"{", 
        RowBox[{
        "Factor", ",", "Simplify", ",", "FullSimplify", ",", "Apart", ",", 
         "Together"}], "}"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{"fun", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"fun", "[", 
           RowBox[{"ds", ",", "opts___"}], "]"}], "^:=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"fun", "[", 
              RowBox[{"#", ",", "opts"}], "]"}], "&"}], ",", "ds", ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}]}], "]"}], "/@", 
      RowBox[{"{", 
       RowBox[{
       "Factor", ",", "Simplify", ",", "FullSimplify", ",", "Apart", ",", 
        "Together"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Variables", "[", "ds", "]"}], "^:=", 
      RowBox[{"Keys", "[", 
       RowBox[{
        RowBox[{"History", "[", "ds", "]"}], "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Protect", "/@", 
      RowBox[{"Variables", "[", "ds", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ds", "[", "x_", "]"}], ":=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}],
         ")"}], "[", "x", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ds", "[", "]"}], ":=", 
      RowBox[{"ds", "[", 
       RowBox[{"[", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ds", "/:", 
      RowBox[{"Part", "[", 
       RowBox[{"ds", ",", "a___"}], "]"}], ":=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{"#", ",", "a"}], "]"}], "&"}], ",", 
        RowBox[{
         RowBox[{"History", "[", "ds", "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ds", "/:", 
      RowBox[{"Map", "[", 
       RowBox[{"f_", ",", "ds", ",", "pars___"}], "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"t1", "=", 
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], 
          "]"}]}], ";", 
        RowBox[{"keys", "=", 
         RowBox[{"Keys", "[", "t1", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"l", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Length", "@", "keys"}], ")"}], "*", 
          SuperscriptBox[
           RowBox[{"Length", "[", "ds", "]"}], "2"]}]}], ";", 
        RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"CWrite", "[", 
         RowBox[{"\"\<\\n[\>\"", "<>", 
          RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<|\>\""}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"FCMonitor", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"t1", "[", "#", "]"}], "=", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"i", "++"}], ";", 
                    RowBox[{"CWrite", "[", "\"\<.\>\"", "]"}], ";", "#"}], 
                   ")"}], "&"}], "@*", "f"}], ",", 
                RowBox[{"t1", "[", "#", "]"}], ",", "pars"}], "]"}]}], ")"}], 
            "&"}], "/@", "keys"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ProgressIndicator", "[", 
           RowBox[{"i", ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "l"}], "}"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"CWrite", "[", "\"\<]\>\"", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"HistoryAppend", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"{", 
           RowBox[{"t1", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"Map", "[", 
                RowBox[{"f", ",", "#1", ",", "##2"}], "]"}], "&"}], ",", "ds",
               ",", "pars"}], "}"}]}], "}"}]}], "]"}]}], ")"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ds", "/:", 
      RowBox[{"MapAt", "[", 
       RowBox[{"f_", ",", "ds", ",", "pars___"}], "]"}], ":=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"t1", "=", 
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], 
          "]"}]}], ";", 
        RowBox[{"keys", "=", 
         RowBox[{"Keys", "[", "t1", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"l", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Length", "@", "keys"}], ")"}], "*", 
          SuperscriptBox[
           RowBox[{"Length", "[", "ds", "]"}], "2"]}]}], ";", 
        RowBox[{"i", "=", "0"}], ";", "\[IndentingNewLine]", 
        RowBox[{"CWrite", "[", 
         RowBox[{"\"\<\\n[\>\"", "<>", 
          RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<|\>\""}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"FCMonitor", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"t1", "[", "#", "]"}], "=", 
              RowBox[{"MapAt", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"i", "++"}], ";", 
                    RowBox[{"CWrite", "[", "\"\<.\>\"", "]"}], ";", "#"}], 
                   ")"}], "&"}], "@*", "f"}], ",", 
                RowBox[{"t1", "[", "#", "]"}], ",", "pars"}], "]"}]}], ")"}], 
            "&"}], "/@", "keys"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ProgressIndicator", "[", 
           RowBox[{"i", ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "l"}], "}"}]}], "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"CWrite", "[", "\"\<]\>\"", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"HistoryAppend", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"{", 
           RowBox[{"t1", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"MapAt", "[", 
                RowBox[{"f", ",", "#1", ",", "##2"}], "]"}], "&"}], ",", "ds",
               ",", "pars"}], "}"}]}], "}"}]}], "]"}]}], ")"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->CompressedData["
1:eJwdz1tIk3EcxvGXEg1DkDnnmCDaAZ2uNi/UcCC84rSiiTkUa21TQ42QBOcU
ZOIhm6Yrpgh79aIVYQZph3UY6KRJuwi1EA2TSGY4NH1fVoNCsDz8n//Fj8/N
93fxpFQ3lNYcYRgmjRyszthcGHjHs78/PQ3A42MlmYPEmeVoNTxVspcHm/zr
Gvinz1cGFZyyDla81Zuh4dZjK7Qyz2z0r9PUA8eXUu3wc1HtfSjP9PhhZMUk
9cSazxgg5ixKb8D5l4oko4dn/yd1pcC4c658uOQLaCC3G18MVxd2qB+181W0
d6zUwW5ZeT3tvgtUfj/PDI+Oqi3wYpmSMRHvmdzUAtVf5zDR7+U42PTl57iL
WKiNfg5bgxsjzVNkZ3/pG8g4uGm4vXn3PdyPMX6AyVmX5mBBVvoaXFaaf8Ch
MxbRdS/PzkY5T0K5oUcOV8Y0CqgfnSyEttlKHcxtFOmhIze1Bj489qAePpm6
ZoblnWGZcZrslf5LhEH3oy47Mdai7YbeC+peaE/P6IfWhLSirTiBbd9RUXWv
Luvg1YlFakTLXBWs5X/dhOelMaJsscC+bo0Uw+CVr1L4beKFDHYchJOhYVdy
GjrutJ2FoRYbtdnpGoS8RzVE+1Aofl0isO6BRgnsE+fcjkgQWFVDuBceArpx
TTc=
  "],
 ExpressionUUID -> "121bda24-3112-4212-a36f-ed8b2b14b964"]
}, Closed]],

Cell[CellGroupData[{

Cell["DSystemQ", "Subsubsection",
 CellChangeTimes->{{3.71966017905875*^9, 3.7196602065727043`*^9}, 
   3.721354406048121*^9},
 ExpressionUUID -> "a51dc2d4-5920-47ef-a10b-09e937b45af8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DSystemQ", "::", "usage"}], "=", 
   "\"\<DSystemQ[ds] returns True if ds is a differential system.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DSystemQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{{3.719660208790081*^9, 3.719660266364728*^9}, {
  3.721354407321693*^9, 3.7213544110645113`*^9}},
 ExpressionUUID -> "63872a04-bdb7-413a-be53-c0ac65097c18"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Polynomial Algebra", "Subsection",
 CellChangeTimes->{{3.7219745860081873`*^9, 3.72197459221539*^9}},
 ExpressionUUID -> "ac539cdf-6962-46a4-a4ea-ef959b6ce23c"],

Cell[CellGroupData[{

Cell["ModBlock,$LibraNotations", "Subsubsection",
 CellChangeTimes->{{3.7705946972948933`*^9, 3.770594702247272*^9}, {
  3.770594855738418*^9, 3.770594873331031*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$LibraNotations", "::", "usage"}], "=", 
  "\"\<$LibraNotations represents global notations of Libra. They are the \
list of the rules \!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) which should be understood as the statement that \!\
\(\*
StyleBox[\"x\", \"TI\"]\) is a root of the polynomial \!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\).\\nUsually, $LibraNotations is set to {_\[Rule]0}. \
It can be temporarily prepended via \
NotationsBlock[notations,\[Ellipsis]].\\n$LibraNotations is supposed to \
provide modding polynomial in the functions *Mod[ex,\!\(\*
StyleBox[\"x\", \"TI\"]\)] effectively making them shortcuts for *Mod[ex,\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)].\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$LibraNotations", "=", 
   RowBox[{"{", 
    RowBox[{"_", "\[Rule]", "0"}], "}"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.770594885660668*^9, 3.77059508885878*^9}, {
  3.770595122667033*^9, 3.770595306542804*^9}, {3.770595631126857*^9, 
  3.770595634558113*^9}, {3.7705966887985897`*^9, 3.770596690446877*^9}}],

Cell[BoxData[
 RowBox[{"SetAttributes", "[", 
  RowBox[{"NotationsBlock", ",", 
   RowBox[{"{", "HoldRest", "}"}]}], "]"}]], "Code",
 CellChangeTimes->{{3.77061001715245*^9, 3.770610030959392*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"NotationsBlock", "[", 
   RowBox[{"notations_List", ",", "expr_"}], "]"}], ":=", 
  RowBox[{"Internal`InheritedBlock", "[", 
   RowBox[{
    RowBox[{"{", "$LibraNotations", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"$LibraNotations", "=", 
      RowBox[{"Join", "[", 
       RowBox[{"notations", ",", "$LibraNotations"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "expr"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.770594706468995*^9, 3.7705948486998577`*^9}, 
   3.770594879940856*^9, 3.770595065644313*^9, {3.770595338625599*^9, 
   3.770595343067336*^9}, {3.770595621987825*^9, 3.770595622477395*^9}, {
   3.770609953847123*^9, 3.7706099576227427`*^9}, {3.770610013671248*^9, 
   3.770610015391173*^9}, {3.770610062663856*^9, 3.77061006453607*^9}, {
   3.770610182011042*^9, 3.770610183961536*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["InvertMod", "Subsubsection",
 CellChangeTimes->{
  3.721974951713025*^9, 3.729897439217166*^9, {3.768112104939489*^9, 
   3.768112112195244*^9}, 3.768113063311255*^9, {3.768114257139352*^9, 
   3.768114305707396*^9}, {3.768135307327364*^9, 3.7681353090073853`*^9}, {
   3.768135713841543*^9, 3.768135727587694*^9}, 3.768174608123156*^9, {
   3.770601715668057*^9, 3.77060171846024*^9}, {3.7706020376925917`*^9, 
   3.770602037844331*^9}},
 ExpressionUUID -> "05ff4856-2f35-45a1-8a80-2afebf18fc6a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"InvertMod", "::", "usage"}], "=", 
   "\"\<InvertMod[\!\(\*SubscriptBox[
StyleBox[\"P\", \"TI\"], \"1\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*SubscriptBox[
StyleBox[\"P\", \"TI\"], \"2\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] gives the polynomial \!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\), such that \!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"\[CenterDot]\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"P\", \"TI\"], \"1\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)= 1 mod \!\(\*SubscriptBox[
StyleBox[\"P\", \"TI\"], \"2\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721974611153246*^9, 3.721974702800254*^9}, {
  3.729897439138495*^9, 3.7298974391400433`*^9}, {3.768112636998975*^9, 
  3.768112735327812*^9}, {3.7681127969990063`*^9, 3.768112811824176*^9}, {
  3.770594640325918*^9, 3.770594645365087*^9}},
 ExpressionUUID -> "f9e161b9-df66-4a77-b42a-39af76a5f379"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InvertMod", "[", 
   RowBox[{"poly1_", ",", "poly2_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"InvertMod", "[", 
   RowBox[{"poly1", ",", 
    RowBox[{"x", "\[Rule]", " ", "poly2"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, 3.729897439155714*^9, {3.770593069482409*^9, 
   3.7705930700902863`*^9}, {3.770593200302123*^9, 3.770593200806137*^9}, {
   3.770593287160633*^9, 3.770593303129422*^9}, {3.770594529831596*^9, 
   3.770594534070253*^9}, 3.770601699439934*^9},
 ExpressionUUID -> "96be814a-b125-459e-810f-40af5c4f153b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"InvertMod", "[", 
    RowBox[{"poly1_", ",", 
     RowBox[{"x_Symbol", "\[Rule]", "0"}]}], "]"}], ":=", 
   RowBox[{"1", "/", "poly1"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.770595421057496*^9, 3.770595440194647*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"InvertMod", "[", 
   RowBox[{"poly1_", ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly2_"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"gcd", ",", "u", ",", "v"}], "}"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"gcd", ",", 
        RowBox[{"{", 
         RowBox[{"u", ",", "v"}], "}"}]}], "}"}], "=", 
      RowBox[{"PolynomialExtendedGCD", "[", 
       RowBox[{"poly1", ",", "poly2", ",", "x"}], "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FreeQ", "[", 
        RowBox[{"gcd", ",", "x"}], "]"}], ",", 
       FractionBox["u", "gcd"], ",", 
       FractionBox["1", "0"]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, 3.729897439155714*^9, {3.770593069482409*^9, 
   3.7705930700902863`*^9}, {3.770593200302123*^9, 3.770593200806137*^9}, {
   3.770593287160633*^9, 3.770593321282259*^9}, {3.770594520695154*^9, 
   3.770594524206451*^9}, 3.770595410908614*^9},
 ExpressionUUID -> "96be814a-b125-459e-810f-40af5c4f153b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InvertMod", "[", 
   RowBox[{"poly1_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"InvertMod", "[", 
   RowBox[{"poly1", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.770595382010597*^9, 3.770595397897915*^9}, {
  3.7705954491960287`*^9, 3.77059547802608*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Invert", "[", "poly1_", "]"}], ":=", 
   RowBox[{"1", "/", "poly1"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.770601724169146*^9, 3.770601741421743*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["QuolyMod", "Subsubsection",
 CellChangeTimes->{
  3.721974951713025*^9, 3.729897439217166*^9, {3.768112104939489*^9, 
   3.768112112195244*^9}, 3.768113063311255*^9, {3.768114257139352*^9, 
   3.768114305707396*^9}, {3.768135307327364*^9, 3.7681353090073853`*^9}, {
   3.768135713841543*^9, 3.768135727587694*^9}, {3.768174615235176*^9, 
   3.768174620347548*^9}},
 ExpressionUUID -> "05ff4856-2f35-45a1-8a80-2afebf18fc6a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"QuolyMod", "::", "usage"}], "=", "\"\<QuolyMod[\!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] gives the \\\"remainder\\\" \!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) of the rational function Q(x) when divided by \
polynomial P(x). Therefore, \!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)=\!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)+ \!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\[CenterDot]\!\(\*
StyleBox[\"S\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\), where \!\(\*
StyleBox[\"S\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is a rational function with denominator being \
mutually simple with \!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721974611153246*^9, 3.721974731337377*^9}, {
  3.721974960750544*^9, 3.721975011037758*^9}, {3.729897381433429*^9, 
  3.729897381435646*^9}, {3.7298974189456253`*^9, 3.729897418946785*^9}, {
  3.7681124353418818`*^9, 3.768112578935623*^9}, {3.768112751238324*^9, 
  3.7681127874874783`*^9}, {3.768112821999517*^9, 3.7681129452324867`*^9}, {
  3.770594559040247*^9, 3.7705946202579813`*^9}},
 ExpressionUUID -> "dfc93b74-40a1-42ec-a0f1-4409fd4f60b3"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"QuolyMod", "::", "wrongargs"}], "=", 
   "\"\<Something wrong with the arguments of QuolyMod.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7681147397910547`*^9, 3.7681147539404783`*^9}, {
   3.768114907462451*^9, 3.7681149677586107`*^9}, 3.7706018684457912`*^9},
 ExpressionUUID -> "b8cb527a-2423-4511-9f6c-e3cdc2bca1f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"QuolyMod", "[", 
    RowBox[{"quoly_List", ",", "args__"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"QuolyMod", "[", 
      RowBox[{"#", ",", "args"}], "]"}], "&"}], "/@", "quoly"}]}], ";", 
  RowBox[{
   RowBox[{"QuolyMod", "[", 
    RowBox[{"quoly_", ",", 
     RowBox[{"poly", ":", 
      RowBox[{"Except", "[", "_Rule", "]"}]}], ",", "x_Symbol"}], "]"}], ":=", 
   RowBox[{"QuolyMod", "[", 
    RowBox[{"quoly", ",", 
     RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768114665477973*^9, 
   3.768114670005917*^9}, {3.768114705071129*^9, 3.768114899959338*^9}, {
   3.7681149881508904`*^9, 3.768114989798518*^9}, 3.768115071192398*^9, {
   3.77059334393274*^9, 3.770593409326621*^9}, {3.770594507686335*^9, 
   3.770594509150078*^9}, {3.770594659368713*^9, 3.7705946636642437`*^9}, {
   3.77059549287486*^9, 3.770595495594808*^9}, {3.770601783613809*^9, 
   3.770601789614032*^9}, {3.770601908382094*^9, 3.770601910765971*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"QuolyMod", "[", 
    RowBox[{"quoly_", ",", 
     RowBox[{"x_Symbol", "\[Rule]", "0"}]}], "]"}], ":=", "quoly"}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.770595535618843*^9, 3.770595578821917*^9}, {
  3.770601872413062*^9, 3.7706018725497227`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuolyMod", "[", 
   RowBox[{"quoly_", ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"num", ",", "den"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"num", ",", "den"}], "}"}], "=", 
      RowBox[{"Through", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Numerator", ",", "Denominator"}], "}"}], "@", 
        RowBox[{"Together", "@", "quoly"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Together", "@", 
      RowBox[{"PolynomialRemainder", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"InvertMod", "[", 
          RowBox[{"den", ",", "poly", ",", "x"}], "]"}], "*", "num"}], ",", 
        "poly", ",", "x"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768114665477973*^9, 
   3.768114670005917*^9}, {3.768114705071129*^9, 3.768114899959338*^9}, {
   3.7681149881508904`*^9, 3.768114989798518*^9}, 3.768115071192398*^9, {
   3.77059334393274*^9, 3.770593409326621*^9}, {3.770594666449082*^9, 
   3.770594670584917*^9}, {3.7705955728675213`*^9, 3.770595574564225*^9}, {
   3.770601875477971*^9, 3.77060188369403*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"QuolyMod", "[", 
   RowBox[{"quoly_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"QuolyMod", "[", 
   RowBox[{"quoly", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768114665477973*^9, 
   3.768114670005917*^9}, {3.768114705071129*^9, 3.768114899959338*^9}, {
   3.7681149881508904`*^9, 3.768114989798518*^9}, 3.768115071192398*^9, {
   3.77059334393274*^9, 3.770593409326621*^9}, {3.770594666449082*^9, 
   3.770594670584917*^9}, {3.7705955704460783`*^9, 3.770595612500092*^9}, {
   3.7705956559512568`*^9, 3.770595667005596*^9}, {3.770601889645155*^9, 
   3.7706018921491013`*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"]
}, Closed]],

Cell[CellGroupData[{

Cell["ExtendedQuolyMod", "Subsubsection",
 CellChangeTimes->{{3.768174628005294*^9, 3.768174637611726*^9}},
 ExpressionUUID -> "495f9f0f-da9e-402b-b223-65b7b0582d67"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExtendedQuolyMod", "::", "usage"}], "=", 
   "\"\<ExtendedQuolyMod[\!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] gives the pair {\!\(\*
StyleBox[\"k\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)}, where \!\(\*
StyleBox[\"k\", \"TI\"]\) is the \\\"leading order\\\" and \!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is the \\\"remainder\\\". Therefore, \!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"=\", \"TI\"]\)\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*SuperscriptBox[
StyleBox[\")\", \"TI\"], \"k\"]\)(\!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"+\", \"TI\"]\)\!\(\*
StyleBox[\" \", \"TI\"]\)\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"\[CenterDot]\", \"TI\"]\)\!\(\*
StyleBox[\"S\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\), where \!\(\*
StyleBox[\"S\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is a rational function with denominator being \
mutually simple with \!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7681120929322367`*^9, 3.768112095307582*^9}, {
  3.7681121399876833`*^9, 3.768112367148645*^9}, {3.768112399869265*^9, 
  3.768112429790001*^9}, {3.768112498597707*^9, 3.768112507782734*^9}, {
  3.768112960095653*^9, 3.768113038584972*^9}, {3.7705957420726557`*^9, 
  3.770595746761579*^9}},
 ExpressionUUID -> "89d916c9-6cb6-4ba4-b2da-bcbbaffdb320"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExtendedQuolyMod", "::", "wrongargs"}], "=", 
   "\"\<Something wrong with the arguments of ExtendedQuolyMod.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7681147397910547`*^9, 3.7681147539404783`*^9}, {
  3.768114907462451*^9, 3.768114978312079*^9}, {3.770601940837693*^9, 
  3.770601941029736*^9}},
 ExpressionUUID -> "f8896532-94ef-4f58-bf5e-031169df8722"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExtendedQuolyMod", "[", 
    RowBox[{"quoly_List", ",", "args__"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"ExtendedQuolyMod", "[", 
      RowBox[{"#", ",", "args"}], "]"}], "&"}], "/@", "quoly"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768113074879766*^9, 
   3.7681131211912107`*^9}, {3.7681132026406307`*^9, 3.768113421936664*^9}, {
   3.768113483273628*^9, 3.768113541619741*^9}, {3.768113580339171*^9, 
   3.768113583722278*^9}, 3.768114167272801*^9, {3.768114463237865*^9, 
   3.768114503934009*^9}, {3.76811500802925*^9, 3.768115028321492*^9}, 
   3.768115073351984*^9, {3.768515324443511*^9, 3.768515410474264*^9}, {
   3.7705934263713512`*^9, 3.77059347511312*^9}, {3.770595708869278*^9, 
   3.770595729525082*^9}, 3.770599200157851*^9},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExtendedQuolyMod", "[", 
    RowBox[{"quoly_", ",", "poly_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"ExtendedQuolyMod", "[", 
    RowBox[{"quoly", ",", 
     RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768113074879766*^9, 
   3.7681131211912107`*^9}, {3.7681132026406307`*^9, 3.768113421936664*^9}, {
   3.768113483273628*^9, 3.768113541619741*^9}, {3.768113580339171*^9, 
   3.768113583722278*^9}, 3.768114167272801*^9, {3.768114463237865*^9, 
   3.768114503934009*^9}, {3.76811500802925*^9, 3.768115028321492*^9}, 
   3.768115073351984*^9, {3.768515324443511*^9, 3.768515410474264*^9}, {
   3.7705934263713512`*^9, 3.77059347511312*^9}, {3.770595708869278*^9, 
   3.770595729525082*^9}, 3.770599200157851*^9, {3.770601948157283*^9, 
   3.770601949773306*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExtendedQuolyMod", "[", 
   RowBox[{"quoly_", ",", 
    RowBox[{"x_Symbol", "\[Rule]", "0"}]}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"0", ",", "quoly"}], "}"}]}]], "Code",
 CellChangeTimes->{{3.7705958099024553`*^9, 3.770595824190235*^9}, 
   3.7706019538853207`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExtendedQuolyMod", "[", 
   RowBox[{"quoly_", ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"num", ",", "num1", ",", "den", ",", "den1", ",", "rmndr", ",", 
      RowBox[{"k", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FreeQ", "[", 
        RowBox[{"poly", ",", "x"}], "]"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"\[Infinity]", ",", "quoly"}], "}"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"num", ",", "den"}], "}"}], "=", 
      RowBox[{"Through", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Numerator", ",", "Denominator"}], "}"}], "@", 
        RowBox[{"Together", "@", "quoly"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"PossibleZeroQ", "[", "num", "]"}], ",", 
       RowBox[{"Return", "[", "\[Infinity]", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{"True", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"den1", ",", "rmndr"}], "}"}], "=", 
         RowBox[{"PolynomialQuotientRemainder", "[", 
          RowBox[{"den", ",", "poly", ",", "x"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"rmndr", "=!=", "0"}], ",", 
          RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"den", "=", "den1"}], ";", 
        RowBox[{"k", "--"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{"True", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"num1", ",", "rmndr"}], "}"}], "=", 
         RowBox[{"PolynomialQuotientRemainder", "[", 
          RowBox[{"num", ",", "poly", ",", "x"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"rmndr", "=!=", "0"}], ",", 
          RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"num", "=", "num1"}], ";", 
        RowBox[{"k", "++"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"k", ",", 
       RowBox[{"QuolyMod", "[", 
        RowBox[{
         RowBox[{"num", "/", "den"}], ",", "poly", ",", "x"}], "]"}]}], 
      "}"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768113074879766*^9, 
   3.7681131211912107`*^9}, {3.7681132026406307`*^9, 3.768113421936664*^9}, {
   3.768113483273628*^9, 3.768113541619741*^9}, {3.768113580339171*^9, 
   3.768113583722278*^9}, 3.768114167272801*^9, {3.768114463237865*^9, 
   3.768114503934009*^9}, {3.76811500802925*^9, 3.768115028321492*^9}, 
   3.768115073351984*^9, {3.768515324443511*^9, 3.768515410474264*^9}, {
   3.7705934263713512`*^9, 3.7705934575288477`*^9}, {3.7705957651264753`*^9, 
   3.770595772199461*^9}, {3.770595866071661*^9, 3.770595878146091*^9}, {
   3.770601957966509*^9, 3.770601962542676*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ExtendedQuolyMod", "[", 
   RowBox[{"quoly_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"ExtendedQuolyMod", "[", 
   RowBox[{"quoly", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.770595919071313*^9, 3.770595965953554*^9}, {
  3.7706019699812803`*^9, 3.7706019734534817`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["LeadingOrderMod", "Subsubsection",
 CellChangeTimes->{{3.768174654796612*^9, 3.768174676385795*^9}, 
   3.768515052968994*^9, 3.770591538965355*^9},
 ExpressionUUID -> "415b51c6-cdb8-4a38-ba76-04148eb41403"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingOrderMod", "::", "usage"}], "=", "\"\<LeadingOrderMod[\!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] gives the \\\"leading order\\\"  \!\(\*
StyleBox[\"k\", \"TI\"]\) such that, \!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"=\", \"TI\"]\)\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*SuperscriptBox[
StyleBox[\")\", \"TI\"], \"k\"]\)\!\(\*
StyleBox[\"S\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\), where both the numerator and denominator of \!\(\*
StyleBox[\"S\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) are mutually simple with \!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7681120929322367`*^9, 3.768112095307582*^9}, {
  3.7681121399876833`*^9, 3.768112367148645*^9}, {3.768112399869265*^9, 
  3.768112429790001*^9}, {3.768112498597707*^9, 3.768112507782734*^9}, {
  3.768112960095653*^9, 3.768113038584972*^9}, {3.768114349967205*^9, 
  3.7681144522703943`*^9}, {3.768135713871872*^9, 3.7681357138743896`*^9}, {
  3.768515054265654*^9, 3.768515055145935*^9}, {3.770591539902767*^9, 
  3.770591540574875*^9}, {3.770595983148443*^9, 3.770595988364599*^9}},
 ExpressionUUID -> "dc210024-2358-4b80-806e-86f73281a92d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "LeadingOrderMod", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Check", "\[Rule]", "False"}], ",", 
     RowBox[{"Parallelize", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LeadingOrderMod", "::", "wrongargs"}], "=", 
   "\"\<Something wrong with the arguments of LeadingOrderMod.\>\""}], 
  ";"}]}], "Code",
 CellChangeTimes->{{3.7681147397910547`*^9, 3.7681147539404783`*^9}, {
  3.768114907462451*^9, 3.768114978312079*^9}, {3.768115091209704*^9, 
  3.768115093544044*^9}, {3.7681357138818417`*^9, 3.768135713883757*^9}, {
  3.768138389520871*^9, 3.76813839465385*^9}, {3.768175378673277*^9, 
  3.7681754236087017`*^9}, {3.768175896874378*^9, 3.7681758996746683`*^9}, {
  3.76817798715843*^9, 3.768177987302741*^9}, {3.768515055942855*^9, 
  3.768515057761661*^9}, {3.7705915419014263`*^9, 3.770591544133664*^9}},
 ExpressionUUID -> "7bfa3f2a-885b-4dc1-847e-19f1f30fcd47"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "poly_", ",", "x_Symbol", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "opts"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7687860246234713`*^9, 3.768786061430894*^9}, {
   3.7704718947084007`*^9, 3.770471894871941*^9}, {3.770591545056457*^9, 
   3.770591546407816*^9}, {3.770596019337289*^9, 3.770596021041604*^9}, {
   3.770596051772867*^9, 3.770596065622706*^9}, 3.7705990081369123`*^9},
 ExpressionUUID -> "7166fef7-01ef-432f-bca4-d6e0ca04f931"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "opts"}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "opts"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.7687860246234713`*^9, 3.768786061430894*^9}, {
   3.7704718947084007`*^9, 3.770471894871941*^9}, {3.770591545056457*^9, 
   3.770591546407816*^9}, {3.770596019337289*^9, 3.770596021041604*^9}, {
   3.770596051772867*^9, 3.770596065622706*^9}, 3.7705990081369123`*^9, {
   3.7705990429845324`*^9, 3.770599055243361*^9}},
 ExpressionUUID -> "7166fef7-01ef-432f-bca4-d6e0ca04f931"],

Cell["lists", "Text",
 CellChangeTimes->{{3.768174701372134*^9, 3.768174714428297*^9}},
 ExpressionUUID -> "5d2e9824-fe3e-4975-818f-92a114b934b4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingOrderMod", "[", 
    RowBox[{"quoly_List", ",", "args__", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"OptionValue", "[", "Parallelize", "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DistributeDefinitions", "[", "LeadingOrderMod", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Min", "[", 
       RowBox[{"ParallelMap", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"LeadingOrderMod", "[", 
           RowBox[{"#", ",", "args", ",", "opts"}], "]"}], "&"}], ",", 
         "quoly", ",", 
         RowBox[{"{", 
          RowBox[{"ArrayDepth", "[", "quoly", "]"}], "}"}]}], "]"}], "]"}]}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"Min", "[", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"LeadingOrderMod", "[", 
          RowBox[{"#", ",", "args", ",", "opts"}], "]"}], "&"}], ",", "quoly",
         ",", 
        RowBox[{"{", 
         RowBox[{"ArrayDepth", "[", "quoly", "]"}], "}"}]}], "]"}], "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768113074879766*^9, 
   3.7681131211912107`*^9}, {3.7681132026406307`*^9, 3.768113421936664*^9}, {
   3.768113483273628*^9, 3.768113541619741*^9}, {3.768113580339171*^9, 
   3.768113583722278*^9}, 3.768114167272801*^9, {3.768114512454125*^9, 
   3.76811456242213*^9}, {3.768115038400421*^9, 3.7681150980586147`*^9}, {
   3.76813571388912*^9, 3.7681357138932467`*^9}, {3.768138292643228*^9, 
   3.7681383779448347`*^9}, {3.768138426856763*^9, 3.768138429521422*^9}, {
   3.7681385456279287`*^9, 3.768138557319029*^9}, 3.768138660884809*^9, 
   3.76817469174927*^9, {3.768515058543008*^9, 3.768515061028946*^9}, {
   3.770591547713324*^9, 3.770591550389852*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"],

Cell["scalar", "Text",
 CellChangeTimes->{{3.768174701372134*^9, 3.768174702259822*^9}},
 ExpressionUUID -> "c6fcc115-d8af-4575-8dc4-f65591583d1d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{"quoly_", ",", "poly_", ",", "x_", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{"quoly", ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "opts"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.770593589039441*^9, 3.770593606983919*^9}, {
  3.7705960960906277`*^9, 3.770596100882975*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingOrderMod", "::", "indet"}], "=", 
   "\"\<LeadingOrderMod returned Indeterminate\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.770599135029976*^9, 3.7705991720789557`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{"quoly_", ",", 
    RowBox[{"x_", "\[Rule]", "0"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"LeadingOrderMod", "::", "indet"}], "]"}], ";", 
    "Indeterminate"}], ")"}]}]], "Code",
 CellChangeTimes->{{3.770599117062652*^9, 3.770599122262496*^9}, {
  3.7705991777015047`*^9, 3.77059918592548*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"LeadingOrderMod", "[", 
     RowBox[{"quoly_", ",", 
      RowBox[{"x_", "\[Rule]", "ix_"}], ",", 
      RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], "/;", 
    RowBox[{
     RowBox[{"x", "*", "ix"}], "===", "1"}]}], ":=", 
   RowBox[{"LeadingOrder", "[", 
    RowBox[{"quoly", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "\[Infinity]"}], "}"}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.770471956035038*^9, 3.770472005139637*^9}, {
   3.770472063855412*^9, 3.770472089557333*^9}, 3.770591551560677*^9, {
   3.770593614057002*^9, 3.77059362012096*^9}, {3.7705961075473223`*^9, 
   3.7705961119071302`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{"quoly_", ",", 
    RowBox[{"x_", "\[Rule]", "poly_"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"num", ",", "den", ",", "rmndr", ",", 
      RowBox[{"k", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FreeQ", "[", 
        RowBox[{"poly", ",", "x"}], "]"}], ",", 
       RowBox[{"Return", "[", "\[Infinity]", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "Check", "]"}], "&&", 
        RowBox[{"!", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{"RatFuncQ", "[", 
            RowBox[{"quoly", ",", "x"}], "]"}], "&&", 
           RowBox[{"PolyQ", "[", 
            RowBox[{"poly", ",", "x"}], "]"}]}], ")"}]}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"LeadingOrderMod", "::", "wrongargs"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"num", ",", "den"}], "}"}], "=", 
      RowBox[{"Through", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Numerator", ",", "Denominator"}], "}"}], "@", 
        RowBox[{"Together", "@", "quoly"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"PossibleZeroQ", "[", "num", "]"}], ",", 
       RowBox[{"Return", "[", "\[Infinity]", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{"True", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"den", ",", "rmndr"}], "}"}], "=", 
         RowBox[{"PolynomialQuotientRemainder", "[", 
          RowBox[{"den", ",", "poly", ",", "x"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"PossibleZeroQ", "[", "rmndr", "]"}]}], ",", 
          RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"k", "--"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{"True", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"num", ",", "rmndr"}], "}"}], "=", 
         RowBox[{"PolynomialQuotientRemainder", "[", 
          RowBox[{"num", ",", "poly", ",", "x"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"PossibleZeroQ", "[", "rmndr", "]"}]}], ",", 
          RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"k", "++"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "k"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768113074879766*^9, 
   3.7681131211912107`*^9}, {3.7681132026406307`*^9, 3.768113421936664*^9}, {
   3.768113483273628*^9, 3.768113541619741*^9}, {3.768113580339171*^9, 
   3.768113583722278*^9}, 3.768114167272801*^9, {3.768114512454125*^9, 
   3.76811456242213*^9}, {3.768115038400421*^9, 3.7681150980586147`*^9}, {
   3.76813571388912*^9, 3.7681357138932467`*^9}, {3.768138292643228*^9, 
   3.7681383779448347`*^9}, {3.768138426856763*^9, 3.768138429521422*^9}, {
   3.7681385456279287`*^9, 3.768138557319029*^9}, 3.768138660884809*^9, 
   3.76817469174927*^9, {3.768177998885447*^9, 3.7681780347452593`*^9}, 
   3.7681782008494177`*^9, {3.768188744549128*^9, 3.768188769428748*^9}, {
   3.768515061788433*^9, 3.768515062600202*^9}, {3.768515186436047*^9, 
   3.768515186590067*^9}, {3.769211263397829*^9, 3.769211264650185*^9}, {
   3.770471976871872*^9, 3.77047198645506*^9}, {3.7705039229899797`*^9, 
   3.770503932437038*^9}, {3.770591552272088*^9, 3.770591553094965*^9}, {
   3.770593641075848*^9, 3.770593644613367*^9}, {3.7705961266763268`*^9, 
   3.7705961323484488`*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{"quoly_", ",", "x_", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"LeadingOrderMod", "[", 
   RowBox[{"quoly", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}], ",", "opts"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.770596151907875*^9, 3.770596180492887*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["LeadingTermMod(inactive)", "Subsubsection",
 CellChangeTimes->{{3.768174644436355*^9, 3.768174649899725*^9}, 
   3.768514964238764*^9, {3.768786078446835*^9, 3.768786112758559*^9}, {
   3.770592709479257*^9, 3.7705927162565603`*^9}},
 ExpressionUUID -> "7302724d-6a1c-4cbf-972e-505001610dbf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", "\"\<Redefine PolyLeadingTerm for matrices.\>\"", "]"}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.768139342647745*^9, 3.768139375340118*^9}, {
   3.7681394200366077`*^9, 3.7681394333831882`*^9}, 3.768514966983799*^9},
 ExpressionUUID -> "9582a2a7-a129-4037-922c-254dae5120de"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PolyLeadingTerm", "[", 
   RowBox[{"quoly_", ",", "poly_", ",", "x_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"num", ",", "den", ",", 
      RowBox[{"k", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "Check", "]"}], "&&", 
        RowBox[{"!", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{"RatFuncQ", "[", 
            RowBox[{"quoly", ",", "x"}], "]"}], "&&", 
           RowBox[{"PolyQ", "[", 
            RowBox[{"poly", ",", "x"}], "]"}]}], ")"}]}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"PolyLeadingTerm", "::", "wrongargs"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"num", ",", "den"}], "}"}], "=", 
      RowBox[{"Through", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Numerator", ",", "Denominator"}], "}"}], "@", 
        RowBox[{"Together", "@", "quoly"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"PossibleZeroQ", "[", "num", "]"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"\[Infinity]", ",", "0"}], "}"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"PolynomialQ", "[", 
         RowBox[{"den", ",", "x"}], "]"}], 
        RowBox[{"(*", 
         RowBox[{"\[LeftArrow]", 
          RowBox[{
          "this", " ", "is", " ", "to", " ", "account", " ", "for", " ", 
           "reducible", " ", "poly"}]}], "*)"}], "&&", 
        RowBox[{"Not", "[", 
         RowBox[{"FreeQ", "[", 
          RowBox[{
           RowBox[{"PolynomialGCD", "[", 
            RowBox[{"den", ",", "poly"}], "]"}], ",", "x"}], "]"}], "]"}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"den", "=", 
         RowBox[{"Cancel", "[", 
          RowBox[{"den", "/", "poly"}], "]"}]}], ";", 
        RowBox[{"k", "--"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"PolynomialQ", "[", 
         RowBox[{"num", ",", "x"}], "]"}], 
        RowBox[{"(*", 
         RowBox[{"\[LeftArrow]", 
          RowBox[{
          "this", " ", "is", " ", "to", " ", "account", " ", "for", " ", 
           "reducible", " ", "poly"}]}], "*)"}], "&&", 
        RowBox[{"Not", "[", 
         RowBox[{"FreeQ", "[", 
          RowBox[{
           RowBox[{"PolynomialGCD", "[", 
            RowBox[{"num", ",", "poly"}], "]"}], ",", "x"}], "]"}], "]"}]}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"num", "=", 
         RowBox[{"Cancel", "[", 
          RowBox[{"num", "/", "poly"}], "]"}]}], ";", 
        RowBox[{"k", "++"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"PolynomialQ", "[", 
         RowBox[{"num", ",", "x"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"num", "=", 
         RowBox[{"Cancel", "[", 
          RowBox[{"num", "*", "poly"}], "]"}]}], ";", 
        RowBox[{"k", "--"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"poly", "^", "k"}], "*", 
      RowBox[{"QuolyMod", "[", 
       RowBox[{
        RowBox[{"num", "/", "den"}], ",", "poly", ",", "x"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellOpen->False,
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768113074879766*^9, 
   3.7681131211912107`*^9}, {3.7681132026406307`*^9, 3.768113421936664*^9}, {
   3.768113483273628*^9, 3.768113541619741*^9}, {3.768113580339171*^9, 
   3.768113583722278*^9}, 3.768114167272801*^9, {3.768114463237865*^9, 
   3.768114503934009*^9}, {3.76811500802925*^9, 3.768115028321492*^9}, 
   3.768115073351984*^9, {3.768135574256246*^9, 3.7681356390742197`*^9}, 
   3.7681747744780893`*^9, {3.768514977693331*^9, 3.7685149783465557`*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingTermMod", "::", "usage"}], "=", "\"\<LeadingTermMod[\!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] gives the result of the form \!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*SuperscriptBox[
StyleBox[\")\", \"TI\"], \"k\"]\)(\!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\), where \!\(\*
StyleBox[\"k\", \"TI\"]\) is the \\\"leading order\\\" and \!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is the \\\"remainder\\\", such that \!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"=\", \"TI\"]\)\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*SuperscriptBox[
StyleBox[\")\", \"TI\"], \"k\"]\)(\!\(\*
StyleBox[\"R\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"+\", \"TI\"]\)\!\(\*
StyleBox[\" \", \"TI\"]\)\!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"\[CenterDot]\", \"TI\"]\)\!\(\*
StyleBox[\"S\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\), where \!\(\*
StyleBox[\"S\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is a rational function with denominator being \
mutually simple with \!\(\*
StyleBox[\"P\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\).\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.7681353278401337`*^9, 3.768135327843053*^9}, {
  3.7681353829704247`*^9, 3.768135489185293*^9}, {3.768135529872567*^9, 
  3.768135536817284*^9}, {3.768514968190526*^9, 3.768514968754299*^9}, {
  3.7705927214373713`*^9, 3.7705927233266983`*^9}},
 ExpressionUUID -> "c8a10573-adf3-49af-9ec4-2bf638bc1350"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "LeadingTermMod", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Check", "\[Rule]", "False"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LeadingTermMod", "::", "wrongargs"}], "=", 
   "\"\<Something wrong with the arguments of LeadingTermMod.\>\""}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.7681147397910547`*^9, 3.7681147539404783`*^9}, {
  3.768114907462451*^9, 3.768114978312079*^9}, {3.768135588867846*^9, 
  3.7681355928166227`*^9}, {3.7685149699082747`*^9, 3.768514971995019*^9}, {
  3.770592728035656*^9, 3.770592730227706*^9}},
 ExpressionUUID -> "00c7a895-35da-4bf5-9368-5254e20a915b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingTermMod", "[", 
    RowBox[{"quoly_List", ",", "args__", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"LeadingTermMod", "[", 
      RowBox[{"#", ",", 
       RowBox[{"args", ".", "opts"}]}], "]"}], "&"}], "/@", "quoly"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768113074879766*^9, 
   3.7681131211912107`*^9}, {3.7681132026406307`*^9, 3.768113421936664*^9}, {
   3.768113483273628*^9, 3.768113541619741*^9}, {3.768113580339171*^9, 
   3.768113583722278*^9}, 3.768114167272801*^9, {3.768114463237865*^9, 
   3.768114503934009*^9}, {3.76811500802925*^9, 3.768115028321492*^9}, 
   3.768115073351984*^9, {3.768135574256246*^9, 3.7681356390742197`*^9}, 
   3.7681747744780893`*^9, {3.7685149731347637`*^9, 3.768514973976074*^9}, {
   3.770592732859671*^9, 3.770592733667974*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingTermMod", "[", 
   RowBox[{"quoly_", ",", "poly_", ",", "x_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"num", ",", "den", ",", "k"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"OptionValue", "[", "Check", "]"}], "&&", 
        RowBox[{"!", 
         RowBox[{"(", " ", 
          RowBox[{
           RowBox[{"RatFuncQ", "[", 
            RowBox[{"quoly", ",", "x"}], "]"}], "&&", 
           RowBox[{"PolyQ", "[", 
            RowBox[{"poly", ",", "x"}], "]"}]}], ")"}]}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"LeadingTermMod", "::", "wrongargs"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"k", "=", 
      RowBox[{"LeadingOrderMod", "[", 
       RowBox[{"quoly", ",", 
        RowBox[{"x", "\[Rule]", "poly"}], ",", 
        RowBox[{"Check", "\[Rule]", "False"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"poly", "^", "k"}], "*", 
      RowBox[{"QuolyMod", "[", 
       RowBox[{
        RowBox[{"quoly", "/", 
         RowBox[{"poly", "^", "k"}]}], ",", "poly", ",", "x"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729900673595203*^9, 3.729900691560335*^9}, {3.768113074879766*^9, 
   3.7681131211912107`*^9}, {3.7681132026406307`*^9, 3.768113421936664*^9}, {
   3.768113483273628*^9, 3.768113541619741*^9}, {3.768113580339171*^9, 
   3.768113583722278*^9}, 3.768114167272801*^9, {3.768114463237865*^9, 
   3.768114503934009*^9}, {3.76811500802925*^9, 3.768115028321492*^9}, 
   3.768115073351984*^9, {3.768135574256246*^9, 3.7681356390742197`*^9}, 
   3.7681747744780893`*^9, {3.768174846924252*^9, 3.768174957780367*^9}, {
   3.7685149751110687`*^9, 3.7685149760574408`*^9}, 3.768515070794784*^9, 
   3.770591556940292*^9, {3.77059273463625*^9, 3.770592737667605*^9}, {
   3.7706023587588587`*^9, 3.770602361895347*^9}},
 ExpressionUUID -> "4c21ca1a-407b-4d0c-8ec0-30dd21a9762b"]
}, Closed]],

Cell[CellGroupData[{

Cell["RadicalsUp", "Subsubsection",
 CellChangeTimes->{
  3.721974951713025*^9, 3.729897439217166*^9, {3.768112104939489*^9, 
   3.768112112195244*^9}, 3.7681130606320667`*^9},
 ExpressionUUID -> "05ff4856-2f35-45a1-8a80-2afebf18fc6a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"RadicalsUp", ",", "Listable"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RadicalsUp", "[", "ex_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"den", "=", 
        RowBox[{"Denominator", "[", "ex", "]"}]}], ",", "num", ",", "denc"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"num", "=", 
       RowBox[{"den", "*", "ex"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"denc", "=", 
       RowBox[{"(", 
        RowBox[{"den", "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", ":", 
            RowBox[{"Power", "[", 
             RowBox[{"_", ",", 
              RowBox[{"1", "/", "2"}]}], "]"}]}], "\[RuleDelayed]", 
           RowBox[{"-", "x"}]}], "}"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"denc", "=!=", "den"}], ",", 
        RowBox[{"Factor", "[", 
         FractionBox[
          RowBox[{"Expand", "[", 
           RowBox[{"num", "*", "denc"}], "]"}], 
          RowBox[{"Expand", "[", 
           RowBox[{"den", "*", "denc"}], "]"}]], "]"}], ",", "ex"}], 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.722164690837919*^9, 3.722164721651515*^9}, 
   3.7221667232259083`*^9, {3.722166919409831*^9, 3.72216692478305*^9}, {
   3.722166975495359*^9, 3.7221670129618196`*^9}},
 ExpressionUUID -> "bef3f82e-0aff-4478-ab02-324d7cb765f4"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Linear Algebra", "Subsection",
 CellChangeTimes->{{3.721436352321959*^9, 3.721436358529262*^9}},
 ExpressionUUID -> "46e21160-86e7-4cdc-b0c3-64bc65265b36"],

Cell[CellGroupData[{

Cell["PickBasis", "Subsubsection",
 CellChangeTimes->{3.72143631149159*^9, 3.768742637930689*^9, 
  3.768872158605191*^9},
 ExpressionUUID -> "48f25bd6-3943-4dd6-9196-0fca6f695d63"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PickBasis", "::", "usage"}], "=", 
   "\"\<PickBasis[{v1,v2,...}] constructs basis in linear span of vectors \
v1,v2,\[Ellipsis]. Basically, it removes all dependent vectors from the given \
list.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7214331268336163`*^9, 3.721433161582429*^9}, {
  3.721433192333995*^9, 3.721433257047196*^9}, {3.721433330079853*^9, 
  3.721433463066819*^9}, {3.7214335771706057`*^9, 3.721433596330242*^9}, {
  3.721434283917411*^9, 3.721434284834832*^9}, {3.768742619588826*^9, 
  3.768742619589806*^9}, {3.768872158644989*^9, 3.768872158646249*^9}},
 ExpressionUUID -> "91fffd22-e5b3-4352-9e60-eedd2f1abc4e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PickBasis", "[", 
   RowBox[{"vectors", ":", 
    RowBox[{"{", "__List", "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"r", "=", "0"}], ",", 
      RowBox[{"basis", "=", 
       RowBox[{"{", "}"}]}], ",", 
      RowBox[{"rrbasis", "=", 
       RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Scan", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"MatrixRank", "[", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"basis", ",", "#"}], "]"}], "]"}], ">", "r"}], ",", 
           RowBox[{"r", "++"}], ",", 
           RowBox[{"basis", "=", 
            RowBox[{"Most", "[", "basis", "]"}]}]}], "]"}], ")"}], "&"}], ",",
        "vectors"}], "]"}], ";", "basis"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721433466105363*^9, 3.721433509484315*^9}, {
   3.721433599010501*^9, 3.7214336096414843`*^9}, {3.7214336648170347`*^9, 
   3.721433825519891*^9}, {3.721433945086652*^9, 3.721433946207259*^9}, {
   3.7214339770069323`*^9, 3.721434013935508*^9}, {3.721434046543439*^9, 
   3.721434119927552*^9}, {3.721434249395426*^9, 3.721434309713563*^9}, 
   3.768742619604372*^9, 3.768872158676002*^9},
 ExpressionUUID -> "fd264346-02a9-4992-bbfe-dcc52b364930"]
}, Closed]],

Cell[CellGroupData[{

Cell["PickBasisMod", "Subsubsection",
 CellChangeTimes->{
  3.72143631149159*^9, {3.768741079878172*^9, 3.768741110223412*^9}, 
   3.768872158514278*^9, 3.770591623711372*^9},
 ExpressionUUID -> "48f25bd6-3943-4dd6-9196-0fca6f695d63"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PickBasisMod", "::", "usage"}], "=", "\"\<PickBasisMod[\!\(\*
StyleBox[\"{\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"2\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] picks a basis out of \!\(\*
StyleBox[\"{\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"2\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\) vectors in the field \!\(\*
StyleBox[\"\[DoubleStruckCapitalQ]\", \"TI\"]\)\!\(\*
StyleBox[\"[\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"]\", \"TI\"]\)\!\(\*
StyleBox[\"/\", \"TI\"]\)\!\(\*
StyleBox[\"p\", \"TI\"]\) where \!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is an irreducible polynomial. The order does not \
change and the left-most positions are preferable.\\nPickBasisMod[\!\(\*
StyleBox[\"{\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"2\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\),\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\),False] means that \!\(\*
StyleBox[\"{\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"2\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\) does not need QuolyMod beforehand.\>\""}]], "Code",
 CellChangeTimes->{{3.768741388605413*^9, 3.768741521569201*^9}, {
   3.768782522648741*^9, 3.768782580627307*^9}, {3.768783075668112*^9, 
   3.768783076057431*^9}, {3.768783411153558*^9, 3.7687834151616287`*^9}, 
   3.7687954923378773`*^9, {3.768872158551938*^9, 3.7688721585549097`*^9}, {
   3.768872277474669*^9, 3.768872329922799*^9}, {3.770591623743648*^9, 
   3.770591623747707*^9}, {3.770596816469907*^9, 3.77059684616422*^9}},
 ExpressionUUID -> "16c2dfc1-4b03-4b71-b8da-06837728d2cc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PickBasisMod", "[", 
   RowBox[{"evs_", ",", "poly_", ",", "x_Symbol", ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"PickBasisMod", "[", 
   RowBox[{"evs", ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "mod"}], "]"}]}]], "Input",
 CellChangeTimes->{
  3.7687819852782803`*^9, {3.768782326335408*^9, 3.768782338944708*^9}, 
   3.768872158585133*^9, 3.770591623751585*^9, {3.770593815318783*^9, 
   3.7705938404451036`*^9}, {3.770596864402431*^9, 3.770596875859071*^9}},
 ExpressionUUID -> "7725f14b-37a6-4705-8dd4-c2876a6fad46"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PickBasisMod", "[", 
   RowBox[{"evs_", ",", 
    RowBox[{"x_Symbol", "\[Rule]", " ", "poly_"}], ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"basis", "=", 
       RowBox[{"{", "}"}]}], ",", "basis1"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Scan", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"basis1", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"basis", ",", "#"}], "]"}]}], ";", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"polyKer", "[", 
              RowBox[{
               RowBox[{"Transpose", "@", "basis1"}], ",", "poly", ",", "x", 
               ",", "mod"}], "]"}], "===", 
             RowBox[{"{", "}"}]}], ",", 
            RowBox[{"basis", "=", "basis1"}]}], "]"}]}], ")"}], "&"}], ",", 
       "evs"}], "]"}], ";", "\[IndentingNewLine]", "basis"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{
  3.7687819852782803`*^9, {3.768782326335408*^9, 3.768782338944708*^9}, 
   3.768872158585133*^9, 3.770591623751585*^9, {3.770593815318783*^9, 
   3.770593849645046*^9}, {3.7705968790366497`*^9, 3.770596884034802*^9}},
 ExpressionUUID -> "7725f14b-37a6-4705-8dd4-c2876a6fad46"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PickBasisMod", "[", 
   RowBox[{"evs_", ",", "x_Symbol", ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"PickBasisMod", "[", 
   RowBox[{"evs", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}], ",", "mod"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.7705970025195913`*^9, 3.770597024287435*^9}, 
   3.7705971188063374`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["KerMod", "Subsubsection",
 CellChangeTimes->{3.768740426853785*^9, 3.770591587608233*^9},
 ExpressionUUID -> "dd100f62-c954-4b01-a89b-f102c68de0bc"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"KerMod", "::", "usage"}], "=", "\"\<KerMod[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] gives a list of nullvectors {\!\(\*SubscriptBox[
StyleBox[\"u\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"u\", \"TI\"], \"2\"]\),\[Ellipsis]} such that each \!\(\*
StyleBox[\"u\", \"TI\"]\) satisfies \!\(\*
StyleBox[\"mu\", \"TI\"]\)\!\(\*
StyleBox[\"=\", \"TI\"]\)\!\(\*
StyleBox[\"0\", \"TI\"]\)(mod \!\(\*
StyleBox[\"p\", \"TI\"]\)).\\nKerMod[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),False] assumes that \!\(\*
StyleBox[\"m\", \"TI\"]\) does not need QuolyMod beforehand.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.768740441283839*^9, 3.7687404450703087`*^9}, {
  3.768740479114036*^9, 3.76874050046574*^9}, {3.768740551791676*^9, 
  3.7687406207673807`*^9}, {3.768782417361396*^9, 3.7687824959288273`*^9}, {
  3.768782566225865*^9, 3.7687825755458603`*^9}, {3.768783079883576*^9, 
  3.7687830802831573`*^9}, {3.768783405645124*^9, 3.768783407919732*^9}, {
  3.7705915876404877`*^9, 3.770591587643261*^9}, {3.7705967173637543`*^9, 
  3.7705967427450438`*^9}},
 ExpressionUUID -> "76c7f30c-65b1-4b01-b11a-00d14a3ac094"],

Cell[BoxData[
 RowBox[{
  RowBox[{"KerMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MatrixQ"}], ",", "poly_", ",", "x_Symbol", ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"KerMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "mod"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.768781852231385*^9, 3.768781857254756*^9}, {
   3.768781997295746*^9, 3.7687820082145643`*^9}, {3.7687823474637127`*^9, 
   3.768782348544002*^9}, {3.768782393048278*^9, 3.768782399744211*^9}, 
   3.768782742162278*^9, 3.768872158379676*^9, 3.77059158765073*^9, 
   3.770591623642745*^9, {3.770593673634132*^9, 3.77059370401367*^9}, {
   3.770596763560432*^9, 3.77059677557659*^9}},
 ExpressionUUID -> "703c494a-e7d6-463e-a84d-ce0b0395ba52"],

Cell[BoxData[
 RowBox[{
  RowBox[{"KerMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"PickBasisMod", "[", 
   RowBox[{
    RowBox[{"SortBy", "[", 
     RowBox[{
      RowBox[{"polyKer", "[", 
       RowBox[{"m", ",", "poly", ",", "x", ",", "mod"}], "]"}], ",", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{"Exponent", "[", 
         RowBox[{"#", ",", "x"}], "]"}], "]"}], "&"}]}], "]"}], ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "False"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.768781852231385*^9, 3.768781857254756*^9}, {
   3.768781997295746*^9, 3.7687820082145643`*^9}, {3.7687823474637127`*^9, 
   3.768782348544002*^9}, {3.768782393048278*^9, 3.768782399744211*^9}, 
   3.768782742162278*^9, 3.768872158379676*^9, 3.77059158765073*^9, 
   3.770591623642745*^9, {3.770593673634132*^9, 3.7705936769492283`*^9}, {
   3.7705937293838243`*^9, 3.7705937353515253`*^9}, {3.770596779467442*^9, 
   3.770596798208078*^9}},
 ExpressionUUID -> "703c494a-e7d6-463e-a84d-ce0b0395ba52"],

Cell[BoxData[
 RowBox[{
  RowBox[{"KerMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MatrixQ"}], ",", "x_Symbol", ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"KerMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}], ",", "mod"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.770597152802094*^9, 3.770597177496475*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"polyKer", "[", 
   RowBox[{"m_", ",", "poly_", ",", "x_", ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"k", "=", 
       RowBox[{"Exponent", "[", 
        RowBox[{"poly", ",", "x"}], "]"}]}], ",", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"Dimensions", "[", "m", "]"}], "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ",", "id", ",", "mr", ",", "xm", 
      ",", "evs"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{"mod", ",", 
       RowBox[{"mr", "=", 
        RowBox[{"QuolyMod", "[", 
         RowBox[{"m", ",", "poly", ",", "x"}], "]"}]}], ",", 
       RowBox[{"mr", "=", "m"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"mr", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"id", "[", 
         RowBox[{"Coefficient", "[", 
          RowBox[{"mr", ",", "x", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", 
         RowBox[{"k", "-", "1"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"xm", "=", 
      RowBox[{"CoefficientList", "[", 
       RowBox[{"poly", ",", "x"}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{
      "action", " ", "of", " ", "x", " ", "as", " ", "a", " ", "matrix", " ", 
       "from", " ", "the", " ", "right"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"xm", "=", 
      RowBox[{"Append", "[", 
       RowBox[{
        RowBox[{"Rest", "[", 
         RowBox[{"IdentityMatrix", "[", "k", "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{"-", 
          RowBox[{"Most", "[", "xm", "]"}]}], "/", 
         RowBox[{"Last", "[", "xm", "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"evs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Factor", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"x", "^", 
            RowBox[{"Range", "[", 
             RowBox[{"0", ",", 
              RowBox[{"k", "-", "1"}]}], "]"}]}], ")"}], ".", 
          RowBox[{"Partition", "[", 
           RowBox[{"#", ",", "n"}], "]"}]}], "]"}], "&"}], "/@", 
       RowBox[{"OKer", "[", 
        RowBox[{"ArrayFlatten", "[", 
         RowBox[{
          RowBox[{"Transpose", "@", 
           RowBox[{"NestList", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{"#1", ",", "xm"}], "]"}], "&"}], ",", "mr", ",", 
             RowBox[{"k", "-", "1"}]}], "]"}]}], "/.", 
          RowBox[{"id", "\[Rule]", "Identity"}]}], "]"}], "]"}]}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.768781947606739*^9, 3.768781968974485*^9}, {
   3.768782254424058*^9, 3.7687823008561907`*^9}, {3.7687827464403152`*^9, 
   3.768782754914906*^9}, 3.768975653048839*^9},
 ExpressionUUID -> "f06d840b-7bdf-4eab-825c-622ed95370f1"]
}, Closed]],

Cell[CellGroupData[{

Cell["MatrixRankMod", "Subsubsection",
 CellChangeTimes->{
  3.768740426853785*^9, {3.768782615599938*^9, 3.7687826183520727`*^9}, 
   3.770591655626639*^9},
 ExpressionUUID -> "257748bf-b823-430a-8476-60b26b3cf861"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"MatrixRankMod", "::", "usage"}], "=", "\"\<MatrixRankMod[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] gives a matrix rank of \!\(\*
StyleBox[\"m\", \"TI\"]\) with entries in \!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"[\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"]\", \"TI\"]\)\!\(\*
StyleBox[\"/\", \"TI\"]\)\!\(\*
StyleBox[\"p\", \"TI\"]\).\\nMatrixRankMod[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),False] assumes that \!\(\*
StyleBox[\"m\", \"TI\"]\) does not need QuolyMod beforehand.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.768740441283839*^9, 3.7687404450703087`*^9}, {
  3.768740479114036*^9, 3.76874050046574*^9}, {3.768740551791676*^9, 
  3.7687406207673807`*^9}, {3.768782417361396*^9, 3.7687824959288273`*^9}, {
  3.768782566225865*^9, 3.7687825755458603`*^9}, {3.768782622626287*^9, 
  3.7687826826911*^9}, {3.768783071011416*^9, 3.768783071419628*^9}, {
  3.768783416477363*^9, 3.768783419133409*^9}, {3.77059165566052*^9, 
  3.77059165566315*^9}, {3.770597199523994*^9, 3.7705972172410183`*^9}},
 ExpressionUUID -> "df15a394-f292-4175-a7fa-fdc5d0adc195"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MatrixRankMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MatrixQ"}], ",", "poly_", ",", "x_Symbol", ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"MatrixRankMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "mod"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.768781852231385*^9, 3.768781857254756*^9}, {
   3.768781997295746*^9, 3.7687820082145643`*^9}, {3.7687823474637127`*^9, 
   3.768782348544002*^9}, {3.768782393048278*^9, 3.768782399744211*^9}, {
   3.768782687297694*^9, 3.7687827001292267`*^9}, {3.7687827309372177`*^9, 
   3.768782795553946*^9}, 3.770591587654963*^9, 3.7705916556667013`*^9, {
   3.770593902203371*^9, 3.770593928271633*^9}, {3.7705972485831223`*^9, 
   3.7705972637670193`*^9}},
 ExpressionUUID -> "1c6a97f7-36fa-4c8b-a415-0695c98f9124"],

Cell[BoxData[
 RowBox[{
  RowBox[{"MatrixRankMod", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"x_Symbol", "\[Rule]", "0"}], ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"MatrixRank", "[", "m", "]"}]}]], "Code",
 CellChangeTimes->{{3.770607423229467*^9, 3.7706074232302*^9}, {
  3.770607495670144*^9, 3.770607497075672*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MatrixRankMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"Length", "@", 
    RowBox[{"First", "@", "m"}]}], "-", 
   RowBox[{"Length", "[", 
    RowBox[{"KerMod", "[", 
     RowBox[{"m", ",", 
      RowBox[{"x", "\[Rule]", "poly"}]}], "]"}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.770607326014558*^9, 3.770607326015711*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"MatrixRankMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MatrixQ"}], ",", "x_Symbol", ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"MatrixRankMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}], ",", "mod"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.770597293685513*^9, 3.770597316876977*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["InverseMod", "Subsubsection",
 CellChangeTimes->{3.76878295728227*^9, 3.770591680192266*^9},
 ExpressionUUID -> "2dc51d19-c252-4c91-9bea-8fd065f0983a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"InverseMod", "::", "usage"}], "=", "\"\<InverseMod[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] gives the inverse of \!\(\*
StyleBox[\"m\", \"TI\"]\) with entries in \!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"[\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"]\", \"TI\"]\)\!\(\*
StyleBox[\"/\", \"TI\"]\)\!\(\*
StyleBox[\"p\", \"TI\"]\).\\nInverseMod[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\),False] assumes that \!\(\*
StyleBox[\"m\", \"TI\"]\) does not need QuolyMod beforehand.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.76878297908327*^9, 3.7687830652356377`*^9}, {
   3.768783420180016*^9, 3.768783422117831*^9}, {3.7705916802319107`*^9, 
   3.770591680235828*^9}, 3.770592920274486*^9, {3.7705973449264*^9, 
   3.770597352976306*^9}},
 ExpressionUUID -> "9ade307c-4a00-422a-81f3-c697a2f48a89"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InverseMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "poly_", ",", "x_Symbol", ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"InverseMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "mod"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.76878297908327*^9, 3.7687830652356377`*^9}, {
   3.768783420180016*^9, 3.768783422117831*^9}, {3.7705916802319107`*^9, 
   3.770591680235828*^9}, 3.770592920274486*^9, {3.770593956782572*^9, 
   3.770593998152163*^9}, {3.770597326117144*^9, 3.770597337092381*^9}},
 ExpressionUUID -> "9ade307c-4a00-422a-81f3-c697a2f48a89"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InverseMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "0"}], ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"OInverse", "[", "m", "]"}]}]], "Code",
 CellChangeTimes->{{3.770597393363212*^9, 3.770597421066628*^9}, 
   3.770607549366531*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"InverseMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "m1", "}"}], ",", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{"mod", ",", 
       RowBox[{"m1", "=", 
        RowBox[{"QuolyMod", "[", 
         RowBox[{"m", ",", "poly", ",", "x"}], "]"}]}], ",", 
       RowBox[{"m1", "=", "m"}]}], "]"}], ";", 
     RowBox[{"m1", "=", 
      RowBox[{"QuolyMod", "[", 
       RowBox[{
        RowBox[{"OInverse", "[", "m1", "]"}], ",", "poly", ",", "x"}], 
       "]"}]}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.76878297908327*^9, 3.7687830652356377`*^9}, {
   3.768783420180016*^9, 3.768783422117831*^9}, {3.7705916802319107`*^9, 
   3.770591680235828*^9}, 3.770592920274486*^9, {3.770593956782572*^9, 
   3.7705939803078117`*^9}, {3.7705973657195873`*^9, 3.770597372107637*^9}},
 ExpressionUUID -> "9ade307c-4a00-422a-81f3-c697a2f48a89"],

Cell[BoxData[
 RowBox[{
  RowBox[{"InverseMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "x_Symbol", ",", 
    RowBox[{"mod", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "True"}]}], "]"}], ":=", 
  RowBox[{"InverseMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}], ",", "mod"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.770597487073666*^9, 3.770597514761663*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["EValues", "Subsubsection",
 CellChangeTimes->{
  3.768719330592369*^9, 3.768806004709882*^9, {3.7688060349172792`*^9, 
   3.768806035229718*^9}, 3.770591764754367*^9, {3.770594027292367*^9, 
   3.770594031902198*^9}, {3.7705975258807707`*^9, 3.770597527160129*^9}},
 ExpressionUUID -> "8c17c1bb-9c83-4a04-ab12-e6833de13ff5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EValues", "::", "usage"}], "=", "\"\<EValues[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives a list of the eigenvalues of the square \
matrix \!\(\*
StyleBox[\"m\", \"TI\"]\). Supposed to be faster than native \
Eigenvalues.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.768806509831483*^9, 3.768806564088584*^9}, 
   3.768924661064526*^9},
 ExpressionUUID -> "96f3dcd1-f5d1-462b-9001-3aa69f4c2515"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EValues", "[", "m_", "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"chpoly", ",", "a"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"chpoly", "=", 
      RowBox[{"Factor", "@", 
       RowBox[{"ODet", "[", 
        RowBox[{
         RowBox[{"a", "*", 
          RowBox[{"IdentityMatrix", "[", 
           RowBox[{"Length", "@", "m"}], "]"}]}], "-", "m"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Replace", "[", 
        RowBox[{"a", ",", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Replace", "[", 
        RowBox[{
         RowBox[{"Factors", "@", "chpoly"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"FreeQ", "[", 
                RowBox[{"#", ",", "a"}], "]"}], "&"}], ")"}]}], 
            "\[RuleDelayed]", 
            RowBox[{"Sequence", "[", "]"}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"p_", ",", "n_"}], "}"}], "\[RuleDelayed]", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"Solve", "[", 
               RowBox[{
                RowBox[{"p", "\[Equal]", "0"}], ",", "a"}], "]"}], ",", "n"}],
              "]"}]}]}], "}"}], ",", 
         RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]",
    "]"}]}]], "Code",
 CellChangeTimes->{{3.7688060438791447`*^9, 3.768806048790637*^9}, {
  3.768806274808461*^9, 3.768806313895953*^9}, {3.768974044289527*^9, 
  3.7689740603803453`*^9}, {3.7689746246714287`*^9, 3.768974646897232*^9}, {
  3.770597542826556*^9, 3.77059755420179*^9}},
 ExpressionUUID -> "bcf1205c-f61f-497d-8175-f1463763e6bd"]
}, Closed]],

Cell[CellGroupData[{

Cell["EValuesMod", "Subsubsection",
 CellChangeTimes->{3.770597531763319*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"EValuesMod", "::", "usage"}], "=", "\"\<EValuesMod[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] gives a list of the eigenvalues of the square \
matrix \!\(\*
StyleBox[\"m\", \"TI\"]\) with entries in the field \!\(\*
StyleBox[\"Q\", \"TI\"]\)\!\(\*
StyleBox[\"[\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"]\", \"TI\"]\)\!\(\*
StyleBox[\"/\", \"TI\"]\)\!\(\*
StyleBox[\"p\", \"TI\"]\) where \!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is an irreducible polynomial. An eigenvalue \!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\) is defined as a root of \!\(\*
StyleBox[\"|\", \"TI\"]\)\!\(\*
StyleBox[\"m\", \"TI\"]\)\!\(\*
StyleBox[\"-\", \"TI\"]\)\!\(\*
StyleBox[\"\[Lambda]P\", \"TI\"]\)\!\(\*
StyleBox[\"'\", \"TI\"]\)\!\(\*
StyleBox[\"|\", \"TI\"]\)\!\(\*
StyleBox[\"=\", \"TI\"]\)\!\(\*
StyleBox[\"0\", \"TI\"]\)(mod \!\(\*
StyleBox[\"p\", \"TI\"]\)) provided that this root is independent of \!\(\*
StyleBox[\"x\", \"TI\"]\).\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EValuesMod", "::", "error"}], "=", 
   "\"\<Can not determine eigenvalues. Aborting...\>\""}], ";"}]}], "Code",
 CellChangeTimes->{
  3.7687196905117683`*^9, {3.7687248281887093`*^9, 3.768724837880165*^9}, {
   3.768740452882736*^9, 3.768740461750635*^9}, {3.768740503521028*^9, 
   3.768740505412022*^9}, 3.76874161892904*^9, {3.7687834234521017`*^9, 
   3.768783427888205*^9}, {3.7688060047604513`*^9, 3.7688060047625923`*^9}, {
   3.768806473474258*^9, 3.7688065212022247`*^9}, {3.770591764795714*^9, 
   3.770591764798189*^9}, {3.770597560172262*^9, 3.770597572621764*^9}},
 ExpressionUUID -> "638f25ac-2ad7-4ea1-bfc1-3106190c8867"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EValuesMod", "[", 
   RowBox[{"m_", ",", "poly_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"EValuesMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]], "Input",
 CellChangeTimes->{
  3.7687196905117683`*^9, {3.7687248281887093`*^9, 3.768724837880165*^9}, {
   3.768740452882736*^9, 3.768740461750635*^9}, {3.768740503521028*^9, 
   3.768740505412022*^9}, 3.76874161892904*^9, {3.768741979550489*^9, 
   3.768741980382379*^9}, {3.768794674174324*^9, 3.768794720342029*^9}, {
   3.7688060047971697`*^9, 3.76880600479841*^9}, {3.76897397224675*^9, 
   3.7689740206779013`*^9}, {3.768974680942113*^9, 3.768974700467558*^9}, {
   3.770591764802006*^9, 3.770591764803639*^9}, {3.770594042793298*^9, 
   3.770594061330132*^9}, {3.770597585977557*^9, 3.770597590441291*^9}},
 ExpressionUUID -> "3560ad0e-926e-43fa-afe5-871a92de4caf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EValuesMod", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"x_Symbol", "\[Rule]", "0"}]}], "]"}], ":=", 
  RowBox[{"EValues", "[", "m", "]"}]}]], "Code",
 CellChangeTimes->{{3.770597610849267*^9, 3.770597620288872*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"EValuesMod", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"chpoly", ",", "a"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"chpoly", "=", 
      RowBox[{"Factor", "@", 
       RowBox[{"QuolyMod", "[", 
        RowBox[{"(*", 
         RowBox[{"Modified", " ", "08.06", ".2019"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"(*", 
          RowBox[{"Deleted", " ", "08.06", ".2019"}], "*)"}], 
         RowBox[{
          RowBox[{"CharacteristicPolynomial", "[", 
           RowBox[{"m", ",", "a"}], "]"}], "/.", 
          RowBox[{"a", "\[Rule]", 
           RowBox[{"a", " ", 
            RowBox[{"D", "[", 
             RowBox[{"poly", ",", "x"}], "]"}]}]}]}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "Deleted"}], " ", "08.06", ".2019"}], "*)"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ODet", "[", 
          RowBox[{
           RowBox[{"a", "*", 
            RowBox[{"D", "[", 
             RowBox[{"poly", ",", "x"}], "]"}], "*", 
            RowBox[{"IdentityMatrix", "[", 
             RowBox[{"Length", "@", "m"}], "]"}]}], "-", "m"}], "]"}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "Modified"}], " ", "08.06", ".2019"}], "*)"}], ",", 
         "poly", ",", "x"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"Replace", "[", 
        RowBox[{"a", ",", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Replace", "[", 
        RowBox[{
         RowBox[{"Factors", "@", "chpoly"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"_", "?", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"FreeQ", "[", 
                RowBox[{"#", ",", "a"}], "]"}], "&"}], ")"}]}], 
            "\[RuleDelayed]", 
            RowBox[{"Sequence", "[", "]"}]}], ",", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"p_", "?", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"#", ",", "x"}], "]"}], "&"}], ")"}]}], ",", "n_"}],
              "}"}], "\[RuleDelayed]", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{
              RowBox[{"Solve", "[", 
               RowBox[{
                RowBox[{"p", "\[Equal]", "0"}], ",", "a"}], "]"}], ",", "n"}],
              "]"}]}], ",", 
           RowBox[{"_", "\[RuleDelayed]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Message", "[", 
               RowBox[{"EValuesMod", "::", "error"}], "]"}], ";", 
              RowBox[{"Abort", "[", "]"}]}], ")"}]}]}], "}"}], ",", 
         RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]",
    "]"}]}]], "Code",
 CellChangeTimes->{
  3.7687196905117683`*^9, {3.7687248281887093`*^9, 3.768724837880165*^9}, {
   3.768740452882736*^9, 3.768740461750635*^9}, {3.768740503521028*^9, 
   3.768740505412022*^9}, 3.76874161892904*^9, {3.768741979550489*^9, 
   3.768741980382379*^9}, {3.768794674174324*^9, 3.768794720342029*^9}, {
   3.7688060047971697`*^9, 3.76880600479841*^9}, {3.76897397224675*^9, 
   3.7689740206779013`*^9}, {3.768974680942113*^9, 3.768974700467558*^9}, {
   3.770591764802006*^9, 3.770591764803639*^9}, {3.770594042793298*^9, 
   3.770594072834403*^9}, {3.770597596835067*^9, 3.77059760265864*^9}},
 ExpressionUUID -> "3560ad0e-926e-43fa-afe5-871a92de4caf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EValuesMod", "[", 
   RowBox[{"m_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"EValuesMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.7705976330011873`*^9, 3.770597652394979*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["ESpace", "Subsubsection",
 CellChangeTimes->{3.7705976669063683`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ESpace", "::", "usage"}], "=", "\"\<ESpace[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\)] gives a list of the eigenvectors \
{\!\(\*SubscriptBox[
StyleBox[\"u\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"u\", \"TI\"], \"2\"]\),\[Ellipsis]} corresponding to the \
eigenvalue \!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\). Last argument can also be a list of \
eigenvalues, All, or omitted (=All).\>\""}]], "Code",
 CellChangeTimes->{{3.76880663417828*^9, 3.768806634180694*^9}, {
  3.7688066753843193`*^9, 3.768806698569655*^9}, {3.77059776994186*^9, 
  3.7705977741150627`*^9}},
 ExpressionUUID -> "4de68070-3090-4345-82d7-84b46a334e35"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ESpace", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "\[Lambda]_"}], "]"}], ":=", 
  RowBox[{"OKer", "[", 
   RowBox[{"m", "-", 
    RowBox[{"\[Lambda]", " ", 
     RowBox[{"IdentityMatrix", "[", 
      RowBox[{"Length", "@", "m"}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.7688067178978777`*^9, 3.768806740888883*^9}, 
   3.768975659088908*^9},
 ExpressionUUID -> "f396303b-7995-425d-ad59-391666735fc0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ESpace", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "\[Lambda]s_List"}], "]"}], ":=", 
  RowBox[{"Join", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"ESpace", "[", 
       RowBox[{"m", ",", "#"}], "]"}], "&"}], "/@", "\[Lambda]s"}], 
    ")"}]}]}]], "Code",
 CellChangeTimes->{{3.768741836993352*^9, 3.7687419087673597`*^9}, {
  3.7688066067833633`*^9, 3.768806606784294*^9}, {3.768807054059492*^9, 
  3.76880708096338*^9}},
 ExpressionUUID -> "8b1fa87a-c857-4cf1-b4f1-2cb664daceb0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ESpace", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "All"}], "]"}], ":=", 
  RowBox[{"Join", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"ESpace", "[", 
       RowBox[{"m", ",", "#"}], "]"}], "&"}], "/@", 
     RowBox[{"DeleteDuplicates", "[", 
      RowBox[{"EValues", "[", "m", "]"}], "]"}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ESpace", "[", 
   RowBox[{"m_", "?", "SquareMatrixQ"}], "]"}], ":=", 
  RowBox[{"ESpace", "[", 
   RowBox[{"m", ",", "All"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.7687419308926773`*^9, 3.768741931465435*^9}, {
   3.768741991604885*^9, 3.7687420012692413`*^9}, 3.768806004809857*^9, {
   3.7688066067895403`*^9, 3.768806606791823*^9}, {3.768807057835548*^9, 
   3.7688071017315187`*^9}, {3.7688071510448017`*^9, 3.768807165198235*^9}, {
   3.768807201020444*^9, 3.768807201757132*^9}, {3.768807297933837*^9, 
   3.7688072995252542`*^9}},
 ExpressionUUID -> "b69afc66-d312-4abd-9e0b-cdcc3ba88721"]
}, Closed]],

Cell[CellGroupData[{

Cell["ESpaceMod", "Subsubsection",
 CellChangeTimes->{
  3.7687246036889963`*^9, {3.7688066067486687`*^9, 3.768806629240382*^9}, 
   3.770591807588134*^9, {3.7705976632394133`*^9, 3.770597675519224*^9}},
 ExpressionUUID -> "c1d95dce-45ce-43f0-a9c7-f065bb6e4293"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ESpaceMod", "::", "usage"}], "=", "\"\<ESpaceMod[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\)] gives a list of the eigenvectors \
{\!\(\*SubscriptBox[
StyleBox[\"u\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"u\", \"TI\"], \"2\"]\),\[Ellipsis]} corresponding to the \
eigenvalue \!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\). Each \!\(\*
StyleBox[\"u\", \"TI\"]\) is such that (\!\(\*
StyleBox[\"m\", \"TI\"]\)\!\(\*
StyleBox[\"-\", \"TI\"]\)\!\(\*
StyleBox[\"\[Lambda]P\", \"TI\"]\)\!\(\*
StyleBox[\"'\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"u\", \"TI\"]\)\!\(\*
StyleBox[\"=\", \"TI\"]\)\!\(\*
StyleBox[\"0\", \"TI\"]\)(mod \!\(\*
StyleBox[\"p\", \"TI\"]\)). Last argument can also be a list of eigenvalues, \
All, or omitted (=All).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.768724618568975*^9, 3.768724792199421*^9}, {
   3.7687248444599543`*^9, 3.768724844736031*^9}, {3.768783429145577*^9, 
   3.768783430269642*^9}, 3.768806004804305*^9, 3.768806606757988*^9, {
   3.768806650266204*^9, 3.768806654849883*^9}, 3.7688066874110203`*^9, {
   3.7705918076343803`*^9, 3.770591807635902*^9}, {3.770597689500883*^9, 
   3.770597761515143*^9}},
 ExpressionUUID -> "6b0f2e33-ccba-4ee8-9281-49b363a34201"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ESpaceMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"poly", ":", 
     RowBox[{"Except", "[", "_Rule", "]"}]}], ",", "x_Symbol", ",", "a_"}], 
   "]"}], ":=", 
  RowBox[{"ESpaceMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "a"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7705941461163473`*^9, 3.770594187579526*^9}, {
   3.7705943033991213`*^9, 3.770594311159607*^9}, {3.770594347423698*^9, 
   3.7705943873583927`*^9}, 3.7705988821117477`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ESpaceMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", "\[Lambda]_"}], "]"}], ":=", 
  RowBox[{"KerMod", "[", 
   RowBox[{
    RowBox[{"m", "-", 
     RowBox[{"\[Lambda]", " ", 
      RowBox[{"IdentityMatrix", "[", 
       RowBox[{"Length", "@", "m"}], "]"}], " ", 
      RowBox[{"D", "[", 
       RowBox[{"poly", ",", "x"}], "]"}]}]}], ",", 
    RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]], "Code",
 CellChangeTimes->{
  3.768741836993352*^9, {3.7687419642839527`*^9, 3.768741975165471*^9}, {
   3.7687818368708277`*^9, 3.7687818417975063`*^9}, 3.768806606779379*^9, 
   3.770591587659186*^9, 3.770591807644693*^9, {3.770594195018255*^9, 
   3.770594234328915*^9}, {3.770594405870534*^9, 3.770594406166161*^9}, {
   3.7705944512309628`*^9, 3.7705944570894003`*^9}, {3.770599313388797*^9, 
   3.7705993174041843`*^9}},
 ExpressionUUID -> "51f69be1-6efd-4573-a8df-c6629a94a77d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ESpaceMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", "\[Lambda]s_List"}], "]"}],
   ":=", 
  RowBox[{"Join", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"ESpaceMod", "[", 
       RowBox[{"m", ",", 
        RowBox[{"x", "\[Rule]", "poly"}], ",", "#"}], "]"}], "&"}], "/@", 
     "\[Lambda]s"}], ")"}]}]}]], "Code",
 CellChangeTimes->{{3.768741836993352*^9, 3.7687419087673597`*^9}, {
   3.7688066067833633`*^9, 3.768806606784294*^9}, {3.770591807649909*^9, 
   3.7705918076511097`*^9}, 3.7705942168283777`*^9, 3.770594465631089*^9, {
   3.770599329134633*^9, 3.7705993301405993`*^9}},
 ExpressionUUID -> "fef5b760-5060-4cb6-9410-8fe53b676d8f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ESpaceMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", "All"}], "]"}], ":=", 
  RowBox[{"Join", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"ESpaceMod", "[", 
       RowBox[{"m", ",", 
        RowBox[{"x", "\[Rule]", "poly"}], ",", "#"}], "]"}], "&"}], "/@", 
     RowBox[{"DeleteDuplicates", "[", 
      RowBox[{"EValuesMod", "[", 
       RowBox[{"m", ",", 
        RowBox[{"x", "\[Rule]", "poly"}]}], "]"}], "]"}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ESpaceMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}]}], "]"}], ":=", 
  RowBox[{"ESpaceMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "All"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.7687419308926773`*^9, 3.768741931465435*^9}, {
   3.768741991604885*^9, 3.7687420012692413`*^9}, 3.768806004809857*^9, {
   3.7688066067895403`*^9, 3.768806606791823*^9}, {3.7688071179560223`*^9, 
   3.768807141915946*^9}, {3.768807288269425*^9, 3.7688072937091618`*^9}, 
   3.770591764808823*^9, {3.770591807655037*^9, 3.770591807657733*^9}, {
   3.770599347895843*^9, 3.770599374533354*^9}},
 ExpressionUUID -> "121de9ab-f576-464d-8d6e-4f6a61d02939"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ESpaceMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "x_Symbol", ",", "a___"}], 
   "]"}], ":=", 
  RowBox[{"ESpaceMod", "[", 
   RowBox[{"m", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}], ",", "a"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.7706103606167*^9, 3.77061038560061*^9}}],

Cell[BoxData[{
 RowBox[{"done", "[", "\"\<ESpaceMod: remove linearly dependent vectors.\>\"",
   "]"}], "\[IndentingNewLine]", 
 RowBox[{"done", "[", "\"\<ESpaceMod: allow for a list of \[Lambda]s.\>\"", 
  "]"}]}], "Code",
 CellChangeTimes->{{3.768724854193894*^9, 3.7687249057841253`*^9}, {
  3.7687418463735237`*^9, 3.768741847057191*^9}, {3.768742017036272*^9, 
  3.768742017777637*^9}, {3.7688066067977324`*^9, 3.768806606799374*^9}, {
  3.770591807661642*^9, 3.7705918076627903`*^9}},
 ExpressionUUID -> "f42882a1-80d4-4bb0-a4ff-f3f0346154dd"]
}, Closed]],

Cell[CellGroupData[{

Cell["Projector", "Subsubsection",
 CellChangeTimes->{3.770599396517441*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Projector", "::", "usage"}], "=", "\"\<Projector[\!\(\*
StyleBox[\"ulist\", \"TI\"]\)\!\(\*
StyleBox[\":\", \"TI\"]\)\!\(\*
StyleBox[\"{\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"2\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"vlist\", \"TI\"]\)\!\(\*
StyleBox[\":\", \"TI\"]\)\!\(\*
StyleBox[\"{\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[\"v\", \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[\"v\", \"2\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\),\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] constructs a projector \!\(\*
StyleBox[\"P\", \"TI\"]\) with prescribed image and coimage.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.721365900431781*^9, 3.721365947592453*^9}, {
  3.7692028516421957`*^9, 3.769202903107856*^9}},
 ExpressionUUID -> "259a7788-e71c-4ffe-828a-3133eec2fc06"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Projector", "[", 
   RowBox[{"u_", ",", "v_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ut", "=", 
      RowBox[{"Transpose", "@", "u"}]}], "}"}], ",", 
    RowBox[{"Check", "[", 
     RowBox[{
      RowBox[{"ODot", "[", 
       RowBox[{"ut", ",", 
        RowBox[{"OInverse", "@", 
         RowBox[{"Dot", "[", 
          RowBox[{"v", ",", "ut"}], "]"}]}], ",", "v"}], "]"}], ",", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Length", "@", 
           RowBox[{"First", "[", "v", "]"}]}], ",", 
          RowBox[{"Length", "@", "ut"}]}], "}"}]}], "]"}]}], "]"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721365791957514*^9, 3.721365882259264*^9}, 
   3.7213662361211977`*^9, {3.72144926966628*^9, 3.721449331259104*^9}, {
   3.721682953645527*^9, 3.721682983574337*^9}, {3.727743963350501*^9, 
   3.7277439809319572`*^9}, {3.7277455396473417`*^9, 3.72774554194532*^9}, 
   3.727745729685837*^9, 3.769036579534986*^9},
 ExpressionUUID -> "1ca840b3-857a-4841-9913-b8de5c3da9d3"]
}, Closed]],

Cell[CellGroupData[{

Cell["ProjectorMod", "Subsubsection",
 CellChangeTimes->{
  3.768783156083009*^9, {3.7692028402379*^9, 3.769202842517776*^9}, 
   3.770591843756907*^9, {3.770599393610825*^9, 3.7705994120265017`*^9}},
 ExpressionUUID -> "e7de72db-050f-4ca5-aa57-b443984f1c44"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ProjectorMod", "::", "usage"}], "=", "\"\<ProjectorMod[\!\(\*
StyleBox[\"ulist\", \"TI\"]\)\!\(\*
StyleBox[\":\", \"TI\"]\)\!\(\*
StyleBox[\"{\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[
StyleBox[\"u\", \"TI\"], \"2\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"vlist\", \"TI\"]\)\!\(\*
StyleBox[\":\", \"TI\"]\)\!\(\*
StyleBox[\"{\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[\"v\", \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[\"v\", \"2\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] constructs a projector \!\(\*
StyleBox[\"P\", \"TI\"]\) with prescribed image and coimage with entries in \
\!\(\*
StyleBox[\"\[DoubleStruckCapitalQ]\", \"TI\"]\)\!\(\*
StyleBox[\"[\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"]\", \"TI\"]\)\!\(\*
StyleBox[\"/\", \"TI\"]\)\!\(\*
StyleBox[\"p\", \"TI\"]\).\\nNote that if one of \!\(\*
StyleBox[\"ulist\", \"TI\"]\) or \!\(\*
StyleBox[\"vlist\", \"TI\"]\) is independent of \!\(\*
StyleBox[\"x\", \"TI\"]\), \!\(\*
StyleBox[\"P\", \"TI\"]\) is also a projector in the usual sense.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.768781037458825*^9, 3.7687811614270353`*^9}, {
   3.768781307483285*^9, 3.768781387283873*^9}, {3.768781419011951*^9, 
   3.7687814964044447`*^9}, {3.7687815329333057`*^9, 3.768781687813046*^9}, 
   3.768781719837174*^9, {3.768783166260027*^9, 3.7687831732598867`*^9}, {
   3.7687832215165052`*^9, 3.768783367830287*^9}, {3.768783432458682*^9, 
   3.768783433620866*^9}, {3.76878355631071*^9, 3.7687835953175163`*^9}, {
   3.76920291500767*^9, 3.769202915267366*^9}, {3.7705918437981577`*^9, 
   3.770591843800089*^9}, {3.7705994141358223`*^9, 3.7705994258541193`*^9}},
 ExpressionUUID -> "f396581d-a8bf-4361-969e-8b02b216ceaa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ProjectorMod", "::", "error"}], "=", 
   "\"\<Can not construct projector.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.768781037458825*^9, 3.7687811614270353`*^9}, {
   3.768781307483285*^9, 3.768781387283873*^9}, {3.768781419011951*^9, 
   3.7687814964044447`*^9}, {3.7687815329333057`*^9, 3.768781687813046*^9}, 
   3.768781719837174*^9, {3.768783166260027*^9, 3.7687831732598867`*^9}, 
   3.770591680244108*^9, {3.770591843804163*^9, 3.7705918438097982`*^9}, {
   3.770599451260324*^9, 3.770599467891964*^9}},
 ExpressionUUID -> "b258439c-7033-4889-ac37-d65e9156d29a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ProjectorMod", "[", 
   RowBox[{"u_", ",", "v_", ",", "poly_", ",", "x_"}], "]"}], ":=", 
  RowBox[{"ProjectorMod", "[", 
   RowBox[{"u", ",", "v", ",", 
    RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.768781037458825*^9, 3.7687811614270353`*^9}, {
   3.768781307483285*^9, 3.768781387283873*^9}, {3.768781419011951*^9, 
   3.7687814964044447`*^9}, {3.7687815329333057`*^9, 3.768781687813046*^9}, 
   3.768781719837174*^9, {3.768783166260027*^9, 3.7687831732598867`*^9}, 
   3.770591680244108*^9, {3.770591843804163*^9, 3.7705918438097982`*^9}, {
   3.770599451260324*^9, 3.770599494627674*^9}},
 ExpressionUUID -> "b258439c-7033-4889-ac37-d65e9156d29a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ProjectorMod", "[", 
   RowBox[{"u_List", ",", "v_List", ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"md", ",", 
      RowBox[{"ut", "=", 
       RowBox[{"Transpose", "[", "u", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Check", "[", 
      RowBox[{
       RowBox[{"md", "=", 
        RowBox[{"InverseMod", "[", 
         RowBox[{
          RowBox[{"ODot", "[", 
           RowBox[{"v", ",", "ut"}], "]"}], ",", 
          RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"ProjectorMod", "::", "error"}], "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "@", 
              RowBox[{"First", "[", "v", "]"}]}], ",", 
             RowBox[{"Length", "@", "ut"}]}], "}"}]}], "]"}], "]"}]}]}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"OQuolyMod", "[", 
      RowBox[{
       RowBox[{"ODot", "[", 
        RowBox[{"ut", ",", "md", ",", "v"}], "]"}], ",", "poly", ",", "x"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.768781037458825*^9, 3.7687811614270353`*^9}, {
   3.768781307483285*^9, 3.768781387283873*^9}, {3.768781419011951*^9, 
   3.7687814964044447`*^9}, {3.7687815329333057`*^9, 3.768781687813046*^9}, 
   3.768781719837174*^9, {3.768783166260027*^9, 3.7687831732598867`*^9}, 
   3.770591680244108*^9, {3.770591843804163*^9, 3.7705918438097982`*^9}, {
   3.770599451260324*^9, 3.77059954667566*^9}, {3.770602572726923*^9, 
   3.7706025757835197`*^9}},
 ExpressionUUID -> "b258439c-7033-4889-ac37-d65e9156d29a"]
}, Closed]],

Cell[CellGroupData[{

Cell["JDTowers,JDSpace", "Subsubsection",
 CellChangeTimes->{{3.768873749394401*^9, 3.7688737616824923`*^9}},
 ExpressionUUID -> "f05fb85b-4d6c-47eb-ace9-bfea50b514f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDTowers", "::", "usage"}], "=", "\"\<JDTowers[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives the towers {\!\(\*SubscriptBox[
StyleBox[\"t\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"t\", \"TI\"], \"2\"]\),\[Ellipsis]}with each tower \
\!\(\*SubscriptBox[
StyleBox[\"t\", \"TI\"], 
StyleBox[\"k\", \"TI\"]]\) being a list of generalized eigenvectors \
corresponding to one Jordan cell. JDTowers[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\)] does the same for the Jordan cells with \
eigenvalue \!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7699195398204412`*^9, 3.769919540293202*^9}, {
  3.7699195749662323`*^9, 3.769919759518735*^9}, {3.769919800551921*^9, 
  3.769919865550555*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"JDTowers", "[", "r_", "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"JDTowers", "[", 
        RowBox[{"r", ",", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"DeleteDuplicates", "@", 
       RowBox[{"EValues", "[", "r", "]"}]}]}], ",", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JDTowers", "[", 
    RowBox[{"r_", ",", "All"}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"JDTowers", "[", 
        RowBox[{"r", ",", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"DeleteDuplicates", "@", 
       RowBox[{"EValues", "[", "r", "]"}]}]}], ",", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JDTowers", "[", 
    RowBox[{
     RowBox[{"r_", "?", "SquareMatrixQ"}], ",", "evs_List"}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"JDTowers", "[", 
        RowBox[{"r", ",", "#"}], "]"}], "&"}], "/@", "evs"}], ",", "1"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JDTowers", "[", 
   RowBox[{
    RowBox[{"r_", "?", "SquareMatrixQ"}], ",", "ev_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vecs", ",", "vecs1", ",", "vecs2", ",", 
      RowBox[{"l", "=", 
       RowBox[{"Length", "[", "r", "]"}]}], ",", "m", ",", 
      RowBox[{"k", "=", "0"}], ",", "ns", ",", 
      RowBox[{"plist", "=", 
       RowBox[{"{", "}"}]}], ",", "rlist", ",", "evs"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"patternQ", "[", "ev", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"JDTowers", "[", 
         RowBox[{"r", ",", 
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"EValues", "[", "r", "]"}]}], ",", "ev"}], "]"}]}], 
         "]"}], "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
     RowBox[{"m", "=", 
      RowBox[{"r", "-", 
       RowBox[{
        RowBox[{"IdentityMatrix", "[", "l", "]"}], "*", "ev"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vecs", "=", 
      RowBox[{"OKer", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vecs", "]"}], ">", "k"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"plist", ",", 
          RowBox[{
           RowBox[{"Length", "[", "vecs", "]"}], "-", "k"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"k", "=", 
         RowBox[{"Length", "@", "vecs"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"vecs1", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"ns", "=", 
              RowBox[{"OKer", "[", "vecs", "]"}]}], ")"}], "===", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"IdentityMatrix", "[", "l", "]"}], ",", 
           RowBox[{"SortBy", "[", 
            RowBox[{
             RowBox[{"OKer", "[", 
              RowBox[{"ODot", "[", 
               RowBox[{"ns", ",", "m"}], "]"}], "]"}], ",", "ByteCount"}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Scan", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"vecs2", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"vecs", ",", "#"}], "]"}]}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MatrixRank", "[", "vecs2", "]"}], "===", 
                RowBox[{"Length", "[", "vecs2", "]"}]}], ",", 
               RowBox[{
                RowBox[{"vecs", "=", "vecs2"}], ";"}]}], "]"}]}], ")"}], 
           "&"}], ",", "vecs1"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"plist", "===", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"rlist", "=", 
      RowBox[{"PartitionByLengths", "[", 
       RowBox[{"vecs", ",", "plist"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"rlist", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"ODot", "[", 
           RowBox[{
            RowBox[{"rlist", "[", 
             RowBox[{"[", 
              RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
            RowBox[{"Transpose", "@", "m"}]}], "]"}], ",", 
          RowBox[{"rlist", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"Length", "@", "rlist"}], "-", "1"}], ",", "1", ",", 
         RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"rlist", "=", 
      RowBox[{"PartitionByLengths", "[", 
       RowBox[{
        RowBox[{"PickBasis", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"rlist", ",", "1"}], "]"}], "]"}], ",", "plist"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"TransposeYoungTableau", "[", "rlist", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.76881717975156*^9, 3.768817185086499*^9}, {
   3.7688172153690567`*^9, 3.768817236061391*^9}, {3.7688173262133427`*^9, 
   3.7688173441089563`*^9}, {3.768817497449255*^9, 3.768817504864161*^9}, 
   3.768817549116563*^9, {3.7688177257194777`*^9, 3.768817824714473*^9}, {
   3.768817875400056*^9, 3.768817926256122*^9}, 3.7688180300913153`*^9, 
   3.76881808699928*^9, {3.768818250407323*^9, 3.7688185009041147`*^9}, {
   3.768866734242364*^9, 3.768866760544333*^9}, {3.768867220901362*^9, 
   3.768867270302534*^9}, {3.7688680228543663`*^9, 3.7688680469572144`*^9}, {
   3.768868081550583*^9, 3.7688680864599257`*^9}, {3.76886814590767*^9, 
   3.768868271035838*^9}, {3.768868310260391*^9, 3.76886831748416*^9}, {
   3.768868357845221*^9, 3.7688684275260344`*^9}, {3.768868487343979*^9, 
   3.768868495232195*^9}, {3.768870052987796*^9, 3.7688700620818577`*^9}, {
   3.768872564802931*^9, 3.7688725658506823`*^9}, {3.7688727933102016`*^9, 
   3.768872794453266*^9}, {3.768872935677216*^9, 3.7688731241489*^9}, {
   3.768873644212284*^9, 3.7688736472818813`*^9}, {3.76887375161091*^9, 
   3.768873767629534*^9}, {3.768876087153646*^9, 3.76887608777737*^9}, {
   3.76887657289977*^9, 3.768876595995512*^9}, {3.768876673691757*^9, 
   3.768876678997583*^9}, {3.76887671021259*^9, 3.7688767891404552`*^9}, {
   3.768876827941901*^9, 3.768876881949615*^9}, {3.7688773578789988`*^9, 
   3.768877485046524*^9}, {3.76887778572609*^9, 3.7688777873503838`*^9}, {
   3.768877835127151*^9, 3.768877835294433*^9}, {3.768877950654986*^9, 
   3.76887795969487*^9}, {3.768919180870934*^9, 3.768919183469183*^9}, {
   3.7689193757285643`*^9, 3.76891937721277*^9}, {3.768946406023687*^9, 
   3.768946421716044*^9}, {3.7689756643913727`*^9, 3.768975671288314*^9}, {
   3.769000151516795*^9, 3.769000178700732*^9}, {3.7690320919153147`*^9, 
   3.769032095503166*^9}, {3.7709536063833027`*^9, 3.7709536157838573`*^9}, {
   3.770953735248362*^9, 3.770953796020996*^9}, {3.770954270485478*^9, 
   3.7709542732304153`*^9}, {3.7709546507931223`*^9, 
   3.7709547114767523`*^9}, {3.770954786790689*^9, 3.7709548148035316`*^9}, {
   3.770954864182334*^9, 3.77095490791465*^9}, {3.7709549635834627`*^9, 
   3.770954981726318*^9}, {3.770955033189105*^9, 3.770955063127386*^9}, 
   3.770958453677499*^9},
 ExpressionUUID -> "7dd423f5-d48c-4d65-96f3-7ff752f2c102"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDSpace", "::", "usage"}], "=", "\"\<JDSpace[\!\(\*
StyleBox[\"...\", \"TI\"]\)] is simply a shortcut for Flatten[JDTowers[\!\(\*
StyleBox[\"...\", \"TI\"]\)],1]. See ?JDTowers. Note that \!\(\*
StyleBox[\"t\", \"TI\"]\)=Transpose@JDSpace[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives the transformation to Jordan form.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7699195398204412`*^9, 3.769919540293202*^9}, {
  3.7699195749662323`*^9, 3.769919759518735*^9}, {3.769919800551921*^9, 
  3.769919865550555*^9}, {3.769919896355233*^9, 3.769920028639636*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDSpace", "[", 
   RowBox[{
    RowBox[{"r_", "?", "SquareMatrixQ"}], ",", "a___"}], "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"JDTowers", "[", 
     RowBox[{"r", ",", "a"}], "]"}], ",", "1"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.76881717975156*^9, 3.768817185086499*^9}, {
   3.7688172153690567`*^9, 3.768817236061391*^9}, {3.7688173262133427`*^9, 
   3.7688173441089563`*^9}, {3.768817497449255*^9, 3.768817504864161*^9}, 
   3.768817549116563*^9, {3.7688177257194777`*^9, 3.768817824714473*^9}, {
   3.768817875400056*^9, 3.768817926256122*^9}, 3.7688180300913153`*^9, 
   3.76881808699928*^9, {3.768818250407323*^9, 3.7688185009041147`*^9}, {
   3.768866734242364*^9, 3.768866760544333*^9}, {3.768867220901362*^9, 
   3.768867270302534*^9}, {3.7688680228543663`*^9, 3.7688680469572144`*^9}, {
   3.768868081550583*^9, 3.7688680864599257`*^9}, {3.76886814590767*^9, 
   3.768868271035838*^9}, {3.768868310260391*^9, 3.76886831748416*^9}, {
   3.768868357845221*^9, 3.7688684275260344`*^9}, {3.768868487343979*^9, 
   3.768868495232195*^9}, {3.768870052987796*^9, 3.7688700620818577`*^9}, {
   3.768872564802931*^9, 3.7688725658506823`*^9}, {3.7688727933102016`*^9, 
   3.768872794453266*^9}, {3.768872935677216*^9, 3.7688731241489*^9}, {
   3.768873644212284*^9, 3.7688736472818813`*^9}, {3.76887375161091*^9, 
   3.768873767629534*^9}},
 ExpressionUUID -> "6064963d-31f0-4b2e-9f8a-b6e8cf4e091f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["JDTowersMod,JDSpaceMod", "Subsubsection",
 CellChangeTimes->{{3.768873749394401*^9, 3.7688737616824923`*^9}, {
  3.768946516938286*^9, 3.7689465334466248`*^9}, {3.769204432719776*^9, 
  3.769204439727335*^9}, {3.770591965297585*^9, 3.770591984674552*^9}},
 ExpressionUUID -> "2d4d7e25-1f3a-4a83-aee5-971ecd4f3a04"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDTowersMod", "[", 
    RowBox[{"r_", ",", "poly_", ",", "x_"}], "]"}], ":=", 
   RowBox[{"JDTowersMod", "[", 
    RowBox[{"r", ",", 
     RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.770599602506742*^9, 3.770599613875231*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDTowersMod", "[", 
    RowBox[{
     RowBox[{"r_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"x_Symbol", "\[Rule]", "poly_"}]}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"JDTowersMod", "[", 
        RowBox[{"r", ",", 
         RowBox[{"x", "\[Rule]", "poly"}], ",", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"DeleteDuplicates", "@", 
       RowBox[{"EValuesMod", "[", 
        RowBox[{"r", ",", 
         RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]}], ",", "1"}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.76881717975156*^9, 3.768817185086499*^9}, {
   3.7688172153690567`*^9, 3.768817236061391*^9}, {3.7688173262133427`*^9, 
   3.7688173441089563`*^9}, {3.768817497449255*^9, 3.768817504864161*^9}, 
   3.768817549116563*^9, {3.7688177257194777`*^9, 3.768817824714473*^9}, {
   3.768817875400056*^9, 3.768817926256122*^9}, 3.7688180300913153`*^9, 
   3.76881808699928*^9, {3.768818250407323*^9, 3.7688185009041147`*^9}, {
   3.768866734242364*^9, 3.768866760544333*^9}, {3.768867220901362*^9, 
   3.768867270302534*^9}, {3.7688680228543663`*^9, 3.7688680469572144`*^9}, {
   3.768868081550583*^9, 3.7688680864599257`*^9}, {3.76886814590767*^9, 
   3.768868271035838*^9}, {3.768868310260391*^9, 3.76886831748416*^9}, {
   3.768868357845221*^9, 3.7688684275260344`*^9}, {3.768868487343979*^9, 
   3.768868495232195*^9}, {3.768870052987796*^9, 3.7688700620818577`*^9}, {
   3.768872564802931*^9, 3.7688725658506823`*^9}, {3.7688727933102016`*^9, 
   3.768872794453266*^9}, {3.768872935677216*^9, 3.7688731241489*^9}, {
   3.768873644212284*^9, 3.7688736472818813`*^9}, {3.76887375161091*^9, 
   3.768873767629534*^9}, {3.768876087153646*^9, 3.76887608777737*^9}, {
   3.76887657289977*^9, 3.768876595995512*^9}, {3.768876673691757*^9, 
   3.768876678997583*^9}, {3.76887671021259*^9, 3.7688767891404552`*^9}, {
   3.768876827941901*^9, 3.768876881949615*^9}, {3.7688773578789988`*^9, 
   3.768877485046524*^9}, {3.76887778572609*^9, 3.7688777873503838`*^9}, {
   3.768877835127151*^9, 3.768877835294433*^9}, {3.768877950654986*^9, 
   3.76887795969487*^9}, {3.768919180870934*^9, 3.768919183469183*^9}, {
   3.7689193757285643`*^9, 3.76891937721277*^9}, {3.768946406023687*^9, 
   3.768946421716044*^9}, {3.7689465498218527`*^9, 3.7689466051546803`*^9}, {
   3.768946635237946*^9, 3.76894663524575*^9}, {3.768946681450045*^9, 
   3.76894670306818*^9}, {3.768946745125478*^9, 3.768946805318239*^9}, {
   3.768946839932332*^9, 3.768946862488576*^9}, {3.768946943638236*^9, 
   3.768946997857037*^9}, 3.7689472289579163`*^9, {3.768947278269906*^9, 
   3.7689473038429127`*^9}, {3.7699193842065077`*^9, 3.769919390773321*^9}, 
   3.769923425764555*^9, {3.770591587669379*^9, 3.770591587674128*^9}, 
   3.7705916237567587`*^9, 3.770591655671507*^9, 3.77059176481745*^9, {
   3.7705919653353767`*^9, 3.77059196534441*^9}, {3.77059961822283*^9, 
   3.770599661180393*^9}, 3.77059975198069*^9},
 ExpressionUUID -> "fcc2afc3-8bf8-4c09-9246-44e83c2e790c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDTowersMod", "[", 
    RowBox[{
     RowBox[{"r_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", "All"}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"JDTowersMod", "[", 
        RowBox[{"r", ",", 
         RowBox[{"x", "\[Rule]", "poly"}], ",", "#"}], "]"}], "&"}], "/@", 
      RowBox[{"DeleteDuplicates", "@", 
       RowBox[{"EValuesMod", "[", 
        RowBox[{"r", ",", 
         RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]}], ",", "1"}], "]"}]}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.76881717975156*^9, 3.768817185086499*^9}, {
   3.7688172153690567`*^9, 3.768817236061391*^9}, {3.7688173262133427`*^9, 
   3.7688173441089563`*^9}, {3.768817497449255*^9, 3.768817504864161*^9}, 
   3.768817549116563*^9, {3.7688177257194777`*^9, 3.768817824714473*^9}, {
   3.768817875400056*^9, 3.768817926256122*^9}, 3.7688180300913153`*^9, 
   3.76881808699928*^9, {3.768818250407323*^9, 3.7688185009041147`*^9}, {
   3.768866734242364*^9, 3.768866760544333*^9}, {3.768867220901362*^9, 
   3.768867270302534*^9}, {3.7688680228543663`*^9, 3.7688680469572144`*^9}, {
   3.768868081550583*^9, 3.7688680864599257`*^9}, {3.76886814590767*^9, 
   3.768868271035838*^9}, {3.768868310260391*^9, 3.76886831748416*^9}, {
   3.768868357845221*^9, 3.7688684275260344`*^9}, {3.768868487343979*^9, 
   3.768868495232195*^9}, {3.768870052987796*^9, 3.7688700620818577`*^9}, {
   3.768872564802931*^9, 3.7688725658506823`*^9}, {3.7688727933102016`*^9, 
   3.768872794453266*^9}, {3.768872935677216*^9, 3.7688731241489*^9}, {
   3.768873644212284*^9, 3.7688736472818813`*^9}, {3.76887375161091*^9, 
   3.768873767629534*^9}, {3.768876087153646*^9, 3.76887608777737*^9}, {
   3.76887657289977*^9, 3.768876595995512*^9}, {3.768876673691757*^9, 
   3.768876678997583*^9}, {3.76887671021259*^9, 3.7688767891404552`*^9}, {
   3.768876827941901*^9, 3.768876881949615*^9}, {3.7688773578789988`*^9, 
   3.768877485046524*^9}, {3.76887778572609*^9, 3.7688777873503838`*^9}, {
   3.768877835127151*^9, 3.768877835294433*^9}, {3.768877950654986*^9, 
   3.76887795969487*^9}, {3.768919180870934*^9, 3.768919183469183*^9}, {
   3.7689193757285643`*^9, 3.76891937721277*^9}, {3.768946406023687*^9, 
   3.768946421716044*^9}, {3.7689465498218527`*^9, 3.7689466051546803`*^9}, {
   3.768946635237946*^9, 3.76894663524575*^9}, {3.768946681450045*^9, 
   3.76894670306818*^9}, {3.768946745125478*^9, 3.768946805318239*^9}, {
   3.768946839932332*^9, 3.768946862488576*^9}, {3.768946943638236*^9, 
   3.768946997857037*^9}, 3.7689472289579163`*^9, {3.768947278269906*^9, 
   3.7689473038429127`*^9}, {3.7699193842065077`*^9, 3.769919390773321*^9}, 
   3.769923425764555*^9, {3.770591587669379*^9, 3.770591587674128*^9}, 
   3.7705916237567587`*^9, 3.770591655671507*^9, 3.77059176481745*^9, {
   3.7705919653353767`*^9, 3.77059196534441*^9}, {3.77059961822283*^9, 
   3.7705996754043703`*^9}, {3.7705997096764603`*^9, 3.7705997104200068`*^9}, 
   3.77059975065578*^9, {3.770958433928171*^9, 3.770958465815983*^9}},
 ExpressionUUID -> "fcc2afc3-8bf8-4c09-9246-44e83c2e790c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDTowersMod", "[", 
    RowBox[{
     RowBox[{"r_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", "evs_List"}], "]"}], ":=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"JDTowersMod", "[", 
        RowBox[{"r", ",", 
         RowBox[{"x", "\[Rule]", "poly"}], ",", "#"}], "]"}], "&"}], "/@", 
      "evs"}], ",", "1"}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.76881717975156*^9, 3.768817185086499*^9}, {
   3.7688172153690567`*^9, 3.768817236061391*^9}, {3.7688173262133427`*^9, 
   3.7688173441089563`*^9}, {3.768817497449255*^9, 3.768817504864161*^9}, 
   3.768817549116563*^9, {3.7688177257194777`*^9, 3.768817824714473*^9}, {
   3.768817875400056*^9, 3.768817926256122*^9}, 3.7688180300913153`*^9, 
   3.76881808699928*^9, {3.768818250407323*^9, 3.7688185009041147`*^9}, {
   3.768866734242364*^9, 3.768866760544333*^9}, {3.768867220901362*^9, 
   3.768867270302534*^9}, {3.7688680228543663`*^9, 3.7688680469572144`*^9}, {
   3.768868081550583*^9, 3.7688680864599257`*^9}, {3.76886814590767*^9, 
   3.768868271035838*^9}, {3.768868310260391*^9, 3.76886831748416*^9}, {
   3.768868357845221*^9, 3.7688684275260344`*^9}, {3.768868487343979*^9, 
   3.768868495232195*^9}, {3.768870052987796*^9, 3.7688700620818577`*^9}, {
   3.768872564802931*^9, 3.7688725658506823`*^9}, {3.7688727933102016`*^9, 
   3.768872794453266*^9}, {3.768872935677216*^9, 3.7688731241489*^9}, {
   3.768873644212284*^9, 3.7688736472818813`*^9}, {3.76887375161091*^9, 
   3.768873767629534*^9}, {3.768876087153646*^9, 3.76887608777737*^9}, {
   3.76887657289977*^9, 3.768876595995512*^9}, {3.768876673691757*^9, 
   3.768876678997583*^9}, {3.76887671021259*^9, 3.7688767891404552`*^9}, {
   3.768876827941901*^9, 3.768876881949615*^9}, {3.7688773578789988`*^9, 
   3.768877485046524*^9}, {3.76887778572609*^9, 3.7688777873503838`*^9}, {
   3.768877835127151*^9, 3.768877835294433*^9}, {3.768877950654986*^9, 
   3.76887795969487*^9}, {3.768919180870934*^9, 3.768919183469183*^9}, {
   3.7689193757285643`*^9, 3.76891937721277*^9}, {3.768946406023687*^9, 
   3.768946421716044*^9}, {3.7689465498218527`*^9, 3.7689466051546803`*^9}, {
   3.768946635237946*^9, 3.76894663524575*^9}, {3.768946681450045*^9, 
   3.76894670306818*^9}, {3.768946745125478*^9, 3.768946805318239*^9}, {
   3.768946839932332*^9, 3.768946862488576*^9}, {3.768946943638236*^9, 
   3.768946997857037*^9}, 3.7689472289579163`*^9, {3.768947278269906*^9, 
   3.7689473038429127`*^9}, {3.7699193842065077`*^9, 3.769919390773321*^9}, 
   3.769923425764555*^9, {3.770591587669379*^9, 3.770591587674128*^9}, 
   3.7705916237567587`*^9, 3.770591655671507*^9, 3.77059176481745*^9, {
   3.7705919653353767`*^9, 3.77059196534441*^9}, {3.77059961822283*^9, 
   3.7705996754043703`*^9}, {3.770599720856277*^9, 3.770599732131979*^9}},
 ExpressionUUID -> "fcc2afc3-8bf8-4c09-9246-44e83c2e790c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDTowersMod", "[", 
   RowBox[{
    RowBox[{"r_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", "ev_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vecs", ",", "vecs1", ",", "vecs2", ",", 
      RowBox[{"l", "=", 
       RowBox[{"Length", "[", "r", "]"}]}], ",", "m", ",", 
      RowBox[{"k", "=", "0"}], ",", "ns", ",", 
      RowBox[{"plist", "=", 
       RowBox[{"{", "}"}]}], ",", "rlist"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"patternQ", "[", "ev", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"JDTowersMod", "[", 
         RowBox[{"r", ",", 
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"EValuesMod", "[", 
              RowBox[{"r", ",", 
               RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}], ",", "ev"}], 
           "]"}]}], "]"}], "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"m", "=", 
      RowBox[{
       RowBox[{"OQuolyMod", "[", 
        RowBox[{"r", ",", "poly", ",", "x"}], "]"}], "-", 
       RowBox[{
        RowBox[{"IdentityMatrix", "[", "l", "]"}], "*", "ev", "*", 
        RowBox[{"D", "[", 
         RowBox[{"poly", ",", "x"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vecs", "=", 
      RowBox[{"KerMod", "[", 
       RowBox[{"m", ",", 
        RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vecs", "]"}], ">", "k"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"plist", ",", 
          RowBox[{
           RowBox[{"Length", "[", "vecs", "]"}], "-", "k"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"k", "=", 
         RowBox[{"Length", "@", "vecs"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"vecs1", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"ns", "=", 
              RowBox[{"KerMod", "[", 
               RowBox[{"vecs", ",", 
                RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}], ")"}], "===", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"IdentityMatrix", "[", "l", "]"}], ",", 
           RowBox[{"SortBy", "[", 
            RowBox[{
             RowBox[{"KerMod", "[", 
              RowBox[{
               RowBox[{"ODot", "[", 
                RowBox[{"ns", ",", "m"}], "]"}], ",", 
               RowBox[{"x", "\[Rule]", "poly"}]}], "]"}], ",", "ByteCount"}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Scan", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"vecs2", "=", 
              RowBox[{"Append", "[", 
               RowBox[{"vecs", ",", "#"}], "]"}]}], ";", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MatrixRankMod", "[", 
                 RowBox[{"vecs2", ",", 
                  RowBox[{"x", "\[Rule]", "poly"}]}], "]"}], "===", 
                RowBox[{"Length", "[", "vecs2", "]"}]}], ",", 
               RowBox[{
                RowBox[{"vecs", "=", "vecs2"}], ";"}]}], "]"}]}], ")"}], 
           "&"}], ",", "vecs1"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"plist", "===", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"{", "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"rlist", "=", 
      RowBox[{"PartitionByLengths", "[", 
       RowBox[{"vecs", ",", "plist"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"rlist", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "=", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"OQuolyMod", "[", 
           RowBox[{
            RowBox[{"ODot", "[", 
             RowBox[{
              RowBox[{"rlist", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
              RowBox[{"Transpose", "@", "m"}]}], "]"}], ",", "poly", ",", 
            "x"}], "]"}], ",", 
          RowBox[{"rlist", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{
          RowBox[{"Length", "@", "rlist"}], "-", "1"}], ",", "1", ",", 
         RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"rlist", "=", 
      RowBox[{"PartitionByLengths", "[", 
       RowBox[{
        RowBox[{"PickBasisMod", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"rlist", ",", "1"}], "]"}], ",", 
          RowBox[{"x", "\[Rule]", "poly"}]}], "]"}], ",", "plist"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"TransposeYoungTableau", "[", "rlist", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.76881717975156*^9, 3.768817185086499*^9}, {
   3.7688172153690567`*^9, 3.768817236061391*^9}, {3.7688173262133427`*^9, 
   3.7688173441089563`*^9}, {3.768817497449255*^9, 3.768817504864161*^9}, 
   3.768817549116563*^9, {3.7688177257194777`*^9, 3.768817824714473*^9}, {
   3.768817875400056*^9, 3.768817926256122*^9}, 3.7688180300913153`*^9, 
   3.76881808699928*^9, {3.768818250407323*^9, 3.7688185009041147`*^9}, {
   3.768866734242364*^9, 3.768866760544333*^9}, {3.768867220901362*^9, 
   3.768867270302534*^9}, {3.7688680228543663`*^9, 3.7688680469572144`*^9}, {
   3.768868081550583*^9, 3.7688680864599257`*^9}, {3.76886814590767*^9, 
   3.768868271035838*^9}, {3.768868310260391*^9, 3.76886831748416*^9}, {
   3.768868357845221*^9, 3.7688684275260344`*^9}, {3.768868487343979*^9, 
   3.768868495232195*^9}, {3.768870052987796*^9, 3.7688700620818577`*^9}, {
   3.768872564802931*^9, 3.7688725658506823`*^9}, {3.7688727933102016`*^9, 
   3.768872794453266*^9}, {3.768872935677216*^9, 3.7688731241489*^9}, {
   3.768873644212284*^9, 3.7688736472818813`*^9}, {3.76887375161091*^9, 
   3.768873767629534*^9}, {3.768876087153646*^9, 3.76887608777737*^9}, {
   3.76887657289977*^9, 3.768876595995512*^9}, {3.768876673691757*^9, 
   3.768876678997583*^9}, {3.76887671021259*^9, 3.7688767891404552`*^9}, {
   3.768876827941901*^9, 3.768876881949615*^9}, {3.7688773578789988`*^9, 
   3.768877485046524*^9}, {3.76887778572609*^9, 3.7688777873503838`*^9}, {
   3.768877835127151*^9, 3.768877835294433*^9}, {3.768877950654986*^9, 
   3.76887795969487*^9}, {3.768919180870934*^9, 3.768919183469183*^9}, {
   3.7689193757285643`*^9, 3.76891937721277*^9}, {3.768946406023687*^9, 
   3.768946421716044*^9}, {3.7689465498218527`*^9, 3.7689466051546803`*^9}, {
   3.768946635237946*^9, 3.76894663524575*^9}, {3.768946681450045*^9, 
   3.76894670306818*^9}, {3.768946745125478*^9, 3.768946805318239*^9}, {
   3.768946839932332*^9, 3.768946862488576*^9}, {3.768946943638236*^9, 
   3.768946997857037*^9}, 3.7689472289579163`*^9, {3.768947278269906*^9, 
   3.7689473038429127`*^9}, {3.7699193842065077`*^9, 3.769919390773321*^9}, 
   3.769923425764555*^9, {3.770591587669379*^9, 3.770591587674128*^9}, 
   3.7705916237567587`*^9, 3.770591655671507*^9, 3.77059176481745*^9, {
   3.7705919653353767`*^9, 3.77059196534441*^9}, {3.77059961822283*^9, 
   3.7705996754043703`*^9}, {3.770599720856277*^9, 3.770599806917734*^9}, {
   3.770602580584724*^9, 3.770602590216378*^9}, {3.770958402978489*^9, 
   3.77095843071714*^9}, 3.7709584714835253`*^9},
 ExpressionUUID -> "fcc2afc3-8bf8-4c09-9246-44e83c2e790c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDTowersMod", "[", 
   RowBox[{
    RowBox[{"r_", "?", "SquareMatrixQ"}], ",", "x_Symbol", ",", "a___"}], 
   "]"}], ":=", 
  RowBox[{"JDTowersMod", "[", 
   RowBox[{"r", ",", 
    RowBox[{"x", "\[Rule]", 
     RowBox[{"(", 
      RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}], ",", "a"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.770599875131233*^9, 3.770599910962584*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"todo", "[", "\"\<Write JDTowersMod::usage\>\"", "]"}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7699200443830214`*^9, 3.769920062144958*^9}, 
   3.770591965352054*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDSpaceMod", "[", 
   RowBox[{
    RowBox[{"r_", "?", "SquareMatrixQ"}], ",", "a___"}], "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"JDTowersMod", "[", 
     RowBox[{"r", ",", "a"}], "]"}], ",", "1"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.76881717975156*^9, 3.768817185086499*^9}, {
   3.7688172153690567`*^9, 3.768817236061391*^9}, {3.7688173262133427`*^9, 
   3.7688173441089563`*^9}, {3.768817497449255*^9, 3.768817504864161*^9}, 
   3.768817549116563*^9, {3.7688177257194777`*^9, 3.768817824714473*^9}, {
   3.768817875400056*^9, 3.768817926256122*^9}, 3.7688180300913153`*^9, 
   3.76881808699928*^9, {3.768818250407323*^9, 3.7688185009041147`*^9}, {
   3.768866734242364*^9, 3.768866760544333*^9}, {3.768867220901362*^9, 
   3.768867270302534*^9}, {3.7688680228543663`*^9, 3.7688680469572144`*^9}, {
   3.768868081550583*^9, 3.7688680864599257`*^9}, {3.76886814590767*^9, 
   3.768868271035838*^9}, {3.768868310260391*^9, 3.76886831748416*^9}, {
   3.768868357845221*^9, 3.7688684275260344`*^9}, {3.768868487343979*^9, 
   3.768868495232195*^9}, {3.768870052987796*^9, 3.7688700620818577`*^9}, {
   3.768872564802931*^9, 3.7688725658506823`*^9}, {3.7688727933102016`*^9, 
   3.768872794453266*^9}, {3.768872935677216*^9, 3.7688731241489*^9}, {
   3.768873644212284*^9, 3.7688736472818813`*^9}, {3.76887375161091*^9, 
   3.768873767629534*^9}, 3.7689466352852993`*^9, {3.7689466733796387`*^9, 
   3.7689466740888023`*^9}, {3.770591965356703*^9, 3.770591984707987*^9}},
 ExpressionUUID -> "29e1325c-eb2b-4a99-89f4-11242dd96bdd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"todo", "[", "\"\<Test JDSpaceMod\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.769824414794916*^9, 3.769824433100498*^9}, {
   3.769919430349701*^9, 3.769919434804105*^9}, 3.770591984716099*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"todo", "[", "\"\<Write JDSpaceMod::usage\>\"", "]"}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7699200443830214`*^9, 3.76992004855938*^9}, 
   3.770591984723131*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["JDData", "Subsubsection",
 CellChangeTimes->{3.76887498449649*^9},
 ExpressionUUID -> "8ba651f4-9a9c-4080-a009-a891c6f256c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDData", "::", "usage"}], "=", "\"\<JDData[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives data for the Jordan decomposition of a \
square matrix \!\(\*
StyleBox[\"m\", \"TI\"]\). The result has a form {{\!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\),\!\(\*
StyleBox[\"ulist\", \"TI\"]\),\!\(\*
StyleBox[\"vlist\", \"TI\"]\)},...} where each element corresponds to Jordan \
cell with the eigenvalue \!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\) , \!\(\*
StyleBox[\"ulist\", \"TI\"]\) being a Jordan chain vectors, starting from the \
eigenvectors, and \!\(\*
StyleBox[\"vlist\", \"TI\"]\) being the same for transposed matrix. Note that \
dual bases are \!\(\*
StyleBox[\"ulist\", \"TI\"]\) and Reverse[\!\(\*
StyleBox[\"vlist\", \"TI\"]\)].\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.768874998192862*^9, 3.768874999536656*^9}},
 ExpressionUUID -> "5e6e63e5-c8c0-4572-a3ed-9bb8cdcab875"],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDData", "[", 
   RowBox[{"m_", "?", "SquareMatrixQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evs", "=", 
       RowBox[{"DeleteDuplicates", "@", 
        RowBox[{"EValues", "[", "m", "]"}]}]}], ",", "\[IndentingNewLine]", 
      "us", ",", "\[IndentingNewLine]", "vs"}], "\[IndentingNewLine]", "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"us", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"JDTowers", "[", 
         RowBox[{"m", ",", "#"}], "]"}], "&"}], "/@", "evs"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"evs", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"MapThread", "[", 
         RowBox[{"ConstantArray", ",", 
          RowBox[{"{", 
           RowBox[{"evs", ",", 
            RowBox[{"Length", "/@", "us"}]}], "}"}]}], "]"}], ",", "1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"us", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"us", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vs", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{"Reverse", "/@", 
        RowBox[{"PartitionByLengths", "[", 
         RowBox[{
          RowBox[{"OInverse", "[", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"us", ",", "1"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"Length", "/@", "us"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"evs", ",", "us", ",", "vs"}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.768873945110799*^9, 3.768874072601989*^9}, {
   3.768874386835177*^9, 3.768874481787889*^9}, {3.7688745871006117`*^9, 
   3.768874689429448*^9}, {3.768874729327812*^9, 3.768874747917768*^9}, {
   3.768874782597971*^9, 3.768874963614829*^9}, {3.768875766855549*^9, 
   3.7688757704070463`*^9}, {3.7688758025728188`*^9, 3.768875806492794*^9}, 
   3.7689466353199253`*^9, 3.768950432062325*^9, 3.770536660013948*^9},
 ExpressionUUID -> "7042fa81-1427-4231-b0cf-600edbe74af1"]
}, Closed]],

Cell[CellGroupData[{

Cell["JDDataMod", "Subsubsection",
 CellChangeTimes->{
  3.76887498449649*^9, {3.769204340579179*^9, 3.769204341154324*^9}, 
   3.770591998057722*^9},
 ExpressionUUID -> "42b68b17-6998-4b40-9d8b-4048cae78a01"],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDDataMod", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"evs", "=", 
       RowBox[{"DeleteDuplicates", "@", 
        RowBox[{"EValuesMod", "[", 
         RowBox[{"m", ",", 
          RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]}], ",", 
      "\[IndentingNewLine]", "us", ",", "\[IndentingNewLine]", "vs"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"us", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"JDTowersMod", "[", 
         RowBox[{"m", ",", 
          RowBox[{"x", "\[Rule]", "poly"}], ",", "#"}], "]"}], "&"}], "/@", 
       "evs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"evs", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"MapThread", "[", 
         RowBox[{"ConstantArray", ",", 
          RowBox[{"{", 
           RowBox[{"evs", ",", 
            RowBox[{"Length", "/@", "us"}]}], "}"}]}], "]"}], ",", "1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"us", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"us", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"vs", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{"Reverse", "/@", 
        RowBox[{"PartitionByLengths", "[", 
         RowBox[{
          RowBox[{"InverseMod", "[", 
           RowBox[{
            RowBox[{"Transpose", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"us", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"x", "\[Rule]", "poly"}]}], "]"}], ",", 
          RowBox[{"Length", "/@", "us"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"evs", ",", "us", ",", "vs"}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.768873945110799*^9, 3.768874072601989*^9}, {
   3.768874386835177*^9, 3.768874481787889*^9}, {3.7688745871006117`*^9, 
   3.768874689429448*^9}, {3.768874729327812*^9, 3.768874747917768*^9}, {
   3.768874782597971*^9, 3.768874963614829*^9}, {3.768875766855549*^9, 
   3.7688757704070463`*^9}, {3.7688758025728188`*^9, 3.768875806492794*^9}, 
   3.7689466353199253`*^9, 3.768950432062325*^9, {3.769204359394513*^9, 
   3.769204391313407*^9}, {3.7692334610791903`*^9, 3.769233462214704*^9}, 
   3.770591680252783*^9, 3.770591764822021*^9, 3.770591965360774*^9, 
   3.770591998091298*^9, {3.770600033725721*^9, 3.770600064942667*^9}},
 ExpressionUUID -> "b290e541-ac9a-4185-82ab-cb9a70bc7741"]
}, Open  ]],

Cell[CellGroupData[{

Cell["JDecomposition (obsolete)", "Subsubsection",
 CellChangeTimes->{{3.721112403351812*^9, 3.721112411551209*^9}, {
  3.7214365194824*^9, 3.721436541761698*^9}, {3.770600078242848*^9, 
  3.7706000837471857`*^9}},
 ExpressionUUID -> "9995f5ae-88f7-44a0-8a07-2d4180793cac"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDecomposition", "::", "usage"}], "=", "\"\<JDecomposition[\!\(\*
StyleBox[\"m\", \"TI\"]\)] yields the Jordan decomposition of a square matrix \
\!\(\*
StyleBox[\"m\", \"TI\"]\). The result is a list {\!\(\*
StyleBox[\"b\", \"TI\"]\),\!\(\*
StyleBox[\"n\", \"TI\"]\)} where \!\(\*
StyleBox[\"b\", \"TI\"]\) is a similarity matrix and \!\(\*
StyleBox[\"n\", \"TI\"]\) is the Jordan canonical form of \!\(\*
StyleBox[\"m\", \"TI\"]\). JDecomposition[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"l\", \"TI\"]\)] does the same, except that it puts \!\(\*
StyleBox[\"l\", \"TI\"]\) above diagonal instead of 1.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.5958489157408714`*^9, 3.5958493537314262`*^9}, {
   3.5958494455337453`*^9, 3.595849463284602*^9}, {3.5958495531826496`*^9, 
   3.595849602769771*^9}, 3.62481375210259*^9},
 ExpressionUUID -> "a14cb39e-bac3-4486-ae1c-8a1bf089c1b5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDecomposition", "[", 
   RowBox[{"m_", "?", "SquareMatrixQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\n", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"s", ",", "d", ",", "a", ",", "b", ",", "p", ",", "jc", ",", 
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "m"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Check", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"s", ",", "a"}], "}"}], "=", 
        RowBox[{"JordanDecomposition", "[", "m", "]"}]}], ",", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"s", "=", 
      RowBox[{"Factor", "@", "s"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"Simplify", "@", 
       RowBox[{"Transform", "[", 
        RowBox[{"m", ",", "s"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"JFormQ", "[", "a", "]"}]}], ",", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Ugly", " ", "hack", " ", "to", " ", "deal", " ", "with", " ", 
       RowBox[{"Mathematica", "'"}], "s", " ", "bugs", " ", "related", " ", 
       "to", " ", "JordanDecomposition"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"d", "=", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"FoldList", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"#2", "===", "0"}], ",", "1", ",", 
            RowBox[{"#1", "/", "#2"}]}], "]"}], "&"}], ",", "1", ",", 
         RowBox[{"Diagonal", "[", 
          RowBox[{"a", ",", "1"}], "]"}]}], "]"}], "]"}]}], ";", 
     RowBox[{"s", "=", 
      RowBox[{"ODot", "[", 
       RowBox[{"s", ",", "d"}], "]"}]}], ";", 
     RowBox[{"a", "=", 
      RowBox[{"Simplify", "@", 
       RowBox[{"Transform", "[", 
        RowBox[{"a", ",", "d"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"s", ",", "a"}], "}"}]}]}], "\n", "]"}]}]], "Code",
 CellChangeTimes->{{3.594701055468109*^9, 3.5947010804236107`*^9}, 
   3.6248149556528144`*^9, 3.625141171200361*^9, 3.625141238074743*^9, {
   3.625141310024493*^9, 3.6251413185061235`*^9}, 3.625199610120382*^9, {
   3.625199682747583*^9, 3.625199709436294*^9}, {3.6252001556790648`*^9, 
   3.6252001719588685`*^9}, {3.625200202464115*^9, 3.6252002042302866`*^9}, {
   3.625200579718958*^9, 3.6252005827059393`*^9}, {3.625202845054161*^9, 
   3.625202845187249*^9}, {3.6252036303190966`*^9, 3.6252036372486954`*^9}, {
   3.6252042856910505`*^9, 3.6252042886420093`*^9}, {3.6264967664123945`*^9, 
   3.6264967720051117`*^9}, {3.626496844485278*^9, 3.6264968741797514`*^9}, {
   3.681598656393116*^9, 3.6815986627280073`*^9}, {3.681598713841381*^9, 
   3.68159871516964*^9}, {3.7204005381674013`*^9, 3.7204005399997473`*^9}, {
   3.721112486653428*^9, 3.721112501234851*^9}, {3.721112601370891*^9, 
   3.7211126110026903`*^9}, {3.721112690874538*^9, 3.721112720395142*^9}, {
   3.7211127570037613`*^9, 3.721112814666265*^9}, {3.721112863771288*^9, 
   3.721112920435687*^9}, {3.7211129738388357`*^9, 3.7211129756344357`*^9}, {
   3.7277434562897882`*^9, 3.727743459730294*^9}, {3.72774529093616*^9, 
   3.7277452991607018`*^9}, 3.7277457295310793`*^9, {3.727746461323827*^9, 
   3.727746461477543*^9}},
 ExpressionUUID -> "48082b85-af38-4335-81b7-b34a61306768"]
}, Closed]],

Cell[CellGroupData[{

Cell["JDecompositionData (obsolete)", "Subsubsection",
 CellChangeTimes->{3.721436515212688*^9, 3.770600087636945*^9},
 ExpressionUUID -> "1dbac2b8-fb2d-438a-b6c4-b227d0075544"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"JDecompositionData", "::", "usage"}], "=", 
   "\"\<JDecompositionData[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives data for the Jordan decomposition of a \
square matrix \!\(\*
StyleBox[\"m\", \"TI\"]\). The result has a form {{\!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\),\!\(\*
StyleBox[\"ulist\", \"TI\"]\),\!\(\*
StyleBox[\"vlist\", \"TI\"]\)},...} where each element corresponds to Jordan \
cell with the eigenvalue \!\(\*
StyleBox[\"\[Lambda]\", \"TI\"]\) , \!\(\*
StyleBox[\"ulist\", \"TI\"]\) being a Jordan chain vectors, starting from the \
eigenvectors, and \!\(\*
StyleBox[\"vlist\", \"TI\"]\) being the same for transposed matrix. Note that \
dual bases are \!\(\*
StyleBox[\"ulist\", \"TI\"]\) and Reverse[\!\(\*
StyleBox[\"vlist\", \"TI\"]\)].\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.5958489157408714`*^9, 3.5958493537314262`*^9}, {
   3.5958494455337453`*^9, 3.595849463284602*^9}, {3.5958495531826496`*^9, 
   3.595849602769771*^9}, 3.62481375210259*^9, {3.6252114066448107`*^9, 
   3.6252117292098913`*^9}, {3.721364338269762*^9, 3.721364339853943*^9}},
 ExpressionUUID -> "a39dd487-4fb1-4267-b584-b577c1a19992"],

Cell[BoxData[
 RowBox[{
  RowBox[{"JDecompositionData", "[", "m_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "m"}]}], ",", "\[IndentingNewLine]", "t", ",", 
      "j", ",", "\[IndentingNewLine]", "inds", ",", "\[IndentingNewLine]", 
      "sizes", ",", "\[IndentingNewLine]", "evals", ",", 
      "\[IndentingNewLine]", "us", ",", "vs"}], "\[IndentingNewLine]", "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"t", ",", "j"}], "}"}], "=", 
      RowBox[{"JDecomposition", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"inds", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"Diagonal", "[", 
            RowBox[{"j", ",", "1"}], "]"}], ",", "0", ",", 
           RowBox[{"{", "1", "}"}]}], "]"}], ",", "n"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sizes", "=", 
      RowBox[{"Differences", "[", "inds", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Assert", "[", 
      RowBox[{"n", "===", 
       RowBox[{"Plus", "@@", "sizes"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"evals", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"j", "[", 
         RowBox[{"[", 
          RowBox[{"#", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
       RowBox[{"Rest", "[", "inds", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"us", "=", 
      RowBox[{"PartitionByLengths", "[", 
       RowBox[{
        RowBox[{"Transpose", "[", "t", "]"}], ",", "sizes"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vs", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{"Reverse", "/@", 
        RowBox[{"PartitionByLengths", "[", 
         RowBox[{
          RowBox[{"Inverse", "[", "t", "]"}], ",", "sizes"}], "]"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Outer", "[", 
       RowBox[{"ODot", ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{"vs", ",", "1"}], "]"}], ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{"us", ",", "1"}], "]"}], ",", "1"}], "]"}], 
      RowBox[{"(*", 
       RowBox[{
       "supposed", " ", "to", " ", "be", " ", "identity", " ", "matrix"}], 
       "*)"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"evals", ",", "us", ",", "vs"}], "}"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.681598435471023*^9, 3.681598440494897*^9}, {
   3.681598540304131*^9, 3.6815985422797747`*^9}, 3.681598737577104*^9, {
   3.7213641208537207`*^9, 3.721364124116818*^9}, {3.721364196589827*^9, 
   3.721364198502041*^9}, 3.72143655826014*^9, {3.727745684456897*^9, 
   3.7277456878177443`*^9}, 3.727745729536386*^9},
 ExpressionUUID -> "78c50e7c-59ba-413a-bf2c-edd1ade7157c"]
}, Closed]],

Cell[CellGroupData[{

Cell["GaussSolve", "Subsubsection",
 CellChangeTimes->{{3.721953650031817*^9, 3.721953680911995*^9}, 
   3.721953897654182*^9},
 ExpressionUUID -> "72b54e37-4873-48f3-985a-f18ee70da82c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GaussSolve", "::", "usage"}], "=", 
   "\"\<GaussSolve[eqs,vars] implements gauss method of the solution of \
linear equations. Option Continue\[Rule]True|False defines how the procedure \
proceeds when hitting the equation that can not be satisfied (like \
1\[Equal]0). With Continue\[Rule]True such equation is simply neglected, and \
with Continue\[Rule]False the procedure immediately returns $Failed (i.e., no \
solution).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7219537882887383`*^9, 3.721953897679122*^9}, {
  3.7219539593768053`*^9, 3.721954223777403*^9}},
 ExpressionUUID -> "f99e5a98-31ce-4492-acd7-fa809629a14c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GaussSolve", "::", "inconsistent"}], "=", 
   "\"\<Inconsistent equation encountered.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721954761567959*^9, 3.721954818720047*^9}},
 ExpressionUUID -> "252dcf89-8f46-48c7-b385-8856abc61c60"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "GaussSolve", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Continue", "\[Rule]", "True"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.6368151167523623`*^9, 3.636815118211299*^9}, {
   3.6368152430426607`*^9, 3.63681528045931*^9}, {3.636815690268203*^9, 
   3.6368156917071247`*^9}, {3.636815786673912*^9, 3.636815799207189*^9}, {
   3.636815873360807*^9, 3.6368158772180767`*^9}, {3.636815939018305*^9, 
   3.636815946449506*^9}, {3.6368159995496264`*^9, 3.6368160026269627`*^9}, {
   3.636816063177524*^9, 3.636816142093259*^9}, {3.681624354463532*^9, 
   3.681624520569107*^9}, {3.688365918308423*^9, 3.688365984914689*^9}, {
   3.7214525869943447`*^9, 3.721452588194523*^9}, 3.72195373820475*^9, 
   3.721953897684228*^9, {3.721953935265192*^9, 3.721953955304826*^9}, {
   3.768532317661255*^9, 3.768532321093521*^9}, {3.768693192071226*^9, 
   3.7686931922156982`*^9}},
 ExpressionUUID -> "e767c2d4-a133-49eb-ba7a-8c4e5981f17f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GaussSolve", "[", 
   RowBox[{"eqs_", ",", "vs_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sol1", ",", "res", ",", 
      RowBox[{"i", "=", "0"}], ",", 
      RowBox[{"l", "=", 
       RowBox[{"Length", "@", "eqs"}]}], ",", "sf", ",", 
      RowBox[{"vars", "=", "vs"}], ",", 
      RowBox[{"cnt", "=", 
       RowBox[{"TrueQ", "[", 
        RowBox[{"OptionValue", "[", "Continue", "]"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sf", "=", 
      RowBox[{
       RowBox[{"Collect", "[", 
        RowBox[{"#", ",", "vars", ",", "Together"}], "]"}], "&"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"CWrite", "[", 
      RowBox[{"\"\<[\>\"", "<>", 
       RowBox[{"ToString", "[", "l", "]"}], "<>", "\"\<|\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"FCMonitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"res", "=", 
        RowBox[{"Catch", "[", 
         RowBox[{"Fold", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"i", "++"}], ";", 
              RowBox[{"CWrite", "[", "\"\<.\>\"", "]"}], ";", 
              RowBox[{"Quiet", "[", 
               RowBox[{
                RowBox[{"Check", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", "sol1", "}"}], "=", 
                   RowBox[{"Quiet", "[", 
                    RowBox[{
                    RowBox[{"Solve", "[", 
                    RowBox[{
                    RowBox[{"0", "\[Equal]", 
                    RowBox[{"sf", "[", 
                    RowBox[{"#2", "/.", "#1"}], "]"}]}], ",", "vars"}], "]"}],
                     ",", 
                    RowBox[{"{", 
                    RowBox[{"Solve", "::", "svars"}], "}"}]}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"sol1", "=", 
                    RowBox[{"{", "}"}]}], ";", 
                   RowBox[{"If", "[", 
                    RowBox[{"cnt", ",", 
                    RowBox[{"Message", "[", 
                    RowBox[{"GaussSolve", "::", "inconsistent"}], "]"}], ",", 
                    RowBox[{"Throw", "[", "$Failed", "]"}]}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"{", 
                   RowBox[{"Set", "::", "shape"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Set", "::", "shape"}], "}"}]}], "]"}], ";", 
              RowBox[{"vars", "=", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{"vars", ",", 
                 RowBox[{"Alternatives", "@@", 
                  RowBox[{"(", 
                   RowBox[{"First", "/@", "sol1"}], ")"}]}]}], "]"}]}], ";", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#1", "\[Rule]", 
                    RowBox[{"sf", "[", 
                    RowBox[{"#2", "/.", "sol1"}], "]"}]}], ")"}], "&"}], "@@@",
                  "#1"}], ",", "sol1"}], "]"}]}], ")"}], "&"}], ",", 
           RowBox[{"{", "}"}], ",", "eqs"}], "]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Overlay", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ProgressIndicator", "[", 
            RowBox[{"i", ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "l"}], "}"}]}], "]"}], ",", 
           RowBox[{
            RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\</\>\"", "<>", 
            RowBox[{"ToString", "[", "l", "]"}]}]}], "}"}], ",", 
         RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}], ",", "1"}], 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"CWrite", "[", "\"\<]\>\"", "]"}], ";", "\[IndentingNewLine]", 
     "res"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.6368151167523623`*^9, 3.636815118211299*^9}, {
   3.6368152430426607`*^9, 3.63681528045931*^9}, {3.636815690268203*^9, 
   3.6368156917071247`*^9}, {3.636815786673912*^9, 3.636815799207189*^9}, {
   3.636815873360807*^9, 3.6368158772180767`*^9}, {3.636815939018305*^9, 
   3.636815946449506*^9}, {3.6368159995496264`*^9, 3.6368160026269627`*^9}, {
   3.636816063177524*^9, 3.636816142093259*^9}, {3.681624354463532*^9, 
   3.681624520569107*^9}, {3.688365918308423*^9, 3.688365992227393*^9}, 
   3.70709016659851*^9, 3.721953739688005*^9, 3.721953897689825*^9, {
   3.721954265034272*^9, 3.721954372961494*^9}, {3.7219544428736153`*^9, 
   3.721954473049819*^9}, {3.72195455299331*^9, 3.7219545941463623`*^9}, {
   3.721954638475116*^9, 3.721954751778903*^9}, {3.721954827418323*^9, 
   3.72195484663407*^9}, {3.721954906763729*^9, 3.721954915522512*^9}, {
   3.7219550315168447`*^9, 3.721955054493164*^9}, 3.721955093525738*^9, {
   3.7219551311894617`*^9, 3.7219551393666887`*^9}, {3.7219551707432127`*^9, 
   3.7219551745017776`*^9}, {3.727424276422024*^9, 3.727424276773531*^9}, {
   3.7686931375649633`*^9, 3.7686931377765207`*^9}, {3.768693198289543*^9, 
   3.768693238569519*^9}, {3.7686938942520857`*^9, 3.7686938979228888`*^9}, {
   3.76902927454592*^9, 3.769029276155898*^9}, {3.769755838272265*^9, 
   3.769755850735973*^9}, {3.76975605100848*^9, 3.769756079994626*^9}, {
   3.769756213049025*^9, 3.769756233384882*^9}, {3.769756266649308*^9, 
   3.769756268241288*^9}, 3.7697563042596397`*^9, 3.769807027122645*^9, {
   3.770095800336928*^9, 3.7700958004858513`*^9}, {3.77016095307071*^9, 
   3.770160957337781*^9}, {3.770161001911333*^9, 3.770161030151246*^9}, 
   3.7701643058915567`*^9},
 ExpressionUUID -> "2aadfbb9-4952-4de0-a6fc-4f87075b8735"],

Cell[BoxData[
 RowBox[{"todo", "[", 
  "\"\<Implement GaussSolve for matrices. Or at least better version of \
NullSpace.\>\"", "]"}]], "Code",
 CellChangeTimes->{{3.727428530880303*^9, 3.727428587223351*^9}},
 ExpressionUUID -> "1a00fc83-ae8c-4bb5-b1b0-82cc94d0b9bd"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Basic matrix quieries", "Subsection",
 CellChangeTimes->{{3.719625670755124*^9, 3.7196256751467237`*^9}, {
  3.719625803259419*^9, 3.7196258059788322`*^9}, {3.727744978720408*^9, 
  3.727744984985721*^9}},
 ExpressionUUID -> "e485861f-8b46-4b9f-bb6e-ea7b4a4ffa58"],

Cell[CellGroupData[{

Cell["\<\
Various queries:
NilpotentQ,DiagonalQ,PolyQ,RatFuncQ\
\>", "Subsubsection",
 CellChangeTimes->{{3.7211104864098473`*^9, 3.721110494296945*^9}, {
  3.727744999296238*^9, 3.727745004151775*^9}, {3.768568306595676*^9, 
  3.7685683515169563`*^9}},
 ExpressionUUID -> "28839cc8-2e4a-4afd-bdbd-fc295318c64e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NilpotentQ", "::", "usage"}], "=", "\"\<NilpotentQ[\!\(\*
StyleBox[\"m\", \"TI\"]\)]  gives True if \!\(\*
StyleBox[\"m\", \"TI\"]\) is nilpotent.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NilpotentQ", "[", 
   RowBox[{"m_", "?", "SquareMatrixQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "x", "}"}], ",", 
    RowBox[{
     RowBox[{"Collect", "[", 
      RowBox[{
       RowBox[{"CharacteristicPolynomial", "[", 
        RowBox[{"m", ",", "x"}], "]"}], ",", "x", ",", "Factor"}], "]"}], "===", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"-", "x"}], ")"}], "^", 
      RowBox[{"Length", "@", "m"}]}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NilpotentQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{{3.7211112028931923`*^9, 3.721111203132535*^9}, {
  3.7211114622103043`*^9, 3.7211114651845207`*^9}, {3.721111714958542*^9, 
  3.721111727086018*^9}},
 ExpressionUUID -> "30d4dc14-7b02-4d4a-b75a-badd8b44fb83"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DiagonalQ", "::", "usage"}], "=", "\"\<DiagonalQ[\!\(\*
StyleBox[\"m\", \"TI\"]\)]  gives True if \!\(\*
StyleBox[\"m\", \"TI\"]\) is diagonal.\>\""}], ";", 
  RowBox[{
   RowBox[{"DiagonalQ", "[", 
    RowBox[{"A_", "?", "SquareMatrixQ"}], "]"}], ":=", 
   RowBox[{"MatchQ", "[", 
    RowBox[{
     RowBox[{"Equal", "@@@", 
      RowBox[{"Position", "[", 
       RowBox[{"A", ",", 
        RowBox[{"Except", "[", "0", "]"}], ",", 
        RowBox[{"{", "2", "}"}], ",", 
        RowBox[{"Heads", "->", "False"}]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"True", ".."}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DiagonalQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{
  3.7211112088770638`*^9, 3.721111469825316*^9, {3.7211117019102497`*^9, 
   3.7211117099256077`*^9}},
 ExpressionUUID -> "674e19fe-e213-474c-86a6-0176c8541c95"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PolyQ", "::", "usage"}], "=", 
   "\"\<PolyQ[expr,x] gives True if expr is a polynomial function of \
x.\\nPolyQ[{a,b,...},x] gives True iff \
PolyQ[a,x]&&PolyQ[b,x]&&..=True.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", "p", "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PolyQ", "[", 
      RowBox[{"expr_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"Catch", "[", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"expr", ",", "x"}], "]"}], ";", "True"}], "]"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"SetAttributes", "[", 
     RowBox[{"p", ",", "Listable"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{
       RowBox[{"ex", ":", 
        RowBox[{"(", 
         RowBox[{"_Plus", "|", "_Times"}], ")"}]}], ",", "x_"}], "]"}], ":=", 
     RowBox[{"p", "[", 
      RowBox[{
       RowBox[{"List", "@@", "ex"}], ",", "x"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{
       RowBox[{"Power", "[", 
        RowBox[{"ex_", ",", 
         RowBox[{"_Integer", "?", "Positive"}]}], "]"}], ",", "x_"}], "]"}], ":=", 
     RowBox[{"p", "[", 
      RowBox[{"ex", ",", "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"p", "[", 
      RowBox[{"ex_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatchQ", "[", 
           RowBox[{"ex", ",", "x"}], "]"}], "||", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"ex", ",", "x"}], "]"}]}], ")"}]}], ",", 
       RowBox[{"Throw", "@", "False"}]}], "]"}]}], ";"}]}], 
  "\[IndentingNewLine]", "]"}]}], "Code",
 CellChangeTimes->{{3.721175118249138*^9, 3.72117519184606*^9}, {
   3.721175496702361*^9, 3.7211755065345573`*^9}, {3.7211761882987328`*^9, 
   3.721176190476061*^9}, {3.721181185146391*^9, 3.721181206912819*^9}, 
   3.727745993869194*^9},
 ExpressionUUID -> "11128de8-2c5a-442b-8d1c-b9372d0cfbf2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"RatFuncQ", "::", "usage"}], "=", 
   "\"\<RatFuncQ[expr,x] gives True if expr is a rational function of \
x.\\nRatFuncQ[{a,b,...},x] gives True iff \
RatFuncQ[a,x]&&RatFuncQ[b,x]&&..=True.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", "rf", "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RatFuncQ", "[", 
      RowBox[{"expr_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"Catch", "[", 
      RowBox[{
       RowBox[{"rf", "[", 
        RowBox[{"expr", ",", "x"}], "]"}], ";", "True"}], "]"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"SetAttributes", "[", 
     RowBox[{"rf", ",", "Listable"}], "]"}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rf", "[", 
      RowBox[{
       RowBox[{"ex", ":", 
        RowBox[{"(", 
         RowBox[{"_Plus", "|", "_Times"}], ")"}]}], ",", "x_"}], "]"}], ":=", 
     RowBox[{"rf", "[", 
      RowBox[{
       RowBox[{"List", "@@", "ex"}], ",", "x"}], "]"}]}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rf", "[", 
      RowBox[{
       RowBox[{"Power", "[", 
        RowBox[{"ex_", ",", "_Integer"}], "]"}], ",", "x_"}], "]"}], ":=", 
     RowBox[{"rf", "[", 
      RowBox[{"ex", ",", "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rf", "[", 
      RowBox[{"ex_", ",", "x_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"MatchQ", "[", 
           RowBox[{"ex", ",", "x"}], "]"}], "||", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"ex", ",", "x"}], "]"}]}], ")"}]}], ",", 
       RowBox[{"Throw", "@", "False"}]}], "]"}]}], ";"}]}], 
  "\[IndentingNewLine]", "]"}]}], "Code",
 CellChangeTimes->{{3.721174862910118*^9, 3.721174891224807*^9}, {
  3.72117494825513*^9, 3.721175108987998*^9}, {3.721175478546997*^9, 
  3.721175519113105*^9}, {3.721176656115665*^9, 3.721176659306477*^9}, {
  3.721181216142544*^9, 3.721181230177726*^9}, {3.727745953977296*^9, 
  3.72774596035314*^9}},
 ExpressionUUID -> "6f8281ba-f940-488b-b382-840cee7358aa"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"JFormQ", "::", "usage"}], "=", "\"\<JFormQ[\!\(\*
StyleBox[\"m\", \"TI\"]\)]  gives True if \!\(\*
StyleBox[\"m\", \"TI\"]\) is a Jordan form.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JFormQ", "[", 
    RowBox[{"{", 
     RowBox[{"{", "_", "}"}], "}"}], "]"}], "=", "True"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JFormQ", "[", 
    RowBox[{"A_", "?", "SquareMatrixQ"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\n", 
    RowBox[{
     RowBox[{"{", "\n", 
      RowBox[{
       RowBox[{"d", "=", 
        RowBox[{"Diagonal", "[", "A", "]"}]}], ",", "\n", 
       RowBox[{"c1", "=", 
        RowBox[{
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Diagonal", "[", 
                RowBox[{"A", ",", "#"}], "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", 
               RowBox[{"2", ",", 
                RowBox[{
                 RowBox[{"Length", "@", "A"}], "-", "1"}]}], "]"}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Diagonal", "[", 
                RowBox[{"A", ",", "#"}], "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"1", "-", 
                 RowBox[{"Length", "@", "A"}]}], ",", 
                RowBox[{"-", "1"}]}], "]"}]}]}], "}"}], "]"}], "]"}], "===", 
         RowBox[{"{", "0", "}"}]}]}]}], "\n", "}"}], ",", "\n", 
     RowBox[{"c1", "&&", 
      RowBox[{"And", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"d", "[", 
            RowBox[{"[", "#", "]"}], "]"}], "===", 
           RowBox[{"d", "[", 
            RowBox[{"[", 
             RowBox[{"#", "+", "1"}], "]"}], "]"}]}], "&"}], "/@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{"Diagonal", "[", 
             RowBox[{"A", ",", "1"}], "]"}], ",", 
            RowBox[{"Except", "[", "0", "]"}], ",", 
            RowBox[{"{", "1", "}"}], ",", 
            RowBox[{"Heads", "->", "False"}]}], "]"}], "]"}]}], ")"}]}]}]}], 
    "\n", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JFormQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{{3.625333810587212*^9, 3.6253338271214075`*^9}, {
   3.721111234750115*^9, 3.7211112353650503`*^9}, 3.7211114782305202`*^9, {
   3.7211116848388577`*^9, 3.721111693956182*^9}},
 ExpressionUUID -> "12e933c3-4fc4-43e7-8e3a-61e9b0432691"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FuchsianQ", "::", "usage"}], "=", "\"\<FuchsianQ[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)]  gives True if \!\(\*
StyleBox[\"m\", \"TI\"]\) has only simple poles in \!\(\*
StyleBox[\"x\", \"TI\"]\).\>\""}], ";", 
  RowBox[{
   RowBox[{
    RowBox[{"FuchsianQ", "[", 
     RowBox[{"m_", ",", "x_"}], "]"}], "/;", 
    RowBox[{"RatFuncQ", "[", 
     RowBox[{"m", ",", "x"}], "]"}]}], ":=", 
   RowBox[{"MatchQ", "[", 
    RowBox[{
     RowBox[{"DenominatorsInfo", "[", 
      RowBox[{"m", ",", "x"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_", ",", 
         RowBox[{"_", "?", "NonPositive"}]}], "}"}], "..."}], "}"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FuchsianQ", "[", "_", "]"}], "=", "False"}], ";"}]}], "Code",
 CellChangeTimes->{{3.625031082415009*^9, 3.625031088978259*^9}, {
   3.6250311402204933`*^9, 3.6250311638957005`*^9}, 3.7211112288132477`*^9, 
   3.72111148339824*^9, {3.721111738574562*^9, 3.7211117692866793`*^9}, {
   3.72117636004358*^9, 3.721176382377513*^9}, 3.721347048906081*^9, 
   3.721347137484569*^9, 3.721452356417967*^9, {3.722596051523273*^9, 
   3.722596065442286*^9}, {3.768568384732504*^9, 3.768568390801861*^9}},
 ExpressionUUID -> "adc1d80e-c7ef-491f-ad77-610143547693"]
}, Closed]],

Cell[CellGroupData[{

Cell["TClosure", "Subsubsection",
 CellChangeTimes->{{3.7196546910410557`*^9, 3.719654738194751*^9}, {
  3.719660064064293*^9, 3.719660064703003*^9}, {3.719706070292749*^9, 
  3.7197060908103743`*^9}},
 ExpressionUUID -> "cc70800f-7c29-4f3d-8b1a-428482c37b36"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TClosure", "::", "usage"}], "=", 
   "\"\<TClosure[m_?MatrixQ] calculates transitive closure of the relation \
given by m.\\n  \
Try\\n(MatrixPlot/@{#,TClosure[#]})&[{{1,0,0,0},{1,0,0,0},{0,1,1,1},{0,0,1,0}}\
]\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719651583727508*^9, 3.719651657330677*^9}, {
   3.719653095911035*^9, 3.719653108864572*^9}, {3.719653831070327*^9, 
   3.719653849986565*^9}, {3.719653954480691*^9, 3.719653958422495*^9}, {
   3.719656159293182*^9, 3.719656238965705*^9}, {3.719659062532278*^9, 
   3.719659076803988*^9}, {3.7196600731714354`*^9, 3.719660085529818*^9}, 
   3.719730734382061*^9, {3.722559151444743*^9, 3.722559151610249*^9}},
 ExpressionUUID -> "c090458b-f94f-4e41-8f5a-afa9c9675983"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TClosure", "[", 
   RowBox[{"m_", "?", "SquareMatrixQ"}], "]"}], ":=", 
  RowBox[{"tclosure", "[", 
   RowBox[{"m", ",", "1"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.7197061056456327`*^9, 3.719706115279158*^9}, 
   3.719706157827229*^9, 3.719740289973288*^9},
 ExpressionUUID -> "5eb13ad1-6b3a-49f9-a0aa-abd8fcfdd0e8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"tclosure", "::", "usage"}], "=", 
   "\"\<tclosure[m_,d:(1|0):1] calculates transitive closure of the relation \
given by m. If the second argument is 0, the relation is symmetrized.\\n  Try\
\\n(MatrixPlot/@{#,TClosure[#]})&[{{1,0,0,0},{1,0,0,0},{0,1,1,1},{0,0,1,0}}]\>\
\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tclosure", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"d", ":", 
     RowBox[{"(", 
      RowBox[{"1", "|", "0"}], ")"}], ":", "1"}], ",", 
    RowBox[{"p_:", 
     RowBox[{"Except", "[", "0", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"paths", ",", "edges", ",", "newpaths"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"paths", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", "#"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "@", "m"}], "]"}]}], "}"}]}], ";", 
     RowBox[{"(*", "vertices", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"edges", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"Rule", "@@@", 
         RowBox[{"Position", "[", 
          RowBox[{"m", ",", "p", ",", 
           RowBox[{"{", "2", "}"}], ",", 
           RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}]}], ",", 
        RowBox[{"Join", "@@", "paths"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"d", "===", "0"}], ",", 
       RowBox[{"edges", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Join", "[", 
          RowBox[{"edges", ",", 
           RowBox[{"Reverse", "/@", "edges"}]}], "]"}], "]"}]}]}], "]"}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"AppendTo", "[", 
      RowBox[{"paths", ",", "edges"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"edges", "=", 
      RowBox[{"Dispatch", "[", "edges", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "}"}], "\[NotEqual]", 
        RowBox[{"(", 
         RowBox[{"newpaths", "=", 
          RowBox[{"Complement", "[", 
           RowBox[{
            RowBox[{"DeleteDuplicates", "@", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Thread", "[", 
                 RowBox[{"#1", "\[Rule]", 
                  RowBox[{"ReplaceList", "[", 
                   RowBox[{"#2", ",", "edges"}], "]"}]}], "]"}], "&"}], "@@@", 
               RowBox[{"Last", "@", "paths"}]}], "]"}]}], ",", 
            RowBox[{"Join", "@@", "paths"}]}], "]"}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"paths", ",", "newpaths"}], "]"}]}], "\[IndentingNewLine]", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"Dimensions", "@", "m"}], ",", "2"}], "]"}]}], "]"}], ",", 
       RowBox[{
        RowBox[{"List", "@@@", 
         RowBox[{"Flatten", "[", "paths", "]"}]}], "\[Rule]", "1"}]}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.719651701607442*^9, 3.7196517138561697`*^9}, {
   3.719652298133848*^9, 3.719652365587676*^9}, {3.719652396073495*^9, 
   3.7196523962272053`*^9}, {3.719652507896278*^9, 3.719652509011404*^9}, {
   3.719652545481112*^9, 3.719652547125983*^9}, {3.7196531234565477`*^9, 
   3.7196531342145033`*^9}, {3.719653196948207*^9, 3.719653218635384*^9}, {
   3.719654654884411*^9, 3.719654659576186*^9}, {3.7196547455301313`*^9, 
   3.719654751352714*^9}, {3.719655284993042*^9, 3.719655398076249*^9}, {
   3.719655881351858*^9, 3.7196559126751537`*^9}, {3.7196559705111647`*^9, 
   3.719655976776245*^9}, {3.719660090170336*^9, 3.719660090393218*^9}, {
   3.719706061161648*^9, 3.71970606168744*^9}, {3.719706149702243*^9, 
   3.7197061534959908`*^9}, {3.7197307145261583`*^9, 3.719730723048646*^9}, {
   3.719731931604109*^9, 3.7197319602936077`*^9}, 3.719732062693516*^9, {
   3.7197324820955*^9, 3.719732487616021*^9}, {3.719734368042199*^9, 
   3.719734369786233*^9}, {3.719734421483749*^9, 3.719734440501052*^9}, {
   3.719734478471178*^9, 3.719734489807366*^9}},
 ExpressionUUID -> "fe758ed2-810c-42ea-8ea1-f9518e4f8daf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TClosure", "[", 
   RowBox[{"ds_", "?", "DSystemQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tc", ",", "lc"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tc", "=", 
      RowBox[{"TClosure", "/.", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", "2"}],
         "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"tc", "===", "TClosure"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"lc", "=", 
         RowBox[{"Transpose", "[", 
          RowBox[{
           RowBox[{"Values", "[", 
            RowBox[{"ds", "[", 
             RowBox[{"[", "]"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tc", "=", 
         RowBox[{"tclosure", "[", 
          RowBox[{"lc", ",", "1", ",", 
           RowBox[{"Except", "[", 
            RowBox[{"{", 
             RowBox[{"0", ".."}], "}"}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"HistoryAddExtra", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"TClosure", "\[Rule]", "tc"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Read TClosure from extras.\>\"", ",", "Small"}], "]"}], 
        "]"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "tc"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.719665653647743*^9, 3.71966571888421*^9}, {
   3.719665749948429*^9, 3.71966584544868*^9}, {3.719665882214034*^9, 
   3.719665884838501*^9}, {3.719665952463447*^9, 3.719666056384942*^9}, {
   3.719666109106063*^9, 3.7196661775650187`*^9}, {3.7196999982388697`*^9, 
   3.7197000715684347`*^9}, {3.719705906994117*^9, 3.71970591033497*^9}, {
   3.719705950352181*^9, 3.719705997013092*^9}, {3.719706128422389*^9, 
   3.719706181981895*^9}, 3.719730778319806*^9, {3.719732090444763*^9, 
   3.719732104773196*^9}, {3.719732171405158*^9, 3.719732208725486*^9}, {
   3.719732310774341*^9, 3.71973237494258*^9}, 3.719732414479376*^9, {
   3.7197325082399483`*^9, 3.7197325224077587`*^9}, {3.720184915308753*^9, 
   3.720184920323051*^9}, 3.7213544128893147`*^9, 3.721381327920908*^9, {
   3.7217165768667173`*^9, 3.72171657752232*^9}, {3.7217166400426607`*^9, 
   3.7217166435785847`*^9}},
 ExpressionUUID -> "b87bf41c-c9ae-4770-8c35-05eb84c0c3a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"TClosure", "[", "as_Association", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"tc", ",", "lc"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tc", "=", 
      RowBox[{"TClosure", "/.", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", "2"}],
         "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"lc", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{
        RowBox[{"Values", "[", 
         RowBox[{"ds", "[", 
          RowBox[{"[", "]"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tclosure", "[", 
      RowBox[{"lc", ",", "1", ",", 
       RowBox[{"Except", "[", 
        RowBox[{"{", 
         RowBox[{"0", ".."}], "}"}], "]"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.719665653647743*^9, 3.71966571888421*^9}, {
   3.719665749948429*^9, 3.71966584544868*^9}, {3.719665882214034*^9, 
   3.719665884838501*^9}, {3.719665952463447*^9, 3.719666056384942*^9}, {
   3.719666109106063*^9, 3.7196661775650187`*^9}, {3.7196999982388697`*^9, 
   3.7197000715684347`*^9}, {3.719705906994117*^9, 3.71970591033497*^9}, {
   3.719705950352181*^9, 3.719705997013092*^9}, {3.719706128422389*^9, 
   3.719706181981895*^9}, 3.719730778319806*^9, {3.719732090444763*^9, 
   3.719732104773196*^9}, {3.719732171405158*^9, 3.719732208725486*^9}, {
   3.719732310774341*^9, 3.71973237494258*^9}, 3.719732414479376*^9, {
   3.7197325082399483`*^9, 3.7197325224077587`*^9}, {3.720184915308753*^9, 
   3.720184976874489*^9}, {3.721716581010387*^9, 3.72171658313783*^9}, 
   3.721716647459573*^9},
 ExpressionUUID -> "d3d83cc2-ca73-42e4-a13d-6e7e6f8c83ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["SubsystemsIndices,LargestSubsystemsIndices", "Subsubsection",
 CellChangeTimes->{{3.719625996899959*^9, 3.719626022595653*^9}, 
   3.7197318157141933`*^9, {3.768193363423546*^9, 3.768193369601935*^9}, {
   3.7685424506043587`*^9, 3.768542480460862*^9}, {3.768542529468781*^9, 
   3.768542536260831*^9}, {3.768545320228958*^9, 3.768545320381936*^9}},
 ExpressionUUID -> "d5c379c5-6789-4bb5-8428-20e94e5db380"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SubsystemsIndices", "::", "usage"}], "=", 
  "\"\<SubsystemsIndices[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives a list {{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]},\[Ellipsis]} with each element \
being the list of indices for the valid subsystem.\>\""}]], "Code",
 CellChangeTimes->{{3.768542492701755*^9, 3.768542584742093*^9}, {
  3.768545288422456*^9, 3.768545288798081*^9}},
 ExpressionUUID -> "cf120357-0c4c-4fdd-877d-637956d8c755"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SubsystemsIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"SortBy", "[", 
   RowBox[{
    RowBox[{"DeleteDuplicates", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Flatten", "[", 
        RowBox[{"Position", "[", 
         RowBox[{"#", ",", "1", ",", 
          RowBox[{"{", "1", "}"}]}], "]"}], "]"}], "&"}], "/@", 
      RowBox[{"If", "[", 
       RowBox[{"tc", ",", "m", ",", 
        RowBox[{"TClosure", "[", "m", "]"}]}], "]"}]}], "]"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Last", "@", "#"}], ",", 
       RowBox[{"Length", "@", "#"}]}], "}"}], "&"}]}], "]"}]}]], "Code",
 CellChangeTimes->{
  3.719654341574215*^9, {3.719654476306919*^9, 3.719654481295598*^9}, {
   3.7196554119650707`*^9, 3.7196554122682657`*^9}, {3.719660041474751*^9, 
   3.719660041718134*^9}, {3.719731145455214*^9, 3.719731145599196*^9}, {
   3.7197317417542753`*^9, 3.719731744306674*^9}, {3.71973185875562*^9, 
   3.7197318617230587`*^9}, {3.720157191356635*^9, 3.7201573014717073`*^9}, {
   3.7201576435101547`*^9, 3.720157750676778*^9}, {3.722301694587873*^9, 
   3.7223017091210957`*^9}, {3.722309679302579*^9, 3.722309731486992*^9}, 
   3.7223098486250772`*^9, 3.7223100463945837`*^9, {3.7681939120138807`*^9, 
   3.7681939175578117`*^9}, {3.7685425999583197`*^9, 3.7685426132706213`*^9}, 
   3.7685431217101107`*^9},
 ExpressionUUID -> "af33b122-ef7c-4267-8e37-8b5c918a7585"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SubsystemsIndices", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"SubsystemsIndices", "[", 
   RowBox[{
    RowBox[{"TClosure", "[", "ds", "]"}], ",", "True"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.768542160084371*^9, 3.7685421832920303`*^9}, {
  3.768543156994515*^9, 3.768543159395172*^9}},
 ExpressionUUID -> "f8478787-bfd8-480c-82eb-6f1e4a30fc12"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LargestSubsystemsIndices", "::", "usage"}], "=", 
  "\"\<LargestSubsystemsIndices[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives a list {{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]},\[Ellipsis]} with each element \
being the list of indices for the valid largest subsystem.\>\""}]], "Code",
 CellChangeTimes->{{3.7685452684387617`*^9, 3.768545282838435*^9}},
 ExpressionUUID -> "689e0974-1df8-451d-aa2d-488b0bd67569"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LargestSubsystemsIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"ss", "=", 
       RowBox[{"Reverse", "@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"SubsystemsIndices", "[", 
           RowBox[{"m", ",", "tc"}], "]"}], ",", "Length"}], "]"}]}]}], ",", 
      RowBox[{"left", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"Length", "@", "m"}], "]"}]}], ",", "left1", ",", 
      RowBox[{"res", "=", 
       RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"left", "=!=", 
          RowBox[{"(", 
           RowBox[{"left1", "=", 
            RowBox[{"Complement", "[", 
             RowBox[{"left", ",", 
              RowBox[{"ss", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ")"}]}], ",", 
         RowBox[{
          RowBox[{"left", "=", "left1"}], ";", 
          RowBox[{"PrependTo", "[", 
           RowBox[{"res", ",", 
            RowBox[{"ss", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "ss"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "res"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.76854363242091*^9, 3.7685437711338463`*^9}, {
   3.768543822056863*^9, 3.76854391405518*^9}, 3.768545255120963*^9},
 ExpressionUUID -> "11cc8578-a609-469c-bafe-5cd72353a076"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LargestSubsystemsIndices", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"LargestSubsystemsIndices", "[", 
   RowBox[{
    RowBox[{"TClosure", "[", "ds", "]"}], ",", "True"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.768542160084371*^9, 3.7685421832920303`*^9}, {
  3.768543156994515*^9, 3.768543159395172*^9}, {3.768545297560296*^9, 
  3.7685453006468153`*^9}},
 ExpressionUUID -> "80be3257-8c50-419d-8df5-bdc85a4bc931"]
}, Closed]],

Cell[CellGroupData[{

Cell["EntangledBlocksIndices", "Subsubsection",
 CellChangeTimes->{{3.719625996899959*^9, 3.719626022595653*^9}, 
   3.7197318157141933`*^9, {3.768193363423546*^9, 3.768193369601935*^9}, {
   3.7685424506043587`*^9, 3.76854245074072*^9}},
 ExpressionUUID -> "d5c379c5-6789-4bb5-8428-20e94e5db380"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EntangledBlocksIndices", "::", "usage"}], "=", 
   "\"\<EntangledBlocksIndices[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives a partitioned list {{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]},\[Ellipsis]} such that the \
reordering {\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis],\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]} of columns and rows of \!\(\*
StyleBox[\"m\", \"TI\"]\) transforms it to lower block-triangular form. The \
partition indicates separate blocks. The order guarantees that dependent \
blocks appear earlier.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.5946962031649194`*^9, 3.5946962033500443`*^9}, {
   3.5946964648589287`*^9, 3.594696476782811*^9}, {3.594697189537241*^9, 
   3.594697190571929*^9}, {3.594768409230133*^9, 3.5947684147347717`*^9}, {
   3.624814416190477*^9, 3.624814424413924*^9}, {3.6248159746928186`*^9, 
   3.6248159833355436`*^9}, {3.6251994886047354`*^9, 3.625199498034993*^9}, {
   3.722301738650923*^9, 3.7223017955532713`*^9}, 3.7229121136292553`*^9},
 CellTags->"Queries",
 ExpressionUUID -> "8424ed69-b0f7-46ba-a88a-f8b3e76bf813"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EntangledBlocksIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "ss", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ss", "=", 
      RowBox[{"SubsystemsIndices", "[", 
       RowBox[{"m", ",", "tc"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Complement", "@@", 
        RowBox[{"Reverse", "[", 
         RowBox[{"Take", "[", 
          RowBox[{"ss", ",", "i"}], "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "ss"}]}], "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{
  3.719654341574215*^9, {3.719654476306919*^9, 3.719654481295598*^9}, {
   3.7196554119650707`*^9, 3.7196554122682657`*^9}, {3.719660041474751*^9, 
   3.719660041718134*^9}, {3.719731145455214*^9, 3.719731145599196*^9}, {
   3.7197317417542753`*^9, 3.719731744306674*^9}, {3.71973185875562*^9, 
   3.7197318617230587`*^9}, {3.720157191356635*^9, 3.7201573014717073`*^9}, {
   3.7201576435101547`*^9, 3.720157750676778*^9}, {3.722301694587873*^9, 
   3.7223017091210957`*^9}, {3.722309679302579*^9, 3.722309731486992*^9}, 
   3.7223098486250772`*^9, 3.7223100463945837`*^9, {3.7681939120138807`*^9, 
   3.7681939175578117`*^9}, {3.768542657016468*^9, 3.76854266126158*^9}, {
   3.7685428130413017`*^9, 3.7685428133118267`*^9}, {3.76854321777911*^9, 
   3.7685432326276293`*^9}},
 ExpressionUUID -> "af33b122-ef7c-4267-8e37-8b5c918a7585"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EntangledBlocksIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "ss", "}"}], ",", 
    RowBox[{
     RowBox[{"ss", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{"#", ",", "1", ",", 
              RowBox[{"{", "1", "}"}]}], "]"}], "]"}], "&"}], "/@", 
          RowBox[{"If", "[", 
           RowBox[{"tc", ",", "m", ",", 
            RowBox[{"TClosure", "[", "m", "]"}]}], "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Last", "@", "#"}], ",", 
           RowBox[{"Length", "@", "#"}]}], "}"}], "&"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Complement", "@@", 
        RowBox[{"Reverse", "[", 
         RowBox[{"Take", "[", 
          RowBox[{"ss", ",", "i"}], "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "ss"}]}], "}"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.719654341574215*^9, {3.719654476306919*^9, 3.719654481295598*^9}, {
   3.7196554119650707`*^9, 3.7196554122682657`*^9}, {3.719660041474751*^9, 
   3.719660041718134*^9}, {3.719731145455214*^9, 3.719731145599196*^9}, {
   3.7197317417542753`*^9, 3.719731744306674*^9}, {3.71973185875562*^9, 
   3.7197318617230587`*^9}, {3.720157191356635*^9, 3.7201573014717073`*^9}, {
   3.7201576435101547`*^9, 3.720157750676778*^9}, {3.722301694587873*^9, 
   3.7223017091210957`*^9}, {3.722309679302579*^9, 3.722309731486992*^9}, 
   3.7223098486250772`*^9, 3.7223100463945837`*^9, {3.7681939120138807`*^9, 
   3.7681939175578117`*^9}, {3.768542657016468*^9, 3.76854266126158*^9}, {
   3.7685428130413017`*^9, 3.7685428133118267`*^9}},
 ExpressionUUID -> "af33b122-ef7c-4267-8e37-8b5c918a7585"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EntangledBlocksIndices", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"EntangledBlocksIndices", "[", 
   RowBox[{
    RowBox[{"TClosure", "[", "ds", "]"}], ",", "True"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.768542160084371*^9, 3.7685421832920303`*^9}},
 ExpressionUUID -> "a893fc8c-b386-4590-a080-4882e59c94ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EntangledBlocksIndices", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "ss", "}"}], ",", 
    RowBox[{
     RowBox[{"ss", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"Union", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Position", "[", 
             RowBox[{"#", ",", "1", ",", 
              RowBox[{"{", "1", "}"}]}], "]"}], "]"}], "&"}], "/@", 
          RowBox[{"TClosure", "[", "ds", "]"}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Last", "@", "#"}], ",", 
           RowBox[{"Length", "@", "#"}]}], "}"}], "&"}]}], "]"}]}], ";", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Complement", "@@", 
        RowBox[{"Reverse", "[", 
         RowBox[{"Take", "[", 
          RowBox[{"ss", ",", "i"}], "]"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", 
         RowBox[{"Length", "@", "ss"}]}], "}"}]}], "]"}]}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7223097991220427`*^9, 3.722309815975421*^9}, {
   3.722309859441794*^9, 3.722309904726425*^9}, 3.722310027969605*^9, {
   3.768193919295403*^9, 3.76819392675952*^9}},
 ExpressionUUID -> "c802e6d8-8f42-42bb-9b53-58bf16115bb0"]
}, Closed]],

Cell[CellGroupData[{

Cell["OffDiagonalBlocksIndices", "Subsubsection",
 CellChangeTimes->{{3.719625996899959*^9, 3.719626022595653*^9}, 
   3.7197318157141933`*^9, {3.768193363423546*^9, 3.768193369601935*^9}, {
   3.768542447596629*^9, 3.768542447725646*^9}},
 ExpressionUUID -> "d5c379c5-6789-4bb5-8428-20e94e5db380"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OffDiagonalBlocksIndices", "::", "usage"}], "=", 
   "\"\<OffDiagonalBlocksIndices[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives a list of pairs {{{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"j\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"j\", \"TI\"], \"2\"]\),\[Ellipsis]}},\[Ellipsis]} such that each \
pair corresponds to the indices of the off-diagonal block. The order should \
be good for treating blocks with BlockTriangularToFuchsian.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.768218696408965*^9, 3.768218894373597*^9}},
 ExpressionUUID -> "d7808e32-d566-4fa6-9cd6-8af35f00c7de"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OffDiagonalBlocksIndices", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Flatten", "\[Rule]", "True"}], ",", 
     RowBox[{"Sort", "\[Rule]", "Row"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OffDiagonalBlocksIndices", "::", "sort"}], "=", 
   "\"\<Option Sort\[Rule]`1` is not allowed. Using Sort\[Rule]Row.\>\""}], 
  ";"}]}], "Code",
 CellChangeTimes->{{3.770962021242753*^9, 3.770962047798596*^9}, {
  3.770962107510343*^9, 3.770962112302911*^9}, {3.770962605345924*^9, 
  3.7709626718299427`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"OffDiagonalBlocksIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "False"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ss", ",", "eb", ",", "res"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ss", "=", 
      RowBox[{"SubsystemsIndices", "[", 
       RowBox[{"m", ",", "tc"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"eb", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Complement", "@@", 
         RowBox[{"Reverse", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"ss", ",", "i"}], "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "ss"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Switch", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "Sort", "]"}], ",", "\[IndentingNewLine]", 
       "Diagonal", ",", "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"SubsetQ", "[", 
             RowBox[{
              RowBox[{"ss", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"eb", "[", 
               RowBox[{"[", 
                RowBox[{"i", "-", "j"}], "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"eb", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"i", "-", "j"}]}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"Unevaluated", "[", 
             RowBox[{"Sequence", "[", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"Length", "@", "ss"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"j", "+", "1"}], ",", 
            RowBox[{"Length", "@", "ss"}]}], "}"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "Row", ",", "\[IndentingNewLine]", 
       RowBox[{"res", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"SubsetQ", "[", 
             RowBox[{
              RowBox[{"ss", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"eb", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"eb", "[", 
             RowBox[{"[", 
              RowBox[{"{", 
               RowBox[{"i", ",", "j"}], "}"}], "]"}], "]"}], ",", 
            RowBox[{"Unevaluated", "[", 
             RowBox[{"Sequence", "[", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "ss"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"i", "-", "1"}], ",", "1", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", "_", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"OffDiagonalBlocksIndices", "::", "sort"}], "]"}], ";", 
        RowBox[{"res", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"SubsetQ", "[", 
              RowBox[{
               RowBox[{"ss", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"eb", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"eb", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"i", ",", "j"}], "}"}], "]"}], "]"}], ",", 
             RowBox[{"Unevaluated", "[", 
              RowBox[{"Sequence", "[", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "ss"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", 
             RowBox[{"i", "-", "1"}], ",", "1", ",", 
             RowBox[{"-", "1"}]}], "}"}]}], "]"}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ";", " ", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "Flatten", "]"}], ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{"res", ",", "1"}], "]"}], ",", "res"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.7681933739075527`*^9, 3.768193373909093*^9}, {
   3.768193439507883*^9, 3.7681934929629173`*^9}, {3.768193556000813*^9, 
   3.7681935570892344`*^9}, {3.768194947058278*^9, 3.7681949735985518`*^9}, {
   3.768543283411866*^9, 3.768543297883294*^9}, 3.77010722494703*^9, 
   3.770133303460746*^9, {3.770962059152515*^9, 3.770962063538452*^9}, {
   3.770962138663067*^9, 3.770962192375367*^9}, {3.770962241335215*^9, 
   3.770962295819448*^9}, {3.770962346047378*^9, 3.770962598558702*^9}, {
   3.770962685320368*^9, 3.770962741823936*^9}},
 ExpressionUUID -> "3fbc7744-6449-48a5-8711-3f4f2902257f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OffDiagonalBlocksIndices", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"OffDiagonalBlocksIndices", "[", 
   RowBox[{
    RowBox[{"TClosure", "[", "ds", "]"}], ",", "True"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.768542160084371*^9, 3.768542204460298*^9}},
 ExpressionUUID -> "526271ca-97d1-48c5-aafa-6aa27c30022f"]
}, Closed]],

Cell[CellGroupData[{

Cell["DiagonalBlocksIndices (deprecated)", "Subsubsection",
 CellChangeTimes->{
  3.719731767251678*^9, {3.7277450203039827`*^9, 3.727745023184762*^9}},
 ExpressionUUID -> "3d7c7508-4d40-42ea-b1cb-fb3d2253087b"],

Cell["TODO: maybe symmetrization is not necessary?", "Text",
 CellChangeTimes->{{3.7197317793617992`*^9, 3.719731809106439*^9}},
 ExpressionUUID -> "02864914-0750-4de1-938e-75a98cf3ab36"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DiagonalBlocksIndices", "::", "usage"}], "=", 
   "\"\<DiagonalBlocksIndices[\!\(\*
StyleBox[\"m\", \"TI\"]\)] gives a partitioned list {{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]},\[Ellipsis]} such that the \
reordering {\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis],\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"k\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], 
RowBox[{\"k\", \"+\", \"1\"}]]\),\[Ellipsis]} of columns and rows of \!\(\*
StyleBox[\"m\", \"TI\"]\) transforms it to block-diagonal form. The partition \
indicates separate diagonal blocks.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.5946962031649194`*^9, 3.5946962033500443`*^9}, {
  3.5946964648589287`*^9, 3.594696476782811*^9}, {3.594697189537241*^9, 
  3.594697190571929*^9}, {3.594768409230133*^9, 3.5947684147347717`*^9}, {
  3.624814416190477*^9, 3.624814424413924*^9}, {3.6248159746928186`*^9, 
  3.6248159833355436`*^9}, {3.6251994886047354`*^9, 3.625199498034993*^9}, {
  3.6252024026655583`*^9, 3.625202452257471*^9}},
 CellTags->"Queries",
 ExpressionUUID -> "ce648ea3-74cd-4d80-aba3-40096c901062"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DiagonalBlocksIndices", "[", "m_", "]"}], ":=", 
  RowBox[{
   RowBox[{"GatherBy", "[", 
    RowBox[{
     RowBox[{"MapIndexed", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#2", ",", 
          RowBox[{"Position", "[", 
           RowBox[{"#", ",", "1", ",", 
            RowBox[{"{", "1", "}"}]}], "]"}]}], "}"}], "&"}], ",", 
       RowBox[{"tclosure", "[", 
        RowBox[{"m", ",", "0"}], "]"}]}], "]"}], ",", "Last"}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "All", ",", "1", ",", "1"}], "]"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.7196554281916323`*^9, 3.719655431277666*^9}, {
  3.719660047256283*^9, 3.71966004751105*^9}, {3.7197311605674677`*^9, 
  3.719731161047188*^9}},
 ExpressionUUID -> "cf55aa26-284c-4606-8f2d-01da71326c76"]
}, Closed]],

Cell[CellGroupData[{

Cell["DependentRowIndices,DependentColumnIndices", "Subsubsection",
 CellChangeTimes->{
  3.7197317588026857`*^9, {3.721111832469984*^9, 3.721111881294001*^9}},
 ExpressionUUID -> "6235c376-8078-4508-8437-c878005f9310"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DependentRowIndices", "::", "usage"}], "=", 
   "\"\<DependentRowIndices[\!\(\*
StyleBox[\"matrix\", \"TI\"]\),\!\(\*
StyleBox[\"index\", \"TI\"]\)] gives a list of indices of all dependent \
rows\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.594768425070605*^9, 3.594768541069293*^9}, {
  3.594768605677006*^9, 3.594768617955124*^9}, {3.594768763048047*^9, 
  3.594768801818677*^9}},
 CellTags->"Queries",
 ExpressionUUID -> "a63db4b3-d6cd-4355-a2b0-f8e1079eadd5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DependentRowIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "rows_", ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", 
      RowBox[{"True", "|", "False"}], ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Union", "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{"#", ",", "1", ",", 
        RowBox[{"{", "1", "}"}]}], "]"}], "&"}], "/@", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{"tc", ",", "m", ",", 
        RowBox[{"TClosure", "[", "m", "]"}]}], "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "rows", "}"}], "]"}], "]"}], "]"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{
  3.71973257074367*^9, {3.7197326253236103`*^9, 3.719732625495676*^9}, {
   3.719734228910142*^9, 3.719734248773912*^9}, {3.719734575354805*^9, 
   3.719734614965242*^9}, {3.719734706266326*^9, 3.719734731276202*^9}, {
   3.7197348610113907`*^9, 3.719734879076476*^9}, {3.7201573556078*^9, 
   3.720157363280262*^9}, {3.7201577328059683`*^9, 3.7201577479337187`*^9}},
 ExpressionUUID -> "a398d82f-23ad-4b1a-9bb5-f5a8dc95b424"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DependentRowIndices", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "rows_", ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"DependentRowIndices", "[", 
   RowBox[{
    RowBox[{"TClosure", "[", "ds", "]"}], ",", "rows", ",", "True"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{
  3.71973257074367*^9, {3.7197326253236103`*^9, 3.719732625495676*^9}, {
   3.719734228910142*^9, 3.719734248773912*^9}, {3.719734575354805*^9, 
   3.719734614965242*^9}, {3.719734706266326*^9, 3.719734731276202*^9}, {
   3.7197348610113907`*^9, 3.719734879076476*^9}, {3.7201573556078*^9, 
   3.720157363280262*^9}, {3.7201577328059683`*^9, 3.7201577745099688`*^9}, {
   3.768542271220777*^9, 3.768542332788604*^9}},
 ExpressionUUID -> "92828896-fcbb-4115-aa2a-685f404a0e67"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DependentRowIndices", "[", 
   RowBox[{"ds_", ",", "rows_", ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"Union", "@", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Position", "[", 
       RowBox[{"#", ",", "1", ",", 
        RowBox[{"{", "1", "}"}]}], "]"}], "&"}], "/@", 
     RowBox[{
      RowBox[{"TClosure", "[", "ds", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "rows", "}"}], "]"}], "]"}], "]"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{
  3.71973257074367*^9, {3.7197326253236103`*^9, 3.719732625495676*^9}, {
   3.719734228910142*^9, 3.719734248773912*^9}, {3.719734575354805*^9, 
   3.719734614965242*^9}, {3.719734706266326*^9, 3.719734731276202*^9}, {
   3.7197348610113907`*^9, 3.719734879076476*^9}, {3.7201573556078*^9, 
   3.720157363280262*^9}, {3.7201577328059683`*^9, 3.7201577745099688`*^9}, 
   3.768542271220777*^9},
 ExpressionUUID -> "92828896-fcbb-4115-aa2a-685f404a0e67"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DependentColumnIndices", "::", "usage"}], "=", 
   "\"\<DependentColumnIndices[\!\(\*
StyleBox[\"matrix\", \"TI\"]\),\!\(\*
StyleBox[\"index\", \"TI\"]\)] gives a list of indices of all dependent \
columns\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721111963847333*^9, 3.721111972382742*^9}},
 ExpressionUUID -> "919ea72b-fa01-47d6-8cc2-d2a629529480"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DependentColumnIndices", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "args__"}], "]"}], ":=", 
  RowBox[{"DependentRowIndices", "[", 
   RowBox[{
    RowBox[{"Transpose", "[", "m", "]"}], ",", "args"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.721111889855186*^9, 3.721111953607114*^9}, 
   3.722578310674747*^9, {3.727065345081635*^9, 3.727065352379445*^9}, {
   3.727065402512157*^9, 3.727065410151052*^9}, 3.759187411176682*^9, {
   3.759187464563115*^9, 3.759187494388483*^9}, 3.7685423157566137`*^9},
 ExpressionUUID -> "9732b107-68e0-4271-9672-c4a85f302cbd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DependentColumnIndices", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "rows_", ",", 
    RowBox[{"tc", ":", 
     RowBox[{"(", "False", ")"}], ":", "False"}]}], "]"}], ":=", 
  RowBox[{"DependentColumnIndices", "[", 
   RowBox[{
    RowBox[{"TClosure", "[", "ds", "]"}], ",", "rows", ",", "True"}], 
   "]"}]}]], "Code",
 CellChangeTimes->{
  3.71973257074367*^9, {3.7197326253236103`*^9, 3.719732625495676*^9}, {
   3.719734228910142*^9, 3.719734248773912*^9}, {3.719734575354805*^9, 
   3.719734614965242*^9}, {3.719734706266326*^9, 3.719734731276202*^9}, {
   3.7197348610113907`*^9, 3.719734879076476*^9}, {3.7201573556078*^9, 
   3.720157363280262*^9}, {3.7201577328059683`*^9, 3.7201577745099688`*^9}, {
   3.768542271220777*^9, 3.768542342684791*^9}},
 ExpressionUUID -> "92828896-fcbb-4115-aa2a-685f404a0e67"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Basic matrix operations", "Subsection",
 CellChangeTimes->{{3.719625670755124*^9, 3.7196256751467237`*^9}, {
  3.719625803259419*^9, 3.7196258059788322`*^9}},
 ExpressionUUID -> "c17ef473-aa2b-47b2-b027-f08bd25a3eca"],

Cell[CellGroupData[{

Cell["$LibraUseFermat", "Subsubsection",
 CellChangeTimes->{{3.727748095761063*^9, 3.727748101381113*^9}, 
   3.728001538269258*^9, 3.76853030392348*^9},
 ExpressionUUID -> "933f9962-deb7-4d18-b046-2c1c81b5e459"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"$LibraUseFermat", "::", "error"}], "=", 
   "\"\<$LibraUseFermat can be set either to False or to True. The latter \
case requires Fermatica\\` to be in the $ContextPath.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"$LibraUseFermat", "/:", 
   RowBox[{"Set", "[", 
    RowBox[{"$LibraUseFermat", ",", "val_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"val", "===", "False"}], ")"}], "||", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"val", "===", "True"}], "&&", 
        RowBox[{"MemberQ", "[", 
         RowBox[{"$ContextPath", ",", "\"\<Fermatica`\>\""}], "]"}]}], 
       ")"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"OwnValues", "[", "$LibraUseFermat", "]"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"HoldPattern", "[", "$LibraUseFermat", "]"}], 
         "\[RuleDelayed]", "val"}], "}"}]}], ";", "val"}], ",", 
     RowBox[{
      RowBox[{"Message", "[", 
       RowBox[{"$LibraUseFermat", "::", "error"}], "]"}], ";", 
      "$LibraUseFermat"}]}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.7280015382980623`*^9, 3.728001538303713*^9}},
 ExpressionUUID -> "74e08734-36a9-49f0-b3f8-556eb45912b4"]
}, Closed]],

Cell[CellGroupData[{

Cell["OQuolyMod", "Subsubsection",
 CellChangeTimes->{{3.72989825305993*^9, 3.72989826212052*^9}},
 ExpressionUUID -> "2e04d7cf-76d1-4016-83a0-cd17142f60f0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OQuolyMod", "::", "usage"}], "=", 
   "\"\<OQuolyMod[quoly,poly,x] gives the \\\"remainder\\\" of the rational \
function quoly when divided by poly. First capital 'O' stands for \
'optimized'.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7299034532610693`*^9, 3.729903558580655*^9}},
 ExpressionUUID -> "fcdae749-2558-45ac-bc11-631a7a116a7e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OQuolyMod", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"UseFermat", "\[Rule]", "False"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.768530051740211*^9, 3.768530066596572*^9}, {
  3.768607347320628*^9, 3.768607348692778*^9}},
 ExpressionUUID -> "b13771d7-0fd0-4745-a5a0-715c176c3521"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "done", "[", 
   "\"\<Remove obsolete definitionfor \
OQuolyMod[quoly_,rule:_Rule|_RuleDelayed]\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.768191712521935*^9, 3.768191738202401*^9}, {
  3.768191846464525*^9, 3.768191876850855*^9}, {3.768530047365003*^9, 
  3.768530047807385*^9}},
 ExpressionUUID -> "22b880af-081b-4e7f-8cb7-a1bf620a2bfc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OQuolyMod", "[", 
   RowBox[{"quoly_", ",", 
    RowBox[{"poly", ":", 
     RowBox[{"Except", "[", "_Rule", "]"}]}], ",", "x_Symbol", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"OQuolyMod", "[", 
   RowBox[{"quoly", ",", 
    RowBox[{"x", "\[Rule]", "poly"}], ",", "opts"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729898265805801*^9, 3.729898324814674*^9}, {3.729900477182205*^9, 
   3.7299005147902803`*^9}, {3.7299005649114428`*^9, 3.729900652225518*^9}, {
   3.7299007045771103`*^9, 3.729900708368188*^9}, {3.768191699506692*^9, 
   3.7681917089140244`*^9}, {3.7706026315949*^9, 3.770602700095398*^9}},
 ExpressionUUID -> "db0c6527-05de-4aa4-9003-6f6c0531106d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OQuolyMod", "[", 
   RowBox[{"quoly_", ",", 
    RowBox[{"x_Symbol", "\[Rule]", "poly_"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"$LibraUseFermat", "&&", 
     RowBox[{"OptionValue", "[", "UseFermat", "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Replace", "[", 
     RowBox[{
      RowBox[{"CheckAbort", "[", 
       RowBox[{
        RowBox[{"FQuolyMod", "[", 
         RowBox[{"quoly", ",", "poly", ",", "x"}], "]"}], ",", "$Failed"}], 
       "]"}], ",", 
      RowBox[{"$Failed", "\[RuleDelayed]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<OQuolyMod: resorting to Mathematica\[Ellipsis]\>\"", "]"}], 
         ";", 
         RowBox[{"QuolyMod", "[", 
          RowBox[{"quoly", ",", "poly", ",", "x"}], "]"}]}], ")"}]}]}], "]"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{"QuolyMod", "[", 
     RowBox[{"quoly", ",", "poly", ",", "x"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.721973949358294*^9, 3.721974117167425*^9}, 
   3.721974151456019*^9, {3.721974366313018*^9, 3.721974414608509*^9}, 
   3.7219747100096703`*^9, {3.729648773356496*^9, 3.729648774596756*^9}, 
   3.729897381444847*^9, {3.729897418957363*^9, 3.729897439164116*^9}, {
   3.729898265805801*^9, 3.729898324814674*^9}, {3.729900477182205*^9, 
   3.7299005147902803`*^9}, {3.7299005649114428`*^9, 3.729900652225518*^9}, {
   3.7299007045771103`*^9, 3.729900708368188*^9}, 3.768191699506692*^9, {
   3.768530072165442*^9, 3.768530095965674*^9}, {3.7706026511192513`*^9, 
   3.770602666503394*^9}},
 ExpressionUUID -> "db0c6527-05de-4aa4-9003-6f6c0531106d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FQuolyMod", "[", "exs__", "]"}], ":=", 
  RowBox[{"Fermatica`FQuolyMod", "[", "exs", "]"}], 
  RowBox[{"(*", 
   RowBox[{"FCStaticMonitor", "[", 
    RowBox[{
     RowBox[{"Fermatica`FQuolyMod", "[", "exs", "]"}], ",", 
     RowBox[{"Style", "[", 
      RowBox[{"\"\<Executing Fermatica`FQuolyMod...\>\"", ",", "Tiny"}], 
      "]"}], ",", "1"}], "]"}], "*)"}]}]], "Code",
 CellChangeTimes->{{3.72775136425244*^9, 3.727751484612381*^9}, {
   3.727751557056512*^9, 3.7277515573979*^9}, {3.727752054466782*^9, 
   3.7277520730804996`*^9}, {3.727753237795642*^9, 3.7277532417449837`*^9}, {
   3.72800108696859*^9, 3.72800108720708*^9}, {3.728002475175424*^9, 
   3.728002486895668*^9}, 3.728004003899982*^9, {3.7298983396690683`*^9, 
   3.729898366650766*^9}, 3.729898400789863*^9, {3.768693256231906*^9, 
   3.768693258495675*^9}, {3.770123975806756*^9, 3.770123979994088*^9}},
 ExpressionUUID -> "970c5930-1f15-41fb-a5e2-64bc41f305f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", 
   "\"\<Make better version of QuolyMod and especially FQuolyMod to deal with \
several successive moddings wrt to different polynomials and variables.\>\"", 
   "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.768191712521935*^9, 3.768191738202401*^9}, {
  3.768191846464525*^9, 3.768191876850855*^9}, {3.768192929599284*^9, 
  3.768193051367763*^9}},
 ExpressionUUID -> "3d9904e0-5bce-4b5d-a336-b3732ea1d717"]
}, Closed]],

Cell[CellGroupData[{

Cell["ODot", "Subsubsection",
 CellChangeTimes->{{3.72774491436176*^9, 3.7277449162094183`*^9}, 
   3.727745729562084*^9},
 ExpressionUUID -> "0facd0d4-5f26-4374-bbc2-f33a239c28f9"],

Cell["Later we will modify this ", "Text",
 CellChangeTimes->{{3.727744856498373*^9, 3.727744867011715*^9}},
 ExpressionUUID -> "83a88093-aa5e-4097-9246-ce9033b05649"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ODot", "::", "usage"}], "=", 
  "\"\<ODot[m1,m2,...] is an optimized dot product.\>\""}]], "Code",
 CellChangeTimes->{{3.7277450763134813`*^9, 3.727745128250895*^9}, {
  3.7277457296033583`*^9, 3.727745729604396*^9}, {3.727749477779316*^9, 
  3.7277494839634113`*^9}},
 ExpressionUUID -> "00165fd8-1a32-4e1f-ba1e-ac9c93a32575"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ODot", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"UseFermat", "\[Rule]", "False"}], ",", 
     RowBox[{"Together", "\[Rule]", "True"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{
  3.7685301115942583`*^9, {3.7686073589843903`*^9, 3.7686073598494864`*^9}, {
   3.7698071060305557`*^9, 3.769807111419466*^9}},
 ExpressionUUID -> "f4fe2e48-e1a4-4adc-9fe9-592f742293b1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ODot", "[", 
    RowBox[{"exs__", ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"$LibraUseFermat", "&&", 
      RowBox[{"OptionValue", "[", "UseFermat", "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Replace", "[", 
      RowBox[{
       RowBox[{"CheckAbort", "[", 
        RowBox[{
         RowBox[{"FDot", "[", "exs", "]"}], ",", "$Failed"}], "]"}], ",", 
       RowBox[{"$Failed", "\[RuleDelayed]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<ODot: resorting to Mathematica\[Ellipsis]\>\"", 
           "]"}], ";", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OptionValue", "[", "Together", "]"}], ",", "Together", 
             ",", "Identity"}], "]"}], "@", 
           RowBox[{"Dot", "[", "exs", "]"}]}]}], ")"}]}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Together", "]"}], ",", "Together", ",", 
        "Identity"}], "]"}], "@", 
      RowBox[{"Dot", "[", "exs", "]"}]}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.727744827981697*^9, 3.727744850852857*^9}, 
   3.727745729615004*^9, {3.727749518683105*^9, 3.727749587041399*^9}, {
   3.727749705161397*^9, 3.727749796453553*^9}, {3.727750900676277*^9, 
   3.727750902787034*^9}, {3.72775133078442*^9, 3.72775135176515*^9}, {
   3.727751488093606*^9, 3.72775148827957*^9}, {3.7277520650277576`*^9, 
   3.7277520696770687`*^9}, 3.728001538308874*^9, {3.729898386747697*^9, 
   3.729898391925767*^9}, {3.768530120733622*^9, 3.7685301215585403`*^9}, {
   3.768530239141673*^9, 3.768530239358635*^9}, {3.769807122659418*^9, 
   3.76980714804*^9}},
 ExpressionUUID -> "5fbd6f02-af6f-47b6-bef7-d6b6f6a660e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FDot", "[", "exs__", "]"}], ":=", 
  RowBox[{"Fermatica`FDot", "[", "exs", "]"}], 
  RowBox[{"(*", 
   RowBox[{"FCStaticMonitor", "[", 
    RowBox[{
     RowBox[{"Fermatica`FDot", "[", "exs", "]"}], ",", 
     RowBox[{"Style", "[", 
      RowBox[{"\"\<Executing Fermatica`FDot...\>\"", ",", "Tiny"}], "]"}], 
     ",", "1"}], "]"}], "*)"}]}]], "Code",
 CellChangeTimes->{{3.72775136425244*^9, 3.727751484612381*^9}, {
   3.727751557056512*^9, 3.7277515573979*^9}, {3.727752054466782*^9, 
   3.7277520730804996`*^9}, {3.727753237795642*^9, 3.7277532417449837`*^9}, {
   3.72800108696859*^9, 3.72800108720708*^9}, {3.728002475175424*^9, 
   3.728002486895668*^9}, 3.728004003899982*^9, {3.7686932665360947`*^9, 
   3.768693268190895*^9}, {3.770123961465128*^9, 3.770123962964267*^9}},
 ExpressionUUID -> "6a8851cc-1b40-4914-b40a-272c40e30dc7"]
}, Closed]],

Cell[CellGroupData[{

Cell["ODet", "Subsubsection",
 CellChangeTimes->{{3.72774491436176*^9, 3.7277449162094183`*^9}, 
   3.727745729562084*^9, 3.768973711744979*^9},
 ExpressionUUID -> "0facd0d4-5f26-4374-bbc2-f33a239c28f9"],

Cell["Later we will modify this ", "Text",
 CellChangeTimes->{{3.727744856498373*^9, 3.727744867011715*^9}},
 ExpressionUUID -> "83a88093-aa5e-4097-9246-ce9033b05649"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ODet", "::", "usage"}], "=", 
  "\"\<ODet[m1] is an optimized version of Det.\>\""}]], "Code",
 CellChangeTimes->{{3.7277450763134813`*^9, 3.727745128250895*^9}, {
   3.7277457296033583`*^9, 3.727745729604396*^9}, {3.727749477779316*^9, 
   3.7277494839634113`*^9}, 3.768973736234611*^9, {3.76897380265487*^9, 
   3.768973820309557*^9}},
 ExpressionUUID -> "00165fd8-1a32-4e1f-ba1e-ac9c93a32575"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ODet", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"UseFermat", "\[Rule]", "False"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{
  3.7685301115942583`*^9, {3.7686073589843903`*^9, 3.7686073598494864`*^9}, {
   3.7689738271672583`*^9, 3.7689738277343807`*^9}},
 ExpressionUUID -> "f6a9668e-9faa-4c53-b6e8-14fb0467b1af"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ODet", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{"$LibraUseFermat", "&&", 
      RowBox[{"OptionValue", "[", "UseFermat", "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Replace", "[", 
      RowBox[{
       RowBox[{"CheckAbort", "[", 
        RowBox[{
         RowBox[{"FDet", "[", "m", "]"}], ",", "$Failed"}], "]"}], ",", 
       RowBox[{"$Failed", "\[RuleDelayed]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<ODet: resorting to Mathematica\[Ellipsis]\>\"", 
           "]"}], ";", 
          RowBox[{"Det", "[", "m", "]"}]}], ")"}]}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Det", "[", "m", "]"}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.727744827981697*^9, 3.727744850852857*^9}, 
   3.727745729615004*^9, {3.727749518683105*^9, 3.727749587041399*^9}, {
   3.727749705161397*^9, 3.727749796453553*^9}, {3.727750900676277*^9, 
   3.727750902787034*^9}, {3.72775133078442*^9, 3.72775135176515*^9}, {
   3.727751488093606*^9, 3.72775148827957*^9}, {3.7277520650277576`*^9, 
   3.7277520696770687`*^9}, 3.728001538308874*^9, {3.729898386747697*^9, 
   3.729898391925767*^9}, {3.768530120733622*^9, 3.7685301215585403`*^9}, {
   3.768530239141673*^9, 3.768530239358635*^9}, {3.768973830943248*^9, 
   3.7689738959205723`*^9}},
 ExpressionUUID -> "5fbd6f02-af6f-47b6-bef7-d6b6f6a660e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FDet", "[", "m__", "]"}], ":=", 
  RowBox[{"Fermatica`FDet", "[", "m", "]"}], 
  RowBox[{"(*", 
   RowBox[{"FCStaticMonitor", "[", 
    RowBox[{
     RowBox[{"Fermatica`FDet", "[", "m", "]"}], ",", 
     RowBox[{"Style", "[", 
      RowBox[{"\"\<Executing Fermatica`FDet...\>\"", ",", "Tiny"}], "]"}], 
     ",", "1"}], "]"}], "*)"}]}]], "Code",
 CellChangeTimes->{{3.72775136425244*^9, 3.727751484612381*^9}, {
   3.727751557056512*^9, 3.7277515573979*^9}, {3.727752054466782*^9, 
   3.7277520730804996`*^9}, {3.727753237795642*^9, 3.7277532417449837`*^9}, {
   3.72800108696859*^9, 3.72800108720708*^9}, {3.728002475175424*^9, 
   3.728002486895668*^9}, 3.728004003899982*^9, {3.7686932665360947`*^9, 
   3.768693268190895*^9}, {3.768973901666914*^9, 3.768973912074608*^9}, {
   3.7689756036927547`*^9, 3.76897560474052*^9}, {3.77012399208603*^9, 
   3.770123993374689*^9}},
 ExpressionUUID -> "6a8851cc-1b40-4914-b40a-272c40e30dc7"]
}, Closed]],

Cell[CellGroupData[{

Cell["OKer", "Subsubsection",
 CellChangeTimes->{{3.72774491436176*^9, 3.7277449162094183`*^9}, 
   3.727745729562084*^9, 3.768973711744979*^9, {3.7689754513711023`*^9, 
   3.768975452141583*^9}},
 ExpressionUUID -> "0facd0d4-5f26-4374-bbc2-f33a239c28f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OKer", "::", "usage"}], "=", 
  "\"\<OKer[m1] is an optimized version of NullSpace.\>\""}]], "Code",
 CellChangeTimes->{{3.7277450763134813`*^9, 3.727745128250895*^9}, {
   3.7277457296033583`*^9, 3.727745729604396*^9}, {3.727749477779316*^9, 
   3.7277494839634113`*^9}, 3.768973736234611*^9, {3.76897380265487*^9, 
   3.768973820309557*^9}, {3.7689754591047087`*^9, 3.768975480161689*^9}},
 ExpressionUUID -> "00165fd8-1a32-4e1f-ba1e-ac9c93a32575"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OKer", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"UseFermat", "\[Rule]", "False"}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{
  3.7685301115942583`*^9, {3.7686073589843903`*^9, 3.7686073598494864`*^9}, {
   3.7689738271672583`*^9, 3.7689738277343807`*^9}, 3.768975486048417*^9},
 ExpressionUUID -> "4be1ba78-8f7d-46bf-abbf-4b34d4100168"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OKer", "[", 
    RowBox[{
     RowBox[{"m_", "?", "MatrixQ"}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Replace", "[", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"$LibraUseFermat", "&&", 
        RowBox[{"OptionValue", "[", "UseFermat", "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"CheckAbort", "[", 
        RowBox[{
         RowBox[{"FKer", "[", "m", "]"}], ",", 
         RowBox[{
          RowBox[{
          "Print", "[", "\"\<ODet: resorting to Mathematica\[Ellipsis]\>\"", 
           "]"}], ";", 
          RowBox[{"ker", "[", "m", "]"}]}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"ker", "[", "m", "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"{", 
        RowBox[{"0", ".."}], "}"}], "}"}], "\[Rule]", 
      RowBox[{"{", "}"}]}]}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.727744827981697*^9, 3.727744850852857*^9}, 
   3.727745729615004*^9, {3.727749518683105*^9, 3.727749587041399*^9}, {
   3.727749705161397*^9, 3.727749796453553*^9}, {3.727750900676277*^9, 
   3.727750902787034*^9}, {3.72775133078442*^9, 3.72775135176515*^9}, {
   3.727751488093606*^9, 3.72775148827957*^9}, {3.7277520650277576`*^9, 
   3.7277520696770687`*^9}, 3.728001538308874*^9, {3.729898386747697*^9, 
   3.729898391925767*^9}, {3.768530120733622*^9, 3.7685301215585403`*^9}, {
   3.768530239141673*^9, 3.768530239358635*^9}, {3.768973830943248*^9, 
   3.7689738959205723`*^9}, {3.768975489186121*^9, 3.768975554503459*^9}, 
   3.76899408928454*^9, {3.769029346303173*^9, 3.769029508155768*^9}},
 ExpressionUUID -> "5fbd6f02-af6f-47b6-bef7-d6b6f6a660e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FKer", "[", "m_", "]"}], ":=", 
  RowBox[{"Fermatica`FKer", "[", "m", "]"}], 
  RowBox[{"(*", 
   RowBox[{"FCStaticMonitor", "[", 
    RowBox[{
     RowBox[{"Fermatica`FKer", "[", "m", "]"}], ",", 
     RowBox[{"Style", "[", 
      RowBox[{"\"\<Executing Fermatica`FKer...\>\"", ",", "Tiny"}], "]"}], 
     ",", "1"}], "]"}], "*)"}]}]], "Code",
 CellChangeTimes->{{3.72775136425244*^9, 3.727751484612381*^9}, {
   3.727751557056512*^9, 3.7277515573979*^9}, {3.727752054466782*^9, 
   3.7277520730804996`*^9}, {3.727753237795642*^9, 3.7277532417449837`*^9}, {
   3.72800108696859*^9, 3.72800108720708*^9}, {3.728002475175424*^9, 
   3.728002486895668*^9}, 3.728004003899982*^9, {3.7686932665360947`*^9, 
   3.768693268190895*^9}, {3.768973901666914*^9, 3.768973912074608*^9}, {
   3.768975572605423*^9, 3.768975590003718*^9}, {3.770124003475676*^9, 
   3.7701240097319937`*^9}},
 ExpressionUUID -> "6a8851cc-1b40-4914-b40a-272c40e30dc7"]
}, Closed]],

Cell[CellGroupData[{

Cell["OInverse", "Subsubsection",
 CellChangeTimes->{{3.689837283323153*^9, 3.689837309343875*^9}, {
   3.695346284320386*^9, 3.695346284472209*^9}, {3.719625758923317*^9, 
   3.719625768971397*^9}, 3.720156071511805*^9, {3.720185050345173*^9, 
   3.720185050484827*^9}, 3.721256313676182*^9, 3.7277451962916517`*^9},
 ExpressionUUID -> "08e37d20-867d-4775-aeaf-ee7a9d6f62f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OInverse", "::", "usage"}], "=", 
   "\"\<OInverse[m] is an optimized version of Inverse[m] for \
block-triangular matrices.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.689838189120213*^9, 3.6898382372563477`*^9}, 
   3.693193027522334*^9, {3.72015607273525*^9, 3.720156074335528*^9}, {
   3.7212563165724487`*^9, 3.721256321594676*^9}, {3.727745196336315*^9, 
   3.7277451963375263`*^9}},
 ExpressionUUID -> "84dd8930-09cf-4d5f-abd0-022bb24db8eb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "OInverse", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Print", "\[Rule]", "False"}], ",", 
     RowBox[{"UseFermat", "\[Rule]", "False"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721543588154291*^9, 3.721543630958571*^9}, 
   3.7277451963467073`*^9, {3.727746358537765*^9, 3.72774635865231*^9}, {
   3.727749634839652*^9, 3.727749635010632*^9}, {3.768530208625663*^9, 
   3.768530212085226*^9}, {3.768607366235655*^9, 3.7686073669842987`*^9}},
 ExpressionUUID -> "8c0605f2-48dd-4b26-960e-5b6a148a9c1b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OInverse", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"s", "=", 
       RowBox[{"TClosure", "[", "m", "]"}]}], ",", 
      RowBox[{"print", "=", 
       RowBox[{"TrueQ", "@", 
        RowBox[{"OptionValue", "[", "Print", "]"}]}]}], ",", "diag", ",", 
      "dep", ",", 
      RowBox[{"mi", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "m"}], "]"}]}], ",", 
      RowBox[{"stat", "=", "\"\<\>\""}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"invert", " ", "diagonal"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{"print", ",", "FCMonitor", ",", 
        RowBox[{"#", "&"}]}], "]"}], "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"stat", "=", "\"\<Finding diagonal blocks\[Ellipsis]\>\""}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"print", ",", 
          RowBox[{
           RowBox[{"CWrite", "[", "\"\<\\n\>\"", "]"}], ";", 
           RowBox[{"CWrite", "[", "stat", "]"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"diag", "=", 
         RowBox[{"EntangledBlocksIndices", "[", 
          RowBox[{"s", ",", "True"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"stat", "=", 
             RowBox[{"\"\<Inverting diagonal elements with indices \>\"", "<>", 
              RowBox[{"ToString", "[", "#", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"print", ",", 
              RowBox[{
               RowBox[{"CWrite", "[", "\"\<\\n\>\"", "]"}], ";", 
               RowBox[{"CWrite", "[", "stat", "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"mi", "[", 
              RowBox[{"[", 
               RowBox[{"#", ",", "#"}], "]"}], "]"}], "=", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"$LibraUseFermat", "&&", 
                  RowBox[{"OptionValue", "[", "UseFermat", "]"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Replace", "[", 
                  RowBox[{
                   RowBox[{"CheckAbort", "[", 
                    RowBox[{
                    RowBox[{"FInverse", "[", "#", "]"}], ",", "$Failed"}], 
                    "]"}], ",", 
                   RowBox[{"$Failed", "\[RuleDelayed]", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<Inverse: resorting to Mathematica\[Ellipsis]\>\"", 
                    "]"}], ";", 
                    RowBox[{"Together", "[", 
                    RowBox[{"Inverse", "[", "#", "]"}], "]"}]}], ")"}]}]}], 
                  "]"}], ",", "\[IndentingNewLine]", 
                 RowBox[{"Together", "[", 
                  RowBox[{"Inverse", "[", "#", "]"}], "]"}]}], "]"}], "&"}], 
              "@", 
              RowBox[{"m", "[", 
               RowBox[{"[", 
                RowBox[{"#", ",", "#"}], "]"}], "]"}]}]}]}], ")"}], "&"}], "/@",
          "diag"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"dep", "=", 
             RowBox[{"Complement", "[", 
              RowBox[{
               RowBox[{"DependentRowIndices", "[", 
                RowBox[{"s", ",", "#", ",", "True"}], "]"}], ",", "#"}], 
              "]"}]}], ";", 
            RowBox[{"stat", "=", 
             RowBox[{"\"\<Inverting off-diagonal elements \>\"", "<>", 
              RowBox[{"ToString", "[", "dep", "]"}], "<>", 
              "\"\< on rows \>\"", "<>", 
              RowBox[{"ToString", "[", "#", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"print", ",", 
              RowBox[{
               RowBox[{"CWrite", "[", "\"\<\\n\>\"", "]"}], ";", 
               RowBox[{"CWrite", "[", "stat", "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"mi", "[", 
              RowBox[{"[", 
               RowBox[{"#", ",", "dep"}], "]"}], "]"}], "=", 
             RowBox[{"-", 
              RowBox[{"ODot", "[", 
               RowBox[{
                RowBox[{"mi", "[", 
                 RowBox[{"[", 
                  RowBox[{"#", ",", "#"}], "]"}], "]"}], ",", 
                RowBox[{"ODot", "[", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"#", ",", "dep"}], "]"}], "]"}], ",", 
                  RowBox[{"mi", "[", 
                   RowBox[{"[", 
                    RowBox[{"dep", ",", "dep"}], "]"}], "]"}]}], "]"}]}], 
               "]"}]}]}]}], ")"}], "&"}], "/@", "diag"}], ";"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", "stat"}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "mi", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.721543588154291*^9, 3.721543630958571*^9}, 
   3.7277451963467073`*^9, {3.727746171832552*^9, 3.727746191139236*^9}, {
   3.727746253579432*^9, 3.727746256068206*^9}, {3.727746369499906*^9, 
   3.727746378804144*^9}, {3.727749631385399*^9, 3.727749631555011*^9}, {
   3.727749867078434*^9, 3.727749937307248*^9}, {3.727749972399729*^9, 
   3.7277500227843*^9}, {3.727750063458495*^9, 3.7277500736232777`*^9}, {
   3.727750720948759*^9, 3.7277507451831512`*^9}, {3.727750829242714*^9, 
   3.727750830592259*^9}, {3.727750891243183*^9, 3.7277508934355516`*^9}, {
   3.727751566715845*^9, 3.727751566880575*^9}, {3.727753164935431*^9, 
   3.727753169545498*^9}, {3.727753298929893*^9, 3.727753305940084*^9}, 
   3.7280015383137627`*^9, {3.768530200816577*^9, 3.768530229995843*^9}, {
   3.768693312425816*^9, 3.7686934084607363`*^9}, {3.768693852857306*^9, 
   3.768693868097783*^9}, {3.770592825118785*^9, 3.770592829367298*^9}},
 ExpressionUUID -> "4c827706-a3f6-4768-989e-1bc102da1611"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FInverse", "[", "ex_", "]"}], ":=", 
  RowBox[{"Fermatica`FInverse", "[", "ex", "]"}], 
  RowBox[{"(*", 
   RowBox[{"FCStaticMonitor", "[", 
    RowBox[{
     RowBox[{"Fermatica`FInverse", "[", "ex", "]"}], ",", 
     RowBox[{"Style", "[", 
      RowBox[{"\"\<Executing Fermatica`FInverse...\>\"", ",", "Tiny"}], "]"}],
      ",", "1"}], "]"}], "*)"}]}]], "Code",
 CellChangeTimes->{{3.72775136425244*^9, 3.727751484612381*^9}, {
  3.727751532016698*^9, 3.727751545844544*^9}, {3.7277532273678827`*^9, 
  3.727753232961553*^9}, {3.7280010959359303`*^9, 3.728001096031149*^9}, {
  3.768693429007152*^9, 3.768693432121745*^9}, {3.770124023704527*^9, 
  3.770124024659786*^9}},
 ExpressionUUID -> "3f6faaea-ad59-4c9b-851e-9c3e74787cb1"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Series etc.", "Subsection",
 CellChangeTimes->{{3.719625670755124*^9, 3.7196256751467237`*^9}, {
  3.719625803259419*^9, 3.7196258059788322`*^9}, {3.721114456293867*^9, 
  3.7211144616801023`*^9}},
 ExpressionUUID -> "6ded640d-61be-4eee-807f-effe2008a446"],

Cell[CellGroupData[{

Cell["Series (redefined), SeriesCoefficients", "Subsubsection",
 CellChangeTimes->{{3.721114469209756*^9, 3.721114491709803*^9}, 
   3.721114782798402*^9, {3.721130085467752*^9, 3.7211300981357517`*^9}, {
   3.721386141112261*^9, 3.721386143595418*^9}, 3.7687870258269043`*^9},
 ExpressionUUID -> "961b01f7-15fd-4f28-a6af-0190dcada406"],

Cell["\<\
Let us fix Series to always give SeriesData and to correctly thread lists and \
matrices\
\>", "Text",
 CellChangeTimes->{{3.721114787342085*^9, 3.721114825134726*^9}, {
  3.721115159280148*^9, 3.721115180312457*^9}},
 ExpressionUUID -> "4fa46793-964c-436d-acfb-bed64f702d30"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", "Series", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Series", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "x0_", ",", "n_Integer"}], "}"}]}], "]"}], "/;", 
   RowBox[{"FreeQ", "[", 
    RowBox[{"expr", ",", "x"}], "]"}]}], ":=", 
  RowBox[{"expr", "+", 
   RowBox[{"SeriesData", "[", 
    RowBox[{"x", ",", "x0", ",", 
     RowBox[{"{", "}"}], ",", 
     RowBox[{"n", "+", "1"}], ",", 
     RowBox[{"n", "+", "1"}], ",", "1"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Series", "[", 
   RowBox[{"expr_List", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x0_", ",", "n_Integer"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Series", "[", 
      RowBox[{"#", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "x0", ",", "n"}], "}"}]}], "]"}], "&"}], ",", 
    "expr"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Protect", "[", "Series", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"todo", "[", "\"\<NB: Series redefined!\>\"", "]"}]}], "Code",
 CellChangeTimes->{{3.7211145769872103`*^9, 3.72111475148678*^9}, {
  3.721114838680212*^9, 3.7211148691111717`*^9}, {3.721114943472725*^9, 
  3.721114972264021*^9}, {3.721115033305772*^9, 3.721115064000175*^9}, {
  3.721115189521079*^9, 3.721115226273196*^9}},
 ExpressionUUID -> "3fce312f-5013-4489-b702-2cddff3b6486"],

Cell[BoxData[
 RowBox[{"Series", "[", 
  RowBox[{"1", ",", 
   RowBox[{"{", 
    RowBox[{"x", ",", "2", ",", "2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7211145101533957`*^9, 3.721114515366473*^9}, {
  3.72111455818435*^9, 3.721114597270219*^9}, {3.721114756880534*^9, 
  3.721114774192081*^9}},
 ExpressionUUID -> "2a5331c2-2252-4ad2-9351-ce4f6db20e54"],

Cell["SeriesCoefficients (convenient for matrices)", "Text",
 CellChangeTimes->{{3.721130113023964*^9, 3.7211301162815104`*^9}, 
   3.721176916758677*^9, {3.7212603403316793`*^9, 3.7212603692226667`*^9}, {
   3.7212635036420383`*^9, 3.721263503815041*^9}, {3.721271600510744*^9, 
   3.7212716047331467`*^9}, {3.721378181627317*^9, 3.721378184500306*^9}, {
   3.7213860805265827`*^9, 3.7213860981061*^9}, 3.721386178657846*^9},
 ExpressionUUID -> "ec415bcb-722d-4ef6-9dad-23ff9f20154e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SeriesCoefficients", "::", "usage"}], "=", 
   "\"\<SeriesCoefficients[f,{x,x0,n}] generate a power series expansion for \
f about the point x=x0 up to  (x-x0)^n return the list of these terms\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.721271627872477*^9, 3.721271655358736*^9}, {
  3.721378196053143*^9, 3.7213782344236*^9}, {3.721386181825918*^9, 
  3.721386204379362*^9}},
 ExpressionUUID -> "e5ebd7d7-2692-40b4-9049-492ee8d2742b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesCoefficients", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", "series", ",", "n"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"series", "=", 
      RowBox[{"Series", "[", 
       RowBox[{"A", ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0", ",", "k"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"n", "=", 
      RowBox[{"LeadingOrder", "[", 
       RowBox[{"series", ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"SeriesCoefficient", "[", 
        RowBox[{"series", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0", ",", "#"}], "}"}]}], "]"}], "&"}], "/@", 
      RowBox[{"Range", "[", 
       RowBox[{"n", ",", "k"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.7212762692481728`*^9, 3.721276273944704*^9}, {
   3.721378041660084*^9, 3.7213780476788607`*^9}, {3.7213780916816597`*^9, 
   3.721378147199555*^9}, {3.721378245942226*^9, 3.721378281654258*^9}, {
   3.721378362458531*^9, 3.721378452556354*^9}, {3.721385839063093*^9, 
   3.721385882249897*^9}, 3.72138599241002*^9, {3.721386212291338*^9, 
   3.721386234944861*^9}, {3.7213863804859133`*^9, 3.721386442327775*^9}, 
   3.7213866610738173`*^9},
 ExpressionUUID -> "b72d5d2d-429a-466b-9a60-6b0a2c6b8389"]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
LeadingSeries,LeadingSeriesCoefficient,LeadingSeriesCoefficients\
\>", "Subsubsection",
 CellChangeTimes->{{3.721130113023964*^9, 3.7211301162815104`*^9}, 
   3.721176916758677*^9, {3.7212603403316793`*^9, 3.7212603692226667`*^9}, {
   3.7212635036420383`*^9, 3.721263503815041*^9}, {3.721271600510744*^9, 
   3.7212716047331467`*^9}, {3.721386129524364*^9, 3.721386129770952*^9}},
 ExpressionUUID -> "9bf6b434-c080-4cd7-a0ca-20205b64b797"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingSeries", "::", "usage"}], "=", 
   "\"\<LeadingSeries[f,{x,x0,n}] generate a power series expansion for f \
about the point x=x0 with n first nonzero terms of expansion\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7211769221830187`*^9, 3.721176946191174*^9}, {
  3.7211770631114693`*^9, 3.721177147947342*^9}, {3.721260351246509*^9, 
  3.721260354358981*^9}},
 ExpressionUUID -> "5245825a-9bdd-49f8-b8ec-5b4f57d2e0eb"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"LeadingSeries", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"n", "=", 
       RowBox[{"LeadingOrder", "[", 
        RowBox[{"A", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "\[Infinity]"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"A", "+", 
         RowBox[{"SeriesData", "[", 
          RowBox[{"x", ",", "x0", ",", 
           RowBox[{"{", "}"}], ",", "\[Infinity]", ",", "\[Infinity]", ",", 
           "1"}], "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Series", "[", 
      RowBox[{"A", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "x0", ",", 
         RowBox[{"n", "+", "k"}]}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LeadingSeries", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "\[Infinity]", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"n", "=", 
       RowBox[{"LeadingOrder", "[", 
        RowBox[{"A", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "\[Infinity]"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"A", "+", 
         RowBox[{"SeriesData", "[", 
          RowBox[{"x", ",", "\[Infinity]", ",", 
           RowBox[{"{", "}"}], ",", "\[Infinity]", ",", "\[Infinity]", ",", 
           "1"}], "]"}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Series", "[", 
      RowBox[{"A", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "\[Infinity]", ",", 
         RowBox[{"n", "+", "k"}]}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}]}], "Code",
 CellChangeTimes->{{3.721177165833036*^9, 3.7211771832151623`*^9}, {
   3.721177286597918*^9, 3.721177353013176*^9}, {3.721177544044634*^9, 
   3.721177582257584*^9}, {3.721177651884191*^9, 3.721177655596026*^9}, {
   3.7211776885663443`*^9, 3.721177700051083*^9}, 3.7212141183848763`*^9, {
   3.7212602939241133`*^9, 3.7212603166963654`*^9}, {3.721260352297309*^9, 
   3.721260353308325*^9}, {3.721262568512467*^9, 3.721262617080518*^9}, {
   3.721264495535777*^9, 3.721264571817264*^9}, {3.721275934507187*^9, 
   3.7212759555132513`*^9}, 3.721275991924389*^9, 3.72127603195129*^9, {
   3.721276106369707*^9, 3.721276106853546*^9}, 3.721378521305128*^9},
 ExpressionUUID -> "fe6119fc-5633-40fb-b551-35abfe8a921c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingSeriesCoefficient", "::", "usage"}], "=", 
   "\"\<LeadingSeriesCoefficient[f,{x,x0,n}] generate a power series \
expansion for f about the point x=x0 with n first nonzero terms of \
expansion\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721271627872477*^9, 3.721271655358736*^9}},
 ExpressionUUID -> "4a80576d-a921-428c-85fa-7b3c7864cace"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingSeriesCoefficient", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"n", "=", 
       RowBox[{"LeadingOrder", "[", 
        RowBox[{"A", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "\[Infinity]"}], ",", 
       RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"SeriesCoefficient", "[", 
      RowBox[{"A", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "x0", ",", 
         RowBox[{"n", "+", "k"}]}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}]], "Code",
 CellChangeTimes->{{3.7212762692481728`*^9, 3.721276273944704*^9}, {
   3.721378041660084*^9, 3.7213780476788607`*^9}, {3.7213780916816597`*^9, 
   3.721378147199555*^9}, 3.721378514853518*^9, 3.721385918693139*^9},
 ExpressionUUID -> "221387f6-67d8-4282-a04f-c4b9f69d7d30"],

Cell["LeadingSeriesCoefficients (convenient for matrices)", "Text",
 CellChangeTimes->{{3.721130113023964*^9, 3.7211301162815104`*^9}, 
   3.721176916758677*^9, {3.7212603403316793`*^9, 3.7212603692226667`*^9}, {
   3.7212635036420383`*^9, 3.721263503815041*^9}, {3.721271600510744*^9, 
   3.7212716047331467`*^9}, {3.721378181627317*^9, 3.721378184500306*^9}, {
   3.7213860805265827`*^9, 3.7213860981061*^9}},
 ExpressionUUID -> "1fc7b324-01e3-4f93-8b58-8daa5e2494e1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingSeriesCoefficients", "::", "usage"}], "=", 
   "\"\<LeadingSeriesCoefficients[f,{x,x0,n}] generate a power series \
expansion for f about the point x=x0 with n first nonzero terms of expansion \
and return the list of these terms\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721271627872477*^9, 3.721271655358736*^9}, {
  3.721378196053143*^9, 3.7213782344236*^9}},
 ExpressionUUID -> "9ad56a98-02f8-4624-83b0-ae201516db30"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingSeriesCoefficients", "[", 
   RowBox[{"A_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_", ",", "k_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", 
      RowBox[{"n", "=", 
       RowBox[{"LeadingOrder", "[", 
        RowBox[{"A", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ",", "series"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"n", "\[Equal]", "\[Infinity]"}], ",", 
       RowBox[{"Return", "[", "0", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"series", "=", 
      RowBox[{"Series", "[", 
       RowBox[{"A", ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0", ",", 
          RowBox[{"n", "+", "k"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"series", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"SeriesCoefficient", "[", 
         RowBox[{"series", ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "x0", ",", "#"}], "}"}]}], "]"}], "&"}], "/@", 
       RowBox[{"Range", "[", 
        RowBox[{"n", ",", 
         RowBox[{"n", "+", "k"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     "series"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.7212762692481728`*^9, 3.721276273944704*^9}, {
   3.721378041660084*^9, 3.7213780476788607`*^9}, {3.7213780916816597`*^9, 
   3.721378147199555*^9}, {3.721378245942226*^9, 3.721378281654258*^9}, {
   3.721378362458531*^9, 3.721378452556354*^9}, {3.721385839063093*^9, 
   3.721385882249897*^9}, 3.72138599241002*^9, {3.7213864758641768`*^9, 
   3.721386487043613*^9}, {3.768991437531521*^9, 3.7689914861652317`*^9}, 
   3.768991631012073*^9, {3.768994105948992*^9, 3.768994127025317*^9}, {
   3.7690321053362837`*^9, 3.769032107105364*^9}},
 ExpressionUUID -> "69f25514-f5cb-48a8-be40-7188c249d056"]
}, Closed]],

Cell[CellGroupData[{

Cell["LeadingOrder", "Subsubsection",
 CellChangeTimes->{3.7212600054381113`*^9},
 ExpressionUUID -> "2b56f025-44b0-496b-be4d-bca242850ff6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"LeadingOrder", "::", "usage"}], "=", 
   "\"\<LeadingOrder[expr,{x,x0}] gives the leading order of expansion in \
x.\\nLeadingOrder[expr,poly,x] returns the leading order of the polynomial \
poly whic can be factorised for expr.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7212600123966084`*^9, 3.721260069086038*^9}, {
  3.7266349771527557`*^9, 3.726635053933693*^9}, {3.7266361346157084`*^9, 
  3.726636150767164*^9}},
 ExpressionUUID -> "7455b42f-64ea-4285-8a0c-24de25f80065"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Deleted", " ", "11.06", ".2019"}], "*)"}], 
  RowBox[{"(*", 
   RowBox[{"Modified", " ", "18.05", ".2019"}], "*)"}], 
  RowBox[{"(*", 
   RowBox[{"Added", " ", "18.05", ".2019"}], "*)"}], 
  RowBox[{
   RowBox[{
    RowBox[{"LeadingOrder", "[", 
     RowBox[{"expr_List", ",", "a__"}], "]"}], ":=", 
    RowBox[{"Min", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"LeadingOrder", "[", 
        RowBox[{"#", ",", "a"}], "]"}], "&"}], "/@", "expr"}], "]"}]}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"/", "Added"}], " ", "18.05", ".2019"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"LeadingOrder", "[", 
     RowBox[{"expr_", ",", 
      RowBox[{"{", 
       RowBox[{"x_Symbol", ",", "x0_"}], "}"}], ",", 
      RowBox[{"opts", ":", 
       RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
    RowBox[{"(*", 
     RowBox[{"Added", " ", "18.05", ".2019"}], "*)"}], 
    RowBox[{"lorder", "[", 
     RowBox[{"expr", ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "x0"}], "}"}]}], "]"}], 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"/", "Added"}], " ", "18.05", ".2019"}], "*)"}], 
    RowBox[{"(*", 
     RowBox[{"(*", 
      RowBox[{"Deleted", " ", "18.05", ".2019"}], "*)"}], 
     RowBox[{"Min", "[", 
      RowBox[{"lorder", "[", 
       RowBox[{"expr", ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0"}], "}"}]}], "]"}], "]"}], 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"/", "Deleted"}], " ", "18.05", ".2019"}], "*)"}], "*)"}], 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"/", "Modified"}], " ", "18.05", ".2019"}], 
     "*)"}]}]}]}]], "Code",
 CellChangeTimes->{{3.7671351214803*^9, 3.7671352625401793`*^9}, {
   3.767159084970107*^9, 3.767159085851191*^9}, {3.768999378349596*^9, 
   3.768999387369267*^9}, {3.7689994265178747`*^9, 3.7689994275694027`*^9}, {
   3.769032116034733*^9, 3.769032117880371*^9}, 3.7692131617761602`*^9, {
   3.7692340598661118`*^9, 3.7692340690179*^9}},
 ExpressionUUID -> "c2b61ef6-9c2e-4afc-ab73-637ac802dc8b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"SetAttributes", "[", 
    RowBox[{"lorder", ",", "Listable"}], "]"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"0", ",", "x_Symbol"}], "]"}], "=", "\[Infinity]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"expr_", ",", "x_Symbol"}], "]"}], ":=", 
     RowBox[{"Plus", "@@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"Factors", "[", "expr", "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "^", "a_."}], ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{"a", " ", "n"}]}]}], "]"}]}]}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"(*", 
    RowBox[{"Deleted", " ", "18.05", ".2019"}], "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"expr_List", ",", "x_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"lorder", "[", 
        RowBox[{"#", ",", "x"}], "]"}], "&"}], "/@", "expr"}]}], ";"}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"/", "Deleted"}], " ", "18.05", ".2019"}], "*)"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"0", ",", 
       RowBox[{"{", 
        RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], "=", 
     "\[Infinity]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"expr_", ",", 
       RowBox[{"{", 
        RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
     RowBox[{"Plus", "@@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"FactorList", "[", 
         RowBox[{"expr", "/.", 
          RowBox[{"x", "\[Rule]", 
           RowBox[{"x", "+", "x0"}]}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "^", "a_."}], ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{"a", " ", "n"}]}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lorder", "[", 
      RowBox[{"expr_", ",", 
       RowBox[{"{", 
        RowBox[{"x_Symbol", ",", "\[Infinity]"}], "}"}]}], "]"}], ":=", 
     RowBox[{"Plus", "@@", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"FactorList", "[", 
         RowBox[{"expr", "/.", 
          RowBox[{"x", "\[Rule]", 
           RowBox[{"1", "/", "x"}]}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"x", "^", "a_."}], ",", "n_"}], "}"}], "\[RuleDelayed]", 
         RowBox[{"a", " ", "n"}]}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{"lorder", "[", 
       RowBox[{"expr_", ",", 
        RowBox[{"{", 
         RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
      RowBox[{
       RowBox[{"Series", "[", 
        RowBox[{"expr", ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0", ",", 
           RowBox[{"-", "20"}]}], "}"}]}], "]"}], "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"lorder", "[", 
       RowBox[{"expr_SeriesData", ",", 
        RowBox[{"{", 
         RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], "/;", 
      RowBox[{"MatchQ", "[", 
       RowBox[{
        RowBox[{"Take", "[", 
         RowBox[{
          RowBox[{"List", "@@", "expr"}], ",", "2"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ":=", 
     RowBox[{"expr", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.721264013946117*^9, 3.721264037813424*^9}, {
   3.721264311467393*^9, 3.7212643490369177`*^9}, {3.721271674507071*^9, 
   3.721271703077076*^9}, {3.721276309364785*^9, 3.72127631423538*^9}, {
   3.721276349396443*^9, 3.7212763502442713`*^9}, {3.72127679705446*^9, 
   3.7212767979623547`*^9}, {3.7212768507543364`*^9, 
   3.7212769725608053`*^9}, {3.7212771239667177`*^9, 3.721277189610032*^9}, {
   3.7212777981810913`*^9, 3.721277807362966*^9}, {3.721277853833679*^9, 
   3.721277880064343*^9}, {3.721278532982346*^9, 3.721278536811804*^9}, {
   3.7212787015830793`*^9, 3.7212787104513187`*^9}, {3.7212788235180197`*^9, 
   3.7212788331278753`*^9}, {3.721347400712051*^9, 3.721347422259848*^9}, 
   3.721349121853903*^9, {3.72134922953473*^9, 3.721349266735911*^9}, 
   3.76713528629634*^9, {3.767136038105316*^9, 3.767136103036735*^9}, {
   3.767142851448699*^9, 3.767142857613041*^9}},
 ExpressionUUID -> "e27ed7e8-c161-4b7c-8350-fbb37a77271b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"lorder", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], "=", "\[Infinity]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lorder", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"{", 
      RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"lorder", "[", 
    RowBox[{
     RowBox[{"expr", "/.", 
      RowBox[{"{", 
       RowBox[{"x", "\[Rule]", 
        RowBox[{"x0", "+", 
         RowBox[{"1", "/", "x"}]}]}], "}"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "\[Infinity]"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lorder", "[", 
    RowBox[{"expr_", ",", 
     RowBox[{"{", 
      RowBox[{"x_Symbol", ",", "\[Infinity]"}], "}"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Exponent", "[", 
       RowBox[{
        RowBox[{"Denominator", "[", "#", "]"}], ",", "x"}], "]"}], "-", 
      RowBox[{"Exponent", "[", 
       RowBox[{
        RowBox[{"Numerator", "[", "#", "]"}], ",", "x"}], "]"}]}], "&"}], "[", 
    RowBox[{"Together", "[", "expr", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"lorder", "[", 
     RowBox[{"expr_SeriesData", ",", 
      RowBox[{"{", 
       RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], "/;", 
    RowBox[{"MatchQ", "[", 
     RowBox[{
      RowBox[{"Take", "[", 
       RowBox[{
        RowBox[{"List", "@@", "expr"}], ",", "2"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ":=", 
   RowBox[{"expr", "[", 
    RowBox[{"[", "4", "]"}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.769210725028604*^9, 3.7692107532699757`*^9}, 
   3.769211274779866*^9, {3.7692123480243273`*^9, 3.7692123606353197`*^9}},
 ExpressionUUID -> "1e631ee6-6677-4ff6-9855-480cc116aece"],

Cell["LeadingOrder[expr_,poly_,x_Symbol]", "Text",
 CellChangeTimes->{3.7266349725442133`*^9},
 ExpressionUUID -> "61bcdeda-e2d2-457f-b548-a62120bdca72"],

Cell[BoxData[
 RowBox[{
  RowBox[{"LeadingOrder", "[", 
   RowBox[{"expr_", ",", "poly_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", ",", "d"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"n", ",", "d"}], "}"}], "=", 
      RowBox[{"Through", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Numerator", ",", "Denominator"}], "}"}], "[", 
        RowBox[{"Together", "@", "expr"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"lorder", "[", 
       RowBox[{"n", ",", "poly", ",", "x"}], "]"}], "-", 
      RowBox[{"lorder", "[", 
       RowBox[{"d", ",", "poly", ",", "x"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.726634951849145*^9, 3.726634965136999*^9}, {
  3.7266352715058813`*^9, 3.7266352837268343`*^9}, {3.726635626672242*^9, 
  3.726635698864616*^9}},
 ExpressionUUID -> "184f5d6b-6d7c-42c6-90f1-08675eadc0b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"lorder", "[", 
    RowBox[{"0", ",", "poly_", ",", "x_Symbol"}], "]"}], ":=", 
   "\[Infinity]"}], ";"}]], "Input",
 CellChangeTimes->{{3.767324499503005*^9, 3.767324505790555*^9}, {
  3.767329755938895*^9, 3.76732975780291*^9}},
 ExpressionUUID -> "dfce5fa2-14f8-4ac0-a200-cc40ea06376a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"lorder", "[", 
   RowBox[{"poly1_", ",", "poly_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"div", "=", "poly1"}], ",", "rem", ",", 
      RowBox[{"i", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"div", ",", "rem"}], "}"}], "=", 
          RowBox[{"PolynomialQuotientRemainder", "[", 
           RowBox[{"div", ",", "poly", ",", "x"}], "]"}]}], ";", 
         RowBox[{"rem", "===", "0"}]}], ")"}], ",", "\[IndentingNewLine]", 
       RowBox[{"i", "++"}]}], "]"}], ";", "\[IndentingNewLine]", "i"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7266357087919407`*^9, 3.726635918472864*^9}, {
  3.726636082311081*^9, 3.726636086359106*^9}},
 ExpressionUUID -> "0726a719-5a21-4de6-b8d0-3514f6a8b71a"]
}, Closed]],

Cell[CellGroupData[{

Cell["SeriesRulesMod", "Subsubsection",
 CellChangeTimes->{3.768439850153408*^9, 3.770591880657996*^9},
 ExpressionUUID -> "58d5a059-adb4-4436-90d0-fa192119486a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesRulesMod", "::", "usage"}], "=", "\"\<SeriesRulesMod[\!\(\*
StyleBox[\"q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"n\", \"TI\"]\)}] gives a list of the form {{\!\(\*
StyleBox[\"k\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\)\!\(\*
StyleBox[\"\[Rule]\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], 
StyleBox[\"k\", \"TI\"]]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),{\!\(\*
StyleBox[\"k\", \"TI\"]\)\!\(\*
StyleBox[\"+\", \"TI\"]\)\!\(\*
StyleBox[\"1\", \"TI\"]\)}\!\(\*
StyleBox[\"\[Rule]\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], 
StyleBox[
RowBox[{\"k\", \"+\", \"1\"}], \"TI\"]]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\[Ellipsis],{\!\(\*
StyleBox[\"n\", \"TI\"]\)}\!\(\*
StyleBox[\"\[Rule]\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], 
StyleBox[\"n\", \"TI\"]]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)}, such that each \!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], 
StyleBox[\"i\", \"TI\"]]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is a polynomial with deg(\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], 
StyleBox[\"i\", \"TI\"]]\))<deg(\!\(\*
StyleBox[\"p\", \"TI\"]\)) and LeadingOrderMod[\!\(\*
StyleBox[\"q\", \"TI\"]\)\!\(\*
StyleBox[\"-\", \"TI\"]\)\!\(\*SubsuperscriptBox[\"\[Sum]\", 
StyleBox[
RowBox[{\"i\", \"=\", \"k\"}], \"TI\"], 
StyleBox[\"n\", \"TI\"]]\)\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], 
StyleBox[\"i\", \"TI\"]]\)\!\(\*SuperscriptBox[
StyleBox[\"p\", \"TI\"], 
StyleBox[\"i\", \"TI\"]]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"\[Rule]\", \"TI\"]\)\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)]>\!\(\*
StyleBox[\"n\", \"TI\"]\).\>\""}]], "Code",
 CellChangeTimes->{{3.768443062095896*^9, 3.768443142047127*^9}, {
   3.768443176191671*^9, 3.7684431781744747`*^9}, {3.7684432172898703`*^9, 
   3.768443626698205*^9}, 3.768515071737718*^9, {3.768783440329299*^9, 
   3.768783445219554*^9}, {3.768783516896253*^9, 3.768783523518281*^9}, {
   3.768785104845049*^9, 3.76878515777195*^9}, {3.768785298663035*^9, 
   3.768785327354534*^9}, 3.770591557529263*^9, {3.7705918807027617`*^9, 
   3.770591880704919*^9}, 3.770600867366784*^9, {3.770602385436075*^9, 
   3.7706023906433983`*^9}},
 ExpressionUUID -> "0932db40-b5d2-406c-9a9c-18c04a4652c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesRulesMod", "[", 
   RowBox[{"ex_", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x_", "\[Rule]", "den_"}], ",", "o_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"lo", ",", "tmp", ",", "rem", ",", 
      RowBox[{"res", "=", 
       RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"RatFuncQ", "[", 
           RowBox[{"ex", ",", "x"}], "]"}], "||", 
          RowBox[{"PolyQ", "[", 
           RowBox[{"den", ",", "x"}], "]"}]}], ")"}]}], ",", 
       RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lo", "=", 
      RowBox[{"LeadingOrderMod", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"x", "\[Rule]", "den"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"o", "<", "lo"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "o", "}"}], "\[Rule]", 
          RowBox[{"0", "*", "ex"}]}], "}"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tmp", "=", 
      RowBox[{"Together", "[", 
       RowBox[{"ex", "/", 
        RowBox[{"den", "^", "lo"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"rem", "=", 
         RowBox[{"QuolyMod", "[", 
          RowBox[{"tmp", ",", "den", ",", "x"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"res", ",", "rem"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"tmp", "=", 
         RowBox[{"Together", "[", 
          FractionBox[
           RowBox[{"tmp", "-", "rem"}], "den"], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"tmp", "===", "0"}], ",", 
          RowBox[{
           RowBox[{"res", "=", 
            RowBox[{"PadRight", "[", 
             RowBox[{"res", ",", 
              RowBox[{"o", "-", "lo", "+", "1"}]}], "]"}]}], ";", 
           RowBox[{"Break", "[", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
       ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "lo", ",", "o"}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Thread", "[", 
      RowBox[{
       RowBox[{"List", "/@", 
        RowBox[{"(", 
         RowBox[{"lo", "-", "1", "+", 
          RowBox[{"Range", "[", 
           RowBox[{"Length", "@", "res"}], "]"}]}], ")"}]}], "\[Rule]", 
       RowBox[{"(", "res", ")"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{
  3.7685150761855793`*^9, {3.768785352261602*^9, 3.768785354301372*^9}, {
   3.768786737770957*^9, 3.768786738386921*^9}, {3.768786926021844*^9, 
   3.768786931388256*^9}, 3.770591558265093*^9, 3.7705918807204*^9, {
   3.770600873874568*^9, 3.770600874627331*^9}, {3.770600908107687*^9, 
   3.7706009210123863`*^9}, {3.770602235463347*^9, 3.77060223927115*^9}},
 ExpressionUUID -> "9ab648af-6069-4165-a1a8-c37ba13b1dc4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesRulesMod", "[", 
   RowBox[{"ex_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "o_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"SeriesRulesMod", "[", 
   RowBox[{"ex", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", "\[Rule]", 
       RowBox[{"(", 
        RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}], ",", "o"}], "}"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.770609803038384*^9, 3.770609836318808*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["SeriesCoefficientMod", "Subsubsection",
 CellChangeTimes->{
  3.768439850153408*^9, {3.768784981001926*^9, 3.768784983274262*^9}, 
   3.770591897959259*^9},
 ExpressionUUID -> "6c55fcf5-47a8-43dc-b87d-358f1879af17"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesCoefficientMod", "::", "usage"}], "=", 
  "\"\<SeriesCoefficientMod[\!\(\*
StyleBox[\"q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\)\[Rule]\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"n\", \"TI\"]\)}] gives the coefficient \!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], 
StyleBox[\"n\", \"TI\"]]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) in the expansion \!\(\*
StyleBox[\"q\", \"TI\"]\)\!\(\*
StyleBox[\"=\", \"TI\"]\)\[Sum]\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], 
StyleBox[\"i\", \"TI\"]]\)\!\(\*SuperscriptBox[
StyleBox[\"p\", \"TI\"], 
StyleBox[\"i\", \"TI\"]]\).\>\""}]], "Code",
 CellChangeTimes->{{3.768443062095896*^9, 3.768443142047127*^9}, {
   3.768443176191671*^9, 3.7684431781744747`*^9}, {3.7684432172898703`*^9, 
   3.768443626698205*^9}, 3.768515071737718*^9, {3.768783440329299*^9, 
   3.768783445219554*^9}, {3.768783516896253*^9, 3.768783523518281*^9}, {
   3.768784990812705*^9, 3.768785096165251*^9}, {3.7687852182707853`*^9, 
   3.7687852339891453`*^9}, {3.770591897994834*^9, 3.7705918979963913`*^9}, {
   3.770600888812024*^9, 3.770600890411174*^9}},
 ExpressionUUID -> "aba7f38c-db94-4dc4-9ddb-77b5284e2c5b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesCoefficientMod", "[", 
   RowBox[{"ex_", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x_", "\[Rule]", "den_"}], ",", "o_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Replace", "[", 
   RowBox[{
    RowBox[{"Cases", "[", 
     RowBox[{
      RowBox[{"SeriesRulesMod", "[", 
       RowBox[{"ex", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"x", "\[Rule]", "den"}], ",", "o"}], "}"}]}], "]"}], ",", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"{", "o", "}"}], "\[Rule]", "c_"}], ")"}], "\[RuleDelayed]", 
       "c"}], ",", "1", ",", "1"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"{", "c_", "}"}], "\[RuleDelayed]", "c"}], ",", 
      RowBox[{
       RowBox[{"{", "}"}], "\[Rule]", "Indeterminate"}]}], "}"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{
  3.7685150761855793`*^9, {3.768785248357534*^9, 3.768785280955866*^9}, {
   3.768785640109295*^9, 3.7687857473100767`*^9}, {3.7687865133533278`*^9, 
   3.768786614497569*^9}, {3.7705918807290783`*^9, 3.770591898029155*^9}, {
   3.770600892722411*^9, 3.770600903098051*^9}},
 ExpressionUUID -> "5dc9046c-e3b0-4ac6-b389-ff58705041e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SeriesCoefficientMod", "[", 
   RowBox[{"ex_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "o_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"SeriesCoefficientMod", "[", 
   RowBox[{"ex", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"x", "\[Rule]", 
       RowBox[{"(", 
        RowBox[{"x", "/.", "$LibraNotations"}], ")"}]}], ",", "o"}], "}"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.770609803038384*^9, 3.770609824086141*^9}}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Evolution operator", "Subsection",
 CellChangeTimes->{{3.724571534914136*^9, 3.724571538690577*^9}},
 ExpressionUUID -> "12c0b9f5-265f-4203-900c-b90503bdc104"],

Cell[CellGroupData[{

Cell["SeriesSolutionData", "Subsubsection",
 CellChangeTimes->{{3.724571548922279*^9, 3.724571550234561*^9}, 
   3.724640781292286*^9},
 ExpressionUUID -> "ffb2705d-4f11-4ed4-9047-0a1967f181d8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SeriesSolutionData", "::", "usage"}], "=", 
   "\"\<SeriesSolutionData[M,{x,x0,n}] constructs data for generalized power \
series solution of the system \[PartialD]U=M\[InvisibleComma]U.\\nGeneralized \
form: SeriesSolutionData[M,{x,y(x),n}].\\n    \[FilledSmallCircle] M should \
be rational.\\n    \[FilledSmallCircle] M should be Fuchsian at x=x0.\\n    \
\[FilledSmallCircle] Residue A at x=x0 should be free of resonances.\\n    \
\[FilledSmallCircle] SeriesSolutionData returns data U with the asymptotics \
(x-x0)^A.\\nReturned data has the form of a list with each element having the \
form {\[Lambda],\!\(\*SubscriptBox[\(K\), \
\(\[Lambda]\)]\),s,{\!\(\*SubscriptBox[\(T\), \(1\)]\),\!\(\*SubscriptBox[\(\
\[Ellipsis]T\), \(s\)]\)}&,C[\[Lambda],0..\!\(\*SubscriptBox[\(K\), \(\
\[Lambda]\)]\)]}.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SeriesSolutionData", "::", "notrat"}], "=", 
   "\"\<Matrix received is not rational in `1`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SeriesSolutionData", "::", "ppr"}], "=", 
   "\"\<Positive Poincare rank at `1`=`2`.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SeriesSolutionData", "::", "res"}], "=", 
   "\"\<Resonant eigenvalues at `1`=`2`.\>\""}], ";"}]}], "Code",
 CellChangeTimes->{{3.724557508402412*^9, 3.724558074721662*^9}, {
   3.72455812291422*^9, 3.724558814710828*^9}, {3.72455888992773*^9, 
   3.7245589825760183`*^9}, {3.7245590772004757`*^9, 
   3.7245591559603024`*^9}, {3.724559209904621*^9, 3.724559247937273*^9}, {
   3.724559373945208*^9, 3.72455940613592*^9}, {3.724559442625133*^9, 
   3.724559475085046*^9}, {3.7245595388665953`*^9, 3.724559606321946*^9}, {
   3.724559645729691*^9, 3.7245597149249*^9}, {3.724561585835918*^9, 
   3.7245616608031807`*^9}, {3.72456170969158*^9, 3.7245617684596148`*^9}, {
   3.724562474632307*^9, 3.72456257722167*^9}, {3.72456265822805*^9, 
   3.724562718014233*^9}, {3.7245628691653223`*^9, 3.7245629379523287`*^9}, {
   3.724562992814644*^9, 3.7245630161590443`*^9}, {3.724563117895488*^9, 
   3.7245631277041283`*^9}, 3.7245631600093517`*^9, {3.7245633387911654`*^9, 
   3.724563458682171*^9}, {3.724564607726287*^9, 3.724564666050934*^9}, {
   3.724564711754243*^9, 3.7245647849147673`*^9}, {3.724564830587393*^9, 
   3.724564859442768*^9}, {3.724565099603634*^9, 3.724565115753808*^9}, {
   3.724565222899396*^9, 3.724565244027137*^9}, 3.724565424932281*^9, {
   3.724565625159061*^9, 3.724565658948978*^9}, {3.724565698884059*^9, 
   3.724565757684884*^9}, {3.7245665483380833`*^9, 3.724566684891971*^9}, {
   3.724566720110775*^9, 3.724566720277038*^9}, {3.724566751485877*^9, 
   3.724566754114599*^9}, {3.724566784421155*^9, 3.72456679339694*^9}, 
   3.7245668288608007`*^9, {3.724566894838122*^9, 3.724566915270524*^9}, {
   3.7245671216711617`*^9, 3.724567187991231*^9}, {3.724567494517847*^9, 
   3.7245675921055307`*^9}, {3.724567628169162*^9, 3.724567651904294*^9}, {
   3.724567708232789*^9, 3.724567804091051*^9}, {3.724567858939662*^9, 
   3.724567922434082*^9}, {3.7245679668361998`*^9, 3.7245679995243263`*^9}, {
   3.724568140297234*^9, 3.724568208342577*^9}, {3.724568716322772*^9, 
   3.724568725441989*^9}, {3.724568806382262*^9, 3.724568885799498*^9}, {
   3.724568931512005*^9, 3.724569031488839*^9}, {3.7245690888906307`*^9, 
   3.7245691773891973`*^9}, {3.724569296408826*^9, 3.724569355570747*^9}, {
   3.7245696223731318`*^9, 3.7245696682815332`*^9}, {3.724569701264073*^9, 
   3.724570030980846*^9}, {3.72457011910854*^9, 3.724570153534108*^9}, {
   3.724570217952458*^9, 3.724570233908577*^9}, {3.724571561262162*^9, 
   3.724571579733132*^9}},
 ExpressionUUID -> "92463b69-5653-47a0-b817-d3e3853502ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ssd", "[", 
   RowBox[{
    RowBox[{"M_", "?", "SquareMatrixQ"}], ",", "y_", ",", "yv_"}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "pr", ",", "A", ",", "T", ",", "JF", ",", "x2A", ",", "p", ",", "fp", 
      ",", "Q", ",", "poles", ",", "dens", ",", "qs", ",", "Bs", ",", 
      "\[Lambda]", ",", "tmp", ",", "\[IndentingNewLine]", "Rcoefs", ",", 
      "rcoefs", ",", "n", ",", "Rdata", ",", "\[IndentingNewLine]", 
      RowBox[{"statusline", "=", "\"\<\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"FCMonitor", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"RatFuncQ", "[", 
           RowBox[{"M", ",", "y"}], "]"}]}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SeriesSolutionData", "::", "notrat"}], ",", "yv"}], 
           "]"}], ";", 
          RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"pr", "=", 
            RowBox[{"PoincareRank", "[", 
             RowBox[{"M", ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", "0"}], "}"}]}], "]"}]}], ")"}], ">", "0"}], 
         ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SeriesSolutionData", "::", "ppr"}], ",", "yv", ",", 
            "0"}], "]"}], ";", 
          RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"A", "=", 
        RowBox[{"SeriesCoefficient", "[", 
         RowBox[{"M", ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", "0", ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"CWrite", "[", "\"\<\\n\>\"", "]"}], ";", 
       RowBox[{"CWrite", "[", 
        RowBox[{"statusline", "=", "\"\<Reducing to Jordan form...\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"T", ",", "JF"}], "}"}], "=", 
        RowBox[{"JDecomposition", "[", "A", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fp", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"p", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"Max", "[", 
              RowBox[{"Length", "/@", "#"}], "]"}], "-", "1"}]}], "]"}], 
          "&"}], "/@", 
         RowBox[{"GatherBy", "[", 
          RowBox[{
           RowBox[{"DeleteDuplicates", "[", 
            RowBox[{"Map", "[", 
             RowBox[{"First", ",", 
              RowBox[{"Split", "[", 
               RowBox[{
                RowBox[{"Transpose", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Diagonal", "[", "JF", "]"}], ",", 
                   RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"Diagonal", "[", 
                    RowBox[{"JF", ",", "1"}], "]"}], ",", "0"}], "]"}]}], 
                  "}"}], "]"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#1", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "=!=", "0"}], "&"}]}], 
               "]"}], ",", 
              RowBox[{"{", "2", "}"}]}], "]"}], "]"}], ",", "First"}], 
          "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"PrintTemporary", "[", 
        RowBox[{"\"\<Leading expansion terms:\\n\>\"", ",", 
         RowBox[{"Sequence", "@@", 
          RowBox[{"(", 
           RowBox[{"Riffle", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"TraditionalForm", "[", 
                RowBox[{
                 SuperscriptBox["yv", "#1"], 
                 SuperscriptBox[
                  RowBox[{"Log", "[", "yv", "]"}], "#2"]}], "]"}], "&"}], "@@@",
               "fp"}], ",", "\"\<,\>\""}], "]"}], ")"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"Factor", "[", 
            RowBox[{"Subtract", "@@@", 
             RowBox[{"Subsets", "[", 
              RowBox[{
               RowBox[{"First", "/@", "fp"}], ",", 
               RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}], ",", "_Integer"}], 
          "]"}], ",", 
         RowBox[{
          RowBox[{"Message", "[", 
           RowBox[{
            RowBox[{"SeriesSolutionData", "::", "res"}], ",", "yv", ",", 
            "0"}], "]"}], ";", 
          RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Now", " ", "we", " ", "find", " ", "common", " ", "denominator", 
          " ", "Q"}], ",", " ", 
         RowBox[{"Eq", 
          RowBox[{"(", "6", ")"}], " ", "of", " ", "DESS", " ", "paper"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"CWrite", "[", "\"\<\\n\>\"", "]"}], ";", 
       RowBox[{"CWrite", "[", 
        RowBox[{
        "statusline", "=", "\"\<Getting rid  of denominators...\>\""}], "]"}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"poles", "=", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"PolesPosition", "[", 
             RowBox[{"M", ",", "y"}], "]"}], ",", 
            RowBox[{"\[Infinity]", "|", "0"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Q", "=", 
          RowBox[{"Times", "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"y", "-", "#"}], ")"}], "^", 
               RowBox[{"(", 
                RowBox[{"1", "+", 
                 RowBox[{"PoincareRank", "[", 
                  RowBox[{"M", ",", 
                   RowBox[{"{", 
                    RowBox[{"y", ",", "#"}], "}"}]}], "]"}]}], ")"}]}], "&"}],
              "/@", "poles"}], ")"}]}]}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Q", "=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "}"}], "=!=", 
          RowBox[{"(", 
           RowBox[{"dens", "=", 
            RowBox[{"Denominators", "[", 
             RowBox[{
              RowBox[{"Together", "[", 
               RowBox[{"M", " ", "Q"}], "]"}], ",", "y"}], "]"}]}], ")"}]}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Q", "*=", 
           RowBox[{"PolynomialLCM", "[", 
            RowBox[{
             RowBox[{"Sequence", "@@", "dens"}], ",", "y"}], "]"}]}], ";"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Q", "=", 
        RowBox[{"Numerator", "@", 
         RowBox[{"Together", "[", 
          RowBox[{"Q", "/", "y"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"qs", "=", 
        RowBox[{"CoefficientList", "[", 
         RowBox[{"Q", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Bs", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Coefficient", "[", 
           RowBox[{
            RowBox[{"Factor", "[", 
             RowBox[{"Q", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"y", " ", "M"}], "-", 
                RowBox[{"\[Lambda]", " ", 
                 RowBox[{"IdentityMatrix", "[", 
                  RowBox[{"Length", "@", "M"}], "]"}]}]}], ")"}]}], "]"}], 
            ",", "y", ",", "#"}], "]"}], "&"}], "/@", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{"Length", "[", "qs", "]"}], "-", "1"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"CWrite", "[", "\"\<\\n\>\"", "]"}], ";", 
       RowBox[{"CWrite", "[", 
        RowBox[{"statusline", "=", "\"\<Evaluating matrix exponent...\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"x2A", "=", 
        RowBox[{"ODot", "[", 
         RowBox[{
          RowBox[{"ODot", "[", 
           RowBox[{"T", ",", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Expand", "[", 
               RowBox[{
                RowBox[{"Expand", "[", 
                 RowBox[{
                  RowBox[{"Simplify", "[", 
                   RowBox[{"MatrixExp", "[", 
                    RowBox[{"JF", "*", 
                    RowBox[{"Log", "[", "y", "]"}]}], "]"}], "]"}], 
                  RowBox[{"p", "[", 
                   RowBox[{"0", ",", "0"}], "]"}]}], "]"}], "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Log", "[", "y", "]"}], "\[Rule]", 
                   RowBox[{"p", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}], ",", 
                  RowBox[{"y", "\[Rule]", 
                   RowBox[{"p", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], "}"}]}], "]"}], "//.", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"p", "[", 
                   RowBox[{"a_", ",", "b_"}], "]"}], "^", "c_"}], ":>", 
                 RowBox[{"p", "[", 
                  RowBox[{
                   RowBox[{"a", "*", "c"}], ",", 
                   RowBox[{"b", "*", "c"}]}], "]"}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"p", "[", 
                   RowBox[{"a_", ",", "b_"}], "]"}], "*", 
                  RowBox[{"p", "[", 
                   RowBox[{"c_", ",", "d_"}], "]"}]}], ":>", 
                 RowBox[{"p", "[", 
                  RowBox[{
                   RowBox[{"a", "+", "c"}], ",", 
                   RowBox[{"b", "+", "d"}]}], "]"}]}]}], "}"}]}], ")"}]}], 
           "]"}], ",", 
          RowBox[{"OInverse", "[", "T", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"CWrite", "[", "\"\<\\n\>\"", "]"}], ";", 
       RowBox[{"CWrite", "[", 
        RowBox[{
        "statusline", "=", "\"\<Evaluating recurrence coefficients...\>\""}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Rcoefs", "=", 
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Alpha]", ",", "k"}], "}"}], ",", 
          RowBox[{"Evaluate", "@", 
           RowBox[{"MapThread", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"bjf", "[", 
               RowBox[{"#1", ",", 
                RowBox[{"#2", "*", 
                 RowBox[{"IdentityMatrix", "[", 
                  RowBox[{"Length", "@", "M"}], "]"}]}], ",", 
                RowBox[{"k", "+", "1"}]}], "]"}], "&"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"MapIndexed", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"#", "/.", 
                    RowBox[{"{", 
                    RowBox[{"\[Lambda]", "\[Rule]", 
                    RowBox[{"\[Alpha]", "+", "n", "-", 
                    RowBox[{"First", "[", "#2", "]"}], "+", "1"}]}], "}"}]}], 
                   ")"}], "&"}], ",", "Bs"}], "]"}], ",", 
               RowBox[{"-", "qs"}]}], "}"}], ",", "1"}], "]"}]}]}], 
         RowBox[{"(*", 
          RowBox[{"Function", "[", 
           RowBox[{"n", ","}], "]"}], "*)"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Rdata", "=", 
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"\[Alpha]", ",", "k"}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"CWrite", "[", "\"\<\\n\>\"", "]"}], ";", 
            RowBox[{"CWrite", "[", 
             RowBox[{"statusline", "=", 
              RowBox[{
              "\"\<Evaluating recurrence coefficients for power \>\"", "<>", 
               RowBox[{"ToString", "[", "\[Alpha]", "]"}], "<>", 
               "\"\<...\>\""}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"rcoefs", "=", 
             RowBox[{"Rcoefs", "[", 
              RowBox[{"\[Alpha]", ",", "k"}], "]"}]}], 
            RowBox[{"(*", 
             RowBox[{"[", "n", "]"}], "*)"}], ";", "\[IndentingNewLine]", 
            RowBox[{"tmp", "=", 
             RowBox[{"OInverse", "[", 
              RowBox[{"-", 
               RowBox[{"rcoefs", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "may", " ", "be", " ", "improved", " ", "by", " ", "dedicated", 
               " ", "calculation", " ", "of", " ", "inverse", " ", "of", " ", 
               "bjf", " ", "with", " ", "\[IndentingNewLine]", "off"}], "-", 
              RowBox[{
              "diagonal", " ", "terms", " ", "calculated", " ", "by", " ", 
               "iterative", " ", "multiplication", " ", "by"}], " ", "-", 
              RowBox[{
               RowBox[{"A", "^", 
                RowBox[{"(", 
                 RowBox[{"-", "1"}], ")"}]}], "B"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"\[Alpha]", ",", "k", ",", 
              RowBox[{
               RowBox[{"Length", "@", "rcoefs"}], "-", "1"}], 
              RowBox[{"(*", 
               RowBox[{"=", 
                RowBox[{"s", " ", "from", " ", "the", " ", "paper"}]}], 
               "*)"}], ",", 
              RowBox[{"Function", "@@", 
               RowBox[{"(", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"ODot", "[", 
                    RowBox[{"tmp", ",", "#"}], "]"}], "&"}], "/@", 
                   RowBox[{"Rest", "[", "rcoefs", "]"}]}], "/.", 
                  RowBox[{"n", "\[RuleDelayed]", 
                   RowBox[{"Slot", "[", "1", "]"}]}]}], "}"}], ")"}]}], ",", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "!"}], "*", 
                   RowBox[{"Coefficient", "[", 
                    RowBox[{"x2A", ",", 
                    RowBox[{"p", "[", 
                    RowBox[{"\[Alpha]", ",", "#"}], "]"}]}], "]"}]}], "&"}], "/@", 
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", "k"}], "]"}]}], ",", "1"}], "]"}]}], 
             "}"}]}]}], "\[IndentingNewLine]", "]"}], "@@@", "fp"}]}], ";", 
       "\[IndentingNewLine]", "Rdata"}], "\[IndentingNewLine]", ",", 
      "statusline"}], "]"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.727743610279875*^9, 3.727743665448456*^9}, {
   3.7277451963716803`*^9, 3.727745196375244*^9}, 3.727745369661689*^9, {
   3.727745436174839*^9, 3.727745457806014*^9}, {3.727745729636136*^9, 
   3.7277457296425753`*^9}, {3.731133913991642*^9, 3.7311339160422*^9}, {
   3.732412583443349*^9, 3.73241266589049*^9}, {3.732412697835609*^9, 
   3.73241270065816*^9}, 3.732412895434914*^9, {3.7324130063856897`*^9, 
   3.732413011402442*^9}, {3.732413108507839*^9, 3.732413110019549*^9}, {
   3.752901574845982*^9, 3.752901587134166*^9}, 3.768187907326936*^9, {
   3.7686934535474043`*^9, 3.7686935989860888`*^9}, {3.768693797538005*^9, 
   3.768693817461835*^9}},
 ExpressionUUID -> "051d2400-1716-4b77-95bc-78ee010f258b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Shortcuts", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"SeriesSolutionData", "[", 
      RowBox[{
       RowBox[{"M_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"{", 
        RowBox[{"x_", ",", "\[Infinity]"}], "}"}]}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "z", "}"}], ",", 
       RowBox[{"ssd", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            SuperscriptBox["x", "2"]}], "M"}], "/.", 
          RowBox[{"{", 
           RowBox[{"x", "\[Rule]", 
            RowBox[{"1", "/", "z"}]}], "}"}]}], ",", "z", ",", 
         RowBox[{"1", "/", "x"}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"SeriesSolutionData", "[", 
       RowBox[{
        RowBox[{"M_", "?", "SquareMatrixQ"}], ",", 
        RowBox[{"{", 
         RowBox[{"x_", ",", "x0_"}], "}"}]}], "]"}], "/;", 
      RowBox[{"FreeQ", "[", 
       RowBox[{"x0", ",", "x"}], "]"}]}], ":=", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "z", "}"}], ",", 
       RowBox[{"ssd", "[", 
        RowBox[{
         RowBox[{"M", "/.", 
          RowBox[{"{", 
           RowBox[{"x", "\[Rule]", 
            RowBox[{"z", "+", "x0"}]}], "}"}]}], ",", "z", ",", 
         RowBox[{"x", "-", "x0"}]}], "]"}]}], "]"}]}], ";"}], " ", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SeriesSolutionData", "[", 
      RowBox[{
       RowBox[{"M_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"{", 
        RowBox[{"x_", ",", "y_"}], "}"}]}], "]"}], ":=", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"z", ",", "xvar"}], "}"}], ",", 
       RowBox[{
        RowBox[{"xvar", "=", 
         RowBox[{"x", "/.", 
          RowBox[{"First", "[", 
           RowBox[{"Solve", "[", 
            RowBox[{
             RowBox[{"z", "\[Equal]", "y"}], ",", "x"}], "]"}], "]"}]}]}], 
        ";", 
        RowBox[{"ssd", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"M", " ", 
            RowBox[{"D", "[", 
             RowBox[{"xvar", ",", "z"}], "]"}]}], "/.", 
           RowBox[{"{", 
            RowBox[{"x", "\[Rule]", "xvar"}], "}"}]}], ",", "z", ",", "y"}], 
         "]"}]}]}], "]"}]}], ";"}]}]}]], "Code",
 CellChangeTimes->{{3.724557508402412*^9, 3.724558074721662*^9}, {
   3.72455812291422*^9, 3.724558814710828*^9}, {3.72455888992773*^9, 
   3.7245589825760183`*^9}, {3.7245590772004757`*^9, 
   3.7245591559603024`*^9}, {3.724559209904621*^9, 3.724559247937273*^9}, {
   3.724559373945208*^9, 3.72455940613592*^9}, {3.724559442625133*^9, 
   3.724559475085046*^9}, {3.7245595388665953`*^9, 3.724559606321946*^9}, {
   3.724559645729691*^9, 3.7245597149249*^9}, {3.724561585835918*^9, 
   3.7245616608031807`*^9}, {3.72456170969158*^9, 3.7245617684596148`*^9}, {
   3.724562474632307*^9, 3.72456257722167*^9}, {3.72456265822805*^9, 
   3.724562718014233*^9}, {3.7245628691653223`*^9, 3.7245629379523287`*^9}, {
   3.724562992814644*^9, 3.7245630161590443`*^9}, {3.724563117895488*^9, 
   3.7245631277041283`*^9}, 3.7245631600093517`*^9, {3.7245633387911654`*^9, 
   3.724563458682171*^9}, {3.724564607726287*^9, 3.724564666050934*^9}, {
   3.724564711754243*^9, 3.7245647849147673`*^9}, {3.724564830587393*^9, 
   3.724564859442768*^9}, {3.724565099603634*^9, 3.724565115753808*^9}, {
   3.724565222899396*^9, 3.724565244027137*^9}, 3.724565424932281*^9, {
   3.724565625159061*^9, 3.724565658948978*^9}, {3.724565698884059*^9, 
   3.724565757684884*^9}, {3.7245665483380833`*^9, 3.724566684891971*^9}, {
   3.724566720110775*^9, 3.724566720277038*^9}, {3.724566751485877*^9, 
   3.724566754114599*^9}, {3.724566784421155*^9, 3.72456679339694*^9}, 
   3.7245668288608007`*^9, {3.724566894838122*^9, 3.724566915270524*^9}, {
   3.7245671216711617`*^9, 3.724567187991231*^9}, {3.724567494517847*^9, 
   3.7245675921055307`*^9}, {3.724567628169162*^9, 3.724567651904294*^9}, {
   3.724567708232789*^9, 3.724567804091051*^9}, {3.724567858939662*^9, 
   3.724567922434082*^9}, {3.7245679668361998`*^9, 3.7245679995243263`*^9}, {
   3.724568140297234*^9, 3.724568208342577*^9}, {3.724568716322772*^9, 
   3.724568725441989*^9}, {3.724568806382262*^9, 3.724568885799498*^9}, {
   3.724568931512005*^9, 3.724569031488839*^9}, {3.7245690888906307`*^9, 
   3.7245691773891973`*^9}, {3.724569296408826*^9, 3.724569355570747*^9}, {
   3.7245696223731318`*^9, 3.7245696682815332`*^9}, {3.724569701264073*^9, 
   3.724570030980846*^9}, {3.72457011910854*^9, 3.724570153534108*^9}, {
   3.724570217952458*^9, 3.724570233908577*^9}, {3.724571561262162*^9, 
   3.724571579733132*^9}},
 ExpressionUUID -> "fbb942bf-739e-414e-ab8a-e1c5dcb9595a"]
}, Closed]],

Cell[CellGroupData[{

Cell["ConstructSeriesSolution", "Subsubsection",
 CellChangeTimes->{{3.724571548922279*^9, 3.724571550234561*^9}, {
  3.724640781292286*^9, 3.724640791367264*^9}},
 ExpressionUUID -> "67d7a69e-8a46-4147-b67c-f412def5ad61"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ConstructSeriesSolution", "::", "usage"}], "=", 
   "\"\<ConstructSeriesSolution[rdata_,{x_,o_}] makes a series solution out \
of rdata (see ?SeriesSolutionData for how to get rdata).\\n    o \[LongDash] \
order in x.\\nIf \
f=ConstructSeriesSolution[SeriesSolutionData[M,{x,0}],{x,o}], then one may \
check the equation by Factor[D[y,x]-M.y].\\nOptions:\\n    \
O\[Rule]True|False:False \[LongDash] whether to add O[x]^o\\n    \
Split\[Rule]True|False:False determines whether to split contribution of \
different fractional powers.\\n    Hold->f|False:False -- whether to wrap the \
leading powers. If f\[NotEqual]False is given, f[lp] is used instead of \
\!\(\*SuperscriptBox[\(x\), \(lp\)]\).\\nSince Mathematica treats generalized \
power series poorly, using options O\[Rule]True and Split\[Rule]False \
simultaneously is not recommended. If option Split\[Rule]True is used,  \
ConstructSeriesSolution returns the result as a rectangular matrix \
n\[Times](n*|S|), with each square n\[Times]n block corresponding to a \
specific fractional power.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConstructSeriesSolution", "::", "mixed"}], "=", 
   "\"\<Since Mathematica treats generalized power series poorly, using \
options O\[Rule]True and Split\[Rule]False simultaneously is not recommended.\
\>\""}], ";"}]}], "Code",
 CellChangeTimes->{{3.724573326363451*^9, 3.7245733284796352`*^9}, {
   3.724573568858251*^9, 3.724573577327174*^9}, {3.7245737085156384`*^9, 
   3.7245737105311003`*^9}, {3.724573931671966*^9, 3.724573936940535*^9}, {
   3.7245756357615547`*^9, 3.724575673796444*^9}, {3.72457603016895*^9, 
   3.724576080834341*^9}, 3.7245762034389763`*^9, {3.7245762511814737`*^9, 
   3.724576269916218*^9}, {3.724576353598178*^9, 3.724576355430125*^9}, {
   3.724576466062735*^9, 3.724576499924611*^9}, {3.7245843215414467`*^9, 
   3.72458434214403*^9}, {3.724632505149716*^9, 3.724632531086482*^9}, 
   3.7246326361913977`*^9, {3.72463274713177*^9, 3.724632770424951*^9}, {
   3.724632873073833*^9, 3.724632914641952*^9}, {3.7246329474436207`*^9, 
   3.7246329523254833`*^9}, {3.724633965244459*^9, 3.724633966759568*^9}, {
   3.7246340255676394`*^9, 3.724634063542871*^9}, {3.724634225102263*^9, 
   3.724634377569359*^9}, {3.7246345077384253`*^9, 3.724634542594706*^9}, {
   3.724634835663616*^9, 3.7246348391829777`*^9}, {3.724634883311021*^9, 
   3.724634902083248*^9}, {3.7246350290186996`*^9, 3.7246350384741497`*^9}, {
   3.724635116184773*^9, 3.724635145224298*^9}, {3.724635225320634*^9, 
   3.724635252288093*^9}, {3.724635292712303*^9, 3.7246354325198174`*^9}, 
   3.72463548811873*^9, {3.7246408395461903`*^9, 3.724641089440737*^9}, {
   3.724641448091117*^9, 3.7246414749870863`*^9}, {3.748225355373044*^9, 
   3.74822539994071*^9}, {3.7482259869929934`*^9, 3.7482260674491453`*^9}},
 ExpressionUUID -> "29eacd29-c7f1-4da7-b8fd-242a384446ad"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ConstructSeriesSolution", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"O", "\[Rule]", "False"}], ",", 
     RowBox[{"Split", "\[Rule]", "False"}], ",", 
     RowBox[{"Simplify", "\[Rule]", "Factor"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.72464079492304*^9, 3.724640823265443*^9}, 
   3.724641237650147*^9, {3.748225258145159*^9, 3.748225270888637*^9}, 
   3.748226974815901*^9, {3.749652994777133*^9, 3.74965301822657*^9}, {
   3.752901472176825*^9, 3.75290147777641*^9}, 3.752901528792409*^9},
 ExpressionUUID -> "e9fbe98f-b6a6-4f83-9727-f24b3512efa4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ConstructSeriesSolution", "[", 
   RowBox[{"rdata_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "o_"}], "}"}], ",", " ", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"c", ",", "n", ",", "sdata", ",", 
      RowBox[{"sf", "=", 
       RowBox[{"OptionValue", "[", "Simplify", "]"}]}], ",", 
      RowBox[{"Oo", "=", 
       RowBox[{"TrueQ", "@", 
        RowBox[{"OptionValue", "[", "O", "]"}]}]}], ",", 
      RowBox[{"So", "=", 
       RowBox[{"TrueQ", "@", 
        RowBox[{"OptionValue", "[", "Split", "]"}]}]}]}], 
     RowBox[{"(*", 
      RowBox[{",", 
       RowBox[{"Ho", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"TrueQ", "@", 
           RowBox[{"!", 
            RowBox[{"OptionValue", "[", "Hold", "]"}]}]}], ",", 
          RowBox[{
           RowBox[{"x", "^", "#"}], "&"}], ",", 
          RowBox[{"OptionValue", "[", "Hold", "]"}]}], "]"}]}]}], "*)"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Oo", "&&", 
        RowBox[{"!", "So"}]}], ",", 
       RowBox[{"Message", "[", 
        RowBox[{"ConstructSeriesSolution", "::", "mixed"}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Oo", "=", 
      RowBox[{"If", "[", 
       RowBox[{"Oo", ",", 
        RowBox[{
         SuperscriptBox["x", "o"], 
         RowBox[{"O", "[", "x", "]"}]}], ",", "0"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"sdata", "=", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"lp", ",", "llp", ",", "M", ",", "coefs", ",", "init"}], 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"c", "[", 
             RowBox[{"lp", ",", "0"}], "]"}], "=", "init"}], ";", 
           RowBox[{
            RowBox[{"c", "[", 
             RowBox[{"lp", ",", 
              RowBox[{"n_Integer", "?", "Positive"}]}], "]"}], ":=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Quiet", "[", 
               RowBox[{"Unset", "[", 
                RowBox[{"c", "[", 
                 RowBox[{"n", "-", "M", "-", "1"}], "]"}], "]"}], "]"}], ";", 
              RowBox[{"(*", 
               RowBox[{"clean", " ", "up"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"lp", ",", "n"}], "]"}], "=", 
               RowBox[{"sf", "@", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"Dot", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"coefs", "[", "n", "]"}], "[", 
                    RowBox[{"[", "m", "]"}], "]"}], ",", 
                    RowBox[{"c", "[", 
                    RowBox[{"lp", ",", 
                    RowBox[{"n", "-", "m"}]}], "]"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"m", ",", 
                    RowBox[{"Min", "[", 
                    RowBox[{"M", ",", "n"}], "]"}]}], "}"}]}], "]"}]}]}]}], 
             ")"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"x", "^", "lp"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Dot", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Log", "[", "x", "]"}], "^", "#"}], "/", 
                    RowBox[{"#", "!"}]}], ")"}], "&"}], "/@", 
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", "llp"}], "]"}]}], ")"}], ",", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{"Length", "@", "#"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"llp", "+", "1"}], ")"}]}]}], "]"}], "&"}], "[", 
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"lp", ",", "n"}], "]"}], "*", 
                    SuperscriptBox["x", "n"]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "0", ",", "o"}], "}"}]}], "]"}], "]"}], 
                 ")"}]}], "]"}], "+", "Oo"}], ")"}]}]}]}], 
         "\[IndentingNewLine]", "]"}], "@@@", "rdata"}], ")"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{"So", ",", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{"{", "sdata", "}"}], "]"}], ",", 
       RowBox[{"Plus", "@@", "sdata"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.724573326363451*^9, 3.7245733284796352`*^9}, {
   3.724573568858251*^9, 3.724573577327174*^9}, {3.7245737085156384`*^9, 
   3.7245737105311003`*^9}, {3.724573931671966*^9, 3.724573936940535*^9}, {
   3.7245756357615547`*^9, 3.724575673796444*^9}, {3.72457603016895*^9, 
   3.724576080834341*^9}, 3.7245762034389763`*^9, {3.7245762511814737`*^9, 
   3.724576269916218*^9}, {3.724576353598178*^9, 3.724576355430125*^9}, {
   3.724576466062735*^9, 3.724576499924611*^9}, {3.7245843215414467`*^9, 
   3.72458434214403*^9}, {3.724632505149716*^9, 3.724632531086482*^9}, 
   3.7246326361913977`*^9, {3.72463274713177*^9, 3.724632770424951*^9}, {
   3.724632873073833*^9, 3.724632914641952*^9}, {3.7246329474436207`*^9, 
   3.7246329523254833`*^9}, {3.724633965244459*^9, 3.724633966759568*^9}, {
   3.7246340255676394`*^9, 3.724634063542871*^9}, {3.724634225102263*^9, 
   3.724634377569359*^9}, {3.7246345077384253`*^9, 3.724634542594706*^9}, {
   3.724634835663616*^9, 3.7246348391829777`*^9}, {3.724634883311021*^9, 
   3.724634902083248*^9}, {3.7246350290186996`*^9, 3.7246350384741497`*^9}, {
   3.724635116184773*^9, 3.724635145224298*^9}, {3.724635225320634*^9, 
   3.724635252288093*^9}, {3.724635292712303*^9, 3.7246354325198174`*^9}, 
   3.72463548811873*^9, {3.724641128388451*^9, 3.724641171980044*^9}, {
   3.7246412059919653`*^9, 3.7246412069638653`*^9}, {3.724641258484334*^9, 
   3.724641316031949*^9}, {3.724641400932399*^9, 3.7246414415906343`*^9}, {
   3.72464148251169*^9, 3.724641484940824*^9}, {3.727743707963991*^9, 
   3.7277437524381332`*^9}, {3.731132091117092*^9, 3.731132093004591*^9}, {
   3.7311321738131332`*^9, 3.7311321777566357`*^9}, {3.731132316574188*^9, 
   3.731132346125952*^9}, {3.731133870330432*^9, 3.731133871314851*^9}, {
   3.748225277651379*^9, 3.748225324637094*^9}, 3.7482257658783712`*^9, {
   3.7482258500714703`*^9, 3.7482258910715427`*^9}, {3.7482269919722557`*^9, 
   3.748227002771371*^9}, {3.749653030559429*^9, 3.7496530343459873`*^9}},
 ExpressionUUID -> "897f128a-cb11-4bc7-ba66-098f18b2f4a9"]
}, Closed]],

Cell[CellGroupData[{

Cell["PexpExpansion", "Subsubsection",
 CellChangeTimes->{{3.724571541802348*^9, 3.7245715423225317`*^9}, 
   3.7248427226151648`*^9},
 ExpressionUUID -> "06d07d69-7b8a-40ff-89b6-d6ea94c3a054"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PexpExpansion", "::", "usage"}], "=", 
  "\"\<PexpExpansion[{M,n},x] gives the perturbative expansion of the \
\!\(TraditionalForm\`Pexp[\[Integral]dx\\\ M]\) in \!\(TraditionalForm\`M\) \
up to the term \!\(TraditionalForm\`\(\(\[Proportional]\)\*SuperscriptBox[\(M\
\), \(n\)]\)\) via the iterated integrals \
\!\(TraditionalForm\`II[{\*SubscriptBox[\(a\), \(n\)], \*SubscriptBox[\(a\), \
\(n - 1\)], \*SubscriptBox[\(\[Ellipsis]a\), \(1\)]}, x] = \
\(\*UnderscriptBox[\(\[Integral]\[Ellipsis] \[Integral]\), \
\(\*SubscriptBox[\(x\), \(0\)] < \*SubscriptBox[\(x\), \(1\)] < \
\*SubscriptBox[\(\[Ellipsis]x\), \(n\)] < x\)] \*FractionBox[\(\
\[DifferentialD]\*SubscriptBox[\(x\), \(n\)]\), \(\*SubscriptBox[\(x\), \
\(n\)] - \*SubscriptBox[\(a\), \(n\)]\)] \(\[Ellipsis]\) \*FractionBox[\(\
\[DifferentialD]\*SubscriptBox[\(x\), \(1\)]\), \(\*SubscriptBox[\(x\), \
\(1\)] - \*SubscriptBox[\(a\), \(1\)]\)]\(\\\ \)\)\), where \
\!\(TraditionalForm\`\*SubscriptBox[\(x\), \(0\)]\) is arbitrary. The result \
is the list of successive terms.\>\""}]], "Code",
 CellChangeTimes->{{3.7248427273901997`*^9, 3.724842790192151*^9}},
 ExpressionUUID -> "2e9c0612-f920-4ac2-a6ca-29b5529f5b46"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PexpExpansion", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"M_", "?", "MatrixQ"}], ",", "n_Integer"}], "}"}], ",", 
    "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"p", "=", 
       RowBox[{"PolesInfo", "[", 
        RowBox[{"M", ",", "x"}], "]"}]}], ",", "op", ",", "res", ",", "w", 
      ",", 
      RowBox[{"i", "=", "0"}], ",", "t"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"MatchQ", "[", 
         RowBox[{"p", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"_", ",", "0"}], "}"}], "..."}], "}"}]}], "]"}], "]"}], 
       ",", 
       RowBox[{"Abort", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"p", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"First", "/@", "p"}], ",", "\[Infinity]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"op", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"SeriesCoefficient", "[", 
            RowBox[{"M", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "#", ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}], 
           RowBox[{"w", "[", "#", "]"}]}], "&"}], "/@", "p"}], ")"}]}]}], ";",
      " ", 
     RowBox[{"(*", "operator", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"FCMonitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"res", "=", 
        RowBox[{"NestList", "[", 
         RowBox[{
          RowBox[{"Function", "[", 
           RowBox[{"pr", ",", 
            RowBox[{
             RowBox[{"i", "++"}], ";", 
             RowBox[{"CWrite", "[", "\"\<.\>\"", "]"}], ";", 
             RowBox[{"t", "=", 
              RowBox[{"Expand", "[", 
               RowBox[{"Dot", "[", 
                RowBox[{"op", ",", "pr"}], "]"}], "]"}]}], ";", 
             RowBox[{"Plus", "@@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Coefficient", "[", 
                    RowBox[{"t", ",", 
                    RowBox[{"w", "[", "#", "]"}]}], "]"}], "/.", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"II", "[", 
                    RowBox[{
                    RowBox[{"{", "a___", "}"}], ",", "x"}], "]"}], ":>", 
                    RowBox[{"II", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", "a"}], "}"}], ",", "x"}], "]"}]}], 
                    "}"}]}], ")"}], "&"}], "/@", "p"}], ")"}]}]}]}], "]"}], 
          ",", 
          RowBox[{
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"Length", "@", "M"}], "]"}], "*", 
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", "x"}], "]"}]}], ",", "n"}], "]"}]}], 
       ",", "\[IndentingNewLine]", "i", ",", "\"\<\\n\>\""}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{
  3.688627609165856*^9, 3.722927706380597*^9, 3.724842739657036*^9, {
   3.727743773357335*^9, 3.727743777883334*^9}, {3.768693624549011*^9, 
   3.768693624741829*^9}, {3.768693668797737*^9, 3.768693771463176*^9}, {
   3.768694203173511*^9, 3.7686942039896727`*^9}},
 ExpressionUUID -> "b83a06aa-e754-4dc4-b944-e0d48b6554c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"PexpExpansion", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"M_", "?", "MatrixQ"}], ",", "n_Integer"}], "}"}], ",", 
    "x_Symbol", ",", "x0_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"p", "=", 
       RowBox[{"PolesInfo", "[", 
        RowBox[{"M", ",", "x"}], "]"}]}], ",", "op", ",", "res", ",", "w", 
      ",", 
      RowBox[{"i", "=", "0"}], ",", "t"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"MatchQ", "[", 
         RowBox[{"p", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"_", ",", "0"}], "}"}], "..."}], "}"}]}], "]"}], "]"}], 
       ",", 
       RowBox[{"Abort", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"p", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"First", "/@", "p"}], ",", "\[Infinity]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"op", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"SeriesCoefficient", "[", 
            RowBox[{"M", ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "#", ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}], 
           RowBox[{"w", "[", "#", "]"}]}], "&"}], "/@", "p"}], ")"}]}]}], ";",
      " ", 
     RowBox[{"(*", "operator", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"FCMonitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"res", "=", 
        RowBox[{"NestList", "[", 
         RowBox[{
          RowBox[{"Function", "[", 
           RowBox[{"pr", ",", 
            RowBox[{
             RowBox[{"i", "++"}], ";", "\[IndentingNewLine]", 
             RowBox[{"CWrite", "[", "\"\<.\>\"", "]"}], ";", 
             RowBox[{"t", "=", 
              RowBox[{"Expand", "[", 
               RowBox[{"Dot", "[", 
                RowBox[{"op", ",", "pr"}], "]"}], "]"}]}], ";", 
             RowBox[{"Plus", "@@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Coefficient", "[", 
                    RowBox[{"t", ",", 
                    RowBox[{"w", "[", "#", "]"}]}], "]"}], "/.", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"II", "[", 
                    RowBox[{
                    RowBox[{"{", "a___", "}"}], ",", "x", ",", "x0"}], "]"}], 
                    ":>", 
                    RowBox[{"II", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"#", ",", "a"}], "}"}], ",", "x", ",", "x0"}], 
                    "]"}]}], "}"}]}], ")"}], "&"}], "/@", "p"}], ")"}]}]}]}], 
           "]"}], ",", 
          RowBox[{
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"Length", "@", "M"}], "]"}], "*", 
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", "x", ",", "x0"}], "]"}]}], ",", "n"}], 
         "]"}]}], ",", "\[IndentingNewLine]", "i"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.724635829096835*^9, 3.724635851970018*^9}, 
   3.7248427411010857`*^9, {3.727743786995122*^9, 3.727743790467804*^9}, {
   3.768694200613411*^9, 3.76869421027684*^9}},
 ExpressionUUID -> "25b327a5-3723-4618-b9fb-0b028a5c87b5"]
}, Closed]],

Cell[CellGroupData[{

Cell["FactorLeadingLetter,FactorTrailingLetter", "Subsubsection",
 CellChangeTimes->{{3.7247460391888943`*^9, 3.724746048894178*^9}, {
  3.724746153900258*^9, 3.7247461573878517`*^9}},
 ExpressionUUID -> "dfe08e56-3c55-4934-bc46-8771b95c0ee6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FactorLeadingLetter", "[", 
   RowBox[{"expr_", ",", "l_", ",", 
    RowBox[{"h_:", "II"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"IIs", ",", 
      RowBox[{"IIrules", "=", 
       RowBox[{"{", "}"}]}], ",", "shuffleRule", ",", 
      RowBox[{"ex", "=", "expr"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"shuffleRule", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"ls", ":", 
             RowBox[{
              RowBox[{"(", "l", ")"}], ".."}]}], ",", 
            RowBox[{"b1", ":", 
             RowBox[{"Except", "[", "l", "]"}]}], ",", "bs___"}], "}"}], ",", 
          "x_"}], "]"}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", 
           RowBox[{
            RowBox[{"{", "ls", "}"}], ",", "x"}], "]"}], 
          RowBox[{"h", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"b1", ",", "bs"}], "}"}], ",", "x"}], "]"}]}], "-", 
         RowBox[{"Plus", "@@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"h", "[", 
              RowBox[{"#", ",", "x"}], "]"}], "&"}], "/@", 
            RowBox[{"Rest", "[", 
             RowBox[{"ShuffleProduct", "[", 
              RowBox[{
               RowBox[{"{", "ls", "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"b1", ",", "bs"}], "}"}]}], "]"}], "]"}]}], 
           ")"}]}]}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{"(*", 
       RowBox[{
       "Find", " ", "all", " ", "instances", " ", "of", " ", "II", " ", 
        "which", " ", "should", " ", "be", " ", "processed"}], "*)"}], 
      RowBox[{
       RowBox[{
        RowBox[{"{", "}"}], "=!=", 
        RowBox[{"(", 
         RowBox[{"IIs", "=", 
          RowBox[{"DeleteDuplicates", "[", 
           RowBox[{"Cases", "[", 
            RowBox[{"ex", ",", 
             RowBox[{"h", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"(", "l", ")"}], ".."}], ",", 
                 RowBox[{"Except", "[", "l", "]"}], ",", "___"}], "}"}], ",", 
               "x_"}], "]"}], ",", "All"}], "]"}], "]"}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Determine", " ", "which", " ", "rules", " ", "are", " ", "absent"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"IIs", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{"IIs", ",", 
           RowBox[{"First", "/@", "IIrules"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IIrules", "=", 
         RowBox[{"Join", "[", 
          RowBox[{"IIrules", ",", 
           RowBox[{"Thread", "[", 
            RowBox[{"IIs", "\[Rule]", 
             RowBox[{"Replace", "[", 
              RowBox[{"IIs", ",", "shuffleRule", ",", 
               RowBox[{"{", "1", "}"}]}], "]"}]}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ex", "=", 
         RowBox[{"ex", "/.", 
          RowBox[{"Dispatch", "[", "IIrules", "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ex", "=", 
      RowBox[{"ex", "/.", 
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{
          RowBox[{"ls", ":", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", "l", ")"}], ".."}], "}"}]}], ",", "x_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", 
           RowBox[{
            RowBox[{"{", "l", "}"}], ",", "x"}], "]"}], "^", 
          RowBox[{"Length", "[", "ls", "]"}]}], "/", 
         RowBox[{
          RowBox[{"Length", "[", "ls", "]"}], "!"}]}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "ex", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.724746053766224*^9, {3.7247463456950693`*^9, 3.7247463526649446`*^9}, {
   3.724756687726622*^9, 3.724756752707788*^9}, {3.724804012447773*^9, 
   3.724804018013332*^9}, {3.7248042654073763`*^9, 3.724804267687333*^9}, {
   3.725846536982469*^9, 3.725846718670599*^9}, {3.725846962975016*^9, 
   3.725847112664344*^9}, {3.72584714445648*^9, 3.7258471646561832`*^9}, {
   3.725847194904845*^9, 3.725847224872677*^9}, {3.725847266689496*^9, 
   3.725847353417351*^9}, {3.725847399329611*^9, 3.725847422914193*^9}, {
   3.725847535474093*^9, 3.725847536194496*^9}, 3.7258476780360107`*^9},
 ExpressionUUID -> "ecf0dde3-dd64-4d48-bef7-424bf606f884"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"InsertionPositions", "[", 
   RowBox[{"m_Integer", ",", "n_Integer"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ss", ",", "range"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"range", "=", 
      RowBox[{
       RowBox[{"Range", "[", "n", "]"}], "-", "1"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "-", "range"}], "&"}], "/@", 
      RowBox[{"Subsets", "[", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"m", "+", "n"}], "]"}], ",", 
        RowBox[{"{", "n", "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"ShuffleProductNestList", "[", 
   RowBox[{"l_", ",", "list_List", ",", "n_Integer"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"len", "=", 
       RowBox[{"Length", "@", "list"}]}], ",", "k"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Insert", "[", 
         RowBox[{"list", ",", "l", ",", 
          RowBox[{"List", "/@", "#"}]}], "]"}], "&"}], "/@", 
       RowBox[{"InsertionPositions", "[", 
        RowBox[{"len", ",", "k"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", "0", ",", "n"}], "}"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.725855102880393*^9, 3.7258551179830112`*^9}, {
   3.725855161510911*^9, 3.725855341791576*^9}, {3.725855386015884*^9, 
   3.7258553865356913`*^9}, {3.7258554377122173`*^9, 3.725855521568495*^9}, {
   3.725855573752652*^9, 3.72585565773682*^9}, {3.7258558989137573`*^9, 
   3.725855920162197*^9}, {3.725855979410316*^9, 3.725855979490136*^9}, {
   3.725856033337954*^9, 3.72585603628204*^9}, {3.725856156754479*^9, 
   3.7258561778987217`*^9}, 3.725856560348806*^9},
 ExpressionUUID -> "f24be758-2746-44e9-933e-7828cbd13442"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", "\"\<InsertionPositions can probably be written in C\>\"", 
   "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.725862280511352*^9, 3.725862295078216*^9}},
 ExpressionUUID -> "dabcd067-d0d5-449c-95c1-13b0a4783477"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FactorLeadingLetter", "[", 
   RowBox[{"expr_", ",", "l_", ",", 
    RowBox[{"h_:", "II"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"IIs", ",", 
      RowBox[{"IIrules", "=", 
       RowBox[{"{", "}"}]}], ",", "shuffleRule", ",", 
      RowBox[{"ex", "=", "expr"}], ",", "k", ",", "il", ",", "i"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"shuffleRule", "=", 
      RowBox[{
       RowBox[{"h", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"ls", ":", 
            RowBox[{
             RowBox[{"(", "l", ")"}], ".."}]}], ",", 
           RowBox[{"b1", ":", 
            RowBox[{"Except", "[", "l", "]"}]}], ",", "bs___"}], "}"}], ",", 
         "x_"}], "]"}], "\[RuleDelayed]", 
       RowBox[{"Plus", "@@", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"shs", ",", "il"}], "}"}], ",", 
            RowBox[{
             RowBox[{"i", "=", 
              RowBox[{
               RowBox[{"First", "[", "il", "]"}], "-", "1"}]}], ";", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"-", "1"}], ")"}], "^", "i"}], ")"}], "*", 
              RowBox[{"h", "[", 
               RowBox[{
                RowBox[{"Drop", "[", 
                 RowBox[{
                  RowBox[{"{", "ls", "}"}], ",", 
                  RowBox[{"-", "i"}]}], "]"}], ",", "x"}], "]"}], "*", 
              RowBox[{"Plus", "@@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"h", "[", 
                   RowBox[{
                    RowBox[{"Prepend", "[", 
                    RowBox[{"#", ",", "b1"}], "]"}], ",", "x"}], "]"}], "&"}],
                  "/@", "shs"}], ")"}]}]}]}]}], "]"}], ",", 
          RowBox[{"ShuffleProductNestList", "[", 
           RowBox[{"l", ",", 
            RowBox[{"{", "bs", "}"}], ",", 
            RowBox[{"Length", "@", 
             RowBox[{"{", "ls", "}"}]}]}], "]"}]}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"IIs", "=", 
      RowBox[{"DeleteDuplicates", "[", 
       RowBox[{"Cases", "[", 
        RowBox[{"ex", ",", 
         RowBox[{"h", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"(", "l", ")"}], ".."}], ",", 
             RowBox[{"Except", "[", "l", "]"}], ",", "___"}], "}"}], ",", 
           "x_"}], "]"}], ",", "All"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"IIrules", "=", 
      RowBox[{"Thread", "[", 
       RowBox[{"IIs", "\[Rule]", 
        RowBox[{"Replace", "[", 
         RowBox[{"IIs", ",", "shuffleRule", ",", 
          RowBox[{"{", "1", "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ex", "=", 
      RowBox[{
       RowBox[{"ex", "/.", 
        RowBox[{"Dispatch", "[", "IIrules", "]"}]}], "/.", 
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{
          RowBox[{"ls", ":", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", "l", ")"}], ".."}], "}"}]}], ",", "x_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", 
           RowBox[{
            RowBox[{"{", "l", "}"}], ",", "x"}], "]"}], "^", 
          RowBox[{"Length", "[", "ls", "]"}]}], "/", 
         RowBox[{
          RowBox[{"Length", "[", "ls", "]"}], "!"}]}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "ex", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.7258538447441177`*^9, 3.725853845552678*^9}, {
   3.725853995225675*^9, 3.725854106834984*^9}, {3.7258542900678673`*^9, 
   3.725854295492062*^9}, {3.725854328419964*^9, 3.725854353132962*^9}, {
   3.72585438770828*^9, 3.7258547303901043`*^9}, {3.725856691036283*^9, 
   3.7258566921884727`*^9}, {3.7258567329321423`*^9, 3.725856734404458*^9}, {
   3.7258588829096413`*^9, 3.725858889052651*^9}, {3.725860462377049*^9, 
   3.725860466609784*^9}, 3.725862422368685*^9},
 ExpressionUUID -> "33ad056e-14e0-4d76-8188-5b8a86f248e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FactorLeadingLetter", "[", 
   RowBox[{"expr_", ",", "l_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "r", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"r", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"II", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"ls", ":", 
              RowBox[{
               RowBox[{"(", "l", ")"}], ".."}]}], ",", 
             RowBox[{"b1", ":", 
              RowBox[{"Except", "[", "l", "]"}]}], ",", "bs___"}], "}"}], ",",
            "x_"}], "]"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", "ls", "}"}], ",", "x"}], "]"}], 
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"b1", ",", "bs"}], "}"}], ",", "x"}], "]"}]}], "-", 
          RowBox[{"Plus", "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"II", "[", 
               RowBox[{"#", ",", "x"}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "[", 
              RowBox[{"ShuffleProduct", "[", 
               RowBox[{
                RowBox[{"{", "ls", "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"b1", ",", "bs"}], "}"}]}], "]"}], "]"}]}], 
            ")"}]}]}]}], ",", 
        RowBox[{
         RowBox[{"II", "[", 
          RowBox[{
           RowBox[{"ls", ":", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"(", "l", ")"}], ".."}], "}"}]}], ",", "x_"}], "]"}], ":>", 
         RowBox[{
          RowBox[{
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", "l", "}"}], ",", "x"}], "]"}], "^", 
           RowBox[{"Length", "[", "ls", "]"}]}], "/", 
          RowBox[{
           RowBox[{"Length", "[", "ls", "]"}], "!"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"expr", "//.", "r"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.724746053766224*^9, {3.7247463456950693`*^9, 3.7247463526649446`*^9}, {
   3.724756687726622*^9, 3.724756752707788*^9}, {3.724804012447773*^9, 
   3.724804018013332*^9}, {3.7248042654073763`*^9, 3.724804267687333*^9}},
 ExpressionUUID -> "73bb76ac-9ec5-4bfb-88ca-29bcf74570a7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FactorTrailingLetter", "[", 
   RowBox[{"expr_", ",", "l_", ",", 
    RowBox[{"h_:", "II"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"IIs", ",", 
      RowBox[{"IIrules", "=", 
       RowBox[{"{", "}"}]}], ",", "shuffleRule", ",", 
      RowBox[{"ex", "=", "expr"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"shuffleRule", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"bs___", ",", 
            RowBox[{"b1", ":", 
             RowBox[{"Except", "[", "l", "]"}]}], ",", 
            RowBox[{"ls", ":", 
             RowBox[{
              RowBox[{"(", "l", ")"}], ".."}]}]}], "}"}], ",", "x_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"bs", ",", "b1"}], "}"}], ",", "x"}], "]"}], 
          RowBox[{"h", "[", 
           RowBox[{
            RowBox[{"{", "ls", "}"}], ",", "x"}], "]"}]}], "-", 
         RowBox[{"Plus", "@@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"h", "[", 
              RowBox[{"#", ",", "x"}], "]"}], "&"}], "/@", 
            RowBox[{"Rest", "[", 
             RowBox[{"ShuffleProduct", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"bs", ",", "b1"}], "}"}], ",", 
               RowBox[{"{", "ls", "}"}]}], "]"}], "]"}]}], ")"}]}]}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{"(*", 
       RowBox[{
       "Find", " ", "all", " ", "instances", " ", "of", " ", "II", " ", 
        "which", " ", "should", " ", "be", " ", "processed"}], "*)"}], 
      RowBox[{
       RowBox[{
        RowBox[{"{", "}"}], "=!=", 
        RowBox[{"(", 
         RowBox[{"IIs", "=", 
          RowBox[{"DeleteDuplicates", "[", 
           RowBox[{"Cases", "[", 
            RowBox[{"ex", ",", 
             RowBox[{"h", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"___", ",", 
                 RowBox[{"Except", "[", "l", "]"}], ",", 
                 RowBox[{
                  RowBox[{"(", "l", ")"}], ".."}]}], "}"}], ",", "x_"}], 
              "]"}], ",", "All"}], "]"}], "]"}]}], ")"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Determine", " ", "which", " ", "rules", " ", "are", " ", "absent"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"IIs", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{"IIs", ",", 
           RowBox[{"First", "/@", "IIrules"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IIrules", "=", 
         RowBox[{"Join", "[", 
          RowBox[{"IIrules", ",", 
           RowBox[{"Thread", "[", 
            RowBox[{"IIs", "\[Rule]", 
             RowBox[{"Replace", "[", 
              RowBox[{"IIs", ",", "shuffleRule", ",", 
               RowBox[{"{", "1", "}"}]}], "]"}]}], "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ex", "=", 
         RowBox[{"ex", "/.", 
          RowBox[{"Dispatch", "[", "IIrules", "]"}]}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ex", "=", 
      RowBox[{"ex", "/.", 
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{
          RowBox[{"ls", ":", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", "l", ")"}], ".."}], "}"}]}], ",", "x_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", 
           RowBox[{
            RowBox[{"{", "l", "}"}], ",", "x"}], "]"}], "^", 
          RowBox[{"Length", "[", "ls", "]"}]}], "/", 
         RowBox[{
          RowBox[{"Length", "[", "ls", "]"}], "!"}]}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "ex", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{
  3.724746053766224*^9, {3.7247463456950693`*^9, 3.7247463526649446`*^9}, {
   3.724756687726622*^9, 3.724756752707788*^9}, {3.724804012447773*^9, 
   3.724804018013332*^9}, {3.7248042654073763`*^9, 3.724804267687333*^9}, {
   3.725846536982469*^9, 3.725846718670599*^9}, {3.725846962975016*^9, 
   3.725847112664344*^9}, {3.72584714445648*^9, 3.7258471646561832`*^9}, {
   3.725847194904845*^9, 3.725847224872677*^9}, {3.725847266689496*^9, 
   3.725847353417351*^9}, {3.725847399329611*^9, 3.725847422914193*^9}, {
   3.725847470481999*^9, 3.725847507106511*^9}, {3.7258475487707663`*^9, 
   3.725847559010521*^9}},
 ExpressionUUID -> "65fd601d-2f8e-41fa-abcf-a03d28f50c0c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FactorTrailingLetter", "[", 
   RowBox[{"expr_", ",", "l_", ",", 
    RowBox[{"h_:", "II"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"IIs", ",", 
      RowBox[{"IIrules", "=", 
       RowBox[{"{", "}"}]}], ",", "shuffleRule", ",", 
      RowBox[{"ex", "=", "expr"}], ",", "k", ",", "il", ",", "i"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"shuffleRule", "=", 
      RowBox[{
       RowBox[{"h", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"bs___", ",", 
           RowBox[{"b1", ":", 
            RowBox[{"Except", "[", "l", "]"}]}], ",", 
           RowBox[{"ls", ":", 
            RowBox[{
             RowBox[{"(", "l", ")"}], ".."}]}]}], "}"}], ",", "x_"}], "]"}], 
       "\[RuleDelayed]", 
       RowBox[{"Plus", "@@", 
        RowBox[{"MapIndexed", "[", 
         RowBox[{
          RowBox[{"Function", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"shs", ",", "il"}], "}"}], ",", 
            RowBox[{
             RowBox[{"i", "=", 
              RowBox[{
               RowBox[{"First", "[", "il", "]"}], "-", "1"}]}], ";", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"-", "1"}], ")"}], "^", "i"}], ")"}], "*", 
              RowBox[{"h", "[", 
               RowBox[{
                RowBox[{"Drop", "[", 
                 RowBox[{
                  RowBox[{"{", "ls", "}"}], ",", 
                  RowBox[{"-", "i"}]}], "]"}], ",", "x"}], "]"}], "*", 
              RowBox[{"Plus", "@@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"h", "[", 
                   RowBox[{
                    RowBox[{"Append", "[", 
                    RowBox[{"#", ",", "b1"}], "]"}], ",", "x"}], "]"}], "&"}],
                  "/@", "shs"}], ")"}]}]}]}]}], "]"}], ",", 
          RowBox[{"ShuffleProductNestList", "[", 
           RowBox[{"l", ",", 
            RowBox[{"{", "bs", "}"}], ",", 
            RowBox[{"Length", "@", 
             RowBox[{"{", "ls", "}"}]}]}], "]"}]}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"IIs", "=", 
      RowBox[{"DeleteDuplicates", "[", 
       RowBox[{"Cases", "[", 
        RowBox[{"ex", ",", 
         RowBox[{"h", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"___", ",", 
             RowBox[{"Except", "[", "l", "]"}], ",", 
             RowBox[{
              RowBox[{"(", "l", ")"}], ".."}]}], "}"}], ",", "x_"}], "]"}], 
         ",", "All"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"IIrules", "=", 
      RowBox[{"Thread", "[", 
       RowBox[{"IIs", "\[Rule]", 
        RowBox[{"Replace", "[", 
         RowBox[{"IIs", ",", "shuffleRule", ",", 
          RowBox[{"{", "1", "}"}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ex", "=", 
      RowBox[{
       RowBox[{"ex", "/.", 
        RowBox[{"Dispatch", "[", "IIrules", "]"}]}], "/.", 
       RowBox[{
        RowBox[{"h", "[", 
         RowBox[{
          RowBox[{"ls", ":", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", "l", ")"}], ".."}], "}"}]}], ",", "x_"}], "]"}], 
        "\[RuleDelayed]", 
        RowBox[{
         RowBox[{
          RowBox[{"h", "[", 
           RowBox[{
            RowBox[{"{", "l", "}"}], ",", "x"}], "]"}], "^", 
          RowBox[{"Length", "[", "ls", "]"}]}], "/", 
         RowBox[{
          RowBox[{"Length", "[", "ls", "]"}], "!"}]}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "ex", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.7258538447441177`*^9, 3.725853845552678*^9}, {
   3.725853995225675*^9, 3.725854106834984*^9}, {3.7258542900678673`*^9, 
   3.725854295492062*^9}, {3.725854328419964*^9, 3.725854353132962*^9}, {
   3.72585438770828*^9, 3.7258547303901043`*^9}, {3.725856691036283*^9, 
   3.7258566921884727`*^9}, {3.7258567329321423`*^9, 3.725856734404458*^9}, {
   3.7258588829096413`*^9, 3.725858889052651*^9}, {3.725860462377049*^9, 
   3.725860466609784*^9}, 3.725862422368685*^9, {3.725862457639434*^9, 
   3.725862468775926*^9}, {3.725862522343655*^9, 3.725862523984438*^9}, 
   3.725862561768374*^9, 3.7258628577057323`*^9},
 ExpressionUUID -> "b25d1d14-47c7-4f0e-93eb-84aecaabbc31"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FactorTrailingLetter", "[", 
   RowBox[{"expr_", ",", "l_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "r", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"r", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"II", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"bs___", ",", 
             RowBox[{"b1", ":", 
              RowBox[{"Except", "[", "l", "]"}]}], ",", 
             RowBox[{"ls", ":", 
              RowBox[{
               RowBox[{"(", "l", ")"}], ".."}]}]}], "}"}], ",", "x_"}], "]"}],
          "\[RuleDelayed]", 
         RowBox[{
          RowBox[{
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"bs", ",", "b1"}], "}"}], ",", "x"}], "]"}], 
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", "ls", "}"}], ",", "x"}], "]"}]}], "-", 
          RowBox[{"Plus", "@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"II", "[", 
               RowBox[{"#", ",", "x"}], "]"}], "&"}], "/@", 
             RowBox[{"Rest", "[", 
              RowBox[{"ShuffleProduct", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"bs", ",", "b1"}], "}"}], ",", 
                RowBox[{"{", "ls", "}"}]}], "]"}], "]"}]}], ")"}]}]}]}], ",", 
        RowBox[{
         RowBox[{"II", "[", 
          RowBox[{
           RowBox[{"ls", ":", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"(", "l", ")"}], ".."}], "}"}]}], ",", "x_"}], "]"}], ":>", 
         RowBox[{
          RowBox[{
           RowBox[{"II", "[", 
            RowBox[{
             RowBox[{"{", "l", "}"}], ",", "x"}], "]"}], "^", 
           RowBox[{"Length", "[", "ls", "]"}]}], "/", 
          RowBox[{
           RowBox[{"Length", "[", "ls", "]"}], "!"}]}]}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"expr", "//.", "r"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.724746053766224*^9, 3.724746142030622*^9}, {
  3.724746354977915*^9, 3.724746360164187*^9}, {3.72475676268476*^9, 
  3.7247567629001904`*^9}, {3.725607315390498*^9, 3.725607317453569*^9}},
 ExpressionUUID -> "1a2124a6-c130-4fe7-9615-e800e244c30c"]
}, Closed]],

Cell[CellGroupData[{

Cell["SpotCoefficients", "Subsubsection",
 CellChangeTimes->{{3.7529050785084352`*^9, 3.7529050836539927`*^9}},
 ExpressionUUID -> "f6cd281c-c25f-4435-b4a4-a810ee69d23e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SpotCoefficients", "::", "usage"}], "=", 
   "\"\<SpotCoefficients[Mf,T,\[Epsilon],{x,y(x),o}] tries to find the \
coefficients in the asymptotic expansion of the initial integrals which are \
sufficient for fixing boundary conditions. The output is a list with each \
element being of the form {y(x),i,\[Alpha],k}. It stands for the coefficient \
\!\(\*SuperscriptBox[\(y\), \(\[Alpha]\)]\)\!\(\*SuperscriptBox[\(ln\), \
\(k\)]\)y in i-th integral.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SpotCoefficients", "[", 
    RowBox[{"Mf_", ",", "T_", ",", "\[Epsilon]_", ",", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "y_", ",", "o_"}], "}"}]}], "]"}], "/;", 
   RowBox[{"FreeQ", "[", 
    RowBox[{"y", ",", "x"}], "]"}]}], ":=", 
  RowBox[{"SpotCoefficients", "[", 
   RowBox[{"Mf", ",", "T", ",", "\[Epsilon]", ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "y", ",", "o"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SpotCoefficients", "[", 
   RowBox[{"Mf_", ",", "T_", ",", "\[Epsilon]_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "y_", ",", "o_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "rdata", ",", "TUr", ",", "z", ",", "zrule", ",", "ii", ",", "p", ",", 
      "powers", ",", "tmp", ",", 
      RowBox[{"cs", "=", 
       RowBox[{"ConstantArray", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Length", "@", "Mf"}]}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"zrule", "=", 
      RowBox[{"First", "[", 
       RowBox[{"Solve", "[", 
        RowBox[{
         RowBox[{"z", "\[Equal]", "y"}], ",", "x"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"FCMonitor", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"ii", "=", "#"}], ";", 
            RowBox[{"CWrite", "[", 
             RowBox[{"ToString", "[", "ii", "]"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"rdata", "=", 
             RowBox[{"SeriesSolutionData", "[", 
              RowBox[{
               RowBox[{"Factor", "[", 
                RowBox[{"Mf", "\[LeftDoubleBracket]", 
                 RowBox[{"ii", ",", "ii"}], "\[RightDoubleBracket]"}], "]"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "y"}], "}"}]}], "]"}]}], ";", 
            RowBox[{"TUr", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Plus", "@@", 
                 RowBox[{"Partition", "[", 
                  RowBox[{"#1", ",", 
                   RowBox[{"Length", "[", "ii", "]"}]}], "]"}]}], "&"}], 
               ")"}], "/@", 
              RowBox[{"Map", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Collect", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Expand", "[", 
                    RowBox[{"#1", 
                    RowBox[{"p", "[", 
                    RowBox[{"0", ",", "0"}], "]"}]}], "]"}], "/.", 
                    "\[VeryThinSpace]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Log", "[", "z", "]"}], "\[Rule]", 
                    RowBox[{"p", "[", 
                    RowBox[{"0", ",", "1"}], "]"}]}], ",", 
                    RowBox[{"z", "\[Rule]", 
                    RowBox[{"p", "[", 
                    RowBox[{"1", ",", "0"}], "]"}]}]}], "}"}]}], "//.", 
                    "\[VeryThinSpace]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"p", "[", 
                    RowBox[{"a_", ",", "b_"}], "]"}], "c_"], "\[RuleDelayed]", 
                    RowBox[{"p", "[", 
                    RowBox[{
                    RowBox[{"a", " ", "c"}], ",", 
                    RowBox[{"b", " ", "c"}]}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"p", "[", 
                    RowBox[{"a_", ",", "b_"}], "]"}], " ", 
                    RowBox[{"p", "[", 
                    RowBox[{"c_", ",", "d_"}], "]"}]}], "\[RuleDelayed]", 
                    RowBox[{"p", "[", 
                    RowBox[{
                    RowBox[{"a", "+", "c"}], ",", 
                    RowBox[{"b", "+", "d"}]}], "]"}]}]}], "}"}]}], ",", "_p", 
                   ",", "Factor"}], "]"}], "&"}], ",", 
                RowBox[{"Normal", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"T", "\[LeftDoubleBracket]", 
                    RowBox[{"ii", ",", "ii"}], "\[RightDoubleBracket]"}], "/.",
                     "\[VeryThinSpace]", "zrule"}], ")"}], ".", 
                  RowBox[{"ConstructSeriesSolution", "[", 
                   RowBox[{"rdata", ",", 
                    RowBox[{"{", 
                    RowBox[{"z", ",", "o"}], "}"}], ",", 
                    RowBox[{"Split", "\[Rule]", "True"}], ",", 
                    RowBox[{"O", "\[Rule]", "True"}]}], "]"}]}], "]"}], ",", 
                RowBox[{"{", "2", "}"}]}], "]"}]}]}], ";", 
            RowBox[{"powers", "=", 
             RowBox[{"{", "}"}]}], ";", 
            RowBox[{"tmp", "=", 
             RowBox[{"{", "}"}]}], ";", 
            RowBox[{"MapIndexed", "[", 
             RowBox[{
              RowBox[{"Function", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"row", ",", "i"}], "}"}], ",", 
                RowBox[{"Module", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"ps", "=", 
                    RowBox[{"SortBy", "[", 
                    RowBox[{
                    RowBox[{"Union", "[", 
                    RowBox[{"Cases", "[", 
                    RowBox[{"row", ",", "_p", ",", "All"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"First", "[", 
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], "]"}], "&"}]}], 
                    "]"}]}], "}"}], ",", 
                  RowBox[{"Catch", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"tmp", "=", 
                    RowBox[{"Append", "[", 
                    RowBox[{"tmp", ",", 
                    RowBox[{"Factor", "[", 
                    RowBox[{"Coefficient", "[", 
                    RowBox[{"row", ",", "#1"}], "]"}], "]"}]}], "]"}]}], ";", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MatrixRank", "[", "tmp", "]"}], 
                    "\[GreaterEqual]", 
                    RowBox[{"First", "[", "i", "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"powers", ",", "#1"}], "]"}], ";", 
                    RowBox[{"Throw", "[", "0", "]"}]}]}], "]"}], ";", 
                    RowBox[{"tmp", "=", 
                    RowBox[{"Most", "[", "tmp", "]"}]}]}], ")"}], "&"}], 
                    ")"}], "/@", "ps"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<Could not find suitable coefficients for block \>\"",
                     ",", "ii", ",", "\"\< Aborting...\>\""}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Abort", "[", "]"}]}], "]"}]}], "]"}]}], "]"}], 
              ",", "TUr"}], "]"}], ";", 
            RowBox[{
             RowBox[{"cs", "[", 
              RowBox[{"[", "ii", "]"}], "]"}], "=", 
             RowBox[{"MapIndexed", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"y", ",", 
                  RowBox[{"ii", "\[LeftDoubleBracket]", 
                   RowBox[{"First", "[", "#2", "]"}], 
                   "\[RightDoubleBracket]"}], ",", 
                  RowBox[{"Sequence", "@@", "#1"}]}], "}"}], "&"}], ",", 
               "powers"}], "]"}]}], ";"}], "\[IndentingNewLine]", ")"}], 
          "&"}], ",", 
         RowBox[{"EntangledBlocksIndices", "[", 
          RowBox[{
           RowBox[{"TClosure", "[", "Mf", "]"}], "+", 
           RowBox[{"TClosure", "[", "T", "]"}]}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "ii"}], "]"}], ";", "\[IndentingNewLine]", 
     "cs"}]}], "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.7529017005047092`*^9, 3.752901838931864*^9}, {
  3.752904052296287*^9, 3.75290405342782*^9}, {3.752904083771893*^9, 
  3.752904222732667*^9}, {3.752904265869007*^9, 3.7529042813569*^9}, {
  3.752904320016818*^9, 3.752904339313057*^9}, {3.75290437490942*^9, 
  3.7529045252783213`*^9}, {3.752904583018615*^9, 3.752904585038781*^9}, {
  3.752904641121315*^9, 3.7529046419261217`*^9}, {3.7529047878312607`*^9, 
  3.75290505121732*^9}, {3.759204575662952*^9, 3.7592045932465267`*^9}, {
  3.759204716756056*^9, 3.7592047757960787`*^9}, {3.7686942223347588`*^9, 
  3.768694262662569*^9}},
 ExpressionUUID -> "b090c500-7da4-47ac-9b3d-cd68670df93a"]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Transformations", "Subsection",
 CellChangeTimes->{{3.719625063544799*^9, 3.719625093593342*^9}},
 ExpressionUUID -> "bcc24066-44f7-4c4a-bab6-e25942acfcd8"],

Cell[CellGroupData[{

Cell["ToOneDE", "Subsubsection",
 CellChangeTimes->{3.7385404961085367`*^9},
 ExpressionUUID -> "f1cbe492-aacc-4a91-ae19-6e06d1aecbd1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ToOneDE", "::", "usage"}], "=", 
   "\"\<ToOneDE[M,x,i] constructs one higher-order differential equation for \
the i-th master.\\nIt returns the list of the coefficients \
\!\(\*Cell[TextData[{
Cell[BoxData[
FormBox[
RowBox[{\"{\", 
RowBox[{
SubscriptBox[\"c\", \"0\"], \",\", 
SubscriptBox[\"c\", \"1\"], \",\", \"\[Ellipsis]\", \",\", 
SubscriptBox[\"c\", \"n\"]}]}], TraditionalForm]],
ExpressionUUID -> \"19116a2b-6dd7-44de-aa9a-72f50502127a\"],
\"}\"
}], \"TI\",
ExpressionUUID -> \"b3544048-3b2f-40e6-a167-a0101a37f428\"]\) in front of the \
consecutive orders of derivatives, so that the equation has the form \
\!\(\*Cell[TextData[{
Cell[BoxData[
FormBox[
RowBox[{
RowBox[{
SubscriptBox[\"c\", \"0\"], 
RowBox[{\"f\", \"(\", \"x\", \")\"}]}], \"+\", 
RowBox[{
SubscriptBox[\"c\", \"1\"], 
RowBox[{\"f\", \"'\"}], 
RowBox[{\"(\", \"x\", \")\"}]}], \"+\", \"\[Ellipsis]\", \"+\", 
RowBox[{
SubscriptBox[\"c\", \"n\"], 
RowBox[{
SuperscriptBox[\"f\", 
RowBox[{\"(\", \"n\", \")\"}]], \"(\", \"x\", \")\"}]}]}], TraditionalForm]],
ExpressionUUID -> \"81af33d5-385c-4ffe-a079-44c00e0da0ba\"],
\"=0\"
}], \"TI\",
ExpressionUUID -> \"e07b28dd-50e4-44fc-aab9-c45160961e96\"]\).\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.738391068472645*^9, 3.738391138016904*^9}, {
  3.738391287970427*^9, 3.738391288153911*^9}, {3.738540486293722*^9, 
  3.738540492537221*^9}, {3.738552054171524*^9, 3.7385522463873377`*^9}},
 ExpressionUUID -> "10621891-b957-439e-a511-d664f77c1038"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ToOneDE", "[", 
   RowBox[{"M_", ",", "x_", ",", 
    RowBox[{"i_:", "1"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ders", ",", 
      RowBox[{"Mk", "=", 
       RowBox[{"IdentityMatrix", "[", 
        RowBox[{"Length", "@", "M"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ders", "=", 
      RowBox[{"{", 
       RowBox[{"Mk", "[", 
        RowBox[{"[", "i", "]"}], "]"}], "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"MatrixRank", "[", "ders", "]"}], "\[Equal]", 
        RowBox[{"Length", "@", "ders"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"PrintTemporary", "[", 
         RowBox[{"Length", "@", "ders"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Add", " ", "one", " ", "more", " ", "row"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Mk", "=", 
         RowBox[{"Factor", "[", 
          RowBox[{
           RowBox[{"D", "[", 
            RowBox[{"Mk", ",", "x"}], "]"}], "+", 
           RowBox[{"Mk", ".", "M"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"ders", ",", 
          RowBox[{"Mk", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"First", "[", 
      RowBox[{"OKer", "[", 
       RowBox[{"Transpose", "[", "ders", "]"}], "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.738391043262322*^9, 3.7383910628088217`*^9}, {
   3.738391141753091*^9, 3.738391147257257*^9}, {3.738391278153605*^9, 
   3.7383912846412563`*^9}, {3.738391468634095*^9, 3.73839161853124*^9}, {
   3.7383916544589148`*^9, 3.7383917586034813`*^9}, {3.738391795467762*^9, 
   3.738391878742257*^9}, 3.738540494174862*^9, 3.768975702022872*^9},
 ExpressionUUID -> "2e263533-bace-4c31-bb33-dc71f27389e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ToCompanionDS", "::", "usage"}], "=", 
   "\"\<ToCompanionDS[\!\(\*Cell[TextData[{
Cell[BoxData[
FormBox[
RowBox[{\"{\", 
RowBox[{
SubscriptBox[\"c\", \"0\"], \",\", 
SubscriptBox[\"c\", \"1\"], \",\", \"\[Ellipsis]\", \",\", 
SubscriptBox[\"c\", \"n\"]}]}], TraditionalForm]],
ExpressionUUID -> \"5990d7b9-9975-4d2d-a525-0d341c60fe23\"],
\"}\"
}], \"TI\",
ExpressionUUID -> \"91277436-7b2a-4f40-b983-e32922c6e50d\"]\)] constructs the \
companion matrix \!\(\*Cell[TextData[Cell[BoxData[
FormBox[
SubscriptBox[\"M\", \"c\"], TraditionalForm]], \"TI\",
ExpressionUUID -> \"ccdd6289-1a76-4361-b916-7ad6549b35bc\"]],
ExpressionUUID -> \"b05f4a1b-4f6f-49d4-965e-ac867e4268fa\"]\) out of the \
coefficients of differential equation \!\(\*Cell[TextData[{
Cell[BoxData[
FormBox[
RowBox[{
RowBox[{
SubscriptBox[\"c\", \"0\"], 
RowBox[{\"f\", \"(\", \"x\", \")\"}]}], \"+\", 
RowBox[{
SubscriptBox[\"c\", \"1\"], 
RowBox[{\"f\", \"'\"}], 
RowBox[{\"(\", \"x\", \")\"}]}], \"+\", \"\[Ellipsis]\", \"+\", 
RowBox[{
SubscriptBox[\"c\", \"n\"], 
RowBox[{
SuperscriptBox[\"f\", 
RowBox[{\"(\", \"n\", \")\"}]], \"(\", \"x\", \")\"}]}]}], TraditionalForm]],
ExpressionUUID -> \"fa3fd96f-15b3-4e1b-8679-6606f93051e3\"],
\"=0\"
}], \"TI\",
ExpressionUUID -> \"c48a093e-a247-4078-83ff-1b3dfe8ee10f\"]\). This matrix \
enters the right-hand side of the differential system \
\!\(\*Cell[TextData[Cell[BoxData[
FormBox[
RowBox[{
RowBox[{
SubscriptBox[\"\[PartialD]\", \"x\"], \"F\"}], \"=\", 
RowBox[{
SubscriptBox[\"M\", \"c\"], \"F\"}]}], TraditionalForm]], \"TI\",
ExpressionUUID -> \"d862d4fc-222e-473f-9bb9-92db2b007362\"]],
ExpressionUUID -> \"0c56b08c-14b0-476a-b0fa-9e8f3b831062\"]\), where \
\!\(\*Cell[TextData[Cell[BoxData[
FormBox[
RowBox[{\"F\", \"=\", 
SuperscriptBox[
RowBox[{\"(\", 
RowBox[{\"f\", \",\", 
RowBox[{\"f\", \"'\"}], \",\", \"\[Ellipsis]\", \",\", 
SuperscriptBox[\"f\", 
RowBox[{\"(\", \"n\", \")\"}]]}], \")\"}], \"T\"]}], TraditionalForm]], \"TI\",
ExpressionUUID -> \"cd3ab9e4-1719-4617-809c-6288156633ff\"]],
ExpressionUUID -> \"12af8d16-c5ec-4727-9fc0-eaef098bdc68\"]\).\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.738552042681644*^9, 3.738552044977212*^9}, {
  3.738552255524353*^9, 3.738552439887187*^9}},
 ExpressionUUID -> "ae86470e-0a26-47f3-abbe-ef23496c2544"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ToCompanionDS", "[", "coefs_List", "]"}], ":=", 
  RowBox[{"Append", "[", 
   RowBox[{
    RowBox[{"Rest", "@", 
     RowBox[{"IdentityMatrix", "[", 
      RowBox[{
       RowBox[{"Length", "@", "coefs"}], "-", "1"}], "]"}]}], ",", 
    RowBox[{"Factor", "[", 
     FractionBox[
      RowBox[{"Most", "[", "coefs", "]"}], 
      RowBox[{"-", 
       RowBox[{"Last", "[", "coefs", "]"}]}]], "]"}]}], "]"}]}]], "Code",
 ExpressionUUID -> "005904c6-ae95-445e-9712-aab9547a8dca"]
}, Closed]],

Cell[CellGroupData[{

Cell["Transform", "Subsubsection",
 CellChangeTimes->{{3.719625098265142*^9, 3.7196251000569*^9}, {
  3.7682950851952457`*^9, 3.7682950858890133`*^9}},
 ExpressionUUID -> "78ad2f07-0acd-44b9-ba05-9d436be60ae3"],

Cell[BoxData[
 RowBox[{"done", "[", "\"\<Transform: add support for notations.\>\"", 
  "]"}]], "Code",
 CellChangeTimes->{{3.729610079592616*^9, 3.729610100560244*^9}, {
   3.763212398951377*^9, 3.7632124064120617`*^9}, 3.768636277174142*^9},
 ExpressionUUID -> "2ccc25ad-81f5-4e65-a964-1e88072dc121"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "::", "usage"}], "=", "\"\<Transform[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"t\", \"TI\"]\)] gives the matrix Inverse[\!\(\*
StyleBox[\"t\", \"TI\"]\)].\!\(\*
StyleBox[\"m\", \"TI\"]\).\!\(\*
StyleBox[\"t\", \"TI\"]\).\\nTransform[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"t\", \"TI\",
FontSize->12]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] gives the matrix Inverse[\!\(\*
StyleBox[\"t\", \"TI\"]\)].(\!\(\*
StyleBox[\"m\", \"TI\"]\).\!\(\*
StyleBox[\"t\", \"TI\"]\)-D[\!\(\*
StyleBox[\"t\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)]).\\nTransform[\!\(\*
StyleBox[\"ds\", \"TI\"]\),\!\(\*
StyleBox[\"t\", \"TI\",
FontSize->12]\)] transforms the differential system.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.6241193067348537`*^9, 3.62411947432415*^9}, {
   3.6248634015535283`*^9, 3.6248634028874145`*^9}, 3.719735107645936*^9, {
   3.719735376631898*^9, 3.719735501319456*^9}},
 ExpressionUUID -> "7a02f271-79a4-4547-8602-19deb074ae6a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "Transform", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Simplify", "\[Rule]", "Factor"}], ",", 
     RowBox[{"Print", "\[Rule]", "True"}], ",", 
     RowBox[{"UseFermat", "\[Rule]", "False"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721483414275229*^9, 3.721483467072748*^9}, {
  3.768291961169685*^9, 3.7682919644146147`*^9}, {3.768530765262856*^9, 
  3.768530768935871*^9}, {3.7686073789841957`*^9, 3.768607379867291*^9}},
 ExpressionUUID -> "34e8ec8e-3ef7-4092-96d4-d86ea970fd06"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "::", "notinv"}], "=", 
   "\"\<The two matrices are not reciprocal to each other. Aborting...\>\""}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "::", "range"}], "=", 
   "\"\<Something wrong with application range `1`. Aborting...\>\""}], 
  ";"}]}], "Code",
 CellChangeTimes->{{3.7274828372246923`*^9, 3.727482887145091*^9}, {
  3.727482930962976*^9, 3.727482951696248*^9}, {3.760854713124867*^9, 
  3.760854766317296*^9}, {3.7608549560856647`*^9, 3.760854957621957*^9}},
 ExpressionUUID -> "9476029f-834b-486e-af20-dfd25d746cfd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"t_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ti", "=", 
       RowBox[{"OInverse", "[", 
        RowBox[{"t", ",", 
         RowBox[{"UseFermat", "\[Rule]", 
          RowBox[{"OptionValue", "[", "UseFermat", "]"}]}]}], "]"}]}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"transform", "[", 
      RowBox[{"m", ",", "t", ",", "ti", ",", 
       RowBox[{"OptionValue", "[", "UseFermat", "]"}]}], "]"}]}], " ", 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Transform", "[", 
     RowBox[{
      RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"t_", "?", "SquareMatrixQ"}], ",", 
        RowBox[{"ti_", "?", "SquareMatrixQ"}], ",", 
        RowBox[{"checked", ":", 
         RowBox[{"True", "|", "False"}], ":", "False"}]}], "}"}]}], "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"checked", "||", 
       RowBox[{
        RowBox[{"Factor", "[", 
         RowBox[{"ti", ".", "t"}], "]"}], "===", 
        RowBox[{"IdentityMatrix", "[", 
         RowBox[{"Length", "@", "t"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"transform", "[", 
       RowBox[{"m", ",", "t", ",", "ti", ",", 
        RowBox[{"OptionValue", "[", "UseFermat", "]"}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{"Transform", "::", "notinv"}], "]"}], ";", 
       RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], ";"}], 
  " "}], "\[IndentingNewLine]"}], "Code",
 CellChangeTimes->{{3.6815607314098253`*^9, 3.681560732640131*^9}, 
   3.681560781682559*^9, {3.688219597862361*^9, 3.6882196008450737`*^9}, {
   3.6995735250441837`*^9, 3.699573553060525*^9}, {3.7197351828234453`*^9, 
   3.719735193158778*^9}, {3.719735321016797*^9, 3.719735356752213*^9}, {
   3.719740294405547*^9, 3.719740298285572*^9}, {3.72015607716747*^9, 
   3.720156078643066*^9}, {3.720185674158463*^9, 3.720185686304554*^9}, {
   3.72121798590963*^9, 3.721217993542419*^9}, {3.721256337085271*^9, 
   3.7212563405543213`*^9}, {3.721542970513906*^9, 3.721542973048395*^9}, {
   3.7215430377310343`*^9, 3.721543065279414*^9}, {3.721543136256091*^9, 
   3.721543148834846*^9}, {3.721543223225543*^9, 3.72154322461392*^9}, {
   3.721543316455496*^9, 3.7215433381935453`*^9}, {3.721543452575382*^9, 
   3.721543463970635*^9}, {3.721543526079637*^9, 3.721543542482067*^9}, {
   3.7230497131601963`*^9, 3.723049732046091*^9}, {3.727482508355522*^9, 
   3.727482517814316*^9}, {3.727482681207074*^9, 3.7274828056503696`*^9}, {
   3.7274829720170794`*^9, 3.72748301640913*^9}, {3.727483556424754*^9, 
   3.727483559451227*^9}, {3.7277438313380537`*^9, 3.7277438404664707`*^9}, 
   3.727745196384386*^9, {3.727745490751855*^9, 3.727745494287525*^9}, {
   3.7277457296494226`*^9, 3.727745729650448*^9}, {3.729901370827129*^9, 
   3.729901387602913*^9}, 3.72990142400769*^9, {3.768291990505631*^9, 
   3.768291991586392*^9}, {3.7682925875926037`*^9, 3.768292597213222*^9}, {
   3.7685308827518587`*^9, 3.768530899103649*^9}, {3.768530945091955*^9, 
   3.7685309460755043`*^9}, {3.768530994081884*^9, 3.76853104868191*^9}, 
   3.768531153250414*^9, {3.768952841778038*^9, 3.7689528609558496`*^9}, {
   3.768953635510036*^9, 3.768953637996482*^9}},
 ExpressionUUID -> "1ba703a4-09b2-4743-aebc-7d159d56acc9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"transform", "[", 
    RowBox[{"m_", ",", "t_", ",", "ti_", ",", 
     RowBox[{"fermat", ":", 
      RowBox[{"True", "|", "False"}]}]}], "]"}], ":=", 
   RowBox[{"ODot", "[", 
    RowBox[{"ti", ",", 
     RowBox[{"ODot", "[", 
      RowBox[{"m", ",", "t", ",", 
       RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], ",", 
     RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"transform", "[", 
    RowBox[{"m_", ",", "t_", ",", "ti_", ",", "x_", ",", 
     RowBox[{"fermat", ":", 
      RowBox[{"True", "|", "False"}]}]}], "]"}], ":=", 
   RowBox[{"ODot", "[", 
    RowBox[{"ti", ",", 
     RowBox[{
      RowBox[{"ODot", "[", 
       RowBox[{"m", ",", "t", ",", 
        RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], "-", 
      RowBox[{"D", "[", 
       RowBox[{"t", ",", "x"}], "]"}]}], ",", 
     RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"transform", "[", 
    RowBox[{"m_", ",", "t_", ",", "ti_", ",", "x_", ",", 
     RowBox[{"{", "}"}], ",", 
     RowBox[{"fermat", ":", 
      RowBox[{"True", "|", "False"}]}]}], "]"}], ":=", 
   RowBox[{"ODot", "[", 
    RowBox[{"ti", ",", 
     RowBox[{
      RowBox[{"ODot", "[", 
       RowBox[{"m", ",", "t", ",", 
        RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], "-", 
      RowBox[{"D", "[", 
       RowBox[{"t", ",", "x"}], "]"}]}], ",", 
     RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.727483285780826*^9, 3.727483342925721*^9}, {
   3.727489468102866*^9, 3.727489476870666*^9}, {3.7274895381032333`*^9, 
   3.727489545598748*^9}, {3.727743861602216*^9, 3.727743900338406*^9}, {
   3.7277455038951178`*^9, 3.727745517007182*^9}, {3.727745729663122*^9, 
   3.727745729664741*^9}, 3.7277521069084377`*^9, {3.72989943786833*^9, 
   3.729899442996557*^9}, {3.768530965032703*^9, 3.768530971988811*^9}, {
   3.768531071768663*^9, 3.768531141234572*^9}, {3.768531173450075*^9, 
   3.768531200014388*^9}},
 ExpressionUUID -> "63b4c9b3-fb7f-4db5-8819-8c6943ed5b46"],

Cell[BoxData[
 RowBox[{
  RowBox[{"transform", "[", 
   RowBox[{"m_", ",", "t_", ",", "ti_", ",", "x_", ",", 
    RowBox[{"notas", ":", 
     RowBox[{"{", "__Rule", "}"}]}], ",", 
    RowBox[{"fermat", ":", 
     RowBox[{"True", "|", "False"}]}]}], "]"}], ":=", 
  RowBox[{"Internal`InheritedBlock", "[", 
   RowBox[{
    RowBox[{"{", "D", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"SetOptions", "[", 
      RowBox[{"D", ",", 
       RowBox[{"NonConstants", "\[Rule]", 
        RowBox[{"First", "/@", "notas"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Modified", " ", "18.05", ".2019"}], "*)"}], 
     RowBox[{"Fold", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"OQuolyMod", "[", 
         RowBox[{"#1", ",", "#2", ",", 
          RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], "&"}], ",", 
       RowBox[{"ODot", "[", 
        RowBox[{"ti", ",", 
         RowBox[{
          RowBox[{"ODot", "[", 
           RowBox[{"m", ",", "t", ",", 
            RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], "-", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"D", "[", 
             RowBox[{"t", ",", "x"}], "]"}], "/.", 
            RowBox[{"First", "[", 
             RowBox[{"Solve", "[", 
              RowBox[{
               RowBox[{"0", "==", 
                RowBox[{"D", "[", 
                 RowBox[{
                  RowBox[{"Last", "/@", "notas"}], ",", "x"}], "]"}]}], ",", 
               RowBox[{"D", "[", 
                RowBox[{
                 RowBox[{"First", "/@", "notas"}], ",", "x"}], "]"}]}], "]"}],
              "]"}]}], ")"}]}], ",", 
         RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], ",", "notas"}], 
      "]"}]}]}], 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"/", "Modified"}], " ", "18.05", ".2019"}], "*)"}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.7296472037276154`*^9, 3.7296472508619204`*^9}, 
   3.729648432703629*^9, {3.729648464965218*^9, 3.7296485004282637`*^9}, {
   3.729648539939048*^9, 3.729648578532525*^9}, {3.7298985111622267`*^9, 
   3.729898527005704*^9}, {3.767174166075973*^9, 3.767174232296101*^9}, {
   3.768191921755824*^9, 3.7681919245318823`*^9}, {3.768531212913557*^9, 
   3.7685312786345587`*^9}, 3.770602944403798*^9},
 ExpressionUUID -> "0ded4d9f-1f35-4e36-87ce-e6a47ed6c140"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"t_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x_Symbol", ",", 
        RowBox[{"notas", ":", 
         RowBox[{"_Association", "|", 
          RowBox[{"{", "___Rule", "}"}]}], ":", 
         RowBox[{"{", "}"}]}]}], "}"}], "|", "x_Symbol"}], ",", 
     RowBox[{"i", ":", 
      RowBox[{
       RowBox[{"{", "__Integer", "}"}], "|", 
       RowBox[{"Span", "[", 
        RowBox[{"_", ",", "_"}], "]"}]}], ":", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", "All"}], "]"}]}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"Transform", "[", 
    RowBox[{"m", ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{"OInverse", "[", 
        RowBox[{"t", ",", 
         RowBox[{"UseFermat", "\[Rule]", 
          RowBox[{"OptionValue", "[", "UseFermat", "]"}]}]}], "]"}], ",", 
       "True"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", "notas"}], "}"}], ",", "i", ",", "opts"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"t_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"ti_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"checked", ":", 
        RowBox[{"True", "|", "False"}], ":", "False"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x_Symbol", ",", 
        RowBox[{"notas", ":", 
         RowBox[{"_Association", "|", 
          RowBox[{"{", "___Rule", "}"}]}], ":", 
         RowBox[{"{", "}"}]}]}], "}"}], "|", "x_Symbol"}], ",", 
     RowBox[{"i", ":", 
      RowBox[{
       RowBox[{"{", "__Integer", "}"}], "|", 
       RowBox[{"Span", "[", 
        RowBox[{"_", ",", "_"}], "]"}]}], ":", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", "All"}], "]"}]}], ",", 
     RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "mt", "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"checked", "||", 
        RowBox[{
         RowBox[{"ODot", "[", 
          RowBox[{"ti", ",", "t"}], "]"}], "===", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"Length", "@", "t"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"mt", "=", 
         RowBox[{"transformrange", "[", 
          RowBox[{"m", ",", "t", ",", "ti", ",", "x", ",", "i", ",", 
           RowBox[{"notas", "/.", 
            RowBox[{"Association", "\[Rule]", "List"}]}], ",", 
           RowBox[{"OptionValue", "[", "UseFermat", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "mt"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"Transform", "::", "notinv"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.720185570275117*^9, 3.720185580608985*^9}, {
   3.7201856474956417`*^9, 3.720185655554455*^9}, {3.720185707573469*^9, 
   3.720186044726626*^9}, 3.720186114098737*^9, {3.7212179946329317`*^9, 
   3.72121799862738*^9}, 3.721256344617486*^9, {3.721483535827744*^9, 
   3.721483554941432*^9}, {3.721542536863422*^9, 3.7215425417583723`*^9}, 
   3.721542957775893*^9, 3.721543469672751*^9, {3.721543505271758*^9, 
   3.7215435194237223`*^9}, {3.722042010051371*^9, 3.7220420450511227`*^9}, {
   3.723049761675005*^9, 3.723049766127157*^9}, {3.7259379796316853`*^9, 
   3.7259381364845047`*^9}, {3.7259401318031397`*^9, 3.725940138002383*^9}, 
   3.727482520567123*^9, {3.727483607682187*^9, 3.727483666440276*^9}, {
   3.72748938931022*^9, 3.727489438894822*^9}, {3.727743904155264*^9, 
   3.727743906843631*^9}, 3.727745196461967*^9, 3.7277455209545317`*^9, 
   3.727745729670854*^9, 3.729899510209668*^9, {3.729899546956443*^9, 
   3.729899586228848*^9}, {3.729899648100359*^9, 3.729899697396891*^9}, {
   3.729899781644507*^9, 3.7298997861747513`*^9}, {3.7298998587591963`*^9, 
   3.7298999393531437`*^9}, {3.7299002885966473`*^9, 3.729900411843472*^9}, 
   3.729900458007622*^9, {3.729901481692092*^9, 3.729901527406477*^9}, {
   3.7299034118901978`*^9, 3.72990341413694*^9}, {3.729904738724121*^9, 
   3.729904740580928*^9}, 3.729908329840301*^9, {3.729952709855714*^9, 
   3.729952718967689*^9}, {3.767174036697493*^9, 3.767174056596779*^9}, {
   3.76819195707402*^9, 3.768191958361331*^9}, {3.7682920399561033`*^9, 
   3.768292082147512*^9}, 3.768292571140671*^9, {3.768292608068913*^9, 
   3.7682926082213*^9}, {3.7682936932252827`*^9, 3.7682938208451567`*^9}, {
   3.768531314186675*^9, 3.7685313372755938`*^9}, 3.76853142496395*^9, {
   3.7685314653784*^9, 3.7685314720746717`*^9}, {3.768607597127486*^9, 
   3.768607597272777*^9}, {3.768953811123444*^9, 3.7689538157921457`*^9}},
 ExpressionUUID -> "6d581fb3-8458-4a66-9f04-ceceb14e3462"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"t_", "?", "SquareMatrixQ"}], ",", "x_Symbol", ",", 
     RowBox[{"i", ":", 
      RowBox[{
       RowBox[{"{", "__Integer", "}"}], "|", 
       RowBox[{"Span", "[", 
        RowBox[{"_", ",", "_"}], "]"}]}], ":", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", "All"}], "]"}]}], ",", 
     RowBox[{"notas", ":", 
      RowBox[{"_Association", "|", 
       RowBox[{"{", "___Rule", "}"}]}], ":", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Transform", "[", 
    RowBox[{"m", ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", 
       RowBox[{"OInverse", "@", "t"}], ",", "True"}], "}"}], ",", "x", ",", 
     "i", ",", "notas"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Transform", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"t_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"ti_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"checked", ":", 
        RowBox[{"True", "|", "False"}], ":", "False"}]}], "}"}], ",", 
     "x_Symbol", ",", 
     RowBox[{"i", ":", 
      RowBox[{
       RowBox[{"{", "__Integer", "}"}], "|", 
       RowBox[{"Span", "[", 
        RowBox[{"_", ",", "_"}], "]"}]}], ":", 
      RowBox[{"Span", "[", 
       RowBox[{"1", ",", "All"}], "]"}]}], ",", 
     RowBox[{"notas", ":", 
      RowBox[{"_Association", "|", 
       RowBox[{"{", "___Rule", "}"}]}], ":", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "mt", "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"checked", "||", 
        RowBox[{
         RowBox[{"ODot", "[", 
          RowBox[{"ti", ",", "t"}], "]"}], "===", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"Length", "@", "t"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"mt", "=", 
         RowBox[{"transformrange", "[", 
          RowBox[{"m", ",", "t", ",", "ti", ",", "x", ",", "i", ",", 
           RowBox[{"notas", "/.", 
            RowBox[{"Association", "\[Rule]", "List"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "mt"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"Transform", "::", "notinv"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellOpen->False,
 CellChangeTimes->{{3.720185570275117*^9, 3.720185580608985*^9}, {
   3.7201856474956417`*^9, 3.720185655554455*^9}, {3.720185707573469*^9, 
   3.720186044726626*^9}, 3.720186114098737*^9, {3.7212179946329317`*^9, 
   3.72121799862738*^9}, 3.721256344617486*^9, {3.721483535827744*^9, 
   3.721483554941432*^9}, {3.721542536863422*^9, 3.7215425417583723`*^9}, 
   3.721542957775893*^9, 3.721543469672751*^9, {3.721543505271758*^9, 
   3.7215435194237223`*^9}, {3.722042010051371*^9, 3.7220420450511227`*^9}, {
   3.723049761675005*^9, 3.723049766127157*^9}, {3.7259379796316853`*^9, 
   3.7259381364845047`*^9}, {3.7259401318031397`*^9, 3.725940138002383*^9}, 
   3.727482520567123*^9, {3.727483607682187*^9, 3.727483666440276*^9}, {
   3.72748938931022*^9, 3.727489438894822*^9}, {3.727743904155264*^9, 
   3.727743906843631*^9}, 3.727745196461967*^9, 3.7277455209545317`*^9, 
   3.727745729670854*^9, 3.729899510209668*^9, {3.729899546956443*^9, 
   3.729899586228848*^9}, {3.729899648100359*^9, 3.729899697396891*^9}, {
   3.729899781644507*^9, 3.7298997861747513`*^9}, {3.7298998587591963`*^9, 
   3.7298999393531437`*^9}, {3.7299002885966473`*^9, 3.729900411843472*^9}, 
   3.729900458007622*^9, {3.729901481692092*^9, 3.729901527406477*^9}, {
   3.7299034118901978`*^9, 3.72990341413694*^9}, {3.729904738724121*^9, 
   3.729904740580928*^9}, 3.729908329840301*^9, {3.729952709855714*^9, 
   3.729952718967689*^9}, {3.767174036697493*^9, 3.767174056596779*^9}, {
   3.76819195707402*^9, 3.768191958361331*^9}, {3.7682920399561033`*^9, 
   3.768292082147512*^9}, 3.768292571140671*^9, {3.768292608068913*^9, 
   3.7682926082213*^9}, {3.7682936932252827`*^9, 3.768293743396531*^9}},
 ExpressionUUID -> "3dfa832e-96bb-454a-af30-9a532ac257a9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"transformrange", "[", 
    RowBox[{"m_", ",", "t_", ",", "ti_", ",", "x_", ",", 
     RowBox[{"Span", "[", 
      RowBox[{"1", ",", "All"}], "]"}], ",", 
     RowBox[{"notas", ":", 
      RowBox[{"{", "___Rule", "}"}], ":", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"fermat", ":", 
      RowBox[{"True", "|", "False"}]}]}], "]"}], ":=", 
   RowBox[{"transform", "[", 
    RowBox[{"m", ",", "t", ",", "ti", ",", "x", ",", "notas", ",", "fermat"}],
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"transformrange", "[", 
    RowBox[{"m_", ",", "t_", ",", "ti_", ",", "x_", ",", "i_", ",", 
     RowBox[{"notas", ":", 
      RowBox[{"{", "___Rule", "}"}], ":", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"fermat", ":", 
      RowBox[{"True", "|", "False"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"mt", "=", "m"}], ",", "jj", ",", "ii", ",", 
       RowBox[{"l", "=", 
        RowBox[{"Length", "@", "m"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ii", "=", 
       RowBox[{"Replace", "[", 
        RowBox[{"i", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Span", "[", 
             RowBox[{"a_Integer", ",", "b_Integer"}], "]"}], "\[RuleDelayed]", 
            RowBox[{"Range", "[", 
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"a", "+", "l", "+", "1"}], ",", 
                RowBox[{"l", "+", "1"}]}], "]"}], ",", 
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"b", "+", "l", "+", "1"}], ",", 
                RowBox[{"l", "+", "1"}]}], "]"}]}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"Span", "[", 
             RowBox[{"a_Integer", ",", "All"}], "]"}], "\[RuleDelayed]", 
            RowBox[{"Range", "[", 
             RowBox[{
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"a", "+", "l", "+", "1"}], ",", 
                RowBox[{"l", "+", "1"}]}], "]"}], ",", 
              RowBox[{"Length", "@", "m"}]}], "]"}]}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Not", "[", 
         RowBox[{"MatchQ", "[", 
          RowBox[{"ii", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"_Integer", "?", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"1", "\[LessEqual]", "#", "\[LessEqual]", " ", "l"}],
                  "&"}], ")"}]}], ")"}], ".."}], "}"}]}], "]"}], "]"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"Transform", "::", "range"}], ",", "i"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"DeleteDuplicates", "[", "ii", "]"}], "=!=", "ii"}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"Transform", "::", "range"}], ",", "i"}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"mt", "[", 
        RowBox[{"[", 
         RowBox[{"ii", ",", "ii"}], "]"}], "]"}], "=", 
       RowBox[{"transform", "[", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", 
           RowBox[{"ii", ",", "ii"}], "]"}], "]"}], ",", "t", ",", "ti", ",", 
         "x", ",", "notas", ",", "fermat"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"jj", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"DependentColumnIndices", "[", 
          RowBox[{"m", ",", "ii"}], "]"}], ",", "ii"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"jj", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{
         RowBox[{"mt", "[", 
          RowBox[{"[", 
           RowBox[{"jj", ",", "ii"}], "]"}], "]"}], "=", 
         RowBox[{"(*", 
          RowBox[{"Modified", " ", "18.05", ".2019"}], "*)"}], 
         RowBox[{"Fold", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"OQuolyMod", "[", 
             RowBox[{"#", ",", "#2", ",", 
              RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], "&"}], ",", 
           RowBox[{"ODot", "[", 
            RowBox[{
             RowBox[{"mt", "[", 
              RowBox[{"[", 
               RowBox[{"jj", ",", "ii"}], "]"}], "]"}], ",", "t", ",", 
             RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], ",", 
           RowBox[{"notas", "/.", 
            RowBox[{"Association", "\[Rule]", "List"}]}]}], "]"}]}]}], 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"/", "Modified"}], " ", "18.05", ".2019"}], "*)"}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"jj", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"DependentRowIndices", "[", 
          RowBox[{"m", ",", "ii"}], "]"}], ",", "ii"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"jj", "=!=", 
         RowBox[{"{", "}"}]}], ",", 
        RowBox[{
         RowBox[{"mt", "[", 
          RowBox[{"[", 
           RowBox[{"ii", ",", "jj"}], "]"}], "]"}], "=", 
         RowBox[{"(*", 
          RowBox[{"Modified", " ", "18.05", ".2019"}], "*)"}], 
         RowBox[{"Fold", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"OQuolyMod", "[", 
             RowBox[{"#", ",", "#2", ",", 
              RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], "&"}], ",", 
           RowBox[{"ODot", "[", 
            RowBox[{"ti", ",", 
             RowBox[{"mt", "[", 
              RowBox[{"[", 
               RowBox[{"ii", ",", "jj"}], "]"}], "]"}], ",", 
             RowBox[{"UseFermat", "\[Rule]", "fermat"}]}], "]"}], ",", 
           RowBox[{"notas", "/.", 
            RowBox[{"Association", "\[Rule]", "List"}]}]}], "]"}]}]}], 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"/", "Modified"}], " ", "18.05", ".2019"}], "*)"}], "]"}], 
      ";", "\[IndentingNewLine]", "mt"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Code",
 CellChangeTimes->{{3.7274831492592688`*^9, 3.727483203251974*^9}, {
   3.7274833997203074`*^9, 3.727483431465288*^9}, {3.727489709452325*^9, 
   3.7274897323885937`*^9}, {3.7274897702847967`*^9, 3.727489821123577*^9}, {
   3.7274898663325653`*^9, 3.7274898716570044`*^9}, {3.727743911507495*^9, 
   3.7277439212628803`*^9}, {3.727745524911996*^9, 3.727745528296423*^9}, {
   3.727745729677381*^9, 3.727745729678755*^9}, {3.729899322477857*^9, 
   3.729899352605899*^9}, {3.729899403254695*^9, 3.7298994129448767`*^9}, {
   3.729899452205448*^9, 3.729899459693076*^9}, {3.729899964835696*^9, 
   3.7299000243802958`*^9}, {3.729952860945557*^9, 3.729952866998486*^9}, {
   3.760854578909975*^9, 3.760854697846629*^9}, {3.760854796111038*^9, 
   3.7608548483028383`*^9}, {3.7608548845825577`*^9, 3.760854978258304*^9}, 
   3.76085512724856*^9, {3.767174074084276*^9, 3.767174130469364*^9}, {
   3.768191968634903*^9, 3.768191970089967*^9}, {3.768531500393693*^9, 
   3.7685316123584833`*^9}, {3.769730655037237*^9, 3.769730681488405*^9}, {
   3.770602779546451*^9, 3.7706027838104973`*^9}, {3.7706029465559473`*^9, 
   3.770602949803998*^9}},
 ExpressionUUID -> "ced14036-78d3-43c3-98d9-1bd717941288"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Transform", "[", 
   RowBox[{"as_Association", ",", "t_", ",", 
    RowBox[{"notas", ":", 
     RowBox[{"{", "___Rule", "}"}], ":", 
     RowBox[{"{", "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", "=", "as"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m", "[", "#", "]"}], "=", 
         RowBox[{"Transform", "[", 
          RowBox[{
           RowBox[{"m", "[", "#", "]"}], ",", "t", ",", "#", ",", "notas"}], 
          "]"}]}], ")"}], "&"}], "/@", 
      RowBox[{"Keys", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", "m"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.720185181379047*^9, 3.7201851975812817`*^9}, {
  3.720185235826391*^9, 3.72018525470667*^9}, {3.721543479975932*^9, 
  3.721543502118628*^9}, {3.7274836963001842`*^9, 3.727483696475609*^9}, {
  3.729900791379915*^9, 3.729900798649096*^9}},
 ExpressionUUID -> "e209fe53-fd21-45bb-8aa2-c2bec034a495"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Transform", "[", 
   RowBox[{"as_Association", ",", "t_", ",", 
    RowBox[{"ii", ":", 
     RowBox[{
      RowBox[{"{", "__Integer", "}"}], "|", 
      RowBox[{"Span", "[", 
       RowBox[{"_", ",", "_"}], "]"}]}], ":", 
     RowBox[{"Span", "[", 
      RowBox[{"1", ",", "All"}], "]"}]}], ",", 
    RowBox[{"notas", ":", 
     RowBox[{"_Association", "|", 
      RowBox[{"{", "___Rule", "}"}]}], ":", 
     RowBox[{"{", "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", "=", "as"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m", "[", "#", "]"}], "=", 
         RowBox[{"Transform", "[", 
          RowBox[{
           RowBox[{"m", "[", "#", "]"}], ",", "t", ",", "#", ",", "ii", ",", 
           "notas"}], "]"}]}], ")"}], "&"}], "/@", 
      RowBox[{"Keys", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", "m"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.7220422326030407`*^9, 3.722042243427289*^9}, 
   3.725940152574031*^9, {3.7274837003559113`*^9, 3.727483700499601*^9}, {
   3.7299007436971283`*^9, 3.72990076783606*^9}, 3.729900999686191*^9, {
   3.729901789215261*^9, 3.729901791531357*^9}, {3.768292105778257*^9, 
   3.768292111829175*^9}, {3.768292929830484*^9, 3.768292929997411*^9}},
 ExpressionUUID -> "c99ae614-7117-40cd-9ab5-75931c249429"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Transform", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "t_", ",", 
    RowBox[{"i", ":", 
     RowBox[{
      RowBox[{"{", "__Integer", "}"}], "|", 
      RowBox[{"Span", "[", 
       RowBox[{"_", ",", "_"}], "]"}]}], ":", 
     RowBox[{"Span", "[", 
      RowBox[{"1", ",", "All"}], "]"}]}], ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", "=", 
      RowBox[{"ds", "[", 
       RowBox[{"[", "]"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"m", "[", "#", "]"}], "=", 
         RowBox[{"Transform", "[", 
          RowBox[{
           RowBox[{"m", "[", "#", "]"}], ",", "t", ",", 
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{"Notations", "[", "ds", "]"}]}], "}"}], ",", "i", ",", 
           "opts"}], "]"}]}], ")"}], "&"}], "/@", 
      RowBox[{"Keys", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"HistoryAppend", "[", 
      RowBox[{"ds", ",", 
       RowBox[{"{", 
        RowBox[{"m", ",", 
         RowBox[{"{", 
          RowBox[{"Transform", ",", "ds", ",", "t", ",", "i"}], "}"}]}], 
        "}"}], ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{"{", "opts", "}"}], ",", 
          RowBox[{"Options", "[", "HistoryAppend", "]"}]}], "]"}]}]}], "]"}], 
     ";", "\[IndentingNewLine]", "m"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.727484732114389*^9, 3.727484745203307*^9}, {
   3.727751275039946*^9, 3.72775128754872*^9}, {3.72775169479503*^9, 
   3.727751715869869*^9}, {3.727751805374586*^9, 3.727751812157061*^9}, {
   3.729900844630809*^9, 3.729900854709077*^9}, {3.729900895025897*^9, 
   3.729900900077594*^9}, {3.729901125522835*^9, 3.729901137386559*^9}, {
   3.729903151301281*^9, 3.7299031514528437`*^9}, {3.7682921168021793`*^9, 
   3.768292146464827*^9}, {3.768292751492901*^9, 3.768292758782714*^9}, {
   3.768293881010866*^9, 3.7682938969063168`*^9}, {3.7682939692491913`*^9, 
   3.7682939698415737`*^9}, {3.768294027169923*^9, 3.768294031198032*^9}, {
   3.7682940722738457`*^9, 3.768294102450184*^9}, {3.768294218378636*^9, 
   3.768294257290666*^9}, {3.7682942929003363`*^9, 3.76829429856353*^9}, {
   3.768294339375537*^9, 3.768294355802414*^9}, {3.768531788772217*^9, 
   3.768531801500579*^9}, 3.7686076641293077`*^9, 3.768636454050798*^9, 
   3.7686365587673073`*^9},
 ExpressionUUID -> "5115fdcc-d4f1-423c-869b-8131eb313d33"],

Cell["apply transformation to indices ii", "Text",
 CellChangeTimes->{{3.720184670359459*^9, 3.7201846837399178`*^9}},
 ExpressionUUID -> "97e23aa9-e0eb-4593-91cb-1d29f8135d0c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["ChangeVar", "Subsubsection",
 CellChangeTimes->{
  3.720049040796907*^9, {3.720049528522545*^9, 3.7200495292422533`*^9}},
 ExpressionUUID -> "7ec60834-54d5-4819-8356-fdf8214ebee0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ChangeVar", "::", "usage"}], "=", 
   "\"\<ChangeVar[ds,{rules},{vars}] changes variable in the matrix.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7200490307179737`*^9, 3.720049057101372*^9}, {
   3.7201500171871643`*^9, 3.720150052250917*^9}, 3.721394862529975*^9},
 ExpressionUUID -> "7ee0b4e4-3f03-4de2-aadd-f8873dff2b64"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ChangeVar", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"x_", "\[Rule]", "xviay_"}], ",", "y_Symbol"}], "]"}], ":=", 
  RowBox[{"Factor", "[", 
   RowBox[{
    RowBox[{"m", " ", 
     RowBox[{"D", "[", 
      RowBox[{"xviay", ",", "y"}], "]"}]}], "/.", 
    RowBox[{"x", "\[Rule]", "xviay"}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.720049266414578*^9, 3.720049335912871*^9}, {
  3.729608840748461*^9, 3.72960884245623*^9}},
 ExpressionUUID -> "6e5b2619-a331-4caa-97f4-f6a86c0d20de"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ChangeVar", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"rs1", ":", 
     RowBox[{"_Rule", "|", 
      RowBox[{"{", "__Rule", "}"}]}]}], ",", 
    RowBox[{"ys1", ":", 
     RowBox[{"_Symbol", "|", "_List"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"keys", "=", 
       RowBox[{"Keys", "[", 
        RowBox[{"ds", "[", 
         RowBox[{"[", "]"}], "]"}], "]"}]}], ",", "M", ",", 
      RowBox[{"rs", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "rs1", "}"}], "]"}]}], ",", 
      RowBox[{"ys", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "ys1", "}"}], "]"}]}], ",", 
      RowBox[{"nkeys", "=", 
       RowBox[{"Keys", "[", 
        RowBox[{"Notations", "[", "ds", "]"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"M", "=", 
      RowBox[{"Association", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{"y", ",", 
           RowBox[{"y", "\[Rule]", 
            RowBox[{"Plus", "@@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"D", "[", 
                    RowBox[{
                    RowBox[{"#1", "/.", "rs"}], ",", "y"}], "]"}], 
                   RowBox[{"ds", "[", "#1", "]"}]}], "/.", "rs"}], ")"}], 
                "&"}], "/@", "keys"}], ")"}]}]}]}], "]"}], "/@", "ys"}], 
        ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Unprotect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Notations", "[", "ds", "]"}], "^=", 
      RowBox[{"Numerator", "@", 
       RowBox[{"Together", "[", 
        RowBox[{
         RowBox[{"Notations", "[", "ds", "]"}], "/.", "rs"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"HistoryAppend", "[", 
      RowBox[{"ds", ",", 
       RowBox[{"{", 
        RowBox[{"M", ",", 
         RowBox[{"{", 
          RowBox[{"ChangeVar", ",", "ds", ",", "rs", ",", "ys"}], "}"}]}], 
        "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Protect", "/@", "ys"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ds", "[", 
      RowBox[{"[", "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.720049172509068*^9, 3.720049177085397*^9}, {
   3.72004935972816*^9, 3.720049403617365*^9}, {3.7200494376584473`*^9, 
   3.720049518529355*^9}, {3.7200496809709253`*^9, 3.720049704625965*^9}, {
   3.720141149019167*^9, 3.720141183071988*^9}, 3.721354418144759*^9, {
   3.721725732454885*^9, 3.721725732725091*^9}, {3.723161710214497*^9, 
   3.723161715284008*^9}, 3.725942463462899*^9, {3.729608651374601*^9, 
   3.729608691933526*^9}, {3.7296087235643873`*^9, 3.729608789427883*^9}, {
   3.729608821317189*^9, 3.729608860879232*^9}, {3.7296096681447372`*^9, 
   3.7296096787233257`*^9}, {3.729609737611946*^9, 3.72960974808175*^9}, {
   3.729609855261262*^9, 3.72960987593762*^9}},
 ExpressionUUID -> "d684ccb5-6210-4f69-a32f-dee1e3956de0"]
}, Closed]],

Cell[CellGroupData[{

Cell["AddNotation", "Subsubsection",
 CellChangeTimes->{
  3.720049040796907*^9, {3.720049528522545*^9, 3.7200495292422533`*^9}, {
   3.7296086146270123`*^9, 3.729608618676738*^9}},
 ExpressionUUID -> "aaf6a9e1-f194-4e26-b796-0865a3010c78"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AddNotation", "::", "usage"}], "=", 
   "\"\<AddNotation[ds,y\[Rule]p(x,y)] adds notation y connected with x via \
p(x,y)=0.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7200490307179737`*^9, 3.720049057101372*^9}, {
   3.7201500171871643`*^9, 3.720150052250917*^9}, 3.721394862529975*^9, {
   3.729608624030764*^9, 3.729608631524749*^9}, {3.729608930463243*^9, 
   3.729608993296427*^9}, {3.768783451704928*^9, 3.7687834526345863`*^9}},
 ExpressionUUID -> "750fe808-522c-4bf1-8767-045895df53b4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"AddNotation", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"y_Symbol", "\[Rule]", "p_"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"keys", "=", 
       RowBox[{"Keys", "[", 
        RowBox[{"ds", "[", "]"}], "]"}]}], ",", "M", ",", 
      RowBox[{"nots", "=", 
       RowBox[{"Notations", "[", "ds", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"FreeQ", "[", 
        RowBox[{"p", ",", "y"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"AddNotation", "::", "wrng"}], "]"}], ";", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nots", "[", "y", "]"}], "=", "p"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Unprotect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Notations", "[", "ds", "]"}], "^=", "nots"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", "ds", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"HistoryAppend", "[", 
      RowBox[{"ds", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ds", "[", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"AddNotation", ",", "ds", ",", 
           RowBox[{"y", "\[Rule]", "p"}]}], "}"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Protect", "[", "y", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ds", "[", 
      RowBox[{"[", "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.720049172509068*^9, 3.720049177085397*^9}, {
   3.72004935972816*^9, 3.720049403617365*^9}, {3.7200494376584473`*^9, 
   3.720049518529355*^9}, {3.7200496809709253`*^9, 3.720049704625965*^9}, {
   3.720141149019167*^9, 3.720141183071988*^9}, 3.721354418144759*^9, {
   3.721725732454885*^9, 3.721725732725091*^9}, {3.723161710214497*^9, 
   3.723161715284008*^9}, 3.725942463462899*^9, {3.729608871677154*^9, 
   3.729608914060672*^9}, {3.72960900805652*^9, 3.729609026392744*^9}, {
   3.729609057855996*^9, 3.72960910301609*^9}, 3.729609236029509*^9, {
   3.729609314174059*^9, 3.729609447903831*^9}, {3.7296095001678143`*^9, 
   3.729609516158209*^9}, {3.7296095603551683`*^9, 3.729609579609556*^9}, {
   3.735277553542101*^9, 3.735277554510034*^9}},
 ExpressionUUID -> "b44c968a-a529-4e0d-b482-79014f6770a1"]
}, Closed]],

Cell[CellGroupData[{

Cell["ModNotation (inactive)", "Subsubsection",
 CellChangeTimes->{{3.768190551508635*^9, 3.7681905569809628`*^9}, {
  3.770602833982008*^9, 3.770602836998622*^9}},
 ExpressionUUID -> "cef78bc3-5c3a-4350-bf1c-6861233b3fc4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ModNotation", "::", "usage"}], "=", "\"\<ModNotation[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\"\[Rule]\", \"TI\"]\)\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)] is a shortcut for OQuolyMod[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"y\", \"TI\"]\)]. Should be good for reducing dependence on \
notations.\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.768190592151075*^9, 3.768190710934609*^9}, {
  3.768191991571904*^9, 3.768191995059677*^9}, {3.768783455549397*^9, 
  3.768783484182335*^9}},
 ExpressionUUID -> "c2486fca-4857-4432-b91c-f0ee626cebba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "ModNotation", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{"UseFermat", "\[Rule]", "False"}], "}"}]}]], "Input",
 CellChangeTimes->{{3.768531829377158*^9, 3.768531850889076*^9}, {
  3.768607679723817*^9, 3.768607680636736*^9}},
 ExpressionUUID -> "da7435b5-17b2-44aa-a867-d0bfcb493b45"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ModNotation", "[", 
   RowBox[{"quoly_", ",", 
    RowBox[{"rule", ":", 
     RowBox[{"_Rule", "|", "_RuleDelayed"}]}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"OQuolyMod", "[", 
   RowBox[{"quoly", ",", 
    RowBox[{"rule", "[", 
     RowBox[{"[", "2", "]"}], "]"}], ",", 
    RowBox[{"rule", "[", 
     RowBox[{"[", "1", "]"}], "]"}], ",", 
    RowBox[{"UseFermat", "\[Rule]", 
     RowBox[{"OptionValue", "[", "UseFermat", "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.768190559246714*^9, 3.76819057689723*^9}, {
  3.7685318657799273`*^9, 3.768531886828559*^9}},
 ExpressionUUID -> "0925a7bf-4259-4ac3-b1b8-3c56c0ca3df5"],

Cell[BoxData[
 RowBox[{"todo", "[", 
  "\"\<Think of removing _RuleDelayed in \
ModNotation[quoly_,rule:_Rule|_RuleDelayed]\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.768190875342882*^9, 3.768190902014682*^9}, {
  3.7685319014363937`*^9, 3.7685319060421867`*^9}},
 ExpressionUUID -> "d45cc5f9-9b9d-4e6e-a984-eec001af539b"]
}, Closed]],

Cell[CellGroupData[{

Cell["RuleToNotation,NotationToRule", "Subsubsection",
 CellChangeTimes->{{3.768190807256503*^9, 3.7681908197582817`*^9}},
 ExpressionUUID -> "eb9dfba6-9841-4941-9d76-284404002044"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RuleToNotation", "::", "usage"}], "=", "\"\<RuleToNotation[\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"\[Rule]\", \"TI\"]\)\!\(\*
StyleBox[\"q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"y\", \"TI\"]\)] gives a rule \!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\"\[Rule]\", \"TI\"]\)\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\), where \!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is the numerator of \!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"-\", \"TI\"]\)\!\(\*
StyleBox[\"q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.768191182852125*^9, 3.768191252033004*^9}, {
  3.768191310705426*^9, 3.7681913497770653`*^9}, {3.768783489829586*^9, 
  3.7687834904217243`*^9}, {3.768783538023971*^9, 3.768783538913864*^9}},
 ExpressionUUID -> "a559cf2b-59e4-4e3a-aa33-71691dc555d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RuleToNotation", "::", "error"}], "=", 
   "\"\<The function `1` is not rational.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7681915818499527`*^9, 3.7681915837776823`*^9}},
 ExpressionUUID -> "d1dae259-01b7-4db4-8d94-9df8b07ff8b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"RuleToNotation", "[", 
   RowBox[{
    RowBox[{"x_", "\[Rule]", "q_"}], ",", "y_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "p", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"RatFuncQ", "[", 
       RowBox[{"q", ",", "y"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{"Numerator", "@", 
         RowBox[{"Together", "[", 
          RowBox[{"q", "-", "x"}], "]"}]}]}], ";", 
       RowBox[{"Return", "[", 
        RowBox[{"y", "\[Rule]", "p"}], "]"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"RuleToNotation", "::", "error"}], ",", "q"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "$Failed", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.768190823741796*^9, 3.768190869742766*^9}, {
  3.768190906399082*^9, 3.768190951879669*^9}, {3.7681909951433687`*^9, 
  3.768191170776629*^9}, {3.768191592138588*^9, 3.768191592269994*^9}},
 ExpressionUUID -> "2816b727-0c24-4c51-b13b-50abe075a661"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"NotationToRule", "::", "usage"}], "=", "\"\<NotationToRule[\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\"\[Rule]\", \"TI\"]\)\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\),\!\(\*
StyleBox[\"y\", \"TI\"]\)] gives a rule \!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"\[Rule]\", \"TI\"]\)\!\(\*
StyleBox[\"q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\), where \!\(\*
StyleBox[\"q\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\) is the solution of \!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\"(\", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"y\", \"TI\"]\)\!\(\*
StyleBox[\")\", \"TI\"]\)\!\(\*
StyleBox[\"=\", \"TI\"]\)\!\(\*
StyleBox[\"0\", \"TI\"]\) wrt \!\(\*
StyleBox[\"x\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.768191182852125*^9, 3.768191252033004*^9}, {
  3.768191310705426*^9, 3.768191441290522*^9}, {3.76878349137395*^9, 
  3.768783493741747*^9}, {3.7687835401960363`*^9, 3.76878354075858*^9}},
 ExpressionUUID -> "71978e19-dcaa-4dec-b571-e1c94af67f88"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"NotationToRule", "::", "error"}], "=", 
   "\"\<The equation `1`=0 is not sutable for introducing notation.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7681916015700407`*^9, 3.7681916554606457`*^9}},
 ExpressionUUID -> "53ba80a1-0a6d-4f5b-a774-9227657b5c74"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NotationToRule", "[", 
   RowBox[{
    RowBox[{"y_", "\[Rule]", "p_"}], ",", "x_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "rule", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"PolyQ", "[", 
        RowBox[{"p", ",", 
         RowBox[{"x", "|", "y"}]}], "]"}], "&&", 
       RowBox[{
        RowBox[{"Exponent", "[", 
         RowBox[{"p", ",", "x"}], "]"}], "\[Equal]", "1"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", "rule", "}"}], "}"}], "=", 
        RowBox[{"Solve", "[", 
         RowBox[{
          RowBox[{"p", "\[Equal]", "0"}], ",", "x"}], "]"}]}], ";", 
       RowBox[{"Return", "[", "rule", "]"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Message", "[", 
        RowBox[{
         RowBox[{"NotationToRule", "::", "error"}], ",", "p"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "$Failed", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.768190823741796*^9, 3.768190869742766*^9}, {
  3.768190906399082*^9, 3.768190951879669*^9}, {3.7681909951433687`*^9, 
  3.768191170776629*^9}, {3.768191448748252*^9, 3.768191558716763*^9}, {
  3.7681916581626463`*^9, 3.768191660979056*^9}, {3.768192530574505*^9, 
  3.768192547445035*^9}},
 ExpressionUUID -> "2d904226-0ada-4995-86f5-e8a53b5e5458"]
}, Closed]],

Cell[CellGroupData[{

Cell["A0ToSubspaces (inactive)", "Subsubsection",
 CellChangeTimes->{{3.721360998471558*^9, 3.721360999389097*^9}, {
   3.721361076360333*^9, 3.721361081804851*^9}, 3.7213615766059017`*^9, {
   3.770955143951289*^9, 3.7709551492689877`*^9}, 3.770961713011056*^9},
 ExpressionUUID -> "85de6eb5-30cb-4c3f-ac11-3cc332c5483d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0ToSubspaces", "::", "usage"}], "=", 
   "\"\<A0ToSubspaces[A0,\[Epsilon]\[Rule]0,Left|Right] gives the subspaces \
which may be used for the construction of the projectors for the balances \
with positive gains.\\nWhen called with option All\[Rule]True, it returns all \
subspaces.\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.721361000170269*^9, 3.721361007685678*^9}, {
   3.721361064718129*^9, 3.721361069149362*^9}, {3.721361140008924*^9, 
   3.721361144206258*^9}, {3.721361554105781*^9, 3.721361556999352*^9}, {
   3.721362373317321*^9, 3.7213623848003883`*^9}, {3.721370151103218*^9, 
   3.721370155319121*^9}, 3.722554987608057*^9, {3.722555154203495*^9, 
   3.722555154339348*^9}, {3.726438749452681*^9, 3.726438788612933*^9}},
 ExpressionUUID -> "a3c33c70-4373-4f44-8974-fe499ebd4b4b"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "A0ToSubspaces", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"All", "\[Rule]", "False"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.726438711397604*^9, 3.726438740860799*^9}, {
  3.7264393124823837`*^9, 3.726439360138434*^9}, {3.7709534091756697`*^9, 
  3.7709534154244947`*^9}, {3.770953471195436*^9, 3.770953471323628*^9}},
 ExpressionUUID -> "487445c7-6b4a-4eb8-85ac-80b60f69c920"],

Cell[BoxData[
 RowBox[{
  RowBox[{"A0ToSubspaces", "[", 
   RowBox[{
    RowBox[{"A0_", "?", "SquareMatrixQ"}], ",", "rules_", ",", 
    RowBox[{"side", ":", 
     RowBox[{"(", 
      RowBox[{"Left", "|", "Right"}], ")"}], ":", "Left"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"l", "=", 
       RowBox[{"Length", "@", "A0"}]}], ",", "jdata", ",", 
      RowBox[{"sel", "=", "Select"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"jdata", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Factor", "[", "#1", "]"}], "/.", "rules"}], ",", "##2"}], 
         "}"}], "&"}], "@@@", 
       RowBox[{"JDData", "@", "A0"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Pick", " ", "suitable", " ", "evs"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"TrueQ", "[", 
        RowBox[{"OptionValue", "[", "All", "]"}], "]"}], ",", 
       RowBox[{"sel", "=", 
        RowBox[{"#", "&"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"side", "===", "Right"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"sel", "[", 
           RowBox[{"jdata", ",", 
            RowBox[{
             RowBox[{"TrueQ", "[", 
              RowBox[{"Positive", "[", 
               RowBox[{"First", "@", "#"}], "]"}], "]"}], "&"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"First", "[", "#", "]"}]}], "&"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"sel", "[", 
           RowBox[{"jdata", ",", 
            RowBox[{
             RowBox[{"TrueQ", "[", 
              RowBox[{"Negative", "[", 
               RowBox[{"First", "@", "#"}], "]"}], "]"}], "&"}]}], "]"}], ",",
           "First"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.721363166786539*^9, 3.7213631736998463`*^9}, {
   3.72136445479079*^9, 3.7213646630148077`*^9}, {3.721364730438281*^9, 
   3.721364757494755*^9}, {3.721364789202026*^9, 3.721364865999148*^9}, {
   3.721364922785144*^9, 3.721364965203183*^9}, 3.72136501902316*^9, {
   3.721370217416032*^9, 3.7213702828663054`*^9}, {3.721682792197624*^9, 
   3.721682801272009*^9}, 3.7216828931554947`*^9, {3.7264388435743847`*^9, 
   3.726438850315735*^9}, 3.726438977873981*^9, 3.726439028110475*^9, {
   3.726439277586336*^9, 3.7264392937621117`*^9}, {3.726439401818733*^9, 
   3.726439409370728*^9}, {3.726439507152362*^9, 3.726439584320519*^9}, 
   3.768878068806253*^9},
 ExpressionUUID -> "6f42738a-028e-4452-8d29-33c7413c9717"],

Cell[BoxData[
 RowBox[{
  RowBox[{"todo", "[", "\"\<Eliminate JDData from A0ToSubspaces.\>\"", "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.76887843435855*^9, 3.7688784521746473`*^9}},
 ExpressionUUID -> "47ff94b3-c9df-46b4-a4bb-2494adda4742"]
}, Closed]],

Cell[CellGroupData[{

Cell["A0ToSubspacesMod (inactive)", "Subsubsection",
 CellChangeTimes->{{3.721360998471558*^9, 3.721360999389097*^9}, {
   3.721361076360333*^9, 3.721361081804851*^9}, 3.7213615766059017`*^9, {
   3.768804491622817*^9, 3.7688044932690897`*^9}, 3.768804567733807*^9, {
   3.770945902712405*^9, 3.770945911334558*^9}, 3.770961820031267*^9},
 ExpressionUUID -> "d882d679-ac27-4b64-848b-12a72ea65f1a"],

Cell[BoxData[
 RowBox[{"todo", "[", "\"\<Write PolyA0ToSubspaces.\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.7688045741981487`*^9, 3.768804582493841*^9}},
 ExpressionUUID -> "fe406007-e5e7-419b-8994-ea8ae466e386"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0ToSubspacesMod", "::", "usage"}], "=", 
   "\"\<A0ToSubspacesMod[A0,\[Epsilon]\[Rule]0,Left|Right] gives the \
subspaces which may be used for the construction of the projectors for the \
balances with positive gains.\\nWhen called with option All\[Rule]True, it \
returns all subspaces.\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.721361000170269*^9, 3.721361007685678*^9}, {
   3.721361064718129*^9, 3.721361069149362*^9}, {3.721361140008924*^9, 
   3.721361144206258*^9}, {3.721361554105781*^9, 3.721361556999352*^9}, {
   3.721362373317321*^9, 3.7213623848003883`*^9}, {3.721370151103218*^9, 
   3.721370155319121*^9}, 3.722554987608057*^9, {3.722555154203495*^9, 
   3.722555154339348*^9}, {3.726438749452681*^9, 3.726438788612933*^9}, {
   3.768804432910141*^9, 3.7688044334865503`*^9}, {3.7688045077667913`*^9, 
   3.7688045083029547`*^9}, {3.770945917071446*^9, 3.7709459182343273`*^9}},
 ExpressionUUID -> "4ba16135-914f-4cd9-b95f-e7f7cb2d65c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "A0ToSubspacesMod", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"All", "\[Rule]", "False"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.726438711397604*^9, 3.726438740860799*^9}, {
   3.7264393124823837`*^9, 3.726439360138434*^9}, 3.768804439382601*^9, 
   3.7709459216591787`*^9},
 ExpressionUUID -> "6646a8c8-cbf4-4964-bb32-aea13344b821"],

Cell[BoxData[
 RowBox[{
  RowBox[{"A0ToSubspacesMod", "[", 
   RowBox[{
    RowBox[{"A0_", "?", "SquareMatrixQ"}], ",", "rules_", ",", 
    RowBox[{"side", ":", 
     RowBox[{"(", 
      RowBox[{"Left", "|", "Right"}], ")"}], ":", "Left"}], ",", 
    RowBox[{"x_", "\[Rule]", "poly_"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"l", "=", 
       RowBox[{"Length", "@", "A0"}]}], ",", "jdata", ",", 
      RowBox[{"sel", "=", "Select"}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"jdata", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Factor", "[", "#1", "]"}], "/.", "rules"}], ",", "##2"}], 
         "}"}], "&"}], "@@@", 
       RowBox[{"JDDataMod", "[", 
        RowBox[{"A0", ",", 
         RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Pick", " ", "suitable", " ", "evs"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"TrueQ", "[", 
        RowBox[{"OptionValue", "[", "All", "]"}], "]"}], ",", 
       RowBox[{"sel", "=", 
        RowBox[{"#", "&"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"side", "===", "Right"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"sel", "[", 
           RowBox[{"jdata", ",", 
            RowBox[{
             RowBox[{"TrueQ", "[", 
              RowBox[{"Positive", "[", 
               RowBox[{"First", "@", "#"}], "]"}], "]"}], "&"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"First", "[", "#", "]"}]}], "&"}]}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"sel", "[", 
           RowBox[{"jdata", ",", 
            RowBox[{
             RowBox[{"TrueQ", "[", 
              RowBox[{"Negative", "[", 
               RowBox[{"First", "@", "#"}], "]"}], "]"}], "&"}]}], "]"}], ",",
           "First"}], "]"}], "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.721363166786539*^9, 3.7213631736998463`*^9}, {
   3.72136445479079*^9, 3.7213646630148077`*^9}, {3.721364730438281*^9, 
   3.721364757494755*^9}, {3.721364789202026*^9, 3.721364865999148*^9}, {
   3.721364922785144*^9, 3.721364965203183*^9}, 3.72136501902316*^9, {
   3.721370217416032*^9, 3.7213702828663054`*^9}, {3.721682792197624*^9, 
   3.721682801272009*^9}, 3.7216828931554947`*^9, {3.7264388435743847`*^9, 
   3.726438850315735*^9}, 3.726438977873981*^9, 3.726439028110475*^9, {
   3.726439277586336*^9, 3.7264392937621117`*^9}, {3.726439401818733*^9, 
   3.726439409370728*^9}, {3.726439507152362*^9, 3.726439584320519*^9}, 
   3.7688044431917133`*^9, 3.768878111051722*^9, 3.770945922746773*^9, {
   3.770945966426161*^9, 3.770945966911004*^9}, {3.770946040899333*^9, 
   3.7709460570429373`*^9}},
 ExpressionUUID -> "922758c9-3bf0-4987-aa96-9b18cec531de"]
}, Closed]],

Cell[CellGroupData[{

Cell["A0A1ToSubspaces", "Subsubsection",
 CellChangeTimes->{{3.721360998471558*^9, 3.721360999389097*^9}, {
  3.721361076360333*^9, 3.721361081804851*^9}},
 ExpressionUUID -> "1cb647f9-3835-42cf-80ef-ca355ff0a602"],

Cell[TextData[{
 "Let us consider Laurent expansion of the matrix ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    RowBox[{"M", "(", "x", ")"}], "TI"], TraditionalForm]],
  ExpressionUUID -> "2e105514-2d74-440a-b746-c3a2ba694f6e"],
 " in the vicinity of singular point ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["x", "0"], TraditionalForm]],
  ExpressionUUID -> "f120e8f5-9ef7-484b-9dec-e737d1aab40c"],
 " (for simplicity we assume that ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["x", "0"], "=", "0"}], TraditionalForm]], "TI",
  ExpressionUUID -> "aa6eee60-3716-42af-8211-af542b3783d3"],
 "):"
}], "Text",
 CellChangeTimes->{{3.689317466485443*^9, 3.68931757667124*^9}},
 ExpressionUUID -> "0b80a052-82f0-40a8-b392-88ec1ee87659"],

Cell[BoxData[
 FormBox[
  RowBox[{
   RowBox[{"M", "(", "x", ")"}], "=", 
   RowBox[{
    RowBox[{
     FractionBox[
      StyleBox[
       SubscriptBox["A", "0"],
       FontColor->RGBColor[0, 0, 1]], 
      SuperscriptBox["x", 
       RowBox[{"p", "+", "1"}]]], "+", 
     FractionBox[
      StyleBox[
       SubscriptBox["A", "1"],
       FontColor->RGBColor[0., 0.6666666666666666, 1.]], 
      SuperscriptBox["x", "p"]], "+", 
     RowBox[{"\[Ellipsis]", "   ", "with", " ", "p"}]}], ">", "0"}]}], 
  TraditionalForm]], "TI",
 CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
   3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
   3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
   3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
   3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
   3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
   3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
   3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
   3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
   3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
   3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
   3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
   3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
   3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
   3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
   3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
   3.689318439104671*^9}, 3.689320101557584*^9, 3.770953137795877*^9},
 TextAlignment->Center,
 ExpressionUUID -> "66203394-dd3e-439d-a28a-e3cb3e4e43af"],

Cell[TextData[{
 "A simple necessary criterion of possibility to lower the Poincare rank",
 Cell[BoxData[
  FormBox[
   SuperscriptBox["", 
    StyleBox["*",
     FontColor->RGBColor[1, 0, 0]]], TraditionalForm]],
  FontSize->24,
  ExpressionUUID -> "668f6253-fcd6-40af-b51d-f96c4b639aea"],
 " ",
 Cell[BoxData[
  FormBox["p", TraditionalForm]], "TI",
  ExpressionUUID -> "8798adf9-2eb4-4d28-9d14-b056ca7fe4bc"],
 " is the requirement that ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["A", "0"],
    FontColor->RGBColor[0, 0, 1]], TraditionalForm]], "TI",
  ExpressionUUID -> "05a358aa-1398-4e0d-85fe-1e86f5888d81"],
 " is nilpotent.\nJ. Moser in his 1960 paper gave a more subtle necessary \
criterion:"
}], "Text",
 CellChangeTimes->{{3.6893188947553873`*^9, 3.689318963938943*^9}, {
   3.689319015651376*^9, 3.689319026483388*^9}, {3.6893191315989227`*^9, 
   3.689319147185334*^9}, {3.6893193165877047`*^9, 3.689319326474041*^9}, 
   3.689405925419014*^9},
 ExpressionUUID -> "19bbbe10-551f-4a43-89ab-7e11f9550831"],

Cell[BoxData[
 FormBox[
  RowBox[{
   RowBox[{
    UnderscriptBox["lim", 
     RowBox[{"x", "\[Rule]", "0"}]], 
    RowBox[{
     SuperscriptBox["x", "r"], 
     RowBox[{"det", "[", 
      RowBox[{
       FractionBox[
        StyleBox[
         SubscriptBox["A", "0"],
         FontColor->RGBColor[0, 0, 1]], "x"], "+", 
       StyleBox[
        SubscriptBox["A", "1"],
        FontColor->RGBColor[0., 0.6666666666666666, 1.]], "-", 
       "\[DoubleStruckCapitalI]\[Lambda]"}], "]"}]}]}], "=", "0"}], 
  TraditionalForm]], "DisplayFormula",
 CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
   3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
   3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
   3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
   3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
   3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
   3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
   3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
   3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
   3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
   3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
   3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
   3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
   3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
   3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
   3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
   3.689318439104671*^9}, {3.689318572100049*^9, 3.689318696203093*^9}, {
   3.689318836608609*^9, 3.6893188372646017`*^9}, 3.689319534194511*^9, 
   3.689319648067197*^9, 3.721370593351315*^9},
 TextAlignment->Center,
 ExpressionUUID -> "8b89a0e4-baa2-4ec2-8431-ab8541c0e63c"],

Cell[TextData[{
 "for any ",
 Cell[BoxData[
  FormBox["\[Lambda]", TraditionalForm]], "TI",
  ExpressionUUID -> "f1760ea5-ba77-4a76-ae66-714a1685dbd3"],
 ". Here ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"r", "=", "rank"}], "\[InvisibleComma]", 
    StyleBox[
     SubscriptBox["A", "0"],
     FontColor->RGBColor[0, 0, 1]]}], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, {3.689318572100049*^9, 3.689318696203093*^9}, {
    3.689318836608609*^9, 3.6893188372646017`*^9}},
  TextAlignment->Center,
  ExpressionUUID -> "9a757139-0569-4b8b-b99f-8201107294eb"],
 " is the matrix rank of the matrix ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["A", "0"],
    FontColor->RGBColor[0, 0, 1]], TraditionalForm]], "TI",
  ExpressionUUID -> "6c8e6d7d-3113-4d91-9988-268db33def9a"],
 "."
}], "Text",
 CellChangeTimes->{{3.689319161908135*^9, 3.689319216187067*^9}, {
   3.6893192818460093`*^9, 3.689319353195269*^9}, {3.689319537289925*^9, 
   3.6893195527705183`*^9}, 3.689405928515492*^9},
 ExpressionUUID -> "ceecf7db-a28d-45e2-9783-2367f343ecc2"],

Cell["It can be reformulated as the requirement", "Text",
 CellChangeTimes->{{3.689318668813882*^9, 3.689318675929102*^9}, 
   3.689318928784409*^9, {3.689319390400855*^9, 3.689319464345278*^9}},
 ExpressionUUID -> "deab72ee-85cf-4929-8ab0-5ff7c66373c6"],

Cell[BoxData[
 FormBox[
  RowBox[{
   RowBox[{
    RowBox[{"dim", "\[ThinSpace]", 
     RowBox[{"ker", "(", "\[NoBreak]", GridBox[{
        {
         StyleBox[
          SubscriptBox["A", "0"],
          FontColor->RGBColor[0, 0, 1]], 
         RowBox[{
          StyleBox[
           SubscriptBox["A", "1"],
           FontColor->RGBColor[0., 0.6666666666666666, 1.]], "-", 
          "\[DoubleStruckCapitalI]\[Lambda]"}]},
        {"0", 
         StyleBox[
          SubscriptBox["A", "0"],
          FontColor->RGBColor[0, 0, 1]]}
       }], "\[NoBreak]", ")"}]}], 
    StyleBox[">",
     FontColor->RGBColor[1, 0.5, 0]], 
    RowBox[{"dim", "\[ThinSpace]", "ker", " ", 
     StyleBox[
      SubscriptBox["A", "0"],
      FontColor->RGBColor[0, 0, 1]]}]}], "=", 
   RowBox[{"n", "-", 
    RowBox[{"r", "."}]}]}], TraditionalForm]], "DisplayFormula",
 CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
   3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
   3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
   3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
   3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
   3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
   3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
   3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
   3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
   3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
   3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
   3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
   3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
   3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
   3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
   3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
   3.689318439104671*^9}, {3.689318572100049*^9, 3.689318696203093*^9}, {
   3.689318836608609*^9, 3.6893188372646017`*^9}, {3.689319474977869*^9, 
   3.689319516195022*^9}, {3.6893195737226*^9, 3.689319589033684*^9}, 
   3.689319663626377*^9, {3.689340080360899*^9, 3.689340095448152*^9}, 
   3.721370595078619*^9},
 TextAlignment->Center,
 ExpressionUUID -> "d4202662-fe77-4c22-a4e6-0b070e5258ea"],

Cell[TextData[{
 " Here ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"r", "=", "rank"}], "\[InvisibleComma]", 
    StyleBox[
     SubscriptBox["A", "0"],
     FontColor->RGBColor[0, 0, 1]]}], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, {3.689318572100049*^9, 3.689318696203093*^9}, {
    3.689318836608609*^9, 3.6893188372646017`*^9}},
  TextAlignment->Center,
  ExpressionUUID -> "994105c8-95b4-4bd1-bc98-7701f32c73b0"],
 " and ",
 Cell[BoxData[
  FormBox["n", TraditionalForm]], "TI",
  ExpressionUUID -> "41a2a1ab-2fbe-4006-ba4e-6194c537caed"],
 " is the size of ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["A", "0"],
    FontColor->RGBColor[0, 0, 1]], TraditionalForm]], "TI",
  ExpressionUUID -> "342d6a40-e2bc-4543-9d3b-bbaeaf3e3a37"],
 ". In simple words, ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        StyleBox[
         SubscriptBox["A", "0"],
         FontColor->RGBColor[0, 0, 1]], 
        RowBox[{
         StyleBox[
          SubscriptBox["A", "1"],
          FontColor->RGBColor[0., 0.6666666666666666, 1.]], "-", 
         "\[DoubleStruckCapitalI]\[Lambda]"}]},
       {"0", 
        StyleBox[
         SubscriptBox["A", "0"],
         FontColor->RGBColor[0, 0, 1]]}
      }], "\[NoBreak]", ")"}],
    FontSize->18], TraditionalForm]], "TI",
  ExpressionUUID -> "86290d8f-a073-4c6a-aaee-72c0aa116218"],
 " should have more null vectors than ",
 Cell[BoxData[
  FormBox[
   StyleBox[
    SubscriptBox["A", "0"],
    FontColor->RGBColor[0, 0, 1]], TraditionalForm]],
  ExpressionUUID -> "8ed531ad-1b4d-4c44-935a-88697b44e50e"],
 "."
}], "Text",
 CellChangeTimes->{{3.721370596375841*^9, 3.721370596376281*^9}},
 ExpressionUUID -> "574809c6-3ea0-438a-99e0-a23c47d7ca76"],

Cell[TextData[{
 "Once the criterion is fulfilled, we may easily prove that there exists ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    StyleBox["\[ScriptCapitalU]",
     FontColor->RGBColor[1, 0, 0]], "\[Subset]", 
    SuperscriptBox["\[DoubleStruckCapitalC]", "n"]}], TraditionalForm]], 
  "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, 3.689320101557584*^9, {3.689341411061653*^9, 
    3.689341527749502*^9}, {3.689341622045527*^9, 3.6893416322695227`*^9}, {
    3.689341738909597*^9, 3.6893418854620132`*^9}, {3.689342621393784*^9, 
    3.689342630801785*^9}, {3.6894049688619013`*^9, 3.689404969901799*^9}},
  TextAlignment->Center,
  ExpressionUUID -> "bbc55e66-6b08-4a20-abdb-beb92a3ae220"],
 " such that"
}], "Text",
 CellChangeTimes->{{3.689405340839839*^9, 3.689405435433226*^9}, {
  3.689405479352332*^9, 3.689405500306015*^9}, {3.689405952267582*^9, 
  3.68940596499582*^9}, {3.689759092676614*^9, 3.689759095804098*^9}, {
  3.72136111219069*^9, 3.721361116518539*^9}},
 ExpressionUUID -> "2aee6bea-c48b-4d2d-97dd-e4dec71719b4"],

Cell[TextData[Cell[BoxData[
 FormBox[GridBox[{
    {
     RowBox[{GridBox[{
        {
         RowBox[{
          RowBox[{"1.", "\[AlignmentMarker] ", 
           StyleBox["\[ScriptCapitalU]",
            FontColor->RGBColor[1, 0, 0]]}], "\[Subset]", 
          RowBox[{"ker", " ", 
           FormBox[
            StyleBox[
             SubscriptBox["A", "0"],
             FontColor->RGBColor[0, 0, 1]],
            TraditionalForm]}]}]},
        {
         RowBox[{
          RowBox[{"2.", "\[AlignmentMarker] ", 
           StyleBox[
            SubscriptBox["A", "1"],
            FontColor->RGBColor[0., 0.6666666666666666, 1.]], 
           StyleBox["\[ScriptCapitalU]",
            FontColor->RGBColor[1, 0, 0]]}], "\[Subset]", 
          RowBox[{
           RowBox[{"im", " ", 
            FormBox[
             StyleBox[
              RowBox[{
               SubscriptBox["A", "0"], "\[ImplicitPlus]"}],
              FontColor->RGBColor[0, 0, 1]],
             TraditionalForm]}], "+", " ", 
           StyleBox["\[ScriptCapitalU]",
            FontColor->RGBColor[1, 0, 0]]}]}]}
       },
       GridBoxAlignment->{"Columns" -> {{"\[AlignmentMarker]"}}}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"3.", "im", " ", 
         FormBox[
          StyleBox[
           RowBox[{
            SubscriptBox["A", "0"], "\[ImplicitPlus]"}],
           FontColor->RGBColor[0, 0, 1]],
          TraditionalForm]}], "\[Intersection]", 
        StyleBox["\[ScriptCapitalU]",
         FontColor->RGBColor[1, 0, 0]]}], ">", "\[EmptySet]"}]}]}
   },
   GridBoxItemSize->{"Columns" -> {{
        Scaled[0.96]}}}], TraditionalForm]],
 ExpressionUUID -> "0244cd8a-d9e9-4a92-91e3-f63db722bdc5"]], "Text",
 CellChangeTimes->{{3.689405713312866*^9, 3.689405841569871*^9}, {
  3.689405872098209*^9, 3.6894059032194443`*^9}, {3.6894059414697857`*^9, 
  3.689405941470138*^9}, {3.689406137563404*^9, 3.689406137563795*^9}, {
  3.689759100894661*^9, 3.689759103957357*^9}, {3.719755583012623*^9, 
  3.7197555830126667`*^9}, {3.721361122929981*^9, 3.721361130935796*^9}},
 ExpressionUUID -> "d34e7c22-41dc-48ca-8d76-32676bd629da"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0A1ToSubspaces", "::", "usage"}], "=", 
   "\"\<A0A1ToSubspaces[{A0,A1},Left|Right] gives the subspaces which may be \
used for the construction of the projectors for the balances.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.721361000170269*^9, 3.721361007685678*^9}, {
   3.721361064718129*^9, 3.721361069149362*^9}, {3.721361140008924*^9, 
   3.721361144206258*^9}, {3.721361554105781*^9, 3.721361556999352*^9}, {
   3.7214487967141933`*^9, 3.721448798170446*^9}, 3.722554989886345*^9, {
   3.722555180676075*^9, 3.72255518080054*^9}, {3.72742846609496*^9, 
   3.727428466404374*^9}},
 ExpressionUUID -> "364dc059-7691-4d70-991a-fb455ac3b805"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0A1ToSubspaces", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"A0_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"A1_", "?", "SquareMatrixQ"}]}], "}"}], ",", 
     RowBox[{"side", ":", 
      RowBox[{"(", 
       RowBox[{"Left", "|", "Right"}], ")"}], ":", "Left"}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "@", "A0"}], "==", 
    RowBox[{"Length", "@", "A1"}]}]}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"l", "=", 
       RowBox[{"Length", "[", "A1", "]"}]}], ",", "\[Lambda]", ",", "ns", ",",
       "A"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "=", 
      RowBox[{"ArrayFlatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"A0", ",", 
           RowBox[{"A1", "-", 
            RowBox[{"\[Lambda]", "*", 
             RowBox[{"IdentityMatrix", "[", "l", "]"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "A0"}], "}"}]}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"side", "===", "Left"}], ",", 
       RowBox[{"A", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{"#", ",", 
            RowBox[{"-", "l"}]}], "]"}], "&"}], "/@", 
         RowBox[{"OKer", "[", "A", "]"}]}]}], ",", 
       RowBox[{"A", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{"#", ",", "l"}], "]"}], "&"}], "/@", 
         RowBox[{"OKer", "[", 
          RowBox[{"Transpose", "@", "A"}], "]"}]}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Get", " ", "rid", " ", "of", " ", "denominators"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ns", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Collect", "[", 
         RowBox[{
          RowBox[{"Cancel", "[", 
           RowBox[{
            RowBox[{"PolynomialLCM", "@@", 
             RowBox[{"Denominator", "[", "#", "]"}]}], "*", "#"}], "]"}], ",",
           "\[Lambda]", ",", "Factor"}], "]"}], "&"}], "/@", 
       RowBox[{"Factor", "@", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"A", ",", 
          RowBox[{"{", 
           RowBox[{"0", ".."}], "}"}]}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ns", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"DeleteCases", "[", 
            RowBox[{
             RowBox[{"RowReduce", "[", 
              RowBox[{
               RowBox[{"FixedPointList", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"D", "[", 
                   RowBox[{"#", ",", "\[Lambda]"}], "]"}], "&"}], ",", "#"}], 
                "]"}], "/.", 
               RowBox[{"\[Lambda]", "\[Rule]", "0"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ".."}], "}"}]}], "]"}], "&"}], "/@", "ns"}], "]"}],
         ",", "Length"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"side", "===", "Left"}], ",", 
        RowBox[{"Transpose", "/@", "ns"}], ",", "ns"}], "]"}], "*)"}], 
     "ns"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.7213608610715647`*^9, 3.721360875431026*^9}, 
   3.721360911905794*^9, 3.7213610919371033`*^9, 3.72136407946924*^9, {
   3.7214487906428757`*^9, 3.72144879341887*^9}, {3.721448828450253*^9, 
   3.72144883407584*^9}, {3.7216829347352667`*^9, 3.72168293719143*^9}, {
   3.727421720397737*^9, 3.727421725076838*^9}, {3.7274235024842997`*^9, 
   3.727423506575769*^9}, {3.7274245787435503`*^9, 3.727424616062718*^9}, {
   3.72742483008917*^9, 3.7274248312729177`*^9}, {3.735003393510914*^9, 
   3.735003397925869*^9}, {3.768743322943626*^9, 3.768743356671131*^9}, {
   3.768999618060032*^9, 3.7689996454722157`*^9}, {3.769029215665612*^9, 
   3.769029220025209*^9}, {3.769032129662356*^9, 3.769032132669198*^9}, {
   3.770955349846286*^9, 3.770955415212205*^9}},
 ExpressionUUID -> "1fc2f61f-d42a-474d-9cd6-1fa1edfcf18b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"A0A1ToSubspaces", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A0_", ",", "A1_"}], "}"}], ",", "Left"}], "]"}], ":=", 
  RowBox[{"A0A1ToSubspaces", "[", 
   RowBox[{"{", 
    RowBox[{"A0", ",", "A1"}], "}"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"A0A1ToSubspaces", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A0_", ",", "A1_"}], "}"}], ",", "Right"}], "]"}], ":=", 
  RowBox[{"A0A1ToSubspaces", "[", 
   RowBox[{"-", 
    RowBox[{"Transpose", "/@", 
     RowBox[{"{", 
      RowBox[{"A0", ",", "A1"}], "}"}]}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.770955567869486*^9, 3.7709556044517603`*^9}, {
   3.7709557294747963`*^9, 3.770955736169858*^9}, 3.770957464642973*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0A1ToSubspaces", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"A0_", "?", "SquareMatrixQ"}], ",", 
      RowBox[{"A1_", "?", "SquareMatrixQ"}]}], "}"}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "@", "A0"}], "==", 
    RowBox[{"Length", "@", "A1"}]}]}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"l", "=", 
       RowBox[{"Length", "[", "A1", "]"}]}], ",", "\[Lambda]", ",", "ns", ",",
       "A"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "=", 
      RowBox[{"ArrayFlatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"A0", ",", 
           RowBox[{"A1", "-", 
            RowBox[{"\[Lambda]", "*", 
             RowBox[{"IdentityMatrix", "[", "l", "]"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "A0"}], "}"}]}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"A", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Take", "[", 
         RowBox[{"#", ",", 
          RowBox[{"-", "l"}]}], "]"}], "&"}], "/@", 
       RowBox[{"OKer", "[", "A", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Get", " ", "rid", " ", "of", " ", "denominators"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ns", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Collect", "[", 
         RowBox[{
          RowBox[{"Cancel", "[", 
           RowBox[{
            RowBox[{"PolynomialLCM", "@@", 
             RowBox[{"Denominator", "[", "#", "]"}]}], "*", "#"}], "]"}], ",",
           "\[Lambda]", ",", "Factor"}], "]"}], "&"}], "/@", 
       RowBox[{"Factor", "@", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"A", ",", 
          RowBox[{"{", 
           RowBox[{"0", ".."}], "}"}]}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ns", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{"PickBasis", "[", 
               RowBox[{
                RowBox[{"FixedPointList", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"D", "[", 
                    RowBox[{"#", ",", "\[Lambda]"}], "]"}], "&"}], ",", "#"}],
                  "]"}], "/.", 
                RowBox[{"\[Lambda]", "\[Rule]", "0"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ".."}], "}"}]}], "]"}], "&"}], "/@", "ns"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"SameQ", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}], "||", 
             RowBox[{
              RowBox[{"Length", "[", "#1", "]"}], "==", 
              RowBox[{"Length", "[", "#2", "]"}], "==", 
              RowBox[{"MatrixRank", "[", 
               RowBox[{"Join", "[", 
                RowBox[{"#1", ",", "#2"}], "]"}], "]"}]}]}], ")"}], "&"}]}], 
         "]"}], ",", "Length"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "ns"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.770955499845418*^9, 3.7709555031338463`*^9}, {
   3.770955536662147*^9, 3.770955544884513*^9}, {3.770955925318756*^9, 
   3.7709559383393917`*^9}, {3.770955976406705*^9, 3.770956016406357*^9}, {
   3.770956191421628*^9, 3.7709561995016613`*^9}, {3.770956326478307*^9, 
   3.7709563998209963`*^9}, 3.7709564583923903`*^9, {3.7709564980007*^9, 
   3.7709566093542337`*^9}, {3.770956686763472*^9, 3.770956691923229*^9}, {
   3.770956723724225*^9, 3.770956755269066*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", 
   "\"\<improve A0A1ToSubspaces \[LongDash] calculate Groebner basis of \
\!\(\*SubscriptBox[\(u\), \(1\)]\)(\[Lambda]),\[Ellipsis],\!\(\*SubscriptBox[\
\(u\), \(k\)]\)(\[Lambda]).\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.721361151637081*^9, 3.7213612051182423`*^9}},
 ExpressionUUID -> "a7ce12d2-e615-4bef-9823-9607cfa59b86"],

Cell[TextData[{
 "The idea is to somehow describe all possibilities to choose ",
 Cell[BoxData[
  FormBox[
   StyleBox["\[ScriptCapitalU]",
    FontColor->RGBColor[1, 0, 0]], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, 3.689320101557584*^9, {3.689341411061653*^9, 
    3.689341527749502*^9}, {3.689341622045527*^9, 3.6893416322695227`*^9}, {
    3.689341738909597*^9, 3.6893418854620132`*^9}, {3.689342621393784*^9, 
    3.689342630801785*^9}, {3.6894049688619013`*^9, 3.689404969901799*^9}},
  TextAlignment->Center,
  ExpressionUUID -> "6cbba982-9fca-4f33-930c-b054d337c091"],
 ". The subspace ",
 Cell[BoxData[
  FormBox[
   StyleBox["\[ScriptCapitalU]",
    FontColor->RGBColor[1, 0, 0]], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, 3.689320101557584*^9, {3.689341411061653*^9, 
    3.689341527749502*^9}, {3.689341622045527*^9, 3.6893416322695227`*^9}, {
    3.689341738909597*^9, 3.6893418854620132`*^9}, {3.689342621393784*^9, 
    3.689342630801785*^9}, {3.6894049688619013`*^9, 3.689404969901799*^9}},
  TextAlignment->Center,
  ExpressionUUID -> "88e95292-9e89-47c6-942a-74bb656d8c85"],
 " is defined by ",
 Cell[BoxData[
  FormBox[
   RowBox[{"u", "(", "\[Lambda]", ")"}], TraditionalForm]],
  ExpressionUUID -> "c35ea39c-d2d6-4a13-bed1-af5fb309c9f7"],
 ", so we can consider any polynomial vector ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["c", "i"], "(", "\[Lambda]", ")"}], 
    RowBox[{
     SubscriptBox["u", "i"], "(", "\[Lambda]", ")"}]}], TraditionalForm]],
  ExpressionUUID -> "572b605b-2da9-4504-98a9-7595b6049e43"],
 ". Therefore, it is natural to find Gr\[ODoubleDot]bner basis of ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     SubscriptBox["u", "i"], "(", "\[Lambda]", ")"}], 
    "\[RightAngleBracket]"}], TraditionalForm]],
  ExpressionUUID -> "627adc05-99d6-41f8-8d70-0536e3637720"],
 "."
}], "Text",
 CellChangeTimes->{{3.721361229532247*^9, 3.721361496231019*^9}, {
  3.72136153320741*^9, 3.721361541454616*^9}},
 ExpressionUUID -> "ec12d3f7-f6c9-43d9-9ca2-394b94f77598"]
}, Closed]],

Cell[CellGroupData[{

Cell["A0A1ToSubspacesMod", "Subsubsection",
 CellChangeTimes->{{3.721360998471558*^9, 3.721360999389097*^9}, {
  3.721361076360333*^9, 3.721361081804851*^9}, {3.770945889040032*^9, 
  3.770945889438179*^9}},
 ExpressionUUID -> "1cb647f9-3835-42cf-80ef-ca355ff0a602"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0A1ToSubspacesMod", "::", "usage"}], "=", 
   "\"\<A0A1ToSubspacesMod[{A0,A1},x\[Rule]poly, Left|Right] gives the \
subspaces which may be used for the construction of the projectors for the \
balances.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721361000170269*^9, 3.721361007685678*^9}, {
   3.721361064718129*^9, 3.721361069149362*^9}, {3.721361140008924*^9, 
   3.721361144206258*^9}, {3.721361554105781*^9, 3.721361556999352*^9}, {
   3.7214487967141933`*^9, 3.721448798170446*^9}, 3.722554989886345*^9, {
   3.722555180676075*^9, 3.72255518080054*^9}, {3.72742846609496*^9, 
   3.727428466404374*^9}, {3.77094496527722*^9, 3.770944965933577*^9}, {
   3.7709568896246357`*^9, 3.7709568994943733`*^9}},
 ExpressionUUID -> "364dc059-7691-4d70-991a-fb455ac3b805"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"A0A1ToSubspacesMod", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A0_", ",", "A1_"}], "}"}], ",", 
    RowBox[{"x_", "\[Rule]", "poly_"}], ",", "Left"}], "]"}], ":=", 
  RowBox[{"A0A1ToSubspaces", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A0", ",", "A1"}], "}"}], ",", 
    RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"A0A1ToSubspaces", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"A0_", ",", "A1_"}], "}"}], ",", 
    RowBox[{"x_", "\[Rule]", "poly_"}], ",", "Right"}], "]"}], ":=", 
  RowBox[{"A0A1ToSubspaces", "[", 
   RowBox[{
    RowBox[{"-", 
     RowBox[{"Transpose", "/@", 
      RowBox[{"{", 
       RowBox[{"A0", ",", "A1"}], "}"}]}]}], ",", 
    RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.770955567869486*^9, 3.7709556044517603`*^9}, {
   3.7709557294747963`*^9, 3.770955736169858*^9}, {3.770956989410492*^9, 
   3.770957013256534*^9}, 3.770957454834659*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"A0A1ToSubspacesMod", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"A0_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"A1_", "?", "SquareMatrixQ"}]}], "}"}], ",", 
     RowBox[{"x_", "\[Rule]", "poly_"}]}], "]"}], "/;", 
   RowBox[{
    RowBox[{"Length", "@", "A0"}], "==", 
    RowBox[{"Length", "@", "A1"}]}]}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"l", "=", 
       RowBox[{"Length", "[", "A1", "]"}]}], ",", "\[Lambda]", ",", "ns", ",",
       "A"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"A", "=", 
      RowBox[{"ArrayFlatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"A0", ",", 
           RowBox[{"A1", "-", 
            RowBox[{"\[Lambda]", "*", 
             RowBox[{"IdentityMatrix", "[", "l", "]"}], " ", 
             RowBox[{"D", "[", 
              RowBox[{"poly", ",", "x"}], "]"}]}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "A0"}], "}"}]}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"A", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Take", "[", 
         RowBox[{"#", ",", 
          RowBox[{"-", "l"}]}], "]"}], "&"}], "/@", 
       RowBox[{"KerMod", "[", 
        RowBox[{"A", ",", 
         RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Get", " ", "rid", " ", "of", " ", "denominators"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ns", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Collect", "[", 
         RowBox[{
          RowBox[{"Cancel", "[", 
           RowBox[{
            RowBox[{"PolynomialLCM", "@@", 
             RowBox[{"Denominator", "[", "#", "]"}]}], "*", "#"}], "]"}], ",",
           "\[Lambda]", ",", "Factor"}], "]"}], "&"}], "/@", 
       RowBox[{"Factor", "@", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"A", ",", 
          RowBox[{"{", 
           RowBox[{"0", ".."}], "}"}]}], "]"}]}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ns", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{"PickBasisMod", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"FixedPointList", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"D", "[", 
                    RowBox[{"#", ",", "\[Lambda]"}], "]"}], "&"}], ",", "#"}],
                   "]"}], "/.", 
                 RowBox[{"\[Lambda]", "\[Rule]", "0"}]}], ",", 
                RowBox[{"x", "\[Rule]", "poly"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ".."}], "}"}]}], "]"}], "&"}], "/@", "ns"}], ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"SameQ", "[", 
              RowBox[{"#1", ",", "#2"}], "]"}], "||", 
             RowBox[{
              RowBox[{"Length", "[", "#1", "]"}], "==", 
              RowBox[{"Length", "[", "#2", "]"}], "==", 
              RowBox[{"MatrixRankMod", "[", 
               RowBox[{
                RowBox[{"Join", "[", 
                 RowBox[{"#1", ",", "#2"}], "]"}], ",", 
                RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]}], ")"}], "&"}]}],
          "]"}], ",", "Length"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"side", "===", "Left"}], ",", 
        RowBox[{"Transpose", "/@", "ns"}], ",", "ns"}], "]"}], "*)"}], 
     "ns"}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.7213608610715647`*^9, 3.721360875431026*^9}, 
   3.721360911905794*^9, 3.7213610919371033`*^9, 3.72136407946924*^9, {
   3.7214487906428757`*^9, 3.72144879341887*^9}, {3.721448828450253*^9, 
   3.72144883407584*^9}, {3.7216829347352667`*^9, 3.72168293719143*^9}, {
   3.727421720397737*^9, 3.727421725076838*^9}, {3.7274235024842997`*^9, 
   3.727423506575769*^9}, {3.7274245787435503`*^9, 3.727424616062718*^9}, {
   3.72742483008917*^9, 3.7274248312729177`*^9}, {3.735003393510914*^9, 
   3.735003397925869*^9}, {3.768743322943626*^9, 3.768743356671131*^9}, {
   3.768999618060032*^9, 3.7689996454722157`*^9}, {3.769029215665612*^9, 
   3.769029220025209*^9}, {3.769032129662356*^9, 3.769032132669198*^9}, 
   3.770944970968655*^9, {3.7709450133271723`*^9, 3.770945033622608*^9}, {
   3.770945065822921*^9, 3.7709450878743753`*^9}, {3.770945174415567*^9, 
   3.770945215615817*^9}, {3.7709568410944023`*^9, 3.7709568724637823`*^9}, 
   3.770957021669468*^9},
 ExpressionUUID -> "1fc2f61f-d42a-474d-9cd6-1fa1edfcf18b"],

Cell[TextData[{
 "The idea is to somehow describe all possibilities to choose ",
 Cell[BoxData[
  FormBox[
   StyleBox["\[ScriptCapitalU]",
    FontColor->RGBColor[1, 0, 0]], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, 3.689320101557584*^9, {3.689341411061653*^9, 
    3.689341527749502*^9}, {3.689341622045527*^9, 3.6893416322695227`*^9}, {
    3.689341738909597*^9, 3.6893418854620132`*^9}, {3.689342621393784*^9, 
    3.689342630801785*^9}, {3.6894049688619013`*^9, 3.689404969901799*^9}},
  TextAlignment->Center,
  ExpressionUUID -> "6cbba982-9fca-4f33-930c-b054d337c091"],
 ". The subspace ",
 Cell[BoxData[
  FormBox[
   StyleBox["\[ScriptCapitalU]",
    FontColor->RGBColor[1, 0, 0]], TraditionalForm]], "DisplayFormula",
  CellChangeTimes->{{3.6884108643811817`*^9, 3.68841092543758*^9}, {
    3.68841104505868*^9, 3.688411080744417*^9}, 3.688411136446681*^9, {
    3.6884112356026373`*^9, 3.6884112693218117`*^9}, 3.688411846021632*^9, {
    3.688412188873933*^9, 3.68841234039725*^9}, {3.688540741282958*^9, 
    3.688540743626298*^9}, {3.688540786626382*^9, 3.688540913587351*^9}, {
    3.6885410333479*^9, 3.688541308452722*^9}, {3.688541348758374*^9, 
    3.688541350230023*^9}, {3.6885416479915943`*^9, 3.688541650686577*^9}, {
    3.688541947208632*^9, 3.688541958161367*^9}, {3.6885420545607*^9, 
    3.688542057799415*^9}, {3.6885424031780148`*^9, 3.688542434393914*^9}, {
    3.688542547154911*^9, 3.6885425502516317`*^9}, {3.688542682305027*^9, 
    3.688542799153183*^9}, {3.6885428415064707`*^9, 3.688542882954734*^9}, {
    3.688812119595171*^9, 3.688812140418848*^9}, {3.68881220037111*^9, 
    3.688812201819044*^9}, {3.6888127660619783`*^9, 3.688812843770711*^9}, {
    3.688814244171461*^9, 3.688814244315339*^9}, 3.688814278246296*^9, {
    3.689153540019925*^9, 3.689153559236383*^9}, 3.689317608108445*^9, {
    3.689317699504125*^9, 3.689317764752461*^9}, {3.6893184240896072`*^9, 
    3.689318439104671*^9}, 3.689320101557584*^9, {3.689341411061653*^9, 
    3.689341527749502*^9}, {3.689341622045527*^9, 3.6893416322695227`*^9}, {
    3.689341738909597*^9, 3.6893418854620132`*^9}, {3.689342621393784*^9, 
    3.689342630801785*^9}, {3.6894049688619013`*^9, 3.689404969901799*^9}},
  TextAlignment->Center,
  ExpressionUUID -> "88e95292-9e89-47c6-942a-74bb656d8c85"],
 " is defined by ",
 Cell[BoxData[
  FormBox[
   RowBox[{"u", "(", "\[Lambda]", ")"}], TraditionalForm]],
  ExpressionUUID -> "c35ea39c-d2d6-4a13-bed1-af5fb309c9f7"],
 ", so we can consider any polynomial vector ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["c", "i"], "(", "\[Lambda]", ")"}], 
    RowBox[{
     SubscriptBox["u", "i"], "(", "\[Lambda]", ")"}]}], TraditionalForm]],
  ExpressionUUID -> "572b605b-2da9-4504-98a9-7595b6049e43"],
 ". Therefore, it is natural to find Gr\[ODoubleDot]bner basis of ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[LeftAngleBracket]", 
    RowBox[{
     SubscriptBox["u", "i"], "(", "\[Lambda]", ")"}], 
    "\[RightAngleBracket]"}], TraditionalForm]],
  ExpressionUUID -> "627adc05-99d6-41f8-8d70-0536e3637720"],
 "."
}], "Text",
 CellChangeTimes->{{3.721361229532247*^9, 3.721361496231019*^9}, {
  3.72136153320741*^9, 3.721361541454616*^9}},
 ExpressionUUID -> "ec12d3f7-f6c9-43d9-9ca2-394b94f77598"]
}, Closed]],

Cell[CellGroupData[{

Cell["GetSubspaces", "Subsubsection",
 CellChangeTimes->{{3.721360998471558*^9, 3.721360999389097*^9}, {
  3.721361076360333*^9, 3.721361081804851*^9}, {3.726439628883585*^9, 
  3.726439629293997*^9}},
 ExpressionUUID -> "b380da57-be52-4c8f-bd66-9ef248d6cb72"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetSubspaces", "::", "usage"}], "=", "\"\<GetSubspaces[\!\(\*
StyleBox[\"m\", \"TI\"]\),{x,\!\(\*SubscriptBox[\(x\), \
\(0\)]\)},\[Epsilon],Left|Right] gives the subspaces which may be used for \
the construction of the projectors for the balances with positive \
gains.\\nWhen called with option All\[Rule]True, it returns all \
subspaces.\>\""}]], "Code",
 CellChangeTimes->{{3.726439635873418*^9, 3.72643970101788*^9}},
 ExpressionUUID -> "7c39f623-cf33-4b7a-acd4-7bdd8589ff7f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Options", "[", "GetSubspaces", "]"}], "=", 
  RowBox[{"{", 
   RowBox[{"All", "\[Rule]", "False"}], "}"}]}]], "Code",
 CellChangeTimes->{{3.72644027967205*^9, 3.726440297291829*^9}},
 ExpressionUUID -> "4d0e9dd0-6a02-49d4-ad57-bbf11365aa60"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"GetSubspaces", "[", 
   RowBox[{
    RowBox[{"m_", "?", "DSystemQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x0_"}], "}"}], ",", "args___"}], "]"}], ":=", 
  RowBox[{"GetSubspaces", "[", 
   RowBox[{
    RowBox[{"m", "[", "x", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}], ",", "args"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetSubspaces", "[", 
   RowBox[{"m_Association", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x0_"}], "}"}], ",", "args___"}], "]"}], ":=", 
  RowBox[{"GetSubspaces", "[", 
   RowBox[{
    RowBox[{"m", "[", "x", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}], ",", "args"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.726442871841387*^9, 3.726442916185626*^9}, {
  3.7264448027988167`*^9, 3.726444814903185*^9}},
 ExpressionUUID -> "e4e3da9d-d804-4ebf-b1b5-d6b3e060d083"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"GetSubspaces", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x0_"}], "}"}], ",", "\[Epsilon]_", ",", "Left", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"GetSubspaces", "[", 
   RowBox[{"m", ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}], ",", "\[Epsilon]", ",", "opts"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetSubspaces", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x0_"}], "}"}], ",", "\[Epsilon]_", ",", "Right", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"GetSubspaces", "[", 
   RowBox[{
    RowBox[{"-", 
     RowBox[{"Transpose", "@", "m"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}], ",", "\[Epsilon]", ",", "opts"}], 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.770957170979658*^9, 3.7709572360535583`*^9}, {
  3.77095739596935*^9, 3.7709573974180727`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"GetSubspaces", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x0_"}], "}"}], ",", "\[Epsilon]_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"r", ",", "s", ",", "o", ",", "ser", ",", "m0", ",", "m1", ",", 
      RowBox[{"status", "=", "\"\<\>\""}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"FCMonitor", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"status", "=", "\"\<Evaluating Poincare rank...\>\""}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"CWrite", "[", 
        RowBox[{"\"\<\\n\>\"", "<>", "status"}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"r", "=", 
        RowBox[{"PoincareRank", "[", 
         RowBox[{"m", ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"PrintTemporary", "[", 
        RowBox[{"\"\<Poincare rank: \>\"", "<>", 
         RowBox[{"ToString", "[", "r", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"status", "=", "\"\<Evaluating expansion\>\""}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"s", "=", 
        RowBox[{
         RowBox[{"2", 
          RowBox[{"Boole", "[", 
           RowBox[{"x0", "===", "\[Infinity]"}], "]"}]}], "-", "1"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"o", "=", 
        RowBox[{"s", "-", "r"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"leading", " ", "order", " ", "of", " ", "expansion"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"r", ">", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"TrueQ", "@", 
            RowBox[{"OptionValue", "[", "All", "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Just", " ", "return", " ", "all", " ", "subspaces"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"m0", "=", 
             RowBox[{
              RowBox[{"-", "s"}], "*", 
              RowBox[{"SeriesCoefficient", "[", 
               RowBox[{"m", ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "x0", ",", "o"}], "}"}]}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"status", "=", "\"\<Evaluating subspaces\>\""}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"CWrite", "[", 
             RowBox[{"\"\<\\n\>\"", "<>", "status"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Return", "[", 
             RowBox[{"JDTowers", "[", "m0", "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ser", "=", 
             RowBox[{
              RowBox[{"-", "s"}], "*", 
              RowBox[{"Series", "[", 
               RowBox[{"m", ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "x0", ",", 
                  RowBox[{"o", "+", "1"}]}], "}"}]}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"m0", "=", 
             RowBox[{"SeriesCoefficient", "[", 
              RowBox[{"ser", ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "x0", ",", "o"}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"m1", "=", 
             RowBox[{"SeriesCoefficient", "[", 
              RowBox[{"ser", ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "x0", ",", 
                 RowBox[{"o", "+", "1"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"status", "=", "\"\<Evaluating subspaces\>\""}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"CWrite", "[", 
             RowBox[{"\"\<\\n\>\"", "<>", "status"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Return", "[", 
             RowBox[{"A0A1ToSubspaces", "[", 
              RowBox[{"{", 
               RowBox[{"m0", ",", "m1"}], "}"}], "]"}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Fuchsian", " ", "singularity"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"m0", "=", 
           RowBox[{
            RowBox[{"-", "s"}], "*", 
            RowBox[{"SeriesCoefficient", "[", 
             RowBox[{"m", ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "x0", ",", "o"}], "}"}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"status", "=", "\"\<Evaluating subspaces\>\""}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"CWrite", "[", 
           RowBox[{"\"\<\\n\>\"", "<>", "status"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Return", "[", 
           RowBox[{"JDTowers", "[", 
            RowBox[{"m0", ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"TrueQ", "@", 
                RowBox[{"OptionValue", "[", "All", "]"}]}], ",", "_", ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Negative", "[", 
                   RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], "]"}], "&"}], 
                 ")"}]}]}], "]"}]}], "]"}], "]"}]}]}], "]"}]}], 
      "\[IndentingNewLine]", ",", "status"}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.726439729000737*^9, 3.7264397295442753`*^9}, {
   3.726439763642982*^9, 3.72644004547571*^9}, {3.726440179438982*^9, 
   3.726440200003991*^9}, {3.726440265996839*^9, 3.726440748544477*^9}, {
   3.7264407968480377`*^9, 3.726440859344585*^9}, {3.7264408894242153`*^9, 
   3.726440898461193*^9}, {3.726444883628943*^9, 3.7264449237470922`*^9}, {
   3.7264449978831*^9, 3.726444998028475*^9}, {3.7264450685063543`*^9, 
   3.72644509093077*^9}, {3.768694272332486*^9, 3.768694310836721*^9}, {
   3.770955177544065*^9, 3.7709551811879683`*^9}, {3.770955214619897*^9, 
   3.770955216605517*^9}, {3.770955261059469*^9, 3.770955278618738*^9}, {
   3.770957131294401*^9, 3.7709571614226227`*^9}, {3.770957244696478*^9, 
   3.770957316901672*^9}, {3.7709573557470284`*^9, 3.770957373316266*^9}, {
   3.770957501823271*^9, 3.770957528295269*^9}, 3.770957560703703*^9, {
   3.7709580761582327`*^9, 3.770958090035725*^9}},
 ExpressionUUID -> "94a03f01-1640-43bd-832d-7fd0fd61acc4"]
}, Closed]],

Cell[CellGroupData[{

Cell["Balance", "Subsubsection",
 CellChangeTimes->{{3.721448569751981*^9, 3.721448572255968*^9}},
 ExpressionUUID -> "6cd408c4-9a0e-4d97-8f24-31f9f78b8441"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Balance", "::", "usage"}], "=", 
   "\"\<A balance transformation matrix. Balance[\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\),\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"2\"]\)}]=\!\(\*
StyleBox[\"\[DoubleStruckCapitalI]\", \"TI\"]\)-\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\)+\!\(\*FractionBox[
RowBox[{
StyleBox[\"x\", \"TI\"], 
StyleBox[\"-\", \"TI\"], SubscriptBox[
StyleBox[\"x\", \"TI\"], \"2\"]}], 
RowBox[{
StyleBox[\"x\", \"TI\"], 
StyleBox[\"-\", \"TI\"], SubscriptBox[
StyleBox[\"x\", \"TI\"], \"1\"]}]]\)\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\), Balance[\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\),\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"1\"]\),\[Infinity]}]=\!\(\*
StyleBox[\"\[DoubleStruckCapitalI]\", \"TI\"]\)-\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\)+\!\(\*FractionBox[\"1\", 
RowBox[{
StyleBox[\"x\", \"TI\"], 
StyleBox[\"-\", \"TI\"], SubscriptBox[
StyleBox[\"x\", \"TI\"], \"1\"]}]]\)\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\), and Balance[\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\),\[Infinity],\!\(\*SubscriptBox[\(x\), \(2\)]\)}]=\!\
\(\*
StyleBox[\"\[DoubleStruckCapitalI]\", \"TI\"]\)-\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\)+(\!\(\*
StyleBox[\" \", \"TI\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"-\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"2\"]\))\!\(\*
StyleBox[\"\[DoubleStruckCapitalP]\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7214485824979877`*^9, 3.721448586514839*^9}, {
  3.770609320470624*^9, 3.770609354253532*^9}},
 ExpressionUUID -> "bfd2fdca-cd0d-43f9-a8e6-7840df9a4ee6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Balance", "::", "notprojector"}], "=", 
   "\"\<Warning: `1` is not a projector. Returning identity matrix\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.624864528783125*^9, 3.6248645624504824`*^9}},
 ExpressionUUID -> "366d035f-91cb-4a7c-a9fc-b9e74217210a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Balance", "[", 
    RowBox[{"p_", ",", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "x1_", ",", "\[Infinity]"}], "}"}], ",", 
     RowBox[{"c_:", "1"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"IdentityMatrix", "@", 
     RowBox[{"Length", "@", "p"}]}], "-", "p", "+", 
    RowBox[{"p", " ", 
     FractionBox["c", 
      RowBox[{"x", "-", "x1"}]]}]}]}], ";"}]], "Code",
 CellChangeTimes->{{3.6248645976498594`*^9, 3.624864598703559*^9}, {
   3.624864691243015*^9, 3.624864704029507*^9}, {3.62495262594692*^9, 
   3.624952631797806*^9}, {3.727744007901886*^9, 3.727744010916359*^9}, {
   3.7277455839925127`*^9, 3.727745584720273*^9}, 3.727745729692422*^9, {
   3.7688975976443996`*^9, 3.76889762500177*^9}, {3.768897709017981*^9, 
   3.76889778010718*^9}, {3.770609358116356*^9, 3.770609389980365*^9}, {
   3.7706094754288683`*^9, 3.770609476750548*^9}},
 ExpressionUUID -> "b339b598-5e20-44d8-a9a8-217d6361ae61"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Balance", "[", 
   RowBox[{"p_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x1_", ",", "\[Infinity]"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"cs", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"List", "/@", 
            RowBox[{"Dimensions", "[", "p", "]"}]}]}], "]"}]}], "]"}]}], ",", 
      "pcs", ",", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pcs", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{"cs", "*", "p"}], "]"}]}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pcs", "===", "0"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"IdentityMatrix", "@", 
         RowBox[{"Length", "@", "p"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{
        RowBox[{"Plus", "@@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"cs", "*", 
           RowBox[{"ODot", "[", 
            RowBox[{"p", ",", "p"}], "]"}]}], "]"}]}], "/", "pcs"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"c", ",", 
          RowBox[{"Alternatives", "@@", "cs"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Balance", "::", "notprojector"}], ",", "p"}], "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Factor", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "-", 
         RowBox[{"p", "/", "c"}]}], "]"}], "+", 
       RowBox[{"p", " ", 
        FractionBox["1", 
         RowBox[{"x", "-", "x1"}]]}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.6248645976498594`*^9, 3.624864598703559*^9}, {
   3.624864691243015*^9, 3.624864704029507*^9}, {3.62495262594692*^9, 
   3.624952631797806*^9}, {3.727744007901886*^9, 3.727744010916359*^9}, {
   3.7277455839925127`*^9, 3.727745584720273*^9}, 3.727745729692422*^9},
 ExpressionUUID -> "79098348-2a7c-4326-bf4a-82be47c6157a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Balance", "[", 
    RowBox[{"p_", ",", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "\[Infinity]", ",", "x2_"}], "}"}], ",", 
     RowBox[{"c_:", "1"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"IdentityMatrix", "@", 
     RowBox[{"Length", "@", "p"}]}], "-", "p", "+", 
    RowBox[{"c", " ", "p", " ", 
     RowBox[{"(", 
      RowBox[{"x", "-", "x2"}], ")"}]}]}]}], ";"}]], "Code",
 CellChangeTimes->{{3.6248645976498594`*^9, 3.624864598703559*^9}, {
   3.624864691243015*^9, 3.624864704029507*^9}, {3.62495262594692*^9, 
   3.624952631797806*^9}, {3.727744007901886*^9, 3.727744010916359*^9}, {
   3.7277455839925127`*^9, 3.727745584720273*^9}, 3.727745729692422*^9, {
   3.7688975976443996`*^9, 3.76889762500177*^9}, {3.768897709017981*^9, 
   3.768897806541647*^9}, {3.7706094013169394`*^9, 3.770609472574501*^9}},
 ExpressionUUID -> "b59dfae1-d715-4567-8d5a-1ba7f467911f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Balance", "[", 
   RowBox[{"p_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "\[Infinity]", ",", "x2_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"cs", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"List", "/@", 
            RowBox[{"Dimensions", "[", "p", "]"}]}]}], "]"}]}], "]"}]}], ",", 
      "pcs", ",", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pcs", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{"cs", "*", "p"}], "]"}]}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pcs", "===", "0"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"IdentityMatrix", "@", 
         RowBox[{"Length", "@", "p"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{
        RowBox[{"Plus", "@@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"cs", "*", 
           RowBox[{"ODot", "[", 
            RowBox[{"p", ",", "p"}], "]"}]}], "]"}]}], "/", "pcs"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"c", ",", 
          RowBox[{"Alternatives", "@@", "cs"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Balance", "::", "notprojector"}], ",", "p"}], "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Factor", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "-", 
         RowBox[{"p", "/", "c"}]}], "]"}], "+", 
       RowBox[{"p", " ", 
        RowBox[{"(", 
         RowBox[{"x", "-", "x2"}], ")"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.6248647223556767`*^9, 3.624864732433369*^9}, {
   3.624952638966566*^9, 3.6249526456119795`*^9}, {3.7277440141242733`*^9, 
   3.727744016924142*^9}, 3.72774558924513*^9, 3.727745729698723*^9},
 ExpressionUUID -> "86570ced-bd1e-4dc0-8499-c38d64d4059c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Balance", "[", 
    RowBox[{"p_", ",", 
     RowBox[{"{", 
      RowBox[{"x_", ",", "x1_", ",", "x2_"}], "}"}], ",", 
     RowBox[{"c_:", "1"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"IdentityMatrix", "@", 
     RowBox[{"Length", "@", "p"}]}], "-", "p", "+", 
    RowBox[{"c", " ", "p", " ", 
     FractionBox[
      RowBox[{"x", "-", "x2"}], 
      RowBox[{"x", "-", "x1"}]]}]}]}], ";"}]], "Code",
 CellChangeTimes->{{3.6248645976498594`*^9, 3.624864598703559*^9}, {
   3.624864691243015*^9, 3.624864704029507*^9}, {3.62495262594692*^9, 
   3.624952631797806*^9}, {3.727744007901886*^9, 3.727744010916359*^9}, {
   3.7277455839925127`*^9, 3.727745584720273*^9}, 3.727745729692422*^9, {
   3.7688975976443996`*^9, 3.76889762500177*^9}, {3.768897709017981*^9, 
   3.76889783103754*^9}, {3.7706094301409063`*^9, 3.7706094634450006`*^9}},
 ExpressionUUID -> "d807aa18-f6a1-4e86-9713-50b537730abf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Balance", "[", 
   RowBox[{"p_", ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", "x1_", ",", "x2_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"cs", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Unique", "[", "]"}], ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"Sequence", "@@", 
           RowBox[{"List", "/@", 
            RowBox[{"Dimensions", "[", "p", "]"}]}]}], "]"}]}], "]"}]}], ",", 
      "pcs", ",", "c"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pcs", "=", 
      RowBox[{"Plus", "@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{"cs", "*", "p"}], "]"}]}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"pcs", "===", "0"}], ",", 
       RowBox[{"Return", "[", 
        RowBox[{"IdentityMatrix", "@", 
         RowBox[{"Length", "@", "p"}]}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"c", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{
        RowBox[{"Plus", "@@", 
         RowBox[{"Flatten", "[", 
          RowBox[{"cs", "*", 
           RowBox[{"ODot", "[", 
            RowBox[{"p", ",", "p"}], "]"}]}], "]"}]}], "/", "pcs"}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Not", "[", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"c", ",", 
          RowBox[{"Alternatives", "@@", "cs"}]}], "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"Balance", "::", "notprojector"}], ",", "p"}], "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{
       RowBox[{"Factor", "[", 
        RowBox[{
         RowBox[{"IdentityMatrix", "@", 
          RowBox[{"Length", "@", "p"}]}], "-", 
         RowBox[{"p", "/", "c"}]}], "]"}], "+", 
       RowBox[{"p", " ", 
        FractionBox[
         RowBox[{"x", "-", "x2"}], 
         RowBox[{"x", "-", "x1"}]]}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.6248641044773426`*^9, 3.6248641570812774`*^9}, {
   3.6248641967666316`*^9, 3.624864525679064*^9}, {3.6248646140547543`*^9, 
   3.624864680916157*^9}, {3.6249526490102367`*^9, 3.624952653972533*^9}, {
   3.727744020260592*^9, 3.7277440231163*^9}, 3.727745592593069*^9, 
   3.727745729705267*^9},
 ExpressionUUID -> "8065dd7c-37fa-48af-ad11-ea3f648ecfa7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "done", "[", 
   "\"\<Balance as it was before seems to be neither necessary nor effective.\
\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.768897199727378*^9, 3.768897236463279*^9}, {
  3.768897277232101*^9, 3.768897308544017*^9}, {3.768897859955361*^9, 
  3.7688978802756557`*^9}, {3.770609514788843*^9, 3.7706095208850727`*^9}},
 ExpressionUUID -> "0b93137e-f6a4-4bbf-8a1b-9aacdbee4014"]
}, Closed]],

Cell[CellGroupData[{

Cell["VisBalancing", "Subsubsection",
 CellChangeTimes->{3.6253280633182087`*^9},
 ExpressionUUID -> "e287391d-7bab-4b67-b587-2b853ffff53d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VisBalancing", "::", "usage"}], "=", "\"\<VisBalancing[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] is a visual tool for the balancing. Soon to be \
obsolete and replaced by VisTransformation.\>\""}], ";"}]], "Code",
 CellChangeTimes->{
  3.7215495819491863`*^9, {3.768896980959249*^9, 3.7688969969129744`*^9}, {
   3.768897033753214*^9, 3.7688970387512493`*^9}},
 ExpressionUUID -> "4ac06b58-8640-4976-b6f2-fef62eff2123"],

Cell[BoxData[
 RowBox[{
  RowBox[{"VisBalancing", "[", 
   RowBox[{"ds_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "poles_"}], "}"}], ",", 
    RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}]}], "]"}], ":=", 
  RowBox[{"VisBalancing", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", 
    "poles"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.72325007829632*^9, 3.723250117018811*^9}, {
  3.7232502260687037`*^9, 3.723250239580832*^9}},
 ExpressionUUID -> "c934fee2-21b7-41c8-b520-d3d047d72e83"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VisBalancing", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol", ",", 
     RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
     RowBox[{"poles", ":", 
      RowBox[{"All", "|", 
       RowBox[{"{", "__", "}"}]}], ":", "All"}]}], "]"}], ":=", 
   RowBox[{"VisBalancing", "[", 
    RowBox[{
     RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", 
     "poles"}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721450868372929*^9, 3.721450892181036*^9}, {
   3.7215493507928534`*^9, 3.721549354953006*^9}, {3.72154947147303*^9, 
   3.721549472952837*^9}, {3.721715237722169*^9, 3.721715237890087*^9}, 
   3.7232501202352877`*^9},
 ExpressionUUID -> "e8fd7ae0-4331-49b3-932a-5f74ccf5e0f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VisBalancing", "[", 
    RowBox[{"as_Association", ",", "x_Symbol", ",", 
     RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
     RowBox[{"poles", ":", 
      RowBox[{"All", "|", 
       RowBox[{"{", "__", "}"}]}], ":", "All"}]}], "]"}], ":=", 
   RowBox[{"VisBalancing", "[", 
    RowBox[{
     RowBox[{"as", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", 
     "poles"}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721450868372929*^9, 3.721450892181036*^9}, {
   3.7215493507928534`*^9, 3.721549354953006*^9}, {3.72154947147303*^9, 
   3.721549472952837*^9}, {3.721715237722169*^9, 3.721715237890087*^9}, 
   3.7232501202352877`*^9, {3.7232501516126213`*^9, 3.723250163164311*^9}},
 ExpressionUUID -> "d033f2e5-6faf-418b-b8e3-efb83f10500e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"VisBalancing", "[", 
   RowBox[{
    RowBox[{"matr_", "?", "SquareMatrixQ"}], ",", "x_Symbol", ",", 
    RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
    RowBox[{"poles", ":", 
     RowBox[{"All", "|", 
      RowBox[{"{", "__", "}"}]}], ":", "All"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Basic", " ", 
      RowBox[{"idea", ":", " ", "first"}]}], ",", " ", 
     RowBox[{
     "find", " ", "JDecompositionData", " ", "for", " ", "all", " ", "points",
       " ", "of", " ", "the", " ", 
      RowBox[{"matrix", ".", "\[IndentingNewLine]", "Then"}], " ", 
      "construct", " ", "a", " ", "graphics", " ", "control"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ttt", ",", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "matr"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"m", "=", "matr"}], ",", "\[IndentingNewLine]", "polesData", 
      ",", "\[IndentingNewLine]", "indices", ",", "index", ",", 
      "\[IndentingNewLine]", "prevu", ",", "prevv", ",", 
      "\[IndentingNewLine]", "psetu", ",", "psetv", ",", 
      "\[IndentingNewLine]", "clickedu", ",", "clickedv", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"buttons", "=", 
       RowBox[{"Grid", "[", 
        RowBox[{"{", 
         RowBox[{"{", "\"\<Wait\>\"", "}"}], "}"}], "]"}]}], ",", 
      "\[IndentingNewLine]", "us", ",", "vs", ",", "x1", ",", "x2", ",", 
      "\[IndentingNewLine]", "lu", ",", "lv", ",", "\[IndentingNewLine]", 
      "gram", ",", "goodBalance", ",", "colorMark", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"statusline", "=", "\"\<Ready\>\""}], ",", "balance", ",", 
      "\[IndentingNewLine]", "transformation", ",", "\[IndentingNewLine]", 
      "updateInteface", ",", "\[IndentingNewLine]", "apply", ",", 
      "\[IndentingNewLine]", "validate"}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"transformation", "=", 
      RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Calculate", " ", "poles"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"forming", " ", "polesData", " ", "and", " ", "indices"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"polesData", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"poles", "===", "All"}], ",", 
            RowBox[{"PolesInfo", "[", 
             RowBox[{"m", ",", "x"}], "]"}], ",", 
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#", ",", 
                  RowBox[{"PoincareRank", "[", 
                   RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#"}], "}"}]}], "]"}]}], "}"}], "&"}], "/@",
                "poles"}], ",", 
              RowBox[{"{", 
               RowBox[{"_", ",", 
                RowBox[{"_", "?", "Negative"}]}], "}"}]}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"FCStaticMonitor", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"polesData", "=", "\[IndentingNewLine]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#1", ",", "#2", ",", 
                  RowBox[{"(*", 
                   RowBox[{"Modified", " ", "07.06", ".2019"}], "*)"}], 
                  RowBox[{"JDData", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"/", "Modified"}], " ", "07.06", ".2019"}], 
                    "*)"}], "@", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#1", "=!=", "\[Infinity]"}], ",", 
                    RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "-", "#2"}]}], "}"}]}], "]"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{"1", "-", "#2"}]}], "}"}]}], "]"}]}]}], "]"}]}], 
                  ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"#2", ">", "0"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Prepend", "[", 
                    RowBox[{"#", ",", "\"\<M\>\""}], "]"}], "&"}], "/@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{"(*", 
                    RowBox[{"Transpose", "/@"}], "*)"}], 
                    RowBox[{
                    RowBox[{"Union", "@", 
                    RowBox[{"A0A1ToSubspaces", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", "1"}], "}"}]}], "]"}], "]"}],
                     ",", "Left"}], "]"}]}], ",", 
                    RowBox[{"Union", "@", 
                    RowBox[{"A0A1ToSubspaces", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", "1"}], "}"}]}], "]"}], "]"}],
                     ",", "Right"}], "]"}]}]}], "}"}], "]"}]}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "}"}], "&"}], "@@@", 
               "polesData"}], ")"}]}], ";"}], "\[IndentingNewLine]", ",", 
           "\"\<Calculating JDData...\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"indices", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2", ",", 
                  RowBox[{"{", "i3", "}"}], ",", 
                  RowBox[{
                   RowBox[{"i3", "==", "1"}], "||", "prevu"}], 
                  RowBox[{"(*", 
                   RowBox[{"\"\<allowed to press?\>\"", " ", "flag"}], "*)"}],
                   ",", 
                  RowBox[{"prevu", "=", 
                   RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}], 
                  RowBox[{"(*", 
                   RowBox[{"\"\<pressed?\>\"", " ", "flag"}], "*)"}], ",", 
                  RowBox[{
                   RowBox[{"i3", "==", "1"}], "||", "prevv"}], ",", 
                  RowBox[{"prevv", "=", 
                   RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}]}], "}"}]}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i2", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i3", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "3", ",", "i2", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{
                   RowBox[{"Length", "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"i1", ",", "3"}], "]"}], "]"}]}], "+", "i2"}], 
                  ",", "All", ",", "True", ",", 
                  RowBox[{"Unique", "[", "\"\<p\>\"", "]"}], ",", "True", ",", 
                  RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}], "}"}]}], "]"}],
               ",", 
              RowBox[{"{", 
               RowBox[{"i2", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "4"}], "]"}], "]"}]}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "@", "polesData"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"polesData", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", 
              RowBox[{"Join", "[", 
               RowBox[{"#3", ",", "#4"}], "]"}]}], "}"}], "&"}], "@@@", 
           "polesData"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "forming"}], " ", "polesData", " ", "and", " ", 
           "indices"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"functions", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetu", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "5"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"psetv", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "7"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{"write", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"psetu", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", "True", "]"}], " ", "and", 
           " ", 
           RowBox[{
            RowBox[{"psetv", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", "True", "]"}]}], " ", 
          "*)"}], 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "for", " ", "the", " ", "naive", " ", "effect", " ", "of", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"indices", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "5"}], "]"}], "]"}]}], "=", 
           RowBox[{
            RowBox[{"True", " ", "and", " ", 
             RowBox[{"indices", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "7"}], "]"}], "]"}]}], "=", "True"}]}], " ", 
          "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "functions"}], " ", "to", " ", "set", " ", 
           "variables"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"forming", " ", "interface"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"buttons", "=", 
          RowBox[{"Grid", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Grid", "[", 
                RowBox[{
                 RowBox[{"ArrayFlatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"PadRight", "[", 
                    RowBox[{"Apply", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", "#"}], 
                    "]"}], "&"}], "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "1"}], "]"}], 
                    "]"}]}], ",", 
                    RowBox[{"clickedu", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#4", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{"#5", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<FramedPalette\>\"", ",", "\"\<Pressed\>\""}],
                     "}"}], ",", "\"\<FramedPalette\>\""}], "]"}], "]"}]}]}], 
                    "]"}], "&"}], ",", 
                    RowBox[{"SplitBy", "[", 
                    RowBox[{"indices", ",", "First"}], "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}], "\[IndentingNewLine]", 
                    "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#2", ">", "0"}], ",", "Style", ",", 
                    RowBox[{"#", "&"}]}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<   \>\"", ",", "x", ",", "\"\<=\>\"", ",", "#1", 
                    ",", "\"\<, pr=\>\"", ",", "#2", ",", "\"\<   \>\""}], 
                    "}"}], "]"}], ",", "Bold"}], "]"}], "}"}], "&"}], "@@@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"PadLeft", "[", 
                    RowBox[{"Reverse", "/@", 
                    RowBox[{"Apply", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", "#"}], 
                    "]"}], "&"}], "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "1"}], "]"}], 
                    "]"}]}], ",", 
                    RowBox[{"clickedv", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#6", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{"#7", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<FramedPalette\>\"", ",", "\"\<Pressed\>\""}],
                     "}"}], ",", "\"\<FramedPalette\>\""}], "]"}], "]"}]}]}], 
                    "]"}], "&"}], ",", 
                    RowBox[{"SplitBy", "[", 
                    RowBox[{"indices", ",", "First"}], "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}]}], "\[IndentingNewLine]",
                     "]"}]}], "\[IndentingNewLine]", "}"}], "}"}], "]"}], ",", 
                 RowBox[{"Spacings", "\[Rule]", "0"}], ",", 
                 RowBox[{"ItemSize", "\[Rule]", "All"}], ",", 
                 RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Apply balance transformation\>\"", ",", 
                 RowBox[{"apply", "[", "]"}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", "goodBalance", "]"}]}], ",", 
                 RowBox[{"Background", "\[Rule]", 
                  RowBox[{"Dynamic", "[", "colorMark", "]"}]}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Paste overall transformation\>\"", ",", 
                 RowBox[{"DialogReturn", "[", "transformation", "]"}]}], 
                "]"}], "\[IndentingNewLine]", "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Dynamic", "[", "statusline", "]"}], 
               "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}], 
            ",", 
            RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "forming"}], " ", "interface"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"unsetting", " ", "buttons"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"Through", "[", 
          RowBox[{"psetu", "[", "False", "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Through", "[", 
          RowBox[{"psetv", "[", "False", "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "unsetting"}], " ", "buttons"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"apply", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"apply", " ", "transformation"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"balance", "=", 
          RowBox[{"Balance", "[", 
           RowBox[{
            RowBox[{"Projector", "[", 
             RowBox[{"(*", 
              RowBox[{"Transpose", "@"}], "*)"}], 
             RowBox[{"us", ",", "vs"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "x1", ",", "x2"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", "\"\<balance constructed\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"m", "=", 
          RowBox[{"Transform", "[", 
           RowBox[{"m", ",", "balance", ",", "x"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", "\"\<transformation applied\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"transformation", "=", 
          RowBox[{"ODot", "[", 
           RowBox[{"transformation", ",", "balance"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
         "statusline", "=", "\"\<overall transformation calculated\>\""}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"updateInteface", "[", "]"}], ";"}], "\[IndentingNewLine]", 
        ")"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"validate", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "pick", " ", "right", " ", "and", " ", "left", " ", "vectors"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"us", "=", 
          RowBox[{"vs", "=", 
           RowBox[{"{", "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"#5", ",", 
               RowBox[{
                RowBox[{"us", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"us", ",", 
                   RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "2", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}]}], ";", 
                RowBox[{"x1", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{"#7", ",", 
               RowBox[{
                RowBox[{"vs", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"vs", ",", 
                   RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "3", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}]}], ";", 
                RowBox[{"x2", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}]}], 
            ")"}], "&"}], "@@@", "indices"}], ";", "\[IndentingNewLine]", 
         RowBox[{"lu", "=", 
          RowBox[{"Length", "@", "us"}]}], ";", 
         RowBox[{"lv", "=", 
          RowBox[{"Length", "@", "vs"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"lu", "\[Equal]", "0"}], "||", 
            RowBox[{"lv", "\[Equal]", "0"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"goodBalance", "=", "False"}], ";", "\[IndentingNewLine]", 
            RowBox[{"colorMark", "=", "Automatic"}]}], "\[IndentingNewLine]", 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"gram", "=", 
             RowBox[{"ODot", "[", 
              RowBox[{"vs", ",", 
               RowBox[{"Transpose", "@", "us"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"goodBalance", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"lu", "\[Equal]", "lv"}], "&&", 
               RowBox[{"lv", "\[Equal]", 
                RowBox[{"MatrixRank", "[", "gram", "]"}]}]}], ")"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"colorMark", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MatrixRank", "[", "gram", "]"}], "\[Equal]", "lu"}], 
               ",", 
               RowBox[{"If", "[", 
                RowBox[{"goodBalance", ",", "Green", ",", "Automatic"}], 
                "]"}], ",", "Red"}], "]"}]}]}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", 
          RowBox[{
           RowBox[{"ToString", "[", "lu", "]"}], "<>", 
           "\"\<-dimensional u-space and \>\"", "<>", 
           RowBox[{"ToString", "[", "lv", "]"}], "<>", 
           "\"\<-dimensional v-space\>\""}]}], ";"}], "\[IndentingNewLine]", 
        ")"}], "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"clickedu", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "5"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetu", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{"{", 
                RowBox[{"#1", ",", "#2", ",", 
                 RowBox[{
                  RowBox[{"{", "k_", "}"}], "/;", 
                  RowBox[{"k", "\[GreaterEqual]", " ", 
                   RowBox[{"First", "[", "#3", "]"}]}]}], ",", "__"}], "}"}], 
               ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetu", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedv", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "7"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetv", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{"{", 
                RowBox[{"#1", ",", "#2", ",", 
                 RowBox[{
                  RowBox[{"{", "k_", "}"}], "/;", 
                  RowBox[{"k", "\[GreaterEqual]", " ", 
                   RowBox[{"First", "[", "#3", "]"}]}]}], ",", "__"}], "}"}], 
               ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetv", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "[", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"DialogInput", "[", 
      RowBox[{"Dynamic", "[", "buttons", 
       RowBox[{"(*", 
        RowBox[{"Refresh", "[", 
         RowBox[{"buttons", ",", 
          RowBox[{"UpdateInterval", "\[Rule]", "1"}]}], "]"}], "*)"}], "]"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.6252099434388247`*^9, 3.6252099509508104`*^9}, {
   3.625220907567676*^9, 3.6252209930734243`*^9}, {3.6252211176701155`*^9, 
   3.6252211442437525`*^9}, {3.625221186024481*^9, 3.6252211868770466`*^9}, {
   3.625221235065028*^9, 3.6252212752547007`*^9}, {3.6252213230544243`*^9, 
   3.6252213777217054`*^9}, {3.6252214205771475`*^9, 
   3.6252215590490484`*^9}, {3.6252217588196306`*^9, 3.625221914712093*^9}, {
   3.625221948184307*^9, 3.6252219816014853`*^9}, {3.625222521642317*^9, 
   3.6252225383263893`*^9}, {3.625222588967373*^9, 3.625222681946081*^9}, {
   3.625222714992013*^9, 3.6252227332321177`*^9}, {3.625222794481768*^9, 
   3.625222839315524*^9}, {3.625222907477761*^9, 3.6252230926606617`*^9}, {
   3.625223184295478*^9, 3.6252232197309957`*^9}, {3.6252232817971883`*^9, 
   3.6252232854566154`*^9}, 3.62522337378924*^9, {3.6252234629324017`*^9, 
   3.6252235577103033`*^9}, {3.62522359706042*^9, 3.6252236712926855`*^9}, {
   3.6252238237958984`*^9, 3.6252239950405483`*^9}, {3.6252241893855305`*^9, 
   3.6252243402056265`*^9}, {3.6252243728763094`*^9, 
   3.6252244042451277`*^9}, {3.6252244471676135`*^9, 
   3.6252246106180935`*^9}, {3.6252246520325785`*^9, 
   3.6252246536036205`*^9}, {3.625224743458256*^9, 3.6252249275534353`*^9}, {
   3.625225008354061*^9, 3.625225072903901*^9}, {3.625225128443761*^9, 
   3.625225168139106*^9}, {3.6252252546995525`*^9, 3.625225256077468*^9}, {
   3.625225301260455*^9, 3.6252253022741275`*^9}, {3.6252253778873105`*^9, 
   3.6252255105773726`*^9}, {3.6252256060497355`*^9, 3.625225627822194*^9}, {
   3.6252257753110704`*^9, 3.6252257994741073`*^9}, {3.6252258754835525`*^9, 
   3.625225925858985*^9}, {3.625225965294157*^9, 3.625226024630537*^9}, 
   3.6252262701284685`*^9, {3.6252263006147013`*^9, 3.62522632917966*^9}, {
   3.6252264124219046`*^9, 3.625226453418113*^9}, {3.6252268112066483`*^9, 
   3.625226813460144*^9}, {3.625226863316232*^9, 3.6252269152216806`*^9}, {
   3.625226976589409*^9, 3.6252269999689255`*^9}, {3.625227034485833*^9, 
   3.625227084050728*^9}, {3.625227118916868*^9, 3.6252271723583355`*^9}, {
   3.625227202643436*^9, 3.625227380171256*^9}, {3.6252274921725893`*^9, 
   3.6252275139270267`*^9}, {3.6252280002838097`*^9, 3.625228035747345*^9}, {
   3.6252280712769265`*^9, 3.625228096524682*^9}, {3.6252282604824967`*^9, 
   3.6252282715978737`*^9}, 3.625228301725869*^9, {3.625228340612677*^9, 
   3.625228392339007*^9}, {3.6252284442704725`*^9, 3.625228515052449*^9}, 
   3.6252286143103237`*^9, {3.6252289303181696`*^9, 3.625228937377855*^9}, {
   3.625228993464077*^9, 3.625229098124537*^9}, {3.625229131852923*^9, 
   3.6252291503031683`*^9}, {3.6252292342332*^9, 3.625229274022607*^9}, {
   3.6252293115435095`*^9, 3.6252293342806*^9}, {3.625229384734084*^9, 
   3.62522946479622*^9}, {3.625229501146344*^9, 3.625229608442554*^9}, 
   3.625230700548358*^9, {3.62523116978878*^9, 3.62523117075142*^9}, {
   3.6252312022513247`*^9, 3.6252312213119745`*^9}, {3.625231325923403*^9, 
   3.6252313741233926`*^9}, {3.6252314241626024`*^9, 3.625231424802027*^9}, {
   3.625231479533351*^9, 3.62523149093892*^9}, {3.6252934707774324`*^9, 
   3.6252935806373425`*^9}, {3.6252936903982744`*^9, 3.625293738887455*^9}, 
   3.625293788274232*^9, {3.6252938282087345`*^9, 3.6252938302490897`*^9}, {
   3.6252938760815077`*^9, 3.625293896624141*^9}, {3.6252940470329638`*^9, 
   3.625294132312562*^9}, {3.625294221468732*^9, 3.6252942529536276`*^9}, {
   3.625299187233882*^9, 3.625299255483177*^9}, 3.6252996148717003`*^9, {
   3.6252996617818284`*^9, 3.6252996648358545`*^9}, {3.6252996948657846`*^9, 
   3.6252998052140207`*^9}, {3.625306151737014*^9, 3.625306158784691*^9}, {
   3.6253062773053503`*^9, 3.6253063245437026`*^9}, {3.6253064016768928`*^9, 
   3.625306422551747*^9}, {3.625306499510823*^9, 3.6253065140384645`*^9}, {
   3.6253065833924932`*^9, 3.6253067200842113`*^9}, {3.6253067854896193`*^9, 
   3.6253068008187933`*^9}, {3.6253069188541307`*^9, 3.625306959211915*^9}, {
   3.625307006063009*^9, 3.625307145222369*^9}, {3.625307181337335*^9, 
   3.6253072203332157`*^9}, {3.625307260956175*^9, 3.625307277602223*^9}, {
   3.625307322429974*^9, 3.6253073339926476`*^9}, {3.6253080943822994`*^9, 
   3.6253081350432854`*^9}, {3.6253081683073616`*^9, 3.62530820097104*^9}, {
   3.6253082545636077`*^9, 3.6253083424839582`*^9}, {3.625308446930277*^9, 
   3.6253084618391714`*^9}, {3.6253084990408616`*^9, 
   3.6253085281501803`*^9}, {3.6253085650176487`*^9, 3.62530858481779*^9}, {
   3.625308636357995*^9, 3.625308640151513*^9}, {3.6253086721537523`*^9, 
   3.625308716458156*^9}, {3.625308759467701*^9, 3.62530887957041*^9}, {
   3.6253090216416993`*^9, 3.6253090263288093`*^9}, {3.625309094304923*^9, 
   3.625309139477904*^9}, {3.625309201620146*^9, 3.6253095155104666`*^9}, {
   3.625309548134118*^9, 3.6253095854018517`*^9}, {3.6253096574606757`*^9, 
   3.6253097660577497`*^9}, {3.6253098630170984`*^9, 3.625309981437691*^9}, {
   3.6253104107145915`*^9, 3.6253104938787856`*^9}, {3.6253106171095705`*^9, 
   3.6253106224761324`*^9}, {3.6253106787404747`*^9, 
   3.6253107592208867`*^9}, {3.62531080712568*^9, 3.6253108940653796`*^9}, {
   3.6253126180333414`*^9, 3.6253126291527205`*^9}, {3.6253128388108654`*^9, 
   3.625312876932165*^9}, {3.625313020689575*^9, 3.6253130435977774`*^9}, {
   3.6253131725603676`*^9, 3.6253133804153147`*^9}, {3.6253135049659758`*^9, 
   3.6253135410389166`*^9}, {3.6253135959743757`*^9, 
   3.6253135969680357`*^9}, {3.6253136367164154`*^9, 
   3.6253137363595457`*^9}, {3.62531377370233*^9, 3.625313851559001*^9}, {
   3.62531396063139*^9, 3.625313980623658*^9}, {3.625314033741912*^9, 
   3.625314050844262*^9}, {3.625314170539702*^9, 3.6253142083858175`*^9}, {
   3.6253142595097485`*^9, 3.6253142982964907`*^9}, {3.6253143764543605`*^9, 
   3.6253145120493684`*^9}, {3.6253145993923197`*^9, 3.625314758244746*^9}, {
   3.625314794303677*^9, 3.6253148132602577`*^9}, {3.625314845696786*^9, 
   3.625314861606344*^9}, {3.625314894841402*^9, 3.625314987551932*^9}, {
   3.6253150648622403`*^9, 3.6253151170338655`*^9}, {3.625315208318449*^9, 
   3.6253152389517794`*^9}, {3.6253153826201286`*^9, 3.625315469431743*^9}, {
   3.625315521639392*^9, 3.6253157770098753`*^9}, {3.6253158731997137`*^9, 
   3.6253158842570524`*^9}, {3.625316277193835*^9, 3.6253163095102825`*^9}, {
   3.6253163671325245`*^9, 3.625316389383292*^9}, {3.625316674367082*^9, 
   3.6253166997749443`*^9}, {3.625316781461158*^9, 3.625316885114951*^9}, {
   3.625317246428745*^9, 3.6253173146910486`*^9}, {3.6253173674300504`*^9, 
   3.6253173719140263`*^9}, {3.6253174245079336`*^9, 3.625317451730999*^9}, {
   3.6253174843976793`*^9, 3.6253175610935802`*^9}, {3.625317595909687*^9, 
   3.625317615139449*^9}, {3.6253176675432286`*^9, 3.6253176995644803`*^9}, {
   3.625317736078713*^9, 3.625317829106454*^9}, {3.6253179992003407`*^9, 
   3.6253180113964357`*^9}, {3.625318186706785*^9, 3.6253182049629*^9}, {
   3.625318334796068*^9, 3.625318365091174*^9}, {3.6253184206860714`*^9, 
   3.6253184469264865`*^9}, {3.625318694346693*^9, 3.625318694867038*^9}, {
   3.62532455395868*^9, 3.625324660275241*^9}, {3.6253247023101377`*^9, 
   3.6253247631793623`*^9}, {3.6253249544893312`*^9, 
   3.6253249670786853`*^9}, {3.6253252770043745`*^9, 3.6253252774216523`*^9}, 
   3.625325550073282*^9, {3.625326054079874*^9, 3.625326072814307*^9}, {
   3.625326284280653*^9, 3.6253263200523944`*^9}, {3.6253280219547586`*^9, 
   3.6253280543112316`*^9}, {3.625556263874431*^9, 3.6255562911845565`*^9}, {
   3.625556339291484*^9, 3.6255563402581253`*^9}, {3.625556738426379*^9, 
   3.6255567634659977`*^9}, {3.6255568708172445`*^9, 3.625556901822822*^9}, {
   3.6255569379648085`*^9, 3.6255569472219524`*^9}, {3.6255571159079046`*^9, 
   3.6255571210973487`*^9}, {3.626496329078463*^9, 3.626496348269456*^9}, {
   3.626496379721356*^9, 3.626496415781577*^9}, {3.626496478532096*^9, 
   3.626496563759957*^9}, {3.626496600500637*^9, 3.6264966381368914`*^9}, {
   3.626496710018921*^9, 3.6264967140335884`*^9}, {3.6264968806980886`*^9, 
   3.6264968811453857`*^9}, 3.6273670020107174`*^9, {3.630969812033251*^9, 
   3.630969812084284*^9}, {3.636430411248167*^9, 3.636430464258616*^9}, {
   3.636430574297887*^9, 3.636430580833844*^9}, {3.636430638053337*^9, 
   3.636430649250955*^9}, {3.636430690650444*^9, 3.63643075182899*^9}, {
   3.6364309119462013`*^9, 3.6364311474783583`*^9}, 3.63643120509418*^9, 
   3.636431244291082*^9, {3.63643138828611*^9, 3.636431403158126*^9}, {
   3.636431437063333*^9, 3.636431441662833*^9}, {3.6364528790116587`*^9, 
   3.636452880559298*^9}, {3.6365152871021748`*^9, 3.6365153084871073`*^9}, 
   3.636515527303523*^9, {3.636515597953497*^9, 3.636515603840073*^9}, {
   3.636515678764413*^9, 3.636515697572631*^9}, {3.636515755241622*^9, 
   3.636515794547304*^9}, {3.636515839166169*^9, 3.636515858257346*^9}, {
   3.6365164752070713`*^9, 3.636516485243099*^9}, {3.636518361579351*^9, 
   3.6365184086158247`*^9}, {3.636518678454998*^9, 3.636518725484923*^9}, {
   3.636518861029854*^9, 3.6365188811744223`*^9}, 3.636518950846974*^9, {
   3.63652020080538*^9, 3.6365202332875633`*^9}, {3.636693107034112*^9, 
   3.636693127482608*^9}, {3.648691984359164*^9, 3.648691994086624*^9}, {
   3.64869203151248*^9, 3.648692050495085*^9}, {3.6486924632091703`*^9, 
   3.648692480578706*^9}, {3.6486925153127728`*^9, 3.6486925248971367`*^9}, 
   3.6489611139486513`*^9, {3.7214473263362513`*^9, 3.7214473318713017`*^9}, {
   3.721447444102982*^9, 3.7214474475664663`*^9}, {3.721447526540522*^9, 
   3.721447533841584*^9}, {3.721447603737103*^9, 3.721447609169169*^9}, {
   3.7214476854085703`*^9, 3.721447789177582*^9}, 3.721447829537491*^9, {
   3.7214479029146557`*^9, 3.7214479291942453`*^9}, {3.721447985801834*^9, 
   3.7214479996741734`*^9}, {3.721448091314249*^9, 3.721448105274411*^9}, {
   3.721448137947218*^9, 3.721448167720804*^9}, 3.721448200166924*^9, {
   3.721448269257345*^9, 3.7214484780493393`*^9}, 3.721448680651931*^9, {
   3.7214487365214987`*^9, 3.721448736810614*^9}, {3.721448777634062*^9, 
   3.7214487778906612`*^9}, {3.721449038869617*^9, 3.721449039008786*^9}, {
   3.721449535796804*^9, 3.721449536886242*^9}, {3.721449690813941*^9, 
   3.721449698316024*^9}, {3.721450320453661*^9, 3.721450325399003*^9}, {
   3.721450548985427*^9, 3.721450557025943*^9}, {3.721535355626676*^9, 
   3.721535362580887*^9}, {3.721535437106536*^9, 3.721535444066293*^9}, {
   3.721536344956002*^9, 3.721536469990004*^9}, {3.72153650509198*^9, 
   3.721536525840782*^9}, 3.72153695247892*^9, {3.721536982671049*^9, 
   3.7215369926771917`*^9}, {3.721537061982338*^9, 3.721537139126383*^9}, {
   3.7215372169497757`*^9, 3.7215372211583977`*^9}, {3.7215372586429377`*^9, 
   3.721537258862175*^9}, {3.721537312575194*^9, 3.721537314278328*^9}, {
   3.7215373800881453`*^9, 3.721537404961217*^9}, {3.721537561143448*^9, 
   3.721537567615698*^9}, {3.721538074010146*^9, 3.721538075745229*^9}, 
   3.721538221053665*^9, {3.721538293272788*^9, 3.721538301722578*^9}, {
   3.721538336610917*^9, 3.7215383730822363`*^9}, {3.7215384222664337`*^9, 
   3.721538431530609*^9}, {3.721538529348304*^9, 3.721538531014943*^9}, {
   3.721538653368702*^9, 3.7215386898700666`*^9}, {3.721538884371725*^9, 
   3.7215388896669407`*^9}, {3.721539017811357*^9, 3.7215390187796803`*^9}, {
   3.721539172907362*^9, 3.721539175080374*^9}, 3.7215392055559673`*^9, {
   3.721539240604484*^9, 3.721539240650786*^9}, {3.721539284900098*^9, 
   3.7215392867233047`*^9}, {3.721539387665976*^9, 3.7215393922513*^9}, {
   3.721539465827445*^9, 3.721539475307624*^9}, {3.7215395286194363`*^9, 
   3.721539531148964*^9}, {3.721539565107641*^9, 3.72153962031645*^9}, {
   3.721539668602569*^9, 3.721539724419104*^9}, {3.721539929472146*^9, 
   3.72153998550895*^9}, {3.721540027316372*^9, 3.721540035475153*^9}, {
   3.721540107479157*^9, 3.721540108028328*^9}, {3.721540149259766*^9, 
   3.721540182076437*^9}, {3.721540305053804*^9, 3.721540361991475*^9}, 
   3.721540409293315*^9, 3.721540451836176*^9, {3.721540698483708*^9, 
   3.721540719268879*^9}, {3.7215408301870604`*^9, 3.72154083164571*^9}, {
   3.721540915294046*^9, 3.721540948440506*^9}, {3.721541028961238*^9, 
   3.721541088680798*^9}, {3.72154112633816*^9, 3.7215411276477013`*^9}, {
   3.721541165081546*^9, 3.721541166209483*^9}, {3.7215413095622473`*^9, 
   3.72154136368285*^9}, {3.7215413975484953`*^9, 3.7215413986423893`*^9}, {
   3.721541432780566*^9, 3.721541459057889*^9}, {3.721541505105554*^9, 
   3.7215415085812197`*^9}, {3.721541596426148*^9, 3.721541597450316*^9}, 
   3.721541654606058*^9, {3.721541764411859*^9, 3.721541984260467*^9}, {
   3.7215420404133387`*^9, 3.721542046461207*^9}, {3.7215420959322042`*^9, 
   3.721542135093568*^9}, {3.721542172590725*^9, 3.72154221219762*^9}, {
   3.7215422620560102`*^9, 3.721542333556528*^9}, {3.721543857247108*^9, 
   3.7215439090931063`*^9}, {3.7215439439204597`*^9, 3.721544050853189*^9}, {
   3.721544114987495*^9, 3.72154411853834*^9}, {3.7215442830790453`*^9, 
   3.721544294407791*^9}, {3.721544328895501*^9, 3.721544329471312*^9}, {
   3.7215443772156267`*^9, 3.7215444692066307`*^9}, {3.721544553604619*^9, 
   3.7215445918386173`*^9}, {3.7215446440803537`*^9, 3.7215446566696243`*^9}, 
   3.721544710625917*^9, 3.721544899361423*^9, 3.721544947065699*^9, {
   3.7215450639055157`*^9, 3.7215450722497663`*^9}, {3.721545324278236*^9, 
   3.721545470159284*^9}, {3.721545530984136*^9, 3.721545655725999*^9}, {
   3.7215457152737217`*^9, 3.721545765940682*^9}, {3.7215459371976147`*^9, 
   3.721546003668597*^9}, {3.721546094990394*^9, 3.721546112636248*^9}, {
   3.721546198046873*^9, 3.7215462261152487`*^9}, {3.72154626840592*^9, 
   3.7215462950297728`*^9}, {3.721546328558613*^9, 3.721546378318513*^9}, {
   3.72154667746979*^9, 3.7215467166261883`*^9}, {3.7215467689504023`*^9, 
   3.721546772350131*^9}, {3.7215468370393887`*^9, 3.721546845931924*^9}, {
   3.721546918582851*^9, 3.7215469225669394`*^9}, {3.7215469760143147`*^9, 
   3.721546994059718*^9}, {3.7215471029767647`*^9, 3.721547150537036*^9}, {
   3.721547183443326*^9, 3.721547218725759*^9}, {3.721547390295579*^9, 
   3.721547391173326*^9}, {3.7215475150117817`*^9, 3.721547518931198*^9}, {
   3.7215476236998577`*^9, 3.7215476253945913`*^9}, {3.721547839525997*^9, 
   3.721547849050775*^9}, {3.721547913410977*^9, 3.721547916285412*^9}, {
   3.7215482841096907`*^9, 3.721548303964943*^9}, {3.721548348014762*^9, 
   3.721548369275957*^9}, {3.72154855702341*^9, 3.7215485571663723`*^9}, {
   3.721548966367491*^9, 3.72154906744058*^9}, {3.721549102218388*^9, 
   3.721549237879533*^9}, {3.7216830209094677`*^9, 3.721683040229981*^9}, {
   3.721715241218113*^9, 3.72171524140779*^9}, {3.7217154149381943`*^9, 
   3.7217154222373037`*^9}, {3.72171550931501*^9, 3.721715509872978*^9}, {
   3.721715629538952*^9, 3.721715632224145*^9}, {3.722227038877988*^9, 
   3.7222270608605433`*^9}, {3.7222271083651447`*^9, 3.722227122312729*^9}, 
   3.722585024785892*^9, 3.7232501221286907`*^9, {3.72774403813691*^9, 
   3.7277440456267147`*^9}, {3.727745600741912*^9, 3.7277456164784737`*^9}, {
   3.727745729717074*^9, 3.727745729722866*^9}, {3.7350020401458483`*^9, 
   3.735002057248728*^9}, {3.73500344394764*^9, 3.735003444580633*^9}, {
   3.768875161891717*^9, 3.76887523542865*^9}, {3.7688755669414797`*^9, 
   3.768875597561839*^9}, {3.768878491205201*^9, 3.768878511964604*^9}, {
   3.768962893314192*^9, 3.7689629202919807`*^9}},
 ExpressionUUID -> "fe66a983-1bae-4b50-8649-32f856415b7e"],

Cell[BoxData[{
 RowBox[{"todo", "[", 
  "\"\<VisBalancing: block simultaneus pressing buttons for nonzero Poincare \
rank singularities\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{"todo", "[", 
  "\"\<VisBalancing: for simple poles allow same-line pressing on left and \
right\>\"", "]"}]}], "Code",
 CellChangeTimes->{{3.721547272361312*^9, 3.72154735198608*^9}, {
  3.721548077461067*^9, 3.721548120165266*^9}},
 ExpressionUUID -> "2bc48f10-65fa-429a-92dc-c435008f89df"],

Cell[BoxData[
 RowBox[{
  RowBox[{"VisBalancing", "[", 
   RowBox[{
    RowBox[{"matr_", "?", "SquareMatrixQ"}], ",", "x_", ",", 
    RowBox[{"\[Epsilon]_:", "Indeterminate"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Basic", " ", 
      RowBox[{"idea", ":", " ", "first"}]}], ",", " ", 
     RowBox[{
     "find", " ", "JDecompositionData", " ", "for", " ", "all", " ", "points",
       " ", "of", " ", "the", " ", 
      RowBox[{"matrix", ".", "\[IndentingNewLine]", "Then"}], " ", 
      "construct", " ", "a", " ", "graphics", " ", "control"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"ttt", ",", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "matr"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"m", "=", "matr"}], ",", "\[IndentingNewLine]", "polesData", 
      ",", "\[IndentingNewLine]", "indices", ",", "indices1", ",", "index", 
      ",", "\[IndentingNewLine]", "prevu", ",", "prevv", ",", 
      "\[IndentingNewLine]", "psetu", ",", "psetv", ",", 
      "\[IndentingNewLine]", "psetu1", ",", "psetv1", ",", 
      "\[IndentingNewLine]", "clickedu", ",", "clickedv", ",", 
      "\[IndentingNewLine]", "clickedu1", ",", "clickedv1", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"buttons", "=", 
       RowBox[{"Grid", "[", 
        RowBox[{"{", 
         RowBox[{"{", "\"\<Wait\>\"", "}"}], "}"}], "]"}]}], ",", 
      "\[IndentingNewLine]", "len", ",", "\[IndentingNewLine]", "validate", 
      ",", "\[IndentingNewLine]", "us", ",", "vs", ",", "x1", ",", "x2", ",", 
      "\[IndentingNewLine]", "lu", ",", "lv", ",", "\[IndentingNewLine]", 
      "gram", ",", "goodBalance", ",", "colorMark", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"statusline", "=", "\"\<Ready\>\""}], ",", 
      "\[IndentingNewLine]", "apply", ",", "balance", ",", "\n", 
      "transformation", ",", "\[IndentingNewLine]", "updateInteface"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"transformation", "=", 
      RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Calculate", " ", "poles"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"polesData", "=", "\[IndentingNewLine]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"#1", ",", "#2", ",", 
               RowBox[{"{", "}"}], ",", 
               RowBox[{"{", "}"}], ",", 
               RowBox[{"JDecompositionData", "@", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"#1", "=!=", "\[Infinity]"}], ",", 
                  RowBox[{"SeriesCoefficient", "[", 
                   RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "-", "#2"}]}], "}"}]}], "]"}], ",", 
                  RowBox[{"-", 
                   RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{"1", "-", "#2"}]}], "}"}]}], "]"}]}]}], "]"}]}]}],
               "}"}], "&"}], "@@@", 
            RowBox[{"PolesInfo", "[", 
             RowBox[{"m", ",", "x"}], "]"}]}], ")"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"polesData", ":", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               SubscriptBox["x", "1"], ",", 
               SubscriptBox["r", "1"], ",", 
               SubscriptBox["JDecompositionData", "1"]}], "}"}], ",", 
             "\[Ellipsis]"}], "}"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Now", " ", "I", " ", "have", " ", "to", " ", "generate", " ", "a", 
           " ", "list", " ", "of", " ", "indices", " ", "of", " ", "the", " ",
            "form", " ", 
           RowBox[{"{", 
            RowBox[{"#pole", ",", "#JC", ",", "depth"}], "}"}], " ", "to", 
           " ", "access", " ", "to", " ", "any", " ", "vector"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"indices", "=", 
          RowBox[{"{", "}"}]}], ";", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"indices", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2", ",", "i3", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"i3", "==", "1"}], ",", "True", ",", "prevu"}], 
                "]"}], ",", 
               RowBox[{"prevu", "=", 
                RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}], ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"i3", "==", "1"}], ",", "True", ",", "prevv"}], 
                "]"}], ",", 
               RowBox[{"prevv", "=", 
                RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}]}], "}"}]}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "@", "polesData"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", 
             RowBox[{"Length", "@", 
              RowBox[{"polesData", "[", 
               RowBox[{"[", 
                RowBox[{"i1", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i3", ",", 
             RowBox[{"Length", "@", 
              RowBox[{"polesData", "[", 
               RowBox[{"[", 
                RowBox[{"i1", ",", 
                 RowBox[{"-", "1"}], ",", "i2", ",", 
                 RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"indices1", "=", 
          RowBox[{"{", "}"}]}], ";", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"indices1", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Unique", "[", "\"\<p\>\"", "]"}], ",", 
               RowBox[{"Unique", "[", "\"\<p\>\"", "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "@", "polesData"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"buttons", "=", 
          RowBox[{"Grid", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Grid", "[", 
                RowBox[{
                 RowBox[{"ArrayFlatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SplitBy", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", "#"}], 
                    "]"}], "&"}], "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", 
                    RowBox[{"-", "1"}], ",", "#2", ",", "1"}], "]"}], "]"}]}],
                     ",", 
                    RowBox[{"clickedu", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#4", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "#5", ",", "\"\<Pressed\>\"", ",", 
                    "\"\<DefaultButton\>\""}], "]"}], "]"}]}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "2"}], "]"}], "]"}], ">", "0"}], ",", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.4823529411764706`", ",", "0.6509803921568628`", ",", 
                    "0.8352941176470589`"}], "]"}], ",", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.`", ",", "0.7098039215686275`", ",", 
                    "0.7450980392156863`"}], "]"}]}], "]"}]}]}], "]"}], ",", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "&"}], "@@@", "indices"}], ",", "Last"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"len", "=", 
                    RowBox[{"Max", "[", 
                    RowBox[{"Length", "/@", "#"}], "]"}]}], ";", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PadRight", "[", 
                    RowBox[{"#", ",", "len", ",", "\"\<\>\""}], "]"}], "&"}], 
                    "/@", "#"}]}], ")"}], "&"}], "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "2"}], "]"}], "]"}], ">", "0"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Button", "[", 
                    RowBox[{"\"\<auto\>\"", ",", 
                    RowBox[{"clickedu1", "[", "#1", "]"}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.4823529411764706`", ",", "0.6509803921568628`", ",", 
                    "0.8352941176470589`"}], "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "#2", ",", "\"\<Pressed\>\"", ",", 
                    "\"\<DefaultButton\>\""}], "]"}], "]"}]}]}], "]"}], "}"}],
                     ",", 
                    RowBox[{"{", "}"}]}], "]"}], "&"}], "@@@", "indices1"}], 
                    "]"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#2", ">", "0"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"x", "\[Equal]", "#1"}], ",", "#2"}], "}"}], ",", 
                    "Red"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"x", "\[Equal]", "#1"}], ",", 
                    RowBox[{"#2", "-", "1"}]}], "}"}]}], "]"}], "}"}], "&"}], 
                    "@@@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "2"}], "]"}], "]"}], ">", "0"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Button", "[", 
                    RowBox[{"\"\<auto\>\"", ",", 
                    RowBox[{"clickedv1", "[", "#1", "]"}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.4823529411764706`", ",", "0.6509803921568628`", ",", 
                    "0.8352941176470589`"}], "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "#3", ",", "\"\<Pressed\>\"", ",", 
                    "\"\<DefaultButton\>\""}], "]"}], "]"}]}]}], "]"}], "}"}],
                     ",", 
                    RowBox[{"{", "\"\<\>\"", "}"}]}], "]"}], "&"}], "@@@", 
                    "indices1"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"SplitBy", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", "#"}], 
                    "]"}], "&"}], "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#", ",", 
                    RowBox[{"-", "1"}], ",", "#2", ",", "1"}], "]"}], "]"}]}],
                     ",", 
                    RowBox[{"clickedv", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#6", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "#7", ",", "\"\<Pressed\>\"", ",", 
                    "\"\<DefaultButton\>\""}], "]"}], "]"}]}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "2"}], "]"}], "]"}], ">", "0"}], ",", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.4823529411764706`", ",", "0.6509803921568628`", ",", 
                    "0.8352941176470589`"}], "]"}], ",", 
                    RowBox[{"RGBColor", "[", 
                    RowBox[{
                    "0.`", ",", "0.7098039215686275`", ",", 
                    "0.7450980392156863`"}], "]"}]}], "]"}]}]}], "]"}], ",", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], "}"}], 
                    "&"}], "@@@", "indices"}], ",", "Last"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}]}], 
                    "\[IndentingNewLine]", "}"}], "}"}], "]"}], ",", 
                 RowBox[{"Spacings", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"n", "+", "1"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"3", ",", "3"}], "}"}], ",", 
                    RowBox[{"ConstantArray", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"n", "+", "1"}]}], "]"}]}], "]"}], ",", "0"}], 
                   "}"}]}], ",", 
                 RowBox[{"ItemSize", "\[Rule]", "All"}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Apply balance transformation\>\"", ",", 
                 RowBox[{"apply", "[", "]"}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", "goodBalance", "]"}]}], ",", 
                 RowBox[{"Background", "\[Rule]", 
                  RowBox[{"Dynamic", "[", "colorMark", "]"}]}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Paste overall transformation\>\"", ",", 
                 RowBox[{"DialogReturn", "[", "transformation", "]"}]}], 
                "]"}], "\[IndentingNewLine]", "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Dynamic", "[", "statusline", "]"}], 
               "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}], 
            ",", 
            RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"psetu", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "5"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "a", " ", "function", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetv", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "7"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "a", " ", "function", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetu1", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices1", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "a", " ", "function", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetv1", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices1", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "a", " ", "function", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetu"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetv"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetu1"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetv1"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"apply", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"apply", " ", "transformation"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"balance", "=", 
          RowBox[{"Balance", "[", 
           RowBox[{
            RowBox[{"Projector", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", "us"}], ",", "vs"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "x1", ",", "x2"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", "\"\<balance constructed\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"m", "=", 
          RowBox[{"Transform", "[", 
           RowBox[{"m", ",", "balance", ",", "x"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", "\"\<transformation applied\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"transformation", "=", 
          RowBox[{"Factor", "[", 
           RowBox[{"transformation", ".", "balance"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
         "statusline", "=", "\"\<overall transformation calculated\>\""}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"PrintTemporary", "[", "statusline", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"updateInteface", "[", "]"}], ";"}], "\[IndentingNewLine]", 
        ")"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"validate", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "pick", " ", "right", " ", "and", " ", "left", " ", "vectors"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"us", "=", 
          RowBox[{"vs", "=", 
           RowBox[{"{", "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"#5", ",", 
               RowBox[{
                RowBox[{"AppendTo", "[", 
                 RowBox[{"us", ",", 
                  RowBox[{"polesData", "[", 
                   RowBox[{"[", 
                    RowBox[{"#1", ",", "5", ",", "#2", ",", "2", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}], ";", 
                RowBox[{"x1", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{"#7", ",", 
               RowBox[{
                RowBox[{"AppendTo", "[", 
                 RowBox[{"vs", ",", 
                  RowBox[{"polesData", "[", 
                   RowBox[{"[", 
                    RowBox[{"#1", ",", "5", ",", "#2", ",", "3", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}], ";", 
                RowBox[{"x2", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}]}], 
            ")"}], "&"}], "@@@", "indices"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"#2", ",", 
               RowBox[{
                RowBox[{"us", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "3"}], "]"}], "]"}]}], ";", 
                RowBox[{"x1", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{"#3", ",", 
               RowBox[{
                RowBox[{"vs", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "4"}], "]"}], "]"}]}], ";", 
                RowBox[{"x2", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}]}], 
            ")"}], "&"}], "@@@", "indices1"}], ";", "\[IndentingNewLine]", 
         RowBox[{"gram", "=", 
          RowBox[{"Factor", "@", 
           RowBox[{"Outer", "[", 
            RowBox[{"Dot", ",", "us", ",", "vs", ",", "1"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lu", "=", 
          RowBox[{"Length", "@", "us"}]}], ";", 
         RowBox[{"lv", "=", 
          RowBox[{"Length", "@", "vs"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"goodBalance", "=", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"lu", ">", "0"}], "&&", 
            RowBox[{"lu", "\[Equal]", "lv"}], "&&", 
            RowBox[{"lv", "\[Equal]", 
             RowBox[{"MatrixRank", "[", "gram", "]"}]}]}], ")"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"colorMark", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"lu", "\[Equal]", "0"}], "||", 
             RowBox[{"lv", "\[Equal]", "0"}], "||", 
             RowBox[{
              RowBox[{"MatrixRank", "[", "gram", "]"}], "\[Equal]", "lu"}]}], 
            ",", 
            RowBox[{"If", "[", 
             RowBox[{"goodBalance", ",", "Green", ",", "Automatic"}], "]"}], 
            ",", "Red"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", 
          RowBox[{
           RowBox[{"ToString", "[", "lu", "]"}], "<>", 
           "\"\<-dimensional u-space and \>\"", "<>", 
           RowBox[{"ToString", "[", "lv", "]"}], "<>", 
           "\"\<-dimensional v-space\>\""}]}]}], "\[IndentingNewLine]", ")"}],
        "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"clickedu", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"if", " ", "pressed"}], ",", " ", 
          RowBox[{"unpress", " ", "and", " ", "vice", " ", "versa"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "5"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetu", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#1", ",", "#2", ",", "k_", ",", "__"}], "}"}], "/;", 
                RowBox[{"k", "\[GreaterEqual]", " ", "#3"}]}], ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetu1"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv1", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices1", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetu", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedv", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"if", " ", "pressed"}], ",", " ", 
          RowBox[{"unpress", " ", "and", " ", "vice", " ", "versa"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "7"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetv", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"#1", ",", "#2", ",", "k_", ",", "__"}], "}"}], "/;", 
                RowBox[{"k", "\[GreaterEqual]", " ", "#3"}]}], ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "False", "]"}], "&"}], "/@", "psetv1"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu1", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices1", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetv", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedu1", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "argument", " ", "is", " ", "just", " ", "the", " ", "#", " ", "of", 
          " ", "the", " ", "pole"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices1", "[", 
            RowBox[{"[", 
             RowBox[{"#", ",", "2"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"psetu1", "[", 
             RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Clear", " ", "all", " ", "auto", " ", "and", " ", "buttons", " ",
              "on", " ", "the", " ", "same", " ", "side"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Join", "[", 
              RowBox[{"psetu", ",", "psetu1"}], 
              RowBox[{"(*", 
               RowBox[{",", "psetv1"}], "*)"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetu1", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "[", "True", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"calculation", " ", "of", " ", "the", " ", "space"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"polesData", "[", 
                RowBox[{"[", 
                 RowBox[{"#1", ",", "3"}], "]"}], "]"}], "===", 
               RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Calculate", " ", "PRLoweringSpace"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"polesData", "[", 
                RowBox[{"[", 
                 RowBox[{"#1", ",", "3"}], "]"}], "]"}], "=", 
               RowBox[{"Transpose", "[", 
                RowBox[{
                 RowBox[{"A0A1ToSubspaces", "[", 
                  RowBox[{
                   RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "1"}], "]"}], "]"}], ",", "1"}], 
                    "}"}]}], "]"}], "]"}], ",", "Left"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedv1", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices1", "[", 
            RowBox[{"[", 
             RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"psetv1", "[", 
             RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Clear", " ", "all", " ", "auto", " ", "and", " ", "buttons", " ",
              "on", " ", "the", " ", "same", " ", "side"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Join", "[", 
              RowBox[{"psetv", ",", 
               RowBox[{"(*", 
                RowBox[{"psetu1", ","}], "*)"}], "psetv1"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetv1", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "[", "True", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"polesData", "[", 
                RowBox[{"[", 
                 RowBox[{"#1", ",", "4"}], "]"}], "]"}], "===", 
               RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Calculate", " ", "PRLoweringSpace"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"polesData", "[", 
                RowBox[{"[", 
                 RowBox[{"#1", ",", "4"}], "]"}], "]"}], "=", 
               RowBox[{
                RowBox[{"A0A1ToSubspaces", "[", 
                 RowBox[{
                  RowBox[{"Factor", "[", 
                   RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "1"}], "]"}], "]"}], ",", "1"}], 
                    "}"}]}], "]"}], "]"}], ",", "Right"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "[", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"DialogInput", "[", 
      RowBox[{"Dynamic", "[", 
       RowBox[{"Refresh", "[", 
        RowBox[{"buttons", ",", 
         RowBox[{"UpdateInterval", "\[Rule]", "1"}]}], "]"}], "]"}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellOpen->False,
 CellChangeTimes->{{3.6252099434388247`*^9, 3.6252099509508104`*^9}, {
   3.625220907567676*^9, 3.6252209930734243`*^9}, {3.6252211176701155`*^9, 
   3.6252211442437525`*^9}, {3.625221186024481*^9, 3.6252211868770466`*^9}, {
   3.625221235065028*^9, 3.6252212752547007`*^9}, {3.6252213230544243`*^9, 
   3.6252213777217054`*^9}, {3.6252214205771475`*^9, 
   3.6252215590490484`*^9}, {3.6252217588196306`*^9, 3.625221914712093*^9}, {
   3.625221948184307*^9, 3.6252219816014853`*^9}, {3.625222521642317*^9, 
   3.6252225383263893`*^9}, {3.625222588967373*^9, 3.625222681946081*^9}, {
   3.625222714992013*^9, 3.6252227332321177`*^9}, {3.625222794481768*^9, 
   3.625222839315524*^9}, {3.625222907477761*^9, 3.6252230926606617`*^9}, {
   3.625223184295478*^9, 3.6252232197309957`*^9}, {3.6252232817971883`*^9, 
   3.6252232854566154`*^9}, 3.62522337378924*^9, {3.6252234629324017`*^9, 
   3.6252235577103033`*^9}, {3.62522359706042*^9, 3.6252236712926855`*^9}, {
   3.6252238237958984`*^9, 3.6252239950405483`*^9}, {3.6252241893855305`*^9, 
   3.6252243402056265`*^9}, {3.6252243728763094`*^9, 
   3.6252244042451277`*^9}, {3.6252244471676135`*^9, 
   3.6252246106180935`*^9}, {3.6252246520325785`*^9, 
   3.6252246536036205`*^9}, {3.625224743458256*^9, 3.6252249275534353`*^9}, {
   3.625225008354061*^9, 3.625225072903901*^9}, {3.625225128443761*^9, 
   3.625225168139106*^9}, {3.6252252546995525`*^9, 3.625225256077468*^9}, {
   3.625225301260455*^9, 3.6252253022741275`*^9}, {3.6252253778873105`*^9, 
   3.6252255105773726`*^9}, {3.6252256060497355`*^9, 3.625225627822194*^9}, {
   3.6252257753110704`*^9, 3.6252257994741073`*^9}, {3.6252258754835525`*^9, 
   3.625225925858985*^9}, {3.625225965294157*^9, 3.625226024630537*^9}, 
   3.6252262701284685`*^9, {3.6252263006147013`*^9, 3.62522632917966*^9}, {
   3.6252264124219046`*^9, 3.625226453418113*^9}, {3.6252268112066483`*^9, 
   3.625226813460144*^9}, {3.625226863316232*^9, 3.6252269152216806`*^9}, {
   3.625226976589409*^9, 3.6252269999689255`*^9}, {3.625227034485833*^9, 
   3.625227084050728*^9}, {3.625227118916868*^9, 3.6252271723583355`*^9}, {
   3.625227202643436*^9, 3.625227380171256*^9}, {3.6252274921725893`*^9, 
   3.6252275139270267`*^9}, {3.6252280002838097`*^9, 3.625228035747345*^9}, {
   3.6252280712769265`*^9, 3.625228096524682*^9}, {3.6252282604824967`*^9, 
   3.6252282715978737`*^9}, 3.625228301725869*^9, {3.625228340612677*^9, 
   3.625228392339007*^9}, {3.6252284442704725`*^9, 3.625228515052449*^9}, 
   3.6252286143103237`*^9, {3.6252289303181696`*^9, 3.625228937377855*^9}, {
   3.625228993464077*^9, 3.625229098124537*^9}, {3.625229131852923*^9, 
   3.6252291503031683`*^9}, {3.6252292342332*^9, 3.625229274022607*^9}, {
   3.6252293115435095`*^9, 3.6252293342806*^9}, {3.625229384734084*^9, 
   3.62522946479622*^9}, {3.625229501146344*^9, 3.625229608442554*^9}, 
   3.625230700548358*^9, {3.62523116978878*^9, 3.62523117075142*^9}, {
   3.6252312022513247`*^9, 3.6252312213119745`*^9}, {3.625231325923403*^9, 
   3.6252313741233926`*^9}, {3.6252314241626024`*^9, 3.625231424802027*^9}, {
   3.625231479533351*^9, 3.62523149093892*^9}, {3.6252934707774324`*^9, 
   3.6252935806373425`*^9}, {3.6252936903982744`*^9, 3.625293738887455*^9}, 
   3.625293788274232*^9, {3.6252938282087345`*^9, 3.6252938302490897`*^9}, {
   3.6252938760815077`*^9, 3.625293896624141*^9}, {3.6252940470329638`*^9, 
   3.625294132312562*^9}, {3.625294221468732*^9, 3.6252942529536276`*^9}, {
   3.625299187233882*^9, 3.625299255483177*^9}, 3.6252996148717003`*^9, {
   3.6252996617818284`*^9, 3.6252996648358545`*^9}, {3.6252996948657846`*^9, 
   3.6252998052140207`*^9}, {3.625306151737014*^9, 3.625306158784691*^9}, {
   3.6253062773053503`*^9, 3.6253063245437026`*^9}, {3.6253064016768928`*^9, 
   3.625306422551747*^9}, {3.625306499510823*^9, 3.6253065140384645`*^9}, {
   3.6253065833924932`*^9, 3.6253067200842113`*^9}, {3.6253067854896193`*^9, 
   3.6253068008187933`*^9}, {3.6253069188541307`*^9, 3.625306959211915*^9}, {
   3.625307006063009*^9, 3.625307145222369*^9}, {3.625307181337335*^9, 
   3.6253072203332157`*^9}, {3.625307260956175*^9, 3.625307277602223*^9}, {
   3.625307322429974*^9, 3.6253073339926476`*^9}, {3.6253080943822994`*^9, 
   3.6253081350432854`*^9}, {3.6253081683073616`*^9, 3.62530820097104*^9}, {
   3.6253082545636077`*^9, 3.6253083424839582`*^9}, {3.625308446930277*^9, 
   3.6253084618391714`*^9}, {3.6253084990408616`*^9, 
   3.6253085281501803`*^9}, {3.6253085650176487`*^9, 3.62530858481779*^9}, {
   3.625308636357995*^9, 3.625308640151513*^9}, {3.6253086721537523`*^9, 
   3.625308716458156*^9}, {3.625308759467701*^9, 3.62530887957041*^9}, {
   3.6253090216416993`*^9, 3.6253090263288093`*^9}, {3.625309094304923*^9, 
   3.625309139477904*^9}, {3.625309201620146*^9, 3.6253095155104666`*^9}, {
   3.625309548134118*^9, 3.6253095854018517`*^9}, {3.6253096574606757`*^9, 
   3.6253097660577497`*^9}, {3.6253098630170984`*^9, 3.625309981437691*^9}, {
   3.6253104107145915`*^9, 3.6253104938787856`*^9}, {3.6253106171095705`*^9, 
   3.6253106224761324`*^9}, {3.6253106787404747`*^9, 
   3.6253107592208867`*^9}, {3.62531080712568*^9, 3.6253108940653796`*^9}, {
   3.6253126180333414`*^9, 3.6253126291527205`*^9}, {3.6253128388108654`*^9, 
   3.625312876932165*^9}, {3.625313020689575*^9, 3.6253130435977774`*^9}, {
   3.6253131725603676`*^9, 3.6253133804153147`*^9}, {3.6253135049659758`*^9, 
   3.6253135410389166`*^9}, {3.6253135959743757`*^9, 
   3.6253135969680357`*^9}, {3.6253136367164154`*^9, 
   3.6253137363595457`*^9}, {3.62531377370233*^9, 3.625313851559001*^9}, {
   3.62531396063139*^9, 3.625313980623658*^9}, {3.625314033741912*^9, 
   3.625314050844262*^9}, {3.625314170539702*^9, 3.6253142083858175`*^9}, {
   3.6253142595097485`*^9, 3.6253142982964907`*^9}, {3.6253143764543605`*^9, 
   3.6253145120493684`*^9}, {3.6253145993923197`*^9, 3.625314758244746*^9}, {
   3.625314794303677*^9, 3.6253148132602577`*^9}, {3.625314845696786*^9, 
   3.625314861606344*^9}, {3.625314894841402*^9, 3.625314987551932*^9}, {
   3.6253150648622403`*^9, 3.6253151170338655`*^9}, {3.625315208318449*^9, 
   3.6253152389517794`*^9}, {3.6253153826201286`*^9, 3.625315469431743*^9}, {
   3.625315521639392*^9, 3.6253157770098753`*^9}, {3.6253158731997137`*^9, 
   3.6253158842570524`*^9}, {3.625316277193835*^9, 3.6253163095102825`*^9}, {
   3.6253163671325245`*^9, 3.625316389383292*^9}, {3.625316674367082*^9, 
   3.6253166997749443`*^9}, {3.625316781461158*^9, 3.625316885114951*^9}, {
   3.625317246428745*^9, 3.6253173146910486`*^9}, {3.6253173674300504`*^9, 
   3.6253173719140263`*^9}, {3.6253174245079336`*^9, 3.625317451730999*^9}, {
   3.6253174843976793`*^9, 3.6253175610935802`*^9}, {3.625317595909687*^9, 
   3.625317615139449*^9}, {3.6253176675432286`*^9, 3.6253176995644803`*^9}, {
   3.625317736078713*^9, 3.625317829106454*^9}, {3.6253179992003407`*^9, 
   3.6253180113964357`*^9}, {3.625318186706785*^9, 3.6253182049629*^9}, {
   3.625318334796068*^9, 3.625318365091174*^9}, {3.6253184206860714`*^9, 
   3.6253184469264865`*^9}, {3.625318694346693*^9, 3.625318694867038*^9}, {
   3.62532455395868*^9, 3.625324660275241*^9}, {3.6253247023101377`*^9, 
   3.6253247631793623`*^9}, {3.6253249544893312`*^9, 
   3.6253249670786853`*^9}, {3.6253252770043745`*^9, 3.6253252774216523`*^9}, 
   3.625325550073282*^9, {3.625326054079874*^9, 3.625326072814307*^9}, {
   3.625326284280653*^9, 3.6253263200523944`*^9}, {3.6253280219547586`*^9, 
   3.6253280543112316`*^9}, {3.625556263874431*^9, 3.6255562911845565`*^9}, {
   3.625556339291484*^9, 3.6255563402581253`*^9}, {3.625556738426379*^9, 
   3.6255567634659977`*^9}, {3.6255568708172445`*^9, 3.625556901822822*^9}, {
   3.6255569379648085`*^9, 3.6255569472219524`*^9}, {3.6255571159079046`*^9, 
   3.6255571210973487`*^9}, {3.626496329078463*^9, 3.626496348269456*^9}, {
   3.626496379721356*^9, 3.626496415781577*^9}, {3.626496478532096*^9, 
   3.626496563759957*^9}, {3.626496600500637*^9, 3.6264966381368914`*^9}, {
   3.626496710018921*^9, 3.6264967140335884`*^9}, {3.6264968806980886`*^9, 
   3.6264968811453857`*^9}, 3.6273670020107174`*^9, {3.630969812033251*^9, 
   3.630969812084284*^9}, {3.636430411248167*^9, 3.636430464258616*^9}, {
   3.636430574297887*^9, 3.636430580833844*^9}, {3.636430638053337*^9, 
   3.636430649250955*^9}, {3.636430690650444*^9, 3.63643075182899*^9}, {
   3.6364309119462013`*^9, 3.6364311474783583`*^9}, 3.63643120509418*^9, 
   3.636431244291082*^9, {3.63643138828611*^9, 3.636431403158126*^9}, {
   3.636431437063333*^9, 3.636431441662833*^9}, {3.6364528790116587`*^9, 
   3.636452880559298*^9}, {3.6365152871021748`*^9, 3.6365153084871073`*^9}, 
   3.636515527303523*^9, {3.636515597953497*^9, 3.636515603840073*^9}, {
   3.636515678764413*^9, 3.636515697572631*^9}, {3.636515755241622*^9, 
   3.636515794547304*^9}, {3.636515839166169*^9, 3.636515858257346*^9}, {
   3.6365164752070713`*^9, 3.636516485243099*^9}, {3.636518361579351*^9, 
   3.6365184086158247`*^9}, {3.636518678454998*^9, 3.636518725484923*^9}, {
   3.636518861029854*^9, 3.6365188811744223`*^9}, 3.636518950846974*^9, {
   3.63652020080538*^9, 3.6365202332875633`*^9}, {3.636693107034112*^9, 
   3.636693127482608*^9}, {3.648691984359164*^9, 3.648691994086624*^9}, {
   3.64869203151248*^9, 3.648692050495085*^9}, {3.6486924632091703`*^9, 
   3.648692480578706*^9}, {3.6486925153127728`*^9, 3.6486925248971367`*^9}, 
   3.6489611139486513`*^9, {3.7214473263362513`*^9, 3.7214473318713017`*^9}, {
   3.721447444102982*^9, 3.7214474475664663`*^9}, {3.721447526540522*^9, 
   3.721447533841584*^9}, {3.721447603737103*^9, 3.721447609169169*^9}, {
   3.7214476854085703`*^9, 3.721447789177582*^9}, 3.721447829537491*^9, {
   3.7214479029146557`*^9, 3.7214479291942453`*^9}, {3.721447985801834*^9, 
   3.7214479996741734`*^9}, {3.721448091314249*^9, 3.721448105274411*^9}, {
   3.721448137947218*^9, 3.721448167720804*^9}, 3.721448200166924*^9, {
   3.721448269257345*^9, 3.7214484780493393`*^9}, 3.721448680651931*^9, {
   3.7214487365214987`*^9, 3.721448736810614*^9}, {3.721448777634062*^9, 
   3.7214487778906612`*^9}, {3.721449038869617*^9, 3.721449039008786*^9}, {
   3.721449535796804*^9, 3.721449536886242*^9}, {3.721449690813941*^9, 
   3.721449698316024*^9}, {3.721450320453661*^9, 3.721450325399003*^9}, {
   3.721450548985427*^9, 3.721450557025943*^9}, {3.721535355626676*^9, 
   3.721535362580887*^9}, {3.721535437106536*^9, 3.721535444066293*^9}, {
   3.721536344956002*^9, 3.721536469990004*^9}, {3.72153650509198*^9, 
   3.721536525840782*^9}},
 ExpressionUUID -> "380084b9-7842-43a2-bff3-e137e40be67d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VisTransformation", "Subsubsection",
 CellChangeTimes->{3.768896874752527*^9},
 ExpressionUUID -> "6cbaee4c-4b88-4c1f-b3c6-1216456614fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VisTransformation", "::", "usage"}], "=", 
   "\"\<VisTransformation[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] is a visual tool for finding transformation. Soon \
to replace VisBalancing.\>\""}], ";"}]], "Code",
 CellChangeTimes->{
  3.7215495819491863`*^9, {3.768896911024886*^9, 3.76889693363885*^9}, {
   3.768897086575362*^9, 3.768897097663113*^9}},
 ExpressionUUID -> "2856126d-2ce3-4252-8694-2e441b50b8a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"VisTransformation", "[", 
   RowBox[{"ds_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "poles_"}], "}"}], ",", 
    RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"VisTransformation", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", "poles", 
    ",", "opts"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.72325007829632*^9, 3.723250117018811*^9}, {
   3.7232502260687037`*^9, 3.723250239580832*^9}, 3.7688969391051693`*^9, 
   3.768951202899088*^9, {3.768958303671468*^9, 3.768958322164116*^9}},
 ExpressionUUID -> "9cb66f01-71a1-45a5-a4bd-2b901629fd51"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VisTransformation", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol", ",", 
     RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
     RowBox[{"poles", ":", 
      RowBox[{"All", "|", 
       RowBox[{"{", "__", "}"}]}], ":", "All"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"VisTransformation", "[", 
    RowBox[{
     RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", "poles",
      ",", "opts"}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721450868372929*^9, 3.721450892181036*^9}, {
   3.7215493507928534`*^9, 3.721549354953006*^9}, {3.72154947147303*^9, 
   3.721549472952837*^9}, {3.721715237722169*^9, 3.721715237890087*^9}, 
   3.7232501202352877`*^9, 3.7688969403749943`*^9, 3.7689512040393877`*^9, {
   3.7689583308780813`*^9, 3.7689583432720747`*^9}},
 ExpressionUUID -> "9abcafe9-2a59-4007-91c6-1886a8a903ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VisTransformation", "[", 
    RowBox[{"as_Association", ",", "x_Symbol", ",", 
     RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
     RowBox[{"poles", ":", 
      RowBox[{"All", "|", 
       RowBox[{"{", "__", "}"}]}], ":", "All"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"VisTransformation", "[", 
    RowBox[{
     RowBox[{"as", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", "poles",
      ",", "opts"}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721450868372929*^9, 3.721450892181036*^9}, {
   3.7215493507928534`*^9, 3.721549354953006*^9}, {3.72154947147303*^9, 
   3.721549472952837*^9}, {3.721715237722169*^9, 3.721715237890087*^9}, 
   3.7232501202352877`*^9, {3.7232501516126213`*^9, 3.723250163164311*^9}, 
   3.768896941879245*^9, 3.768951206088657*^9, {3.768958350690268*^9, 
   3.768958356600341*^9}},
 ExpressionUUID -> "056381ea-62ec-4459-b7c6-6b27eaf7f76d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "VisTransformation", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"UseFermat", "\[Rule]", "False"}], ",", 
     RowBox[{"Log", "\[Rule]", "False"}], ",", 
     RowBox[{"Debug", "\[Rule]", "False"}], ",", 
     RowBox[{"Highlighted", "\[Rule]", "False"}], ",", 
     RowBox[{"Animate", "\[Rule]", "False"}], ",", 
     RowBox[{"AnimationRate", "\[Rule]", "5"}]}], "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.768883673229196*^9, 3.7688836833206387`*^9}, {
   3.7688837398431396`*^9, 3.768883761585402*^9}, 3.76888384553612*^9, {
   3.768883959448791*^9, 3.76888396790588*^9}, 3.768884265122773*^9, {
   3.768884394698118*^9, 3.7688843957404222`*^9}, {3.768884437885153*^9, 
   3.7688844406564283`*^9}, {3.768884603550152*^9, 3.7688846048273363`*^9}, {
   3.768884686230318*^9, 3.768884697363865*^9}, {3.768884805735989*^9, 
   3.768884849729986*^9}, {3.768885261952456*^9, 3.768885268272355*^9}, {
   3.768887286877696*^9, 3.768887353656507*^9}, 3.7688873897744083`*^9, 
   3.7688874326169577`*^9, {3.768887479626685*^9, 3.768887492091527*^9}, {
   3.7688876475953693`*^9, 3.768887655619399*^9}, {3.768887776168305*^9, 
   3.76888778134969*^9}, 3.768887829461048*^9, {3.768887892776437*^9, 
   3.768887966705843*^9}, {3.768888018252489*^9, 3.7688880730673523`*^9}, {
   3.768888150290524*^9, 3.7688881593881693`*^9}, {3.7688882760611877`*^9, 
   3.768888313332767*^9}, {3.768888369712187*^9, 3.768888404607811*^9}, {
   3.768888451659333*^9, 3.7688884872903337`*^9}, {3.7688885260013437`*^9, 
   3.768888538799514*^9}, {3.7688885797289953`*^9, 3.768888610614152*^9}, {
   3.768888669642646*^9, 3.7688886970393*^9}, {3.768890888669334*^9, 
   3.768890890538596*^9}, {3.7688910104845047`*^9, 3.768891031946739*^9}, {
   3.768891210887643*^9, 3.76889121992635*^9}, 3.768891542250896*^9, {
   3.768891876625001*^9, 3.768891876642634*^9}, {3.7688919147181*^9, 
   3.768891918910204*^9}, {3.768892121712277*^9, 3.768892127127733*^9}, {
   3.768892169080371*^9, 3.768892303912305*^9}, {3.768892454906122*^9, 
   3.768892464577695*^9}, {3.768892645793434*^9, 3.768892662715845*^9}, {
   3.768892755428076*^9, 3.768892755618445*^9}, {3.768892981259873*^9, 
   3.768892988592821*^9}, {3.768893077661159*^9, 3.768893152839888*^9}, {
   3.768893269694521*^9, 3.76889333518358*^9}, {3.7688934671752377`*^9, 
   3.7688934995138807`*^9}, {3.768893562135682*^9, 3.768893568885934*^9}, {
   3.768893948250082*^9, 3.7688939490977697`*^9}, 3.768894237919043*^9, {
   3.7688942695031013`*^9, 3.768894337222807*^9}, {3.768894525524055*^9, 
   3.76889453612249*^9}, 3.7688945706535797`*^9, {3.768894705942731*^9, 
   3.768894759352044*^9}, {3.7688950014400673`*^9, 3.768895015879937*^9}, {
   3.7688950534973593`*^9, 3.768895076726639*^9}, {3.7688951282365503`*^9, 
   3.768895128521174*^9}, {3.768895165175178*^9, 3.768895170283161*^9}, 
   3.768895212569784*^9, {3.768895253850604*^9, 3.7688952666650267`*^9}, 
   3.768895318928771*^9, {3.768895462969563*^9, 3.768895475586203*^9}, 
   3.768895639075342*^9, {3.768895784098667*^9, 3.768895828040162*^9}, 
   3.768896952328436*^9, {3.7689584096196613`*^9, 3.768958414801444*^9}, {
   3.7689609419523363`*^9, 3.768961041338532*^9}, {3.768961081515246*^9, 
   3.76896110434761*^9}, 3.768961136554397*^9, {3.769028906275814*^9, 
   3.7690289381086197`*^9}, {3.7690297613937387`*^9, 3.769029765929029*^9}, {
   3.769029942728528*^9, 3.7690300044885883`*^9}, {3.769030110536378*^9, 
   3.769030118300109*^9}, {3.769030237624324*^9, 3.769030248120461*^9}, {
   3.7690319749925756`*^9, 3.769032032801787*^9}, {3.769032145453845*^9, 
   3.76903215499476*^9}, {3.769032241982126*^9, 3.769032256944352*^9}, {
   3.769032343583706*^9, 3.769032401041994*^9}, {3.769032525826779*^9, 
   3.769032527001409*^9}, {3.769032714484827*^9, 3.769032774472619*^9}, {
   3.769032811755013*^9, 3.7690328174949102`*^9}, 3.7690328799963417`*^9, {
   3.769033149694045*^9, 3.769033154631096*^9}, {3.769133555954192*^9, 
   3.769133564529211*^9}, {3.769133764772559*^9, 3.769133769746258*^9}, {
   3.769133881367518*^9, 3.769133941674693*^9}, {3.76913397429084*^9, 
   3.769134058519753*^9}, {3.769828331143759*^9, 3.769828361383753*^9}, 
   3.7698285916083517`*^9, {3.7698288932490377`*^9, 3.76982891328189*^9}, {
   3.769831196708028*^9, 3.769831234007399*^9}, {3.7698336938430243`*^9, 
   3.769833695562459*^9}, 3.769834504720085*^9, 3.770591898042718*^9, {
   3.7706032446081142`*^9, 3.770603244975358*^9}, {3.7707853048820467`*^9, 
   3.7707853106916447`*^9}, {3.770785605820609*^9, 3.770785609127146*^9}, {
   3.770785643412841*^9, 3.770785645239699*^9}, 3.770785772749764*^9, {
   3.7707858288448763`*^9, 3.770785858185885*^9}, 3.7707859419913263`*^9, {
   3.770786117348982*^9, 3.770786150514689*^9}, 3.770786334825778*^9, {
   3.770786490893505*^9, 3.770786491676331*^9}, {3.770787073346355*^9, 
   3.770787092755692*^9}, {3.770787160448743*^9, 3.770787161575263*^9}, {
   3.770787246967805*^9, 3.770787247413678*^9}, {3.770787369575439*^9, 
   3.770787374806806*^9}, {3.770787521250387*^9, 3.770787522694347*^9}, {
   3.770787674125286*^9, 3.7707876960151453`*^9}, {3.770787741781776*^9, 
   3.7707877508541927`*^9}, {3.770787809447112*^9, 3.770787809896057*^9}, {
   3.770787946854123*^9, 3.770787963804669*^9}, {3.7707880170128098`*^9, 
   3.7707880249023933`*^9}, {3.770788154217849*^9, 3.770788228585779*^9}, 
   3.77078828997512*^9, {3.7707883224004602`*^9, 3.7707883581609983`*^9}, {
   3.7707889588260393`*^9, 3.770789015129057*^9}, {3.7707890675744867`*^9, 
   3.770789079710801*^9}, {3.770789117107399*^9, 3.770789134365237*^9}, {
   3.770789165230074*^9, 3.7707891689912167`*^9}, {3.770789263697166*^9, 
   3.7707893582643347`*^9}, {3.770789550786521*^9, 3.770789566858273*^9}, {
   3.770789734574334*^9, 3.770789769867923*^9}, {3.7707899425721617`*^9, 
   3.7707899797085133`*^9}, {3.770790011865275*^9, 3.770790035085514*^9}, {
   3.77079006591656*^9, 3.770790151452856*^9}, {3.7707901836479473`*^9, 
   3.770790316792583*^9}, {3.7707903594025784`*^9, 3.7707903687355833`*^9}, {
   3.77079045348503*^9, 3.770790462486796*^9}, {3.770791239650359*^9, 
   3.7707912775431013`*^9}, {3.7707913145074253`*^9, 
   3.7707913897860203`*^9}, {3.770791438649184*^9, 3.7707914391092243`*^9}, {
   3.770791487823125*^9, 3.77079159899341*^9}, {3.770791660171587*^9, 
   3.7707916751101627`*^9}, {3.7707917860137997`*^9, 3.770791801326344*^9}, {
   3.770791859645583*^9, 3.7707919110162487`*^9}, {3.770791964692897*^9, 
   3.770792012758411*^9}, {3.7707920537465754`*^9, 3.770792064098494*^9}, {
   3.770792095106545*^9, 3.7707920995295887`*^9}, {3.770792130008017*^9, 
   3.770792359015182*^9}, {3.770792404513569*^9, 3.770792408241948*^9}, {
   3.770792524234542*^9, 3.7707925496030397`*^9}, {3.7707926169299717`*^9, 
   3.7707928001303*^9}, {3.770792831600987*^9, 3.770792831705861*^9}, {
   3.770792877102272*^9, 3.770792896156798*^9}, 3.770792929382119*^9, {
   3.770792977989743*^9, 3.770793010570661*^9}, {3.770793093320986*^9, 
   3.770793165104521*^9}, {3.770793207267508*^9, 3.7707932523922367`*^9}, {
   3.770793289031611*^9, 3.7707934111891947`*^9}, {3.770793542625557*^9, 
   3.770793543673018*^9}, {3.770793616060204*^9, 3.7707936821891813`*^9}, {
   3.7707938028674307`*^9, 3.7707938434740334`*^9}, {3.7707939154382963`*^9, 
   3.770793934279809*^9}, {3.7707940231934023`*^9, 3.770794046539659*^9}, {
   3.7707943043356237`*^9, 3.770794308143011*^9}, {3.770794475424499*^9, 
   3.7707945177432327`*^9}, {3.7707946387285624`*^9, 3.770794782824548*^9}, {
   3.770794817789222*^9, 3.770795009099537*^9}, {3.770795100330513*^9, 
   3.77079517836644*^9}, {3.770795218773715*^9, 3.7707952888160067`*^9}, {
   3.7707953200552187`*^9, 3.7707954178463717`*^9}, {3.770795817410697*^9, 
   3.770795839571066*^9}, {3.770796025354205*^9, 3.77079604034*^9}, {
   3.770796109459984*^9, 3.770796192572958*^9}, {3.7707962372793713`*^9, 
   3.7707962623376513`*^9}, {3.7707965188040457`*^9, 3.770796548017264*^9}, {
   3.770796607661497*^9, 3.7707966169398737`*^9}, {3.770796772730731*^9, 
   3.7707969017137127`*^9}, {3.7707970856285257`*^9, 3.770797109643943*^9}, {
   3.7707974839860907`*^9, 3.770797506648532*^9}, {3.770798053844675*^9, 
   3.7707980881333027`*^9}, {3.770798309259274*^9, 3.770798318425021*^9}, {
   3.770798481547571*^9, 3.7707984857135963`*^9}, 3.770798609507653*^9, {
   3.770798704238109*^9, 3.7707987083229322`*^9}, {3.770798808368764*^9, 
   3.770798819480607*^9}, {3.7707988832694607`*^9, 3.770798889079056*^9}, {
   3.770798938997636*^9, 3.770798942489278*^9}, {3.770798976784931*^9, 
   3.770799050409774*^9}, {3.770799109694536*^9, 3.770799119635153*^9}, {
   3.770799203782023*^9, 3.77079924281334*^9}, {3.770799682575952*^9, 
   3.770799738609145*^9}, {3.770799933725116*^9, 3.7707999407782383`*^9}, {
   3.770800199851424*^9, 3.770800200018664*^9}, {3.770800432151455*^9, 
   3.770800437677537*^9}, {3.7708005057710533`*^9, 3.770800536705286*^9}, {
   3.770800602199905*^9, 3.7708006033589497`*^9}, {3.770800650411224*^9, 
   3.770800735150079*^9}, {3.7708009730699387`*^9, 3.770800974616898*^9}, {
   3.770801029279633*^9, 3.770801031403932*^9}, {3.770802346113769*^9, 
   3.770802349907116*^9}, {3.7708158439761143`*^9, 3.770815870625139*^9}, {
   3.770815924810457*^9, 3.7708159259841146`*^9}, {3.770816551206444*^9, 
   3.7708165513083973`*^9}},
 ExpressionUUID -> "3d203fc1-9cec-4631-b975-e90cb10bf401"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"VisTransformation", "[", 
   RowBox[{
    RowBox[{"matr_", "?", "SquareMatrixQ"}], ",", "x_Symbol", ",", 
    RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
    RowBox[{"poles", ":", 
     RowBox[{"All", "|", 
      RowBox[{"{", "__", "}"}]}], ":", "All"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Basic", " ", 
      RowBox[{"idea", ":", " ", "first"}]}], ",", " ", 
     RowBox[{
     "find", " ", "JDecompositionData", " ", "for", " ", "all", " ", "points",
       " ", "of", " ", "the", " ", 
      RowBox[{"matrix", ".", "\[IndentingNewLine]", "Then"}], " ", 
      "construct", " ", "a", " ", "graphics", " ", "control"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "matr"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"m", "=", "matr"}], ",", 
      RowBox[{"i", "=", "0"}], ",", "\[IndentingNewLine]", "polespos", ",", 
      "polesData", ",", "pd", ",", "\[IndentingNewLine]", "indices", ",", 
      "index", ",", "\[IndentingNewLine]", "prevu", ",", "prevv", ",", 
      "\[IndentingNewLine]", "psetu", ",", "psetv", ",", 
      "\[IndentingNewLine]", "clickedu", ",", "clickedv", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"buttons", "=", 
       RowBox[{"Grid", "[", 
        RowBox[{"{", 
         RowBox[{"{", "\"\<Wait\>\"", "}"}], "}"}], "]"}]}], ",", 
      "\[IndentingNewLine]", "uinds", ",", "vinds", ",", 
      "\[IndentingNewLine]", "us", ",", "vs", ",", "x1", ",", "x2", ",", 
      "\[IndentingNewLine]", "lu", ",", "lv", ",", "\[IndentingNewLine]", 
      "gram", ",", "applyEnabled", ",", "colorMark", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"statusline", "=", "\"\<Ready\>\""}], ",", "balance", ",", 
      "\[IndentingNewLine]", "transformation", ",", "\[IndentingNewLine]", 
      "updateInteface", ",", "\[IndentingNewLine]", "apply", ",", 
      "\[IndentingNewLine]", "validate", ",", "\[IndentingNewLine]", 
      RowBox[{"continue", "=", "True"}], ",", "\[IndentingNewLine]", 
      "guidedlist", ",", "\[IndentingNewLine]", 
      RowBox[{"guidedlistnew", "=", 
       RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", "guided", ",", 
      "\[IndentingNewLine]", "animationlist", ",", "\[IndentingNewLine]", 
      "animationdelay", ",", "\[IndentingNewLine]", "animate", ",", "dia"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"transformation", "=", 
      RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"guidedlist", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Highlighted", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Except", "[", "_List", "]"}], "\[Rule]", 
          RowBox[{"{", "}"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"animationlist", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "Animate", "]"}], ",", 
        RowBox[{"Highlighted", "\[Rule]", "guidedlist"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"animationdelay", "=", 
      RowBox[{"1", "/", 
       RowBox[{"OptionValue", "[", "AnimationRate", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"animationlist", "===", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", "transformation", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"polespos", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{"poles", ",", 
        RowBox[{"All", "->", 
         RowBox[{"PolesPosition", "[", 
          RowBox[{"m", ",", "x"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"guidedlist", "=!=", 
            RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"guided", "=", 
             RowBox[{"First", "[", "guidedlist", "]"}]}], ";", 
            RowBox[{"guidedlist", "=", 
             RowBox[{"Rest", "[", "guidedlist", "]"}]}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"guided", "=", 
            RowBox[{
             RowBox[{"{", "}"}], "\[LongLeftRightArrow]", 
             RowBox[{"{", "}"}]}]}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"forming", " ", "polesData", " ", "and", " ", "indices"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"polesData", "=", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{"PoincareRank", "[", 
                 RowBox[{"m", ",", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "#"}], "}"}]}], "]"}]}], "}"}], "&"}], "/@",
              "polespos"}], ",", 
            RowBox[{"{", 
             RowBox[{"_", ",", 
              RowBox[{"_", "?", "Negative"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Libra`Private`FCStaticMonitor", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"polesData", "=", "\[IndentingNewLine]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Monitor", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"#1", ",", "#2", ",", 
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"JDData", "@", 
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#1", "=!=", "\[Infinity]"}], ",", 
                    RowBox[{"(*", 
                    RowBox[{"SeriesCoefficientMod", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"x", "->", 
                    RowBox[{"x", "-", "#1"}]}], ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "-", "#2"}]}], "}"}]}], "]"}], "*)"}], 
                    RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "-", "#2"}]}], "}"}]}], "]"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{"1", "-", "#2"}]}], "}"}]}], "]"}]}]}], "]"}], 
                    ",", "\"\<\\t\\tSC\>\"", ",", "1"}], "]"}]}], ",", 
                    "\"\<\\tJDD\>\""}], "]"}], ",", 
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#2", ">", "0"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Prepend", "[", 
                    RowBox[{"#", ",", "\"\<Fuchsify\>\""}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{"TransposePadRight", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Union", "@", 
                    RowBox[{"A0A1ToSubspaces", "[", 
                    RowBox[{
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", "1"}], "}"}]}], "]"}], "]"}],
                     ",", "\"\<\\t\\tLSC\>\""}], "]"}], ",", "Left"}], 
                    "]"}]}], ",", 
                    RowBox[{"Union", "@", 
                    RowBox[{"A0A1ToSubspaces", "[", 
                    RowBox[{
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", "1"}], "}"}]}], "]"}], "]"}],
                     ",", "\"\<\\t\\tLSC\>\""}], "]"}], ",", "Right"}], 
                    "]"}]}]}], "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}], ")"}]}], ",", 
                    RowBox[{"{", "}"}]}], "]"}], ",", "\"\<\\tA0A1\>\""}], 
                    "]"}]}], "}"}], ",", 
                  RowBox[{
                   RowBox[{"ToString", "[", "#1", "]"}], "<>", 
                   "\"\<: \>\""}]}], "]"}], "&"}], "@@@", "polesData"}], 
              ")"}]}], ";"}], "\[IndentingNewLine]", ",", 
           "\"\<Calculating Jordan decomposition data...\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"indices", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{"i1", ",", "i2", ",", 
                  RowBox[{"{", "i3", "}"}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"i3", "==", "1"}], "||", "prevu"}], 
                  RowBox[{"(*", 
                   RowBox[{"\"\<allowed to press?\>\"", " ", "flag"}], "*)"}],
                   ",", 
                  RowBox[{"prevu", "=", 
                   RowBox[{"Unique", "[", "\"\<u\>\"", "]"}]}], 
                  RowBox[{"(*", 
                   RowBox[{"\"\<pressed?\>\"", " ", "flag"}], "*)"}], ",", 
                  RowBox[{
                   RowBox[{"i3", "==", "1"}], "||", "prevv"}], 
                  RowBox[{"(*", 
                   RowBox[{"\"\<allowed to press?\>\"", " ", "flag"}], "*)"}],
                   ",", 
                  RowBox[{"prevv", "=", 
                   RowBox[{"Unique", "[", "\"\<v\>\"", "]"}]}]}], "}"}]}], 
               RowBox[{"(*", 
                RowBox[{"\"\<pressed?\>\"", " ", "flag"}], "*)"}], 
               "\[IndentingNewLine]", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i2", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i3", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "3", ",", "i2", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{
                   RowBox[{"Length", "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"i1", ",", "3"}], "]"}], "]"}]}], "+", "i2"}], 
                  ",", "All", ",", "True", ",", 
                  RowBox[{"Unique", "[", "\"\<f\>\"", "]"}], ",", "True", ",", 
                  RowBox[{"Unique", "[", "\"\<f\>\"", "]"}]}], "}"}]}], "]"}],
               ",", 
              RowBox[{"{", 
               RowBox[{"i2", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "4"}], "]"}], "]"}]}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "@", "polesData"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"polesData", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", 
              RowBox[{"Join", "[", 
               RowBox[{"#3", ",", "#4"}], "]"}]}], "}"}], "&"}], "@@@", 
           "polesData"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "forming"}], " ", "polesData", " ", "and", " ", 
           "indices"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"functions", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetu", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "5"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"psetv", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "7"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{"write", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"psetu", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", "True", "]"}], " ", "and", 
           " ", 
           RowBox[{
            RowBox[{"psetv", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", "True", "]"}]}], " ", 
          "*)"}], 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "for", " ", "the", " ", "naive", " ", "effect", " ", "of", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"indices", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "5"}], "]"}], "]"}]}], "=", 
           RowBox[{
            RowBox[{"True", " ", "and", " ", 
             RowBox[{"indices", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "7"}], "]"}], "]"}]}], "=", "True"}]}], " ", 
          "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "functions"}], " ", "to", " ", "set", " ", 
           "variables"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"forming", " ", "interface"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"buttons", "=", 
          RowBox[{"Grid", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Grid", "[", 
                RowBox[{
                 RowBox[{"ArrayFlatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"index", "=", "0"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"Replace", "[", 
                    RowBox[{
                    RowBox[{"PadRight", "[", "\[IndentingNewLine]", 
                    RowBox[{"Apply", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"index", "++"}], ";", 
                    RowBox[{"pd", "=", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "1"}], "]"}], 
                    "]"}]}], ";", 
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"pd", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"pd", ",", 
                    RowBox[{"{", 
                    RowBox[{"Lighter", "@", "Red"}], "}"}]}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"pd", ",", 
                    RowBox[{"{", 
                    RowBox[{"Blue", ",", "Bold"}], "}"}]}], "]"}], ",", 
                    RowBox[{"_", "?", "PossibleZeroQ"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"pd", ",", 
                    RowBox[{"{", 
                    RowBox[{"Darker", "@", "Green"}], "}"}]}], "]"}], ",", 
                    "_", ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"pd", ",", 
                    RowBox[{"{", "Bold", "}"}]}], "]"}]}], "]"}], ",", 
                    RowBox[{"clickedu", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#4", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{"#5", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<FramedPalette\>\"", ",", "\"\<Pressed\>\""}],
                     "}"}], ",", "\"\<FramedPalette\>\""}], "]"}], "]"}]}], 
                    ",", 
                    RowBox[{"TooltipDelay", "\[Rule]", "0.5"}], ",", 
                    RowBox[{"Tooltip", "\[Rule]", 
                    RowBox[{"\"\<Left button #\>\"", "<>", 
                    RowBox[{"ToString", "[", "index", "]"}]}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"guided", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "index"}], "]"}], 
                    ",", "Yellow", ",", "Automatic"}], "]"}]}]}], "]"}]}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"Item", "[", 
                    RowBox[{"(*", 
                    RowBox[{",", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"guided", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "index"}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Frame", "\[Rule]", "True"}], ",", 
                    RowBox[{"FrameStyle", "\[Rule]", 
                    RowBox[{"Directive", "[", 
                    RowBox[{"Yellow", ",", 
                    RowBox[{"AbsoluteThickness", "[", "5", "]"}]}], "]"}]}]}],
                     "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}]}], "*)"}], "]"}], "*)"}], 
                    ")"}], "&"}], ",", 
                    RowBox[{"SplitBy", "[", 
                    RowBox[{"indices", ",", "First"}], "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}], "\[IndentingNewLine]", 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", "\[Rule]", "\"\<\>\""}], "}"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<   \>\"", ",", "x", ",", "\"\<=\>\"", ",", "#1", 
                    ",", "\"\<, pr=\>\"", ",", "#2", ",", "\"\<   \>\""}], 
                    "}"}], "]"}], "}"}], "&"}], "@@@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"index", "=", "0"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"Replace", "[", 
                    RowBox[{
                    RowBox[{"PadLeft", "[", 
                    RowBox[{"Reverse", "/@", 
                    RowBox[{"Apply", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"index", "++"}], ";", 
                    RowBox[{"pd", "=", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "1"}], "]"}], 
                    "]"}]}], ";", 
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"pd", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"pd", ",", 
                    RowBox[{"{", 
                    RowBox[{"Red", ",", "Bold"}], "}"}]}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"pd", ",", 
                    RowBox[{"{", 
                    RowBox[{"Lighter", "@", "Blue"}], "}"}]}], "]"}], ",", 
                    RowBox[{"_", "?", "PossibleZeroQ"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"pd", ",", 
                    RowBox[{"{", 
                    RowBox[{"Darker", "@", "Green"}], "}"}]}], "]"}], ",", 
                    "_", ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"pd", ",", 
                    RowBox[{"{", "Bold", "}"}]}], "]"}]}], "]"}], ",", 
                    RowBox[{"clickedv", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#6", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{"#7", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<FramedPalette\>\"", ",", "\"\<Pressed\>\""}],
                     "}"}], ",", "\"\<FramedPalette\>\""}], "]"}], "]"}]}], 
                    ",", 
                    RowBox[{"TooltipDelay", "\[Rule]", "0.5"}], ",", 
                    RowBox[{"Tooltip", "\[Rule]", 
                    RowBox[{"\"\<Right button #\>\"", "<>", 
                    RowBox[{"ToString", "[", "index", "]"}]}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"guided", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "index"}], "]"}], 
                    ",", "Yellow", ",", "Automatic"}], "]"}]}]}], "]"}]}], 
                    RowBox[{"(*", 
                    RowBox[{"Item", "[", 
                    RowBox[{"(*", 
                    RowBox[{",", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"guided", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "index"}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Frame", "\[Rule]", "True"}], ",", 
                    RowBox[{"FrameStyle", "\[Rule]", 
                    RowBox[{"Directive", "[", 
                    RowBox[{"Yellow", ",", 
                    RowBox[{"AbsoluteThickness", "[", "5", "]"}]}], "]"}]}]}],
                     "}"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}]}], "*)"}], "]"}], "*)"}], 
                    ")"}], "&"}], ",", 
                    RowBox[{"SplitBy", "[", 
                    RowBox[{"indices", ",", "First"}], "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}]}], "\[IndentingNewLine]",
                     "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", "\[Rule]", "\"\<\>\""}], "}"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}]}]}], 
                    "\[IndentingNewLine]", "}"}], "}"}], "]"}], ",", 
                 RowBox[{"Spacings", "\[Rule]", "0"}], ",", 
                 RowBox[{"ItemSize", "\[Rule]", "All"}], ",", 
                 RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Apply balance transformation\>\"", ",", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"OptionValue", "[", "Debug", "]"}], ",", 
                    RowBox[{"WriteString", "[", 
                    RowBox[{
                    "\"\<stdout\>\"", ",", 
                    "\"\<Pressed \\\"Apply balance transformation\\\" button.\
\\n\>\""}], "]"}]}], "]"}], ";", 
                  RowBox[{"continue", "=", "True"}], ";", 
                  RowBox[{"DialogReturn", "[", "]"}]}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", "applyEnabled", "]"}]}], ",", 
                 RowBox[{"Background", "\[Rule]", 
                  RowBox[{"Dynamic", "[", "colorMark", "]"}]}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Paste overall transformation\>\"", ",", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"OptionValue", "[", "Debug", "]"}], ",", 
                    RowBox[{"WriteString", "[", 
                    RowBox[{
                    "\"\<stdout\>\"", ",", 
                    "\"\<Pressed \\\"Paste overall transformation\\\" button.\
\\n\>\""}], "]"}]}], "]"}], ";", 
                  RowBox[{"DialogReturn", "[", "]"}]}], ",", 
                 RowBox[{"Background", "\[Rule]", 
                  RowBox[{"Dynamic", "[", "colorMark", "]"}]}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Dynamic", "[", "statusline", "]"}], 
               "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}], 
            ",", 
            RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "forming"}], " ", "interface"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"unsetting", " ", "buttons"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"Through", "[", 
          RowBox[{"psetu", "[", "False", "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Through", "[", 
          RowBox[{"psetv", "[", "False", "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "unsetting"}], " ", "buttons"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"continue", "=", "False"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "animationlist", "]"}], "=!=", "List"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"DialogInput", "[", "buttons", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"dia", "=", 
             RowBox[{"CreateDialog", "[", "buttons", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"animate", "=", 
             RowBox[{"First", "@", "animationlist"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"animationlist", "=", 
             RowBox[{"Rest", "@", "animationlist"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Pause", "[", "animationdelay", "]"}], ";", 
                RowBox[{"clickedu", "@@", 
                 RowBox[{"indices", "[", 
                  RowBox[{"[", "#", "]"}], "]"}]}]}], ")"}], "&"}], "/@", 
             RowBox[{"animate", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Pause", "[", "animationdelay", "]"}], ";", 
                RowBox[{"clickedv", "@@", 
                 RowBox[{"indices", "[", 
                  RowBox[{"[", "#", "]"}], "]"}]}]}], ")"}], "&"}], "/@", 
             RowBox[{"animate", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"animationlist", "=!=", 
               RowBox[{"{", "}"}]}], ",", 
              RowBox[{"continue", "=", "True"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Pause", "[", "animationdelay", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"NotebookClose", "[", "dia", "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"apply", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Libra`Private`FCMonitor", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"applyEnabled", "=", "False"}], ";", "\[IndentingNewLine]", 
           RowBox[{"colorMark", "=", "Magenta"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"apply", " ", "transformation"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"statusline", "=", "\"\<Constructing balance...\>\""}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"balance", "=", 
            RowBox[{"Balance", "[", 
             RowBox[{
              RowBox[{"Projector", "[", 
               RowBox[{"(*", 
                RowBox[{"Transpose", "@"}], "*)"}], 
               RowBox[{"us", ",", "vs"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "x1", ",", "x2"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"statusline", "=", 
            RowBox[{
            "statusline", "<>", 
             "\"\<\\nCalculating overall transformation...\>\""}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"transformation", "=", 
            RowBox[{"ODot", "[", 
             RowBox[{"transformation", ",", "balance"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"OptionValue", "[", "Log", "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"WriteString", "[", 
               RowBox[{"\"\<stdout\>\"", ",", 
                RowBox[{"\"\<Applied balance \>\"", "<>", 
                 RowBox[{"ToString", "[", 
                  RowBox[{"uinds", "\[LongLeftRightArrow]", "vinds"}], "]"}], 
                 "<>", "\"\<.\\n\>\""}]}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"guidedlistnew", ",", 
                RowBox[{"uinds", "\[LongLeftRightArrow]", "vinds"}]}], "]"}], 
              ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"guided", "=!=", 
               RowBox[{
                RowBox[{"{", "}"}], "\[LongLeftRightArrow]", 
                RowBox[{"{", "}"}]}]}], "&&", 
              RowBox[{"Not", "[", 
               RowBox[{"MatchQ", "[", 
                RowBox[{
                 RowBox[{"uinds", "\[LongLeftRightArrow]", "vinds"}], ",", 
                 "guided"}], "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"WriteString", "[", 
               RowBox[{
               "\"\<stdout\>\"", ",", 
                "\"\<Guided action turned off. Proceed now at your own \
risk.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"guidedlist", "=", 
               RowBox[{"{", "}"}]}]}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"statusline", "=", 
            RowBox[{
            "statusline", "<>", "\"\<\\nApplying transformation...\>\""}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"m", "=", 
            RowBox[{"Transform", "[", 
             RowBox[{"m", ",", "balance", ",", "x"}], "]"}]}], ";"}], 
          "\[IndentingNewLine]", ",", "\[IndentingNewLine]", "statusline"}], 
         "]"}], "\[IndentingNewLine]", ")"}], "&"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"validate", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "pick", " ", "right", " ", "and", " ", "left", " ", "vectors"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"uinds", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"indices", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "5"}], "]"}], "]"}], ",", "True", ",", 
             RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"vinds", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"indices", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "7"}], "]"}], "]"}], ",", "True", ",", 
             RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"uinds", "===", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"us", "=", 
            RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"us", "=", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "3", ",", "#2", ",", "2", ",", "#3"}], 
                   "]"}], "]"}], "&"}], "@@@", 
                RowBox[{"indices", "[", 
                 RowBox[{"[", "uinds", "]"}], "]"}]}], ",", "1"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"x1", "=", 
             RowBox[{"polesData", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"indices", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"First", "@", "uinds"}], ",", "1"}], "]"}], "]"}], 
                ",", "1"}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"vinds", "===", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"vs", "=", 
            RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"vs", "=", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "3", ",", "#2", ",", "3", ",", "#3"}], 
                   "]"}], "]"}], "&"}], "@@@", 
                RowBox[{"indices", "[", 
                 RowBox[{"[", "vinds", "]"}], "]"}]}], ",", "1"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"x2", "=", 
             RowBox[{"polesData", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"indices", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"First", "@", "vinds"}], ",", "1"}], "]"}], "]"}], 
                ",", "1"}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"lu", "=", 
          RowBox[{"Length", "@", "us"}]}], ";", 
         RowBox[{"lv", "=", 
          RowBox[{"Length", "@", "vs"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"lu", "\[Equal]", "0"}], "||", 
            RowBox[{"lv", "\[Equal]", "0"}], "||", 
            RowBox[{"lu", "\[NotEqual]", "lv"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"applyEnabled", "=", "False"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"colorMark", "=", "Automatic"}]}], "\[IndentingNewLine]", 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"gram", "=", 
             RowBox[{"ODot", "[", 
              RowBox[{"vs", ",", 
               RowBox[{"Transpose", "@", "us"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"applyEnabled", "=", 
             RowBox[{"(", 
              RowBox[{"lv", "\[Equal]", 
               RowBox[{"MatrixRank", "[", "gram", "]"}]}], ")"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"colorMark", "=", 
             RowBox[{"If", "[", 
              RowBox[{"applyEnabled", ",", "Green", ",", "Red"}], "]"}]}]}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", 
          RowBox[{
           RowBox[{"ToString", "[", "lu", "]"}], "<>", 
           "\"\<-dimensional u-space and \>\"", "<>", 
           RowBox[{"ToString", "[", "lv", "]"}], "<>", 
           "\"\<-dimensional v-space\>\""}]}], ";"}], "\[IndentingNewLine]", 
        ")"}], "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"clickedu", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "5"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", "unpress", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"psetu", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "False", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "#2", ",", 
                  RowBox[{
                   RowBox[{"{", "k_", "}"}], "/;", 
                   RowBox[{"k", ">", " ", 
                    RowBox[{"First", "[", "#3", "]"}]}]}], ",", "__"}], "}"}],
                 ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"OptionValue", "[", "Debug", "]"}], ",", 
              RowBox[{"WriteString", "[", 
               RowBox[{"\"\<stdout\>\"", ",", 
                RowBox[{"\"\<Unpressed left  button #\>\"", "<>", 
                 RowBox[{"ToString", "[", "index", "]"}], "<>", 
                 "\"\<.\\n\>\""}]}], "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"press", "+", "unpress"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Except", "[", "#1", "]"}], ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"#3", "===", "All"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"psetu", "[", 
                  RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], 
               "/@", 
               RowBox[{"Flatten", "[", 
                RowBox[{"Position", "[", 
                 RowBox[{"indices", ",", 
                  RowBox[{"{", 
                   RowBox[{"#1", ",", "_", ",", 
                    RowBox[{"Except", "[", "All", "]"}], ",", "___"}], "}"}], 
                  ",", 
                  RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"psetu", "[", 
                  RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], 
               "/@", 
               RowBox[{"Flatten", "[", 
                RowBox[{"Position", "[", 
                 RowBox[{"indices", ",", 
                  RowBox[{"{", 
                   RowBox[{"#1", ",", "_", ",", "All", ",", "___"}], "}"}], 
                  ",", 
                  RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetu", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"OptionValue", "[", "Debug", "]"}], ",", 
              RowBox[{"WriteString", "[", 
               RowBox[{"\"\<stdout\>\"", ",", 
                RowBox[{"\"\<Pressed left button #\>\"", "<>", 
                 RowBox[{"ToString", "[", "index", "]"}], "<>", 
                 "\"\<.\\n\>\""}]}], "]"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedv", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "7"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"psetv", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "False", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "#2", ",", 
                  RowBox[{
                   RowBox[{"{", "k_", "}"}], "/;", 
                   RowBox[{"k", ">", " ", 
                    RowBox[{"First", "[", "#3", "]"}]}]}], ",", "__"}], "}"}],
                 ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"OptionValue", "[", "Debug", "]"}], ",", 
              RowBox[{"WriteString", "[", 
               RowBox[{"\"\<stdout\>\"", ",", 
                RowBox[{"\"\<Unpressed right  button #\>\"", "<>", 
                 RowBox[{"ToString", "[", "index", "]"}], "<>", 
                 "\"\<.\\n\>\""}]}], "]"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"#3", "===", "All"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"psetv", "[", 
                  RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], 
               "/@", 
               RowBox[{"Flatten", "[", 
                RowBox[{"Position", "[", 
                 RowBox[{"indices", ",", 
                  RowBox[{"{", 
                   RowBox[{"#1", ",", "_", ",", 
                    RowBox[{"Except", "[", "All", "]"}], ",", "___"}], "}"}], 
                  ",", 
                  RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"psetv", "[", 
                  RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], 
               "/@", 
               RowBox[{"Flatten", "[", 
                RowBox[{"Position", "[", 
                 RowBox[{"indices", ",", 
                  RowBox[{"{", 
                   RowBox[{"#1", ",", "_", ",", "All", ",", "___"}], "}"}], 
                  ",", 
                  RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetv", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"OptionValue", "[", "Debug", "]"}], ",", 
              RowBox[{"WriteString", "[", 
               RowBox[{"\"\<stdout\>\"", ",", 
                RowBox[{"\"\<Pressed right button #\>\"", "<>", 
                 RowBox[{"ToString", "[", "index", "]"}], "<>", 
                 "\"\<.\\n\>\""}]}], "]"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{"continue", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"updateInteface", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"applyEnabled", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"apply", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"OptionValue", "[", "Log", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<NB: option\\n\\t\>\"", ",", 
          RowBox[{"Highlighted", "\[Rule]", "guidedlistnew"}], ",", 
          "\"\<\\nwill guide you through the same path,\\n while option\\n\\t\
\>\"", ",", 
          RowBox[{"Animate", "\[Rule]", "guidedlistnew"}], ",", 
          "\"\<\\nwill press the buttons for you \[HappySmiley].\>\""}], 
         "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "transformation"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"NotebookSave", "[", "]"}]}], "Code",
 CellChangeTimes->{{3.768883673229196*^9, 3.7688836833206387`*^9}, {
   3.7688837398431396`*^9, 3.768883761585402*^9}, 3.76888384553612*^9, {
   3.768883959448791*^9, 3.76888396790588*^9}, 3.768884265122773*^9, {
   3.768884394698118*^9, 3.7688843957404222`*^9}, {3.768884437885153*^9, 
   3.7688844406564283`*^9}, {3.768884603550152*^9, 3.7688846048273363`*^9}, {
   3.768884686230318*^9, 3.768884697363865*^9}, {3.768884805735989*^9, 
   3.768884849729986*^9}, {3.768885261952456*^9, 3.768885268272355*^9}, {
   3.768887286877696*^9, 3.768887353656507*^9}, 3.7688873897744083`*^9, 
   3.7688874326169577`*^9, {3.768887479626685*^9, 3.768887492091527*^9}, {
   3.7688876475953693`*^9, 3.768887655619399*^9}, {3.768887776168305*^9, 
   3.76888778134969*^9}, 3.768887829461048*^9, {3.768887892776437*^9, 
   3.768887966705843*^9}, {3.768888018252489*^9, 3.7688880730673523`*^9}, {
   3.768888150290524*^9, 3.7688881593881693`*^9}, {3.7688882760611877`*^9, 
   3.768888313332767*^9}, {3.768888369712187*^9, 3.768888404607811*^9}, {
   3.768888451659333*^9, 3.7688884872903337`*^9}, {3.7688885260013437`*^9, 
   3.768888538799514*^9}, {3.7688885797289953`*^9, 3.768888610614152*^9}, {
   3.768888669642646*^9, 3.7688886970393*^9}, {3.768890888669334*^9, 
   3.768890890538596*^9}, {3.7688910104845047`*^9, 3.768891031946739*^9}, {
   3.768891210887643*^9, 3.76889121992635*^9}, 3.768891542250896*^9, {
   3.768891876625001*^9, 3.768891876642634*^9}, {3.7688919147181*^9, 
   3.768891918910204*^9}, {3.768892121712277*^9, 3.768892127127733*^9}, {
   3.768892169080371*^9, 3.768892303912305*^9}, {3.768892454906122*^9, 
   3.768892464577695*^9}, {3.768892645793434*^9, 3.768892662715845*^9}, {
   3.768892755428076*^9, 3.768892755618445*^9}, {3.768892981259873*^9, 
   3.768892988592821*^9}, {3.768893077661159*^9, 3.768893152839888*^9}, {
   3.768893269694521*^9, 3.76889333518358*^9}, {3.7688934671752377`*^9, 
   3.7688934995138807`*^9}, {3.768893562135682*^9, 3.768893568885934*^9}, {
   3.768893948250082*^9, 3.7688939490977697`*^9}, 3.768894237919043*^9, {
   3.7688942695031013`*^9, 3.768894337222807*^9}, {3.768894525524055*^9, 
   3.76889453612249*^9}, 3.7688945706535797`*^9, {3.768894705942731*^9, 
   3.768894759352044*^9}, {3.7688950014400673`*^9, 3.768895015879937*^9}, {
   3.7688950534973593`*^9, 3.768895076726639*^9}, {3.7688951282365503`*^9, 
   3.768895128521174*^9}, {3.768895165175178*^9, 3.768895170283161*^9}, 
   3.768895212569784*^9, {3.768895253850604*^9, 3.7688952666650267`*^9}, 
   3.768895318928771*^9, {3.768895462969563*^9, 3.768895475586203*^9}, 
   3.768895639075342*^9, {3.768895784098667*^9, 3.768895828040162*^9}, 
   3.768896952328436*^9, {3.7689584096196613`*^9, 3.768958414801444*^9}, {
   3.7689609419523363`*^9, 3.768961041338532*^9}, {3.768961081515246*^9, 
   3.76896110434761*^9}, 3.768961136554397*^9, {3.769028906275814*^9, 
   3.7690289381086197`*^9}, {3.7690297613937387`*^9, 3.769029765929029*^9}, {
   3.769029942728528*^9, 3.7690300044885883`*^9}, {3.769030110536378*^9, 
   3.769030118300109*^9}, {3.769030237624324*^9, 3.769030248120461*^9}, {
   3.7690319749925756`*^9, 3.769032032801787*^9}, {3.769032145453845*^9, 
   3.76903215499476*^9}, {3.769032241982126*^9, 3.769032256944352*^9}, {
   3.769032343583706*^9, 3.769032401041994*^9}, {3.769032525826779*^9, 
   3.769032527001409*^9}, {3.769032714484827*^9, 3.769032774472619*^9}, {
   3.769032811755013*^9, 3.7690328174949102`*^9}, 3.7690328799963417`*^9, {
   3.769033149694045*^9, 3.769033154631096*^9}, {3.769133555954192*^9, 
   3.769133564529211*^9}, {3.769133764772559*^9, 3.769133769746258*^9}, {
   3.769133881367518*^9, 3.769133941674693*^9}, {3.76913397429084*^9, 
   3.769134058519753*^9}, {3.769828331143759*^9, 3.769828361383753*^9}, 
   3.7698285916083517`*^9, {3.7698288932490377`*^9, 3.76982891328189*^9}, {
   3.769831196708028*^9, 3.769831234007399*^9}, {3.7698336938430243`*^9, 
   3.769833695562459*^9}, 3.769834504720085*^9, 3.770591898042718*^9, {
   3.7706032446081142`*^9, 3.770603244975358*^9}, {3.7707853048820467`*^9, 
   3.7707853106916447`*^9}, {3.770785605820609*^9, 3.770785609127146*^9}, {
   3.770785643412841*^9, 3.770785645239699*^9}, 3.770785772749764*^9, {
   3.7707858288448763`*^9, 3.770785858185885*^9}, 3.7707859419913263`*^9, {
   3.770786117348982*^9, 3.770786150514689*^9}, 3.770786334825778*^9, {
   3.770786490893505*^9, 3.770786491676331*^9}, {3.770787073346355*^9, 
   3.770787092755692*^9}, {3.770787160448743*^9, 3.770787161575263*^9}, {
   3.770787246967805*^9, 3.770787247413678*^9}, {3.770787369575439*^9, 
   3.770787374806806*^9}, {3.770787521250387*^9, 3.770787522694347*^9}, {
   3.770787674125286*^9, 3.7707876960151453`*^9}, {3.770787741781776*^9, 
   3.7707877508541927`*^9}, {3.770787809447112*^9, 3.770787809896057*^9}, {
   3.770787946854123*^9, 3.770787963804669*^9}, {3.7707880170128098`*^9, 
   3.7707880249023933`*^9}, {3.770788154217849*^9, 3.770788228585779*^9}, 
   3.77078828997512*^9, {3.7707883224004602`*^9, 3.7707883581609983`*^9}, {
   3.7707889588260393`*^9, 3.770789015129057*^9}, {3.7707890675744867`*^9, 
   3.770789079710801*^9}, {3.770789117107399*^9, 3.770789134365237*^9}, {
   3.770789165230074*^9, 3.7707891689912167`*^9}, {3.770789263697166*^9, 
   3.7707893582643347`*^9}, {3.770789550786521*^9, 3.770789566858273*^9}, {
   3.770789734574334*^9, 3.770789769867923*^9}, {3.7707899425721617`*^9, 
   3.7707899797085133`*^9}, {3.770790011865275*^9, 3.770790035085514*^9}, {
   3.77079006591656*^9, 3.770790151452856*^9}, {3.7707901836479473`*^9, 
   3.770790316792583*^9}, {3.7707903594025784`*^9, 3.7707903687355833`*^9}, {
   3.77079045348503*^9, 3.770790462486796*^9}, {3.770791239650359*^9, 
   3.7707912775431013`*^9}, {3.7707913145074253`*^9, 
   3.7707913897860203`*^9}, {3.770791438649184*^9, 3.7707914391092243`*^9}, {
   3.770791487823125*^9, 3.77079159899341*^9}, {3.770791660171587*^9, 
   3.7707916751101627`*^9}, {3.7707917860137997`*^9, 3.770791801326344*^9}, {
   3.770791859645583*^9, 3.7707919110162487`*^9}, {3.770791964692897*^9, 
   3.770792012758411*^9}, {3.7707920537465754`*^9, 3.770792064098494*^9}, {
   3.770792095106545*^9, 3.7707920995295887`*^9}, {3.770792130008017*^9, 
   3.770792359015182*^9}, {3.770792404513569*^9, 3.770792408241948*^9}, {
   3.770792524234542*^9, 3.7707925496030397`*^9}, {3.7707926169299717`*^9, 
   3.7707928001303*^9}, {3.770792831600987*^9, 3.770792831705861*^9}, {
   3.770792877102272*^9, 3.770792896156798*^9}, 3.770792929382119*^9, {
   3.770792977989743*^9, 3.770793010570661*^9}, {3.770793093320986*^9, 
   3.770793165104521*^9}, {3.770793207267508*^9, 3.7707932523922367`*^9}, {
   3.770793289031611*^9, 3.7707934111891947`*^9}, {3.770793542625557*^9, 
   3.770793543673018*^9}, {3.770793616060204*^9, 3.7707936821891813`*^9}, {
   3.7707938028674307`*^9, 3.7707938434740334`*^9}, {3.7707939154382963`*^9, 
   3.770793934279809*^9}, {3.7707940231934023`*^9, 3.770794046539659*^9}, {
   3.7707943043356237`*^9, 3.770794308143011*^9}, {3.770794475424499*^9, 
   3.7707945177432327`*^9}, {3.7707946387285624`*^9, 3.770794782824548*^9}, {
   3.770794817789222*^9, 3.770795009099537*^9}, {3.770795100330513*^9, 
   3.77079517836644*^9}, {3.770795218773715*^9, 3.7707952888160067`*^9}, {
   3.7707953200552187`*^9, 3.7707954178463717`*^9}, {3.770795817410697*^9, 
   3.770795839571066*^9}, {3.770796025354205*^9, 3.77079604034*^9}, {
   3.770796109459984*^9, 3.770796192572958*^9}, {3.7707962372793713`*^9, 
   3.7707962623376513`*^9}, {3.7707965188040457`*^9, 3.770796548017264*^9}, {
   3.770796607661497*^9, 3.7707966169398737`*^9}, {3.770796772730731*^9, 
   3.7707969017137127`*^9}, {3.7707970856285257`*^9, 3.770797109643943*^9}, {
   3.7707974839860907`*^9, 3.770797506648532*^9}, {3.770798053844675*^9, 
   3.7707980881333027`*^9}, {3.770798309259274*^9, 3.770798318425021*^9}, {
   3.770798481547571*^9, 3.7707984857135963`*^9}, 3.770798609507653*^9, {
   3.770798704238109*^9, 3.7707987083229322`*^9}, {3.770798808368764*^9, 
   3.770798819480607*^9}, {3.7707988832694607`*^9, 3.770798889079056*^9}, {
   3.770798938997636*^9, 3.770798942489278*^9}, {3.770798976784931*^9, 
   3.770799050409774*^9}, {3.770799109694536*^9, 3.770799119635153*^9}, {
   3.770799203782023*^9, 3.77079924281334*^9}, {3.770799682575952*^9, 
   3.770799738609145*^9}, {3.770799933725116*^9, 3.7707999407782383`*^9}, {
   3.770800199851424*^9, 3.770800200018664*^9}, {3.770800432151455*^9, 
   3.770800437677537*^9}, {3.7708005057710533`*^9, 3.770800536705286*^9}, {
   3.770800602199905*^9, 3.7708006033589497`*^9}, {3.770800650411224*^9, 
   3.770800735150079*^9}, {3.7708009730699387`*^9, 3.770800974616898*^9}, {
   3.770801029279633*^9, 3.770801031403932*^9}, {3.770802346113769*^9, 
   3.7708023539888697`*^9}, {3.770802426718667*^9, 3.770802435042225*^9}, {
   3.7708024741815042`*^9, 3.77080259870138*^9}, {3.77080282376471*^9, 
   3.7708028699887447`*^9}, {3.770802944471854*^9, 3.770802971646453*^9}, {
   3.7708030267291193`*^9, 3.7708030569182158`*^9}, {3.770816046168239*^9, 
   3.7708160870735397`*^9}, {3.770816159761949*^9, 3.770816261775754*^9}, {
   3.770816293530876*^9, 3.7708163278158007`*^9}, {3.770816380007341*^9, 
   3.770816493054541*^9}, {3.7708165265853987`*^9, 3.7708167082647142`*^9}, 
   3.770816818257341*^9, 3.770816961209869*^9, {3.770816993500145*^9, 
   3.7708170078898087`*^9}, {3.770817161656041*^9, 3.770817179910746*^9}, {
   3.770817344432466*^9, 3.7708173752420483`*^9}, {3.7708174693386507`*^9, 
   3.770817476112782*^9}, {3.7708175160448303`*^9, 3.770817559499176*^9}, {
   3.7708175986450787`*^9, 3.770817602175458*^9}, {3.770817694401939*^9, 
   3.770817760670679*^9}, {3.770819207685645*^9, 3.770819214108467*^9}, {
   3.770819266806807*^9, 3.770819268753386*^9}, {3.770819304796487*^9, 
   3.7708193747668247`*^9}, {3.770819406199071*^9, 3.7708194246170387`*^9}, {
   3.770819481425943*^9, 3.7708195128632298`*^9}, {3.7708198905502*^9, 
   3.770819902894911*^9}, {3.770819960969006*^9, 3.770819991605798*^9}, {
   3.770820024136956*^9, 3.770820038348371*^9}, {3.770820113727084*^9, 
   3.770820134054899*^9}, {3.770820249415358*^9, 3.770820252740416*^9}, {
   3.770820526055397*^9, 3.770820540552656*^9}, {3.770820642705326*^9, 
   3.770820708009598*^9}, {3.7708207511994953`*^9, 3.77082076063446*^9}, 
   3.77082084552162*^9, 3.770820939634088*^9, {3.770820970081922*^9, 
   3.770820991010889*^9}, {3.770821090628965*^9, 3.77082110641187*^9}, {
   3.770821248173092*^9, 3.770821324547235*^9}, {3.770821371715642*^9, 
   3.770821405802569*^9}, {3.7708214511438427`*^9, 3.770821454705069*^9}, 
   3.7708214934852448`*^9, {3.770821539181118*^9, 3.770821545555367*^9}, {
   3.770821576175006*^9, 3.770821590774871*^9}, {3.770821630613209*^9, 
   3.770821689979282*^9}, {3.770821806046994*^9, 3.7708218671958838`*^9}, {
   3.7708219002272673`*^9, 3.770821904578458*^9}, {3.770822241755537*^9, 
   3.770822251388653*^9}, {3.770822288593423*^9, 3.770822298516136*^9}, {
   3.770822389352111*^9, 3.77082241847409*^9}, {3.770822476786366*^9, 
   3.770822520882594*^9}, {3.770822566274023*^9, 3.7708225664408607`*^9}, {
   3.770822614114949*^9, 3.770822749245646*^9}, 3.7708227803882217`*^9, {
   3.770822821195772*^9, 3.770822859818366*^9}, {3.770822894265296*^9, 
   3.770822906477557*^9}, {3.7708229982011433`*^9, 3.770823046515337*^9}, {
   3.770823084931321*^9, 3.7708230868834352`*^9}, {3.77082313725696*^9, 
   3.770823146245178*^9}, {3.770823194922114*^9, 3.770823222744905*^9}, {
   3.770823331962574*^9, 3.770823358926867*^9}, {3.770823509150285*^9, 
   3.77082351252824*^9}, 3.770823550806532*^9, {3.770823613788054*^9, 
   3.7708236320722933`*^9}, {3.770823755149475*^9, 3.770823777128233*^9}, {
   3.7708238383367453`*^9, 3.770823876082321*^9}},
 ExpressionUUID -> "3d203fc1-9cec-4631-b975-e90cb10bf401"],

Cell[BoxData[
 RowBox[{
  RowBox[{"VisTransformation", "[", 
   RowBox[{
    RowBox[{"matr_", "?", "SquareMatrixQ"}], ",", "x_Symbol", ",", 
    RowBox[{"\[Epsilon]_Symbol:", "Indeterminate"}], ",", 
    RowBox[{"poles", ":", 
     RowBox[{"All", "|", 
      RowBox[{"{", "__", "}"}]}], ":", "All"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Basic", " ", 
      RowBox[{"idea", ":", " ", "first"}]}], ",", " ", 
     RowBox[{
     "find", " ", "JDecompositionData", " ", "for", " ", "all", " ", "points",
       " ", "of", " ", "the", " ", 
      RowBox[{"matrix", ".", "\[IndentingNewLine]", "Then"}], " ", 
      "construct", " ", "a", " ", "graphics", " ", "control"}]}], 
    "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "matr"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"m", "=", "matr"}], ",", "\[IndentingNewLine]", "polespos", ",",
       "polesData", ",", "\[IndentingNewLine]", "indices", ",", "index", ",", 
      "\[IndentingNewLine]", "prevu", ",", "prevv", ",", 
      "\[IndentingNewLine]", "psetu", ",", "psetv", ",", 
      "\[IndentingNewLine]", "clickedu", ",", "clickedv", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"buttons", "=", 
       RowBox[{"Grid", "[", 
        RowBox[{"{", 
         RowBox[{"{", "\"\<Wait\>\"", "}"}], "}"}], "]"}]}], ",", 
      "\[IndentingNewLine]", "us", ",", "vs", ",", "x1", ",", "x2", ",", 
      "\[IndentingNewLine]", "lu", ",", "lv", ",", "\[IndentingNewLine]", 
      "gram", ",", "applyEnabled", ",", "colorMark", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"statusline", "=", "\"\<Ready\>\""}], ",", "balance", ",", 
      "\[IndentingNewLine]", "transformation", ",", "\[IndentingNewLine]", 
      "updateInteface", ",", "\[IndentingNewLine]", "apply", ",", 
      "\[IndentingNewLine]", "validate", ",", "\[IndentingNewLine]", 
      RowBox[{"continue", "=", "True"}]}], "\[IndentingNewLine]", "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"transformation", "=", 
      RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"polespos", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{"poles", ",", 
        RowBox[{"All", "->", 
         RowBox[{"PolesPosition", "[", 
          RowBox[{"m", ",", "x"}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"updateInteface", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"forming", " ", "polesData", " ", "and", " ", "indices"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"polesData", "=", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#", ",", 
                RowBox[{"PoincareRank", "[", 
                 RowBox[{"m", ",", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "#"}], "}"}]}], "]"}]}], "}"}], "&"}], "/@",
              "polespos"}], ",", 
            RowBox[{"{", 
             RowBox[{"_", ",", 
              RowBox[{"_", "?", "Negative"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"FCStaticMonitor", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"polesData", "=", "\[IndentingNewLine]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Monitor", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"#1", ",", "#2", ",", 
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"JDData", "@", 
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#1", "=!=", "\[Infinity]"}], ",", 
                    RowBox[{"(*", 
                    RowBox[{"SeriesCoefficientMod", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"x", "->", 
                    RowBox[{"x", "-", "#1"}]}], ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "-", "#2"}]}], "}"}]}], "]"}], "*)"}], 
                    RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "-", "#2"}]}], "}"}]}], "]"}], ",", 
                    RowBox[{"-", 
                    RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", 
                    RowBox[{"1", "-", "#2"}]}], "}"}]}], "]"}]}]}], "]"}], 
                    ",", "\"\<\\t\\tSC\>\"", ",", "1"}], "]"}]}], ",", 
                    "\"\<\\tJDD\>\""}], "]"}], ",", 
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#2", ">", "0"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Prepend", "[", 
                    RowBox[{"#", ",", "\"\<F\>\""}], "]"}], "&"}], "/@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Union", "@", 
                    RowBox[{"A0A1ToSubspaces", "[", 
                    RowBox[{
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", "1"}], "}"}]}], "]"}], "]"}],
                     ",", "\"\<\\t\\tLSC\>\""}], "]"}], ",", "Left"}], 
                    "]"}]}], ",", 
                    RowBox[{"Union", "@", 
                    RowBox[{"A0A1ToSubspaces", "[", 
                    RowBox[{
                    RowBox[{"Monitor", "[", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"LeadingSeriesCoefficients", "[", 
                    RowBox[{"m", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "#1", ",", "1"}], "}"}]}], "]"}], "]"}],
                     ",", "\"\<\\t\\tLSC\>\""}], "]"}], ",", "Right"}], 
                    "]"}]}]}], "}"}], "]"}]}], ",", 
                    RowBox[{"{", "}"}]}], "]"}], ",", "\"\<\\tA0A1\>\""}], 
                    "]"}]}], "}"}], ",", 
                  RowBox[{
                   RowBox[{"ToString", "[", "#1", "]"}], "<>", 
                   "\"\<: \>\""}]}], "]"}], "&"}], "@@@", "polesData"}], 
              ")"}]}], ";"}], "\[IndentingNewLine]", ",", 
           "\"\<Calculating Jordan decomposition data...\>\""}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"indices", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2", ",", 
                  RowBox[{"{", "i3", "}"}], ",", 
                  RowBox[{
                   RowBox[{"i3", "==", "1"}], "||", "prevu"}], 
                  RowBox[{"(*", 
                   RowBox[{"\"\<allowed to press?\>\"", " ", "flag"}], "*)"}],
                   ",", 
                  RowBox[{"prevu", "=", 
                   RowBox[{"Unique", "[", "\"\<u\>\"", "]"}]}], 
                  RowBox[{"(*", 
                   RowBox[{"\"\<pressed?\>\"", " ", "flag"}], "*)"}], ",", 
                  RowBox[{
                   RowBox[{"i3", "==", "1"}], "||", "prevv"}], ",", 
                  RowBox[{"prevv", "=", 
                   RowBox[{"Unique", "[", "\"\<v\>\"", "]"}]}]}], "}"}]}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i2", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i3", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "3", ",", "i2", ",", 
                    RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{
                   RowBox[{"Length", "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"i1", ",", "3"}], "]"}], "]"}]}], "+", "i2"}], 
                  ",", "All", ",", "True", ",", 
                  RowBox[{"Unique", "[", "\"\<f\>\"", "]"}], ",", "True", ",", 
                  RowBox[{"Unique", "[", "\"\<f\>\"", "]"}]}], "}"}]}], "]"}],
               ",", 
              RowBox[{"{", 
               RowBox[{"i2", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"i1", ",", "4"}], "]"}], "]"}]}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "@", "polesData"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"polesData", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", 
              RowBox[{"Join", "[", 
               RowBox[{"#3", ",", "#4"}], "]"}]}], "}"}], "&"}], "@@@", 
           "polesData"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "forming"}], " ", "polesData", " ", "and", " ", 
           "indices"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"functions", " ", "to", " ", "set", " ", "variables"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"psetu", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "5"}], "]"}], "]"}]}]}], ";", 
         RowBox[{"psetv", "=", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"v", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"v", "=", "#"}], ")"}], "&"}]}], "]"}], "/@", 
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "7"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{"write", " ", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"psetu", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", "True", "]"}], " ", "and", 
           " ", 
           RowBox[{
            RowBox[{"psetv", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", "True", "]"}]}], " ", 
          "*)"}], 
         RowBox[{"(*", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "for", " ", "the", " ", "naive", " ", "effect", " ", "of", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"indices", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "5"}], "]"}], "]"}]}], "=", 
           RowBox[{
            RowBox[{"True", " ", "and", " ", 
             RowBox[{"indices", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "7"}], "]"}], "]"}]}], "=", "True"}]}], " ", 
          "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "functions"}], " ", "to", " ", "set", " ", 
           "variables"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"forming", " ", "interface"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"buttons", "=", 
          RowBox[{"Grid", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Grid", "[", 
                RowBox[{
                 RowBox[{"ArrayFlatten", "[", 
                  RowBox[{"{", 
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"PadRight", "[", 
                    RowBox[{"Apply", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Darker", "@", "Green"}]}], "]"}]}], "]"}], "&"}],
                     "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "1"}], "]"}], 
                    "]"}]}], ",", 
                    RowBox[{"clickedu", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#4", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{"#5", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<FramedPalette\>\"", ",", "\"\<Pressed\>\""}],
                     "}"}], ",", "\"\<FramedPalette\>\""}], "]"}], "]"}]}]}], 
                    "]"}], "&"}], ",", 
                    RowBox[{"SplitBy", "[", 
                    RowBox[{"indices", ",", "First"}], "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}], "\[IndentingNewLine]", 
                    "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Row", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<   \>\"", ",", "x", ",", "\"\<=\>\"", ",", "#1", 
                    ",", "\"\<, pr=\>\"", ",", "#2", ",", "\"\<   \>\""}], 
                    "}"}], "]"}], "}"}], "&"}], "@@@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"PadLeft", "[", 
                    RowBox[{"Reverse", "/@", 
                    RowBox[{"Apply", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Switch", "[", 
                    RowBox[{
                    RowBox[{"#", "/.", 
                    RowBox[{"\[Epsilon]", "\[Rule]", "0"}]}], ",", 
                    RowBox[{"_", "?", "Positive"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Red"}], "]"}], ",", 
                    RowBox[{"_", "?", "Negative"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Blue"}], "]"}], ",", "_", ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"Darker", "@", "Green"}]}], "]"}]}], "]"}], "&"}],
                     "@", 
                    RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "1"}], "]"}], 
                    "]"}]}], ",", 
                    RowBox[{"clickedv", "[", 
                    RowBox[{"#1", ",", "#2", ",", "#3"}], "]"}], ",", 
                    RowBox[{"Enabled", "\[Rule]", 
                    RowBox[{"Dynamic", "[", "#6", "]"}]}], ",", 
                    RowBox[{"Appearance", "\[Rule]", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{"#7", ",", 
                    RowBox[{"{", 
                    RowBox[{"\"\<FramedPalette\>\"", ",", "\"\<Pressed\>\""}],
                     "}"}], ",", "\"\<FramedPalette\>\""}], "]"}], "]"}]}]}], 
                    "]"}], "&"}], ",", 
                    RowBox[{"SplitBy", "[", 
                    RowBox[{"indices", ",", "First"}], "]"}], ",", 
                    RowBox[{"{", "2", "}"}]}], "]"}]}], "\[IndentingNewLine]",
                     "]"}]}], "\[IndentingNewLine]", "}"}], "}"}], "]"}], ",", 
                 RowBox[{"Spacings", "\[Rule]", "0"}], ",", 
                 RowBox[{"ItemSize", "\[Rule]", "All"}], ",", 
                 RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Apply balance transformation\>\"", ",", 
                 RowBox[{
                  RowBox[{"continue", "=", "True"}], ";", 
                  RowBox[{"DialogReturn", "[", "]"}]}], ",", 
                 RowBox[{"Enabled", "->", 
                  RowBox[{"Dynamic", "[", "applyEnabled", "]"}]}], ",", 
                 RowBox[{"Background", "\[Rule]", 
                  RowBox[{"Dynamic", "[", "colorMark", "]"}]}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Button", "[", 
                RowBox[{"\"\<Paste overall transformation\>\"", ",", 
                 RowBox[{"DialogReturn", "[", "]"}], ",", 
                 RowBox[{"Background", "\[Rule]", 
                  RowBox[{"Dynamic", "[", "colorMark", "]"}]}]}], "]"}], 
               "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"Dynamic", "[", "statusline", "]"}], 
               "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "}"}], 
            ",", 
            RowBox[{"Alignment", "\[Rule]", "Center"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "forming"}], " ", "interface"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"unsetting", " ", "buttons"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"Through", "[", 
          RowBox[{"psetu", "[", "False", "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Through", "[", 
          RowBox[{"psetv", "[", "False", "]"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"/", "unsetting"}], " ", "buttons"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"continue", "=", "False"}], ";", "\[IndentingNewLine]", 
         RowBox[{"DialogInput", "[", "buttons", "]"}], ";"}], 
        "\[IndentingNewLine]", ")"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"apply", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Libra`Private`FCMonitor", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"applyEnabled", "=", "False"}], ";", "\[IndentingNewLine]", 
           RowBox[{"colorMark", "=", "Magenta"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"apply", " ", "transformation"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"statusline", "=", "\"\<Constructing balance...\>\""}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"balance", "=", 
            RowBox[{"Balance", "[", 
             RowBox[{
              RowBox[{"Projector", "[", 
               RowBox[{"(*", 
                RowBox[{"Transpose", "@"}], "*)"}], 
               RowBox[{"us", ",", "vs"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", "x1", ",", "x2"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"statusline", "=", 
            RowBox[{
            "statusline", "<>", 
             "\"\<\\nCalculating overall transformation...\>\""}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"transformation", "=", 
            RowBox[{"ODot", "[", 
             RowBox[{"transformation", ",", "balance"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"statusline", "=", 
            RowBox[{
            "statusline", "<>", "\"\<\\nApplying transformation...\>\""}]}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"m", "=", 
            RowBox[{"Transform", "[", 
             RowBox[{"m", ",", "balance", ",", "x"}], "]"}]}], ";"}], ",", 
          "\[IndentingNewLine]", "statusline"}], "]"}], "\[IndentingNewLine]",
         ")"}], "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"validate", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "pick", " ", "right", " ", "and", " ", "left", " ", "vectors"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"us", "=", 
          RowBox[{"vs", "=", 
           RowBox[{"{", "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"(", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{"#5", ",", 
               RowBox[{
                RowBox[{"us", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"us", ",", 
                   RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "2", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}]}], ";", 
                RowBox[{"x1", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}], ";", 
             RowBox[{"If", "[", 
              RowBox[{"#7", ",", 
               RowBox[{
                RowBox[{"vs", "=", 
                 RowBox[{"Join", "[", 
                  RowBox[{"vs", ",", 
                   RowBox[{"polesData", "[", 
                    RowBox[{"[", 
                    RowBox[{"#1", ",", "3", ",", "#2", ",", "3", ",", "#3"}], 
                    "]"}], "]"}]}], "]"}]}], ";", 
                RowBox[{"x2", "=", 
                 RowBox[{"polesData", "[", 
                  RowBox[{"[", 
                   RowBox[{"#1", ",", "1"}], "]"}], "]"}]}]}]}], "]"}]}], 
            ")"}], "&"}], "@@@", "indices"}], ";", "\[IndentingNewLine]", 
         RowBox[{"lu", "=", 
          RowBox[{"Length", "@", "us"}]}], ";", 
         RowBox[{"lv", "=", 
          RowBox[{"Length", "@", "vs"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"lu", "\[Equal]", "0"}], "||", 
            RowBox[{"lv", "\[Equal]", "0"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"applyEnabled", "=", "False"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"colorMark", "=", "Automatic"}]}], "\[IndentingNewLine]", 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"gram", "=", 
             RowBox[{"ODot", "[", 
              RowBox[{"vs", ",", 
               RowBox[{"Transpose", "@", "us"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"applyEnabled", "=", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"lu", "\[Equal]", "lv"}], "&&", 
               RowBox[{"lv", "\[Equal]", 
                RowBox[{"MatrixRank", "[", "gram", "]"}]}]}], ")"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"colorMark", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"MatrixRank", "[", "gram", "]"}], "\[Equal]", "lu"}], 
               ",", 
               RowBox[{"If", "[", 
                RowBox[{"applyEnabled", ",", "Green", ",", "Automatic"}], 
                "]"}], ",", "Red"}], "]"}]}]}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"statusline", "=", 
          RowBox[{
           RowBox[{"ToString", "[", "lu", "]"}], "<>", 
           "\"\<-dimensional u-space and \>\"", "<>", 
           RowBox[{"ToString", "[", "lv", "]"}], "<>", 
           "\"\<-dimensional v-space\>\""}]}], ";"}], "\[IndentingNewLine]", 
        ")"}], "&"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"clickedu", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "5"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetu", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{"{", 
                RowBox[{"#1", ",", "#2", ",", 
                 RowBox[{
                  RowBox[{"{", "k_", "}"}], "/;", 
                  RowBox[{"k", "\[GreaterEqual]", " ", 
                   RowBox[{"First", "[", "#3", "]"}]}]}], ",", "__"}], "}"}], 
               ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], " ", ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetu", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"clickedv", "=", 
      RowBox[{
       RowBox[{"(", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", "index", "}"}], "}"}], "=", 
          RowBox[{"Position", "[", 
           RowBox[{"indices", ",", 
            RowBox[{"{", 
             RowBox[{"#1", ",", "#2", ",", "#3", ",", "__"}], "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"indices", "[", 
            RowBox[{"[", 
             RowBox[{"index", ",", "7"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"psetv", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{"indices", ",", 
               RowBox[{"{", 
                RowBox[{"#1", ",", "#2", ",", 
                 RowBox[{
                  RowBox[{"{", "k_", "}"}], "/;", 
                  RowBox[{"k", "\[GreaterEqual]", " ", 
                   RowBox[{"First", "[", "#3", "]"}]}]}], ",", "__"}], "}"}], 
               ",", 
               RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetv", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"k_", ",", "__"}], "}"}], "/;", 
                 RowBox[{"k", "!=", " ", "#1"}]}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"psetu", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "[", "False", "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"Position", "[", 
               RowBox[{"indices", ",", 
                RowBox[{"{", 
                 RowBox[{"#1", ",", "__"}], "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"psetv", "[", 
              RowBox[{"[", "index", "]"}], "]"}], "[", "True", "]"}], ";"}]}],
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"validate", "[", "]"}], ";"}], "\[IndentingNewLine]", ")"}], 
       "&"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"While", "[", 
      RowBox[{"continue", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"updateInteface", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{"applyEnabled", ",", 
          RowBox[{"apply", "[", "]"}]}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "transformation"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.768883673229196*^9, 3.7688836833206387`*^9}, {
   3.7688837398431396`*^9, 3.768883761585402*^9}, 3.76888384553612*^9, {
   3.768883959448791*^9, 3.76888396790588*^9}, 3.768884265122773*^9, {
   3.768884394698118*^9, 3.7688843957404222`*^9}, {3.768884437885153*^9, 
   3.7688844406564283`*^9}, {3.768884603550152*^9, 3.7688846048273363`*^9}, {
   3.768884686230318*^9, 3.768884697363865*^9}, {3.768884805735989*^9, 
   3.768884849729986*^9}, {3.768885261952456*^9, 3.768885268272355*^9}, {
   3.768887286877696*^9, 3.768887353656507*^9}, 3.7688873897744083`*^9, 
   3.7688874326169577`*^9, {3.768887479626685*^9, 3.768887492091527*^9}, {
   3.7688876475953693`*^9, 3.768887655619399*^9}, {3.768887776168305*^9, 
   3.76888778134969*^9}, 3.768887829461048*^9, {3.768887892776437*^9, 
   3.768887966705843*^9}, {3.768888018252489*^9, 3.7688880730673523`*^9}, {
   3.768888150290524*^9, 3.7688881593881693`*^9}, {3.7688882760611877`*^9, 
   3.768888313332767*^9}, {3.768888369712187*^9, 3.768888404607811*^9}, {
   3.768888451659333*^9, 3.7688884872903337`*^9}, {3.7688885260013437`*^9, 
   3.768888538799514*^9}, {3.7688885797289953`*^9, 3.768888610614152*^9}, {
   3.768888669642646*^9, 3.7688886970393*^9}, {3.768890888669334*^9, 
   3.768890890538596*^9}, {3.7688910104845047`*^9, 3.768891031946739*^9}, {
   3.768891210887643*^9, 3.76889121992635*^9}, 3.768891542250896*^9, {
   3.768891876625001*^9, 3.768891876642634*^9}, {3.7688919147181*^9, 
   3.768891918910204*^9}, {3.768892121712277*^9, 3.768892127127733*^9}, {
   3.768892169080371*^9, 3.768892303912305*^9}, {3.768892454906122*^9, 
   3.768892464577695*^9}, {3.768892645793434*^9, 3.768892662715845*^9}, {
   3.768892755428076*^9, 3.768892755618445*^9}, {3.768892981259873*^9, 
   3.768892988592821*^9}, {3.768893077661159*^9, 3.768893152839888*^9}, {
   3.768893269694521*^9, 3.76889333518358*^9}, {3.7688934671752377`*^9, 
   3.7688934995138807`*^9}, {3.768893562135682*^9, 3.768893568885934*^9}, {
   3.768893948250082*^9, 3.7688939490977697`*^9}, 3.768894237919043*^9, {
   3.7688942695031013`*^9, 3.768894337222807*^9}, {3.768894525524055*^9, 
   3.76889453612249*^9}, 3.7688945706535797`*^9, {3.768894705942731*^9, 
   3.768894759352044*^9}, {3.7688950014400673`*^9, 3.768895015879937*^9}, {
   3.7688950534973593`*^9, 3.768895076726639*^9}, {3.7688951282365503`*^9, 
   3.768895128521174*^9}, {3.768895165175178*^9, 3.768895170283161*^9}, 
   3.768895212569784*^9, {3.768895253850604*^9, 3.7688952666650267`*^9}, 
   3.768895318928771*^9, {3.768895462969563*^9, 3.768895475586203*^9}, 
   3.768895639075342*^9, {3.768895784098667*^9, 3.768895828040162*^9}, 
   3.768896952328436*^9, {3.7689584096196613`*^9, 3.768958414801444*^9}, {
   3.7689609419523363`*^9, 3.768961041338532*^9}, {3.768961081515246*^9, 
   3.76896110434761*^9}, 3.768961136554397*^9, {3.769028906275814*^9, 
   3.7690289381086197`*^9}, {3.7690297613937387`*^9, 3.769029765929029*^9}, {
   3.769029942728528*^9, 3.7690300044885883`*^9}, {3.769030110536378*^9, 
   3.769030118300109*^9}, {3.769030237624324*^9, 3.769030248120461*^9}, {
   3.7690319749925756`*^9, 3.769032032801787*^9}, {3.769032145453845*^9, 
   3.76903215499476*^9}, {3.769032241982126*^9, 3.769032256944352*^9}, {
   3.769032343583706*^9, 3.769032401041994*^9}, {3.769032525826779*^9, 
   3.769032527001409*^9}, {3.769032714484827*^9, 3.769032774472619*^9}, {
   3.769032811755013*^9, 3.7690328174949102`*^9}, 3.7690328799963417`*^9, {
   3.769033149694045*^9, 3.769033154631096*^9}, {3.769133555954192*^9, 
   3.769133564529211*^9}, {3.769133764772559*^9, 3.769133769746258*^9}, {
   3.769133881367518*^9, 3.769133941674693*^9}, {3.76913397429084*^9, 
   3.769134058519753*^9}, {3.769828331143759*^9, 3.769828361383753*^9}, 
   3.7698285916083517`*^9, {3.7698288932490377`*^9, 3.76982891328189*^9}, {
   3.769831196708028*^9, 3.769831234007399*^9}, {3.7698336938430243`*^9, 
   3.769833695562459*^9}, 3.769834504720085*^9, 3.770591898042718*^9, {
   3.7706032446081142`*^9, 3.770603244975358*^9}, {3.7707853048820467`*^9, 
   3.7707853106916447`*^9}, {3.770785605820609*^9, 3.770785609127146*^9}, {
   3.770785643412841*^9, 3.770785645239699*^9}, 3.770785772749764*^9, {
   3.7707858039563293`*^9, 3.770785804350584*^9}, {3.770788630385488*^9, 
   3.7707887411186237`*^9}, {3.770788776158133*^9, 3.77078888890979*^9}},
 ExpressionUUID -> "3d203fc1-9cec-4631-b975-e90cb10bf401"]
}, Open  ]],

Cell[CellGroupData[{

Cell["FactorOut", "Subsubsection",
 CellChangeTimes->{{3.721451730181402*^9, 3.721451733061451*^9}},
 ExpressionUUID -> "fe6d2117-258c-453c-917f-7ccfe05dfaf2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", "\"\<FactorOut: make clever sorting of the equations\>\"", 
   "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.7692429754407187`*^9, 3.769243003138386*^9}},
 ExpressionUUID -> "854e1b33-b1fa-45ba-804a-2d534ec9c4a5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "::", "usage"}], "=", 
   "\"\<FactorOut[m,x,\[Epsilon],\[Mu]] returns a transformation which \
reduces m to a factorized form.\>\""}], ";"}]], "Code",
 ExpressionUUID -> "16582b37-dab7-47c9-ab44-068f52c48b55"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "::", "notfuchsian"}], "=", 
   "\"\<Not Fuchsian matrix...\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "::", "notnormalized"}], "=", 
   "\"\<Eigenvalues of the matrix residues are not normalized...\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FactorOut", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"DependentRowIndices", "\[Rule]", "Automatic"}], ",", 
     RowBox[{"Solve", "\[Rule]", "True"}]}], "}"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.6253279815119176`*^9, 3.6253279823424683`*^9}, {
   3.6253282372536464`*^9, 3.625328256242247*^9}, {3.62532828821647*^9, 
   3.6253283738362927`*^9}, {3.6253284129722652`*^9, 3.62532844785942*^9}, {
   3.625328478441716*^9, 3.625328479057125*^9}, {3.6253289261178412`*^9, 
   3.625328959835209*^9}, {3.6253290055805655`*^9, 3.625329488837291*^9}, {
   3.62532952614205*^9, 3.6253296483329935`*^9}, {3.625329687642082*^9, 
   3.625329690137742*^9}, {3.6253297578837*^9, 3.6253300370629845`*^9}, {
   3.625330083973117*^9, 3.62533016369903*^9}, {3.6253302504975204`*^9, 
   3.625330254389104*^9}, {3.6253305102278976`*^9, 3.625330586282373*^9}, {
   3.625330627313605*^9, 3.6253306426277685`*^9}, {3.6253307256938972`*^9, 
   3.625330764002321*^9}, {3.625331772413579*^9, 3.625331837835998*^9}, {
   3.6255554236457925`*^9, 3.625555429400611*^9}, 3.636862761365727*^9, {
   3.636862802513592*^9, 3.636862802794469*^9}, {3.6816103356962137`*^9, 
   3.681610335845941*^9}, {3.6816103839804583`*^9, 3.681610497927836*^9}, {
   3.681613681267647*^9, 3.681613693064554*^9}, {3.6816137421577272`*^9, 
   3.68161384066824*^9}, {3.681614045343399*^9, 3.681614046478931*^9}, {
   3.705891671092375*^9, 3.7058918817318497`*^9}, {3.705892929866144*^9, 
   3.705892941050314*^9}, {3.721451842386711*^9, 3.721451863369669*^9}, {
   3.7214522524357777`*^9, 3.721452328837083*^9}, 3.721452507845632*^9, {
   3.721452574746566*^9, 3.7214525764696302`*^9}, 3.721452606641981*^9, {
   3.7214527629343767`*^9, 3.721452781221694*^9}, {3.721452825693466*^9, 
   3.72145286030191*^9}, {3.721452965375201*^9, 3.721452972511736*^9}, 
   3.721953765052177*^9, 3.7219538975323*^9, {3.722576554134058*^9, 
   3.722576557078549*^9}, {3.722576697502305*^9, 3.7225767081658583`*^9}, {
   3.722576756390956*^9, 3.722576790014408*^9}, {3.723250276245151*^9, 
   3.723250287332571*^9}},
 ExpressionUUID -> "ecf0eabb-f4b3-425e-92fd-b920b1dd806f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_", ",", "\[Epsilon]_", ",", 
     "\[Mu]_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"FactorOut", "[", 
    RowBox[{
     RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", "\[Mu]",
      ",", "opts"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorOut", "[", 
    RowBox[{
    "as_Association", ",", "x_", ",", "\[Epsilon]_", ",", "\[Mu]_", ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   RowBox[{"FactorOut", "[", 
    RowBox[{
     RowBox[{"as", "[", "x", "]"}], ",", "x", ",", "\[Epsilon]", ",", "\[Mu]",
      ",", "opts"}], "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.6253279815119176`*^9, 3.6253279823424683`*^9}, {
   3.6253282372536464`*^9, 3.625328256242247*^9}, {3.62532828821647*^9, 
   3.6253283738362927`*^9}, {3.6253284129722652`*^9, 3.62532844785942*^9}, {
   3.625328478441716*^9, 3.625328479057125*^9}, {3.6253289261178412`*^9, 
   3.625328959835209*^9}, {3.6253290055805655`*^9, 3.625329488837291*^9}, {
   3.62532952614205*^9, 3.6253296483329935`*^9}, {3.625329687642082*^9, 
   3.625329690137742*^9}, {3.6253297578837*^9, 3.6253300370629845`*^9}, {
   3.625330083973117*^9, 3.62533016369903*^9}, {3.6253302504975204`*^9, 
   3.625330254389104*^9}, {3.6253305102278976`*^9, 3.625330586282373*^9}, {
   3.625330627313605*^9, 3.6253306426277685`*^9}, {3.6253307256938972`*^9, 
   3.625330764002321*^9}, {3.625331772413579*^9, 3.625331837835998*^9}, {
   3.6255554236457925`*^9, 3.625555429400611*^9}, 3.636862761365727*^9, {
   3.636862802513592*^9, 3.636862802794469*^9}, {3.6816103356962137`*^9, 
   3.681610335845941*^9}, {3.6816103839804583`*^9, 3.681610497927836*^9}, {
   3.681613681267647*^9, 3.681613693064554*^9}, {3.6816137421577272`*^9, 
   3.68161384066824*^9}, {3.681614045343399*^9, 3.681614046478931*^9}, {
   3.705891671092375*^9, 3.7058918817318497`*^9}, {3.705892929866144*^9, 
   3.705892941050314*^9}, {3.721451842386711*^9, 3.721451863369669*^9}, {
   3.7214522524357777`*^9, 3.721452328837083*^9}, 3.721452507845632*^9, {
   3.721452574746566*^9, 3.7214525764696302`*^9}, 3.721452606641981*^9, {
   3.7214527629343767`*^9, 3.721452781221694*^9}, {3.721452825693466*^9, 
   3.72145286030191*^9}, {3.721452965375201*^9, 3.721452972511736*^9}, 
   3.721953765052177*^9, 3.7219538975323*^9, {3.722576554134058*^9, 
   3.722576557078549*^9}, {3.722576697502305*^9, 3.7225767081658583`*^9}, {
   3.722576756390956*^9, 3.722576790014408*^9}, {3.723250276245151*^9, 
   3.723250280613402*^9}, {3.7232503472067966`*^9, 3.723250357262085*^9}},
 ExpressionUUID -> "af239a6f-0016-4752-b9ee-e11ae4f752d7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FactorOut", "[", 
   RowBox[{
    RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "x_", ",", "\[Epsilon]_", ",", 
    "\[Mu]_", ",", 
    RowBox[{"opts", ":", 
     RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "m"}]}], ",", "mres", ",", "t", ",", "vars", 
      ",", "eqs", ",", "sol", ",", "ms"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"FuchsianQ", "[", 
         RowBox[{"m", ",", "x"}], "]"}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FactorOut", "::", "notfuchsian"}], "]"}], ";", 
        RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", 
     RowBox[{"ms", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "DependentRowIndices", "]"}], ",", 
        RowBox[{"Automatic", "\[Rule]", 
         RowBox[{"TClosure", "[", "m", "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"mres", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"LeadingSeriesCoefficient", "[", 
         RowBox[{
          FractionBox["m", "\[Epsilon]"], ",", 
          RowBox[{"{", 
           RowBox[{"x", ",", "#1", ",", "0"}], "}"}]}], "]"}], "&"}], "@@@", 
       RowBox[{"PolesInfo", "[", 
        RowBox[{"m", ",", "x"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"FactorDependence", "[", 
      RowBox[{"mres", ",", "\[Epsilon]", ",", "\[Mu]", ",", 
       RowBox[{"Sequence", "@@", 
        RowBox[{"FilterRules", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"#", "\[Rule]", 
             RowBox[{"OptionValue", "[", "#", "]"}]}], "&"}], "@@@", 
           RowBox[{"Options", "[", "FactorOut", "]"}]}], ",", 
          RowBox[{"Options", "[", "FactorDependence", "]"}]}], "]"}]}]}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.6253279815119176`*^9, 3.6253279823424683`*^9}, {
   3.6253282372536464`*^9, 3.625328256242247*^9}, {3.62532828821647*^9, 
   3.6253283738362927`*^9}, {3.6253284129722652`*^9, 3.62532844785942*^9}, {
   3.625328478441716*^9, 3.625328479057125*^9}, {3.6253289261178412`*^9, 
   3.625328959835209*^9}, {3.6253290055805655`*^9, 3.625329488837291*^9}, {
   3.62532952614205*^9, 3.6253296483329935`*^9}, {3.625329687642082*^9, 
   3.625329690137742*^9}, {3.6253297578837*^9, 3.6253300370629845`*^9}, {
   3.625330083973117*^9, 3.62533016369903*^9}, {3.6253302504975204`*^9, 
   3.625330254389104*^9}, {3.6253305102278976`*^9, 3.625330586282373*^9}, {
   3.625330627313605*^9, 3.6253306426277685`*^9}, {3.6253307256938972`*^9, 
   3.625330764002321*^9}, {3.625331772413579*^9, 3.625331837835998*^9}, {
   3.6255554236457925`*^9, 3.625555429400611*^9}, 3.636862761365727*^9, {
   3.636862802513592*^9, 3.636862802794469*^9}, {3.6816103356962137`*^9, 
   3.681610335845941*^9}, {3.6816103839804583`*^9, 3.681610497927836*^9}, {
   3.681613681267647*^9, 3.681613693064554*^9}, {3.6816137421577272`*^9, 
   3.68161384066824*^9}, {3.681614045343399*^9, 3.681614046478931*^9}, {
   3.705891671092375*^9, 3.7058918817318497`*^9}, {3.705892929866144*^9, 
   3.705892941050314*^9}, {3.721451842386711*^9, 3.721451863369669*^9}, {
   3.7214522524357777`*^9, 3.721452328837083*^9}, 3.721452507845632*^9, {
   3.721452574746566*^9, 3.7214525764696302`*^9}, 3.721452606641981*^9, {
   3.7214527629343767`*^9, 3.721452781221694*^9}, {3.721452825693466*^9, 
   3.72145286030191*^9}, {3.721452965375201*^9, 3.721452972511736*^9}, 
   3.721953765052177*^9, 3.7219538975323*^9, {3.722576554134058*^9, 
   3.722576557078549*^9}, {3.722576697502305*^9, 3.7225767081658583`*^9}, {
   3.722576756390956*^9, 3.72257677301479*^9}, {3.72257688607679*^9, 
   3.722576888244738*^9}, {3.722576932944145*^9, 3.722576946088687*^9}},
 ExpressionUUID -> "02b5df31-d064-49bd-bf45-9d08c81f9349"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", "\"\<rewrite FactorOut in the spirit of SimplifyFuchsian\>\"", 
   "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.7219782811805468`*^9, 3.7219783244393473`*^9}},
 ExpressionUUID -> "43129ed5-ae3b-448b-b720-b128f46e9879"]
}, Closed]],

Cell[CellGroupData[{

Cell["FactorDependence", "Subsubsection",
 CellChangeTimes->{{3.721451730181402*^9, 3.721451733061451*^9}, {
  3.7225586958231983`*^9, 3.72255877230505*^9}},
 ExpressionUUID -> "40819208-9aa1-436b-9799-936da3a7ffe2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FactorDependence", "::", "usage"}], "=", 
   "\"\<FactorDependence[{m1,m2,\[Ellipsis]},\[Epsilon],\[Mu]] returns a \
transformation which reduces m1,m2,... to \[Epsilon]\[LongDash]independent \
matrices.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.72255878207178*^9, 3.722558868020969*^9}},
 ExpressionUUID -> "f0bf5cf0-45a3-491c-8eb3-e7b8649e9dfe"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "FactorDependence", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"DependentRowIndices", "\[Rule]", "Automatic"}], ",", 
     RowBox[{"Solve", "\[Rule]", "True"}], ",", 
     RowBox[{"UseFermat", "\[Rule]", "False"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FactorDependence", "[", 
   RowBox[{
    RowBox[{"m", ":", 
     RowBox[{"{", 
      RowBox[{"__", "?", "SquareMatrixQ"}], "}"}]}], ",", "\[Epsilon]_", ",", 
    "\[Mu]_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "[", 
        RowBox[{"First", "@", "m"}], "]"}]}], ",", "t", ",", "vars", ",", 
      "eqs", ",", "sol", ",", "ms"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ms", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"OptionValue", "[", "DependentRowIndices", "]"}], ",", 
        RowBox[{"Automatic", "\[Rule]", 
         RowBox[{"tclosure", "[", 
          RowBox[{
           RowBox[{"Transpose", "[", 
            RowBox[{"m", ",", 
             RowBox[{"{", 
              RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], ",", "1", 
           ",", 
           RowBox[{"Except", "[", 
            RowBox[{"{", 
             RowBox[{"0", ".."}], "}"}], "]"}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "insert", " ", "here", " ", "check", " ", "for", " ", "normalization"}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"t", "=", 
      RowBox[{"ConstantArray", "[", 
       RowBox[{"0", ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"vars", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"t", "[", 
           RowBox[{"[", "##", "]"}], "]"}], "=", 
          RowBox[{"Unique", "[", "\"\<t\>\"", "]"}]}], ")"}], "&"}], "@@@", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Outer", "[", 
            RowBox[{"List", ",", 
             RowBox[{"{", "#", "}"}], ",", 
             RowBox[{"DependentRowIndices", "[", 
              RowBox[{"ms", ",", 
               RowBox[{"{", "#", "}"}]}], "]"}]}], "]"}], "&"}], "/@", 
          RowBox[{"Range", "[", "n", "]"}]}], ",", "2"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"eqs", "=", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ODot", "[", 
                RowBox[{"#", ",", "t"}], "]"}], "-", 
               RowBox[{"ODot", "[", 
                RowBox[{"t", ",", 
                 RowBox[{"#", "/.", 
                  RowBox[{"\[Epsilon]", "\[Rule]", "\[Mu]"}]}]}], "]"}]}], 
              ")"}], "&"}], "/@", "m"}], "]"}], ",", "ByteCount"}], "]"}]}], 
       ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"eqs", "=", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Transpose", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"ODot", "[", 
                RowBox[{"#", ",", "t", ",", 
                 RowBox[{"Together", "\[Rule]", "False"}]}], "]"}], "-", 
               RowBox[{"ODot", "[", 
                RowBox[{"t", ",", 
                 RowBox[{"#", "/.", 
                  RowBox[{"\[Epsilon]", "\[Rule]", "\[Mu]"}]}], ",", 
                 RowBox[{"Together", "\[Rule]", "False"}]}], "]"}]}], ")"}], 
             "&"}], "/@", "m"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "1", ",", "2"}], "}"}]}], "]"}], "]"}], ",", 
        "0"}], "]"}]}], ";", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"OptionValue", "[", "Solve", "]"}]}], ",", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Returning a pair {eqs,t}. To find the transformation one should \
solve eqs\[Equal]0 with respect to Variables[t] and substitute the solution \
to t.\>\"", "]"}], ";", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"eqs", ",", "t"}], "}"}], "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Quiet", "[", 
      RowBox[{"sol", "=", 
       RowBox[{"GaussSolve", "[", 
        RowBox[{"eqs", ",", "vars"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "/.", "sol"}], "/.", 
      RowBox[{"MapIndexed", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Rule]", 
          RowBox[{"C", "@@", "#2"}]}], "&"}], ",", 
        RowBox[{"Complement", "[", 
         RowBox[{"vars", ",", 
          RowBox[{"First", "/@", "sol"}]}], "]"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.6253279815119176`*^9, 3.6253279823424683`*^9}, {
   3.6253282372536464`*^9, 3.625328256242247*^9}, {3.62532828821647*^9, 
   3.6253283738362927`*^9}, {3.6253284129722652`*^9, 3.62532844785942*^9}, {
   3.625328478441716*^9, 3.625328479057125*^9}, {3.6253289261178412`*^9, 
   3.625328959835209*^9}, {3.6253290055805655`*^9, 3.625329488837291*^9}, {
   3.62532952614205*^9, 3.6253296483329935`*^9}, {3.625329687642082*^9, 
   3.625329690137742*^9}, {3.6253297578837*^9, 3.6253300370629845`*^9}, {
   3.625330083973117*^9, 3.62533016369903*^9}, {3.6253302504975204`*^9, 
   3.625330254389104*^9}, {3.6253305102278976`*^9, 3.625330586282373*^9}, {
   3.625330627313605*^9, 3.6253306426277685`*^9}, {3.6253307256938972`*^9, 
   3.625330764002321*^9}, {3.625331772413579*^9, 3.625331837835998*^9}, {
   3.6255554236457925`*^9, 3.625555429400611*^9}, 3.636862761365727*^9, {
   3.636862802513592*^9, 3.636862802794469*^9}, {3.6816103356962137`*^9, 
   3.681610335845941*^9}, {3.6816103839804583`*^9, 3.681610497927836*^9}, {
   3.681613681267647*^9, 3.681613693064554*^9}, {3.6816137421577272`*^9, 
   3.68161384066824*^9}, {3.681614045343399*^9, 3.681614046478931*^9}, {
   3.705891671092375*^9, 3.7058918817318497`*^9}, {3.705892929866144*^9, 
   3.705892941050314*^9}, {3.721451842386711*^9, 3.721451863369669*^9}, {
   3.7214522524357777`*^9, 3.721452328837083*^9}, 3.721452507845632*^9, {
   3.721452574746566*^9, 3.7214525764696302`*^9}, 3.721452606641981*^9, {
   3.7214527629343767`*^9, 3.721452781221694*^9}, {3.721452825693466*^9, 
   3.72145286030191*^9}, {3.721452965375201*^9, 3.721452972511736*^9}, 
   3.721953765052177*^9, 3.7219538975323*^9, {3.722558878615649*^9, 
   3.72255899092308*^9}, 3.722559050676868*^9, {3.722559091028425*^9, 
   3.722559098294598*^9}, {3.7225591786640987`*^9, 3.722559214417663*^9}, {
   3.722559246872656*^9, 3.7225592732400217`*^9}, {3.72255932582837*^9, 
   3.722559325956849*^9}, {3.722559484806509*^9, 3.722559494816758*^9}, {
   3.722559632856444*^9, 3.722559637240152*^9}, {3.723250311413713*^9, 
   3.723250319581985*^9}, {3.725939481482831*^9, 3.7259394909233932`*^9}, {
   3.7259397135478067`*^9, 3.7259397147158833`*^9}, {3.7277441055662203`*^9, 
   3.727744119526379*^9}, {3.727745658656651*^9, 3.727745663880212*^9}, {
   3.727745729730608*^9, 3.727745729732333*^9}, {3.727779562972131*^9, 
   3.7277795658003063`*^9}, {3.768532169758871*^9, 3.7685322095683107`*^9}, {
   3.7685324409995747`*^9, 3.7685324464274054`*^9}, 3.7685352299035597`*^9, {
   3.769389507054069*^9, 3.769389510774941*^9}, {3.769389648535047*^9, 
   3.769389677999716*^9}, {3.769389822769636*^9, 3.769389823488871*^9}, {
   3.769504041042862*^9, 3.769504048634678*^9}, {3.7698072172034683`*^9, 
   3.7698072350290823`*^9}, {3.770004341183547*^9, 3.770004363234496*^9}},
 ExpressionUUID -> "5d9cb8ba-a2c3-4fc4-b15d-f782dbbdc13d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", 
   "\"\< implement FactorOut and FactorDependence using Fermat and \
FGaussSolve\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.728183252654107*^9, 3.728183288685647*^9}, {
  3.7697466928169127`*^9, 3.76974669359275*^9}},
 ExpressionUUID -> "daa4be2e-c00d-44c9-a60b-bcf216c4a7ff"]
}, Closed]],

Cell[CellGroupData[{

Cell["BlockTriangularToFuchsian", "Subsubsection",
 CellChangeTimes->{
  3.7185784431616087`*^9, {3.719597588805992*^9, 3.719597599101102*^9}, {
   3.7217290573432302`*^9, 3.721729150011833*^9}, {3.721729676481063*^9, 
   3.721729694087757*^9}, {3.7225770311508007`*^9, 3.7225770331751432`*^9}},
 ExpressionUUID -> "51561b0f-dee9-4af6-91d1-d273e8cb6158"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BlockTriangularToFuchsian", "::", "usage"}], "=", 
   "\"\<BlockTriangularToFuchsian[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] gets rid of multiple poles in off-diagonal \
elements.\\nBlockTriangularToFuchsian[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\),\!\(\*
StyleBox[\"{\", \"TI\"]\)\!\(\*
StyleBox[SubscriptBox[\"p\", \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"p\", \"TI\"], \"2\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\)\!\(\*
StyleBox[\"}\", \"TI\"]\)] gets rid of multiple poles in off-diagonal \
elements for points \!\(\*
StyleBox[SubscriptBox[\"p\", \"1\"], \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"p\", \"TI\"], \"2\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"\[Ellipsis]\", \"TI\"]\) only. Each \!\(\*
StyleBox[SubscriptBox[\"p\", \"i\"], \"TI\"]\) is either a point \!\(\*
StyleBox[\"p\", \"TI\"]\) or a pair {\!\(\*
StyleBox[\"p\", \"TI\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*
StyleBox[\"r\", \"TI\"]\)}, where \!\(\*
StyleBox[\"r\", \"TI\"]\) is a Poincare rank.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.625389554485264*^9, 3.625389668360841*^9}, {
  3.6253907600833893`*^9, 3.6253907606147423`*^9}, {3.6278829977877383`*^9, 
  3.6278830369077015`*^9}, {3.7225650225607443`*^9, 3.722565022737211*^9}, {
  3.767160433497561*^9, 3.767160670240074*^9}},
 ExpressionUUID -> "475709c8-f628-45c5-855b-cc00e2fba0f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "BlockTriangularToFuchsian", "]"}], "=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{"Simplify", "\[Rule]", "False"}], 
    RowBox[{"(*", 
     RowBox[{
     "whether", " ", "to", " ", "simplify", " ", "simple", " ", "poles"}], 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{",", 
      RowBox[{"Check", "\[Rule]", "True"}]}], 
     RowBox[{"(*", 
      RowBox[{
      "whether", " ", "to", " ", "check", " ", "if", " ", "diagonal", " ", 
       "blocks", " ", "are", " ", "fuchsian"}], "*)"}], "*)"}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.7225652030752573`*^9, 3.722565221519306*^9}, {
  3.727136331626996*^9, 3.727136335112133*^9}, {3.727136405795583*^9, 
  3.727136445970522*^9}, {3.727136488294429*^9, 3.727136511490522*^9}},
 ExpressionUUID -> "5896600d-0c94-4d1f-98a0-92e4c3ef2120"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BlockTriangularToFuchsian", "[", 
    RowBox[{
     RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_", ",", 
     RowBox[{"p", ":", 
      RowBox[{"(", 
       RowBox[{"_List", "|", "All"}], ")"}], ":", "All"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"BlockTriangularToFuchsian", "[", 
    RowBox[{
     RowBox[{"ds", "[", "x", "]"}], ",", "x", ",", "p", ",", "opts"}], 
    "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.722576385956354*^9, 3.722576428596874*^9}, 
   3.722754126340829*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BlockTriangularToFuchsian", "[", 
    RowBox[{"as_Association", ",", "x_", ",", 
     RowBox[{"p", ":", 
      RowBox[{"(", 
       RowBox[{"_List", "|", "All"}], ")"}], ":", "All"}], ",", 
     RowBox[{"opts", ":", 
      RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"BlockTriangularToFuchsian", "[", 
    RowBox[{
     RowBox[{"as", "[", "x", "]"}], ",", "x", ",", "p", ",", "opts"}], 
    "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.722576385956354*^9, 3.722576428596874*^9}, 
   3.722754126340829*^9, {3.723250387533922*^9, 3.72325040207794*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"BlockTriangularToFuchsian", "::", "blocks"}], "=", 
   "\"\<Diagonal blocks are not Fuchsian...\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BlockTriangularToFuchsian", "[", 
   RowBox[{"matr_", ",", "x_", ",", 
    RowBox[{"p", ":", 
     RowBox[{"(", 
      RowBox[{"_List", "|", "All"}], ")"}], ":", "All"}], ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "matr"}]}], ",", "order", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"m", "=", "matr"}], ",", "mt", ",", "i1", ",", "i2", ",", 
      "\[IndentingNewLine]", "ind1", ",", "ind2", ",", "t", ",", "o", ",", 
      "vars", ",", "sol", ",", "\[IndentingNewLine]", "transform", ",", "c", 
      ",", "\[IndentingNewLine]", "poles", ",", 
      RowBox[{"oc", "=", 
       RowBox[{"Boole", "[", 
        RowBox[{"Not", "[", 
         RowBox[{"TrueQ", "@", 
          RowBox[{"OptionValue", "[", "Simplify", "]"}]}], "]"}], "]"}]}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"blocks", "=", 
       RowBox[{"EntangledBlocksIndices", "[", "matr", "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Modified", " ", "18.05", ".2019"}], "*)"}], 
    RowBox[{
     RowBox[{"poles", "=", 
      RowBox[{"Reverse", "@", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{
         RowBox[{"Replace", "[", 
          RowBox[{"p", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"All", ":>", 
              RowBox[{"PolesInfo", "[", 
               RowBox[{"matr", ",", "x"}], "]"}]}], ",", 
             RowBox[{"_", "\[RuleDelayed]", 
              RowBox[{"Replace", "[", 
               RowBox[{"p", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"z_List", "\[RuleDelayed]", "z"}], ",", 
                  RowBox[{"z_", ":>", 
                   RowBox[{"{", 
                    RowBox[{"z", ",", 
                    RowBox[{"PoincareRank", "[", 
                    RowBox[{"matr", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "z"}], "}"}]}], "]"}]}], "}"}]}]}], 
                 "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}]}]}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", 
           RowBox[{"_", "?", "Negative"}]}], "}"}]}], "]"}]}]}], 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"/", "Modified"}], " ", "18.05", ".2019"}], "*)"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"transform", "=", 
      RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"poles", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", "transform", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"(*", 
       RowBox[{"Deleted", " ", "09.02", ".2018"}], "*)"}], 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "Check", "]"}], ",", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"And", "@@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"FuchsianQ", "[", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"#", ",", "#"}], "]"}], "]"}], ",", "x"}], "]"}], 
                 "&"}], "/@", "blocks"}], ")"}]}]}], ",", 
            RowBox[{"Message", "[", 
             RowBox[{"BlockTriangularToFuchsian", "::", "blocks"}], "]"}]}], 
           "]"}], ";", 
          RowBox[{"Return", "[", 
           RowBox[{"IdentityMatrix", "[", "n", "]"}], "]"}]}]}], "]"}], ";"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"/", "Deleted"}], " ", "09.02", ".2018"}], "*)"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x0", ",", "order"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Cycle", " ", "over", " ", 
          RowBox[{"blocks", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"FCMonitor", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"First", ",", " ", 
             RowBox[{"generate", " ", "matrix"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"i2", "=", "\"\<?\>\""}], ";", "\[IndentingNewLine]", 
             RowBox[{"c", "=", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"0", ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ind1", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"blocks", "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], ";", 
             RowBox[{"ind2", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"blocks", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", 
                  RowBox[{"(", 
                   RowBox[{"i1", "-", "1"}], ")"}]}], "]"}], "]"}], "]"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"vars", "=", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Unique", "[", "\"\<c\>\"", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Length", "@", "ind1"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Length", "@", "ind2"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], "=", "vars"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"vars", "=", 
              RowBox[{"Flatten", "@", "vars"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"matrix", " ", "generated"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"(*", 
               RowBox[{"Deleted", " ", "19.05", ".2019"}], "*)"}], 
              RowBox[{
               RowBox[{"order", "=", 
                RowBox[{"PoincareRank", "[", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ";"}], 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"/", "Deleted"}], " ", "19.05", ".2019"}], "*)"}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "Now", " ", "cycle", " ", "over", " ", "pole", " ", "order"}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"Unset", "[", "i2", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"CWrite", "[", 
                 RowBox[{"\"\<\\n\>\"", "<>", 
                  RowBox[{"ToString", "[", "x0", "]"}], "<>", "\"\<:\>\"", "<>", 
                  RowBox[{"ToString", "[", "i1", "]"}], "<>", 
                  "\"\<\[LeftArrow]\>\"", "<>", "\"\<i2\>\""}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"x0", "=!=", "\[Infinity]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t", "=", 
                    RowBox[{
                    RowBox[{"IdentityMatrix", "[", "n", "]"}], "+", 
                    RowBox[{"c", "/", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x", "-", "x0"}], ")"}], "^", "i2"}]}]}]}], ";", 
                   RowBox[{"o", "=", 
                    RowBox[{"-", "1"}]}]}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t", "=", 
                    RowBox[{
                    RowBox[{"IdentityMatrix", "[", "n", "]"}], "+", 
                    RowBox[{"c", "*", 
                    RowBox[{
                    RowBox[{"(", "x", ")"}], "^", "i2"}]}]}]}], ";", 
                   RowBox[{"o", "=", "1"}]}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"mt", "=", 
                 RowBox[{"Transform", "[", 
                  RowBox[{"m", ",", "t", ",", "x"}], "]"}]}], ";", 
                RowBox[{"(*", 
                 RowBox[{"TODO", ":", " ", 
                  RowBox[{
                  "here", " ", "Fermat", " ", "should", " ", "not", " ", "be",
                    " ", "used"}]}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"Quiet", "[", 
                 RowBox[{
                  RowBox[{"Check", "[", 
                   RowBox[{
                    RowBox[{"sol", "=", 
                    RowBox[{"GaussSolve", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i2", ">", "0"}], ",", "SortBy", ",", 
                    RowBox[{"#1", "&"}]}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{
                    RowBox[{"mt", "[", 
                    RowBox[{"[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "x0", ",", 
                    RowBox[{"o", "-", "i2"}]}], "}"}]}], "]"}], "]"}], ",", 
                    "ByteCount"}], "]"}], ",", "vars"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i2", ">", "0"}], ",", 
                    RowBox[{"Print", "[", "\"\<Problem\>\"", "]"}]}], "]"}], 
                    ";", 
                    RowBox[{"Continue", "[", "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"GaussSolve", "::", "inconsistent"}], "}"}]}], 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"GaussSolve", "::", "inconsistent"}], "}"}]}], 
                 "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"m", "=", 
                 RowBox[{"Factor", "[", 
                  RowBox[{
                   RowBox[{"mt", "/.", "sol"}], "/.", 
                   RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "@", "c"}], "\[Rule]", "0"}], "]"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"transform", "=", 
                 RowBox[{"ODot", "[", 
                  RowBox[{"transform", ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"t", "/.", "sol"}], "/.", 
                    RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "@", "c"}], "\[Rule]", "0"}], "]"}]}], 
                    ")"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i2", ",", "order", ",", "oc", ",", 
                 RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", "2", ",", 
              RowBox[{"Length", "@", "blocks"}]}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{
            "x0", ",", "\"\<:\>\"", ",", "i1", ",", "\"\<\[LeftArrow]\>\"", 
             ",", "i2"}], "}"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
       "]"}], 
      RowBox[{"(*", 
       RowBox[{"Modified", " ", "19.05", ".2019"}], "*)"}], "@@@", "poles"}], 
     ";", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"/", "Modified"}], " ", "19.05", ".2019"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "transform", "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.625378712674498*^9, 3.625378972668049*^9}, {
   3.625379019330018*^9, 3.6253791308640404`*^9}, {3.6253793118251395`*^9, 
   3.6253793259975457`*^9}, {3.625379370174864*^9, 3.625379375779585*^9}, {
   3.625379411205097*^9, 3.6253795419668784`*^9}, {3.625380216321431*^9, 
   3.6253802943882427`*^9}, {3.6253803247984247`*^9, 
   3.6253804168114915`*^9}, {3.6253807586753774`*^9, 3.625380892367106*^9}, {
   3.6253814177845078`*^9, 3.6253817359276514`*^9}, {3.6253817844948835`*^9, 
   3.6253818856520195`*^9}, {3.6253825433395095`*^9, 
   3.6253828422849126`*^9}, {3.625382917682953*^9, 3.625382979571026*^9}, {
   3.6253830148034086`*^9, 3.6253830852671747`*^9}, {3.6253831222056894`*^9, 
   3.6253831668463163`*^9}, {3.6253834044930363`*^9, 
   3.6253834191157417`*^9}, {3.6253835080647745`*^9, 
   3.6253835104863815`*^9}, {3.625383562265746*^9, 3.625383567175004*^9}, {
   3.6253837402155776`*^9, 3.625383753349295*^9}, {3.6253838154533157`*^9, 
   3.6253838185503716`*^9}, {3.6253839748190823`*^9, 3.625383978005197*^9}, {
   3.6253841103230133`*^9, 3.625384116866356*^9}, {3.62538428029482*^9, 
   3.625384388354536*^9}, {3.625384487435293*^9, 3.6253844973548765`*^9}, {
   3.625388601183956*^9, 3.6253886077443094`*^9}, 3.625388788919552*^9, {
   3.6253888232983675`*^9, 3.6253888260111675`*^9}, 3.6253899755076866`*^9, {
   3.6253906054777813`*^9, 3.6253906095114584`*^9}, {3.6253907509283123`*^9, 
   3.625390751070408*^9}, {3.636779847212949*^9, 3.63677994757589*^9}, {
   3.636780082944087*^9, 3.6367801026530247`*^9}, {3.636782512021681*^9, 
   3.636782524415447*^9}, {3.636782650830504*^9, 3.636782653088087*^9}, {
   3.636809723410131*^9, 3.636809729579875*^9}, {3.636814886573309*^9, 
   3.6368148901306543`*^9}, {3.636815176813446*^9, 3.6368151991542263`*^9}, {
   3.636815300137587*^9, 3.6368153016901913`*^9}, {3.636815987687482*^9, 
   3.636815994918272*^9}, {3.68161405189056*^9, 3.681614052850561*^9}, {
   3.70106099525415*^9, 3.701060995910063*^9}, {3.7010612241663427`*^9, 
   3.70106122553883*^9}, {3.701061260500371*^9, 3.701061296518874*^9}, {
   3.701061429807447*^9, 3.701061462207486*^9}, {3.701061577415759*^9, 
   3.701061591816835*^9}, {3.701061666544174*^9, 3.701061682550577*^9}, {
   3.721751248503564*^9, 3.721751284284225*^9}, {3.7219537599557123`*^9, 
   3.721953759962091*^9}, {3.72195389755941*^9, 3.7219538975645733`*^9}, {
   3.7219784347008257`*^9, 3.721978461446856*^9}, {3.7219785234607573`*^9, 
   3.721978550209847*^9}, 3.721978590045052*^9, {3.721978696853903*^9, 
   3.721978726782259*^9}, {3.721978760918068*^9, 3.721978827645509*^9}, {
   3.721978862153886*^9, 3.721978900918065*^9}, {3.721978959655129*^9, 
   3.721979228582507*^9}, {3.721981777998444*^9, 3.721981805285931*^9}, {
   3.721981889349906*^9, 3.721981905374929*^9}, {3.7219819790063887`*^9, 
   3.721981983853489*^9}, {3.721982098631998*^9, 3.72198210087181*^9}, {
   3.7219823151841516`*^9, 3.721982315336897*^9}, {3.722062217667783*^9, 
   3.72206222128535*^9}, {3.722062326421666*^9, 3.722062335381789*^9}, 
   3.722062376545657*^9, {3.722062529566758*^9, 3.722062534326943*^9}, {
   3.7220626067757797`*^9, 3.722062634872116*^9}, {3.722115931734398*^9, 
   3.722115950685521*^9}, 3.72212239041348*^9, {3.7221224210701027`*^9, 
   3.722122428189169*^9}, {3.722125379597105*^9, 3.7221253946785727`*^9}, {
   3.72222674133607*^9, 3.722226963608832*^9}, {3.72256019550611*^9, 
   3.722560208202252*^9}, {3.722565229180984*^9, 3.722565303493278*^9}, 
   3.722565375423127*^9, {3.722754105395754*^9, 3.722754117179433*^9}, {
   3.725939770462648*^9, 3.725939787035791*^9}, {3.725939820869005*^9, 
   3.72593983779782*^9}, {3.72594322497853*^9, 3.725943255050659*^9}, {
   3.7259448853565683`*^9, 3.72594489052468*^9}, {3.727136346271102*^9, 
   3.727136357430455*^9}, 3.72713756339213*^9, {3.7277441395697613`*^9, 
   3.727744142633692*^9}, 3.72774566830021*^9, 3.7277457297411747`*^9, {
   3.749256898632346*^9, 3.7492569143316107`*^9}, {3.749257465882751*^9, 
   3.749257556476223*^9}, {3.749257712404277*^9, 3.749257717012267*^9}, {
   3.749257889471369*^9, 3.749257891794046*^9}, {3.749257965325954*^9, 
   3.7492579727731123`*^9}, {3.749258199911186*^9, 3.749258205222988*^9}, {
   3.767159706450791*^9, 3.7671597604551077`*^9}, {3.7671598026578827`*^9, 
   3.767159828068366*^9}, 3.7671606957500763`*^9, 3.767189899366992*^9, {
   3.7671899356987534`*^9, 3.7671899420933*^9}, 3.7671899784220867`*^9, {
   3.767190085458309*^9, 3.76719015396131*^9}, {3.7671901878514833`*^9, 
   3.767190204929625*^9}, {3.768694328213745*^9, 3.768694328398444*^9}, {
   3.7686944135311317`*^9, 3.768694455908681*^9}},
 ExpressionUUID -> "c3568560-5bbb-4128-bcf2-7b66c6d427c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BlockTriangularToFuchsian", "[", 
   RowBox[{"matr_", ",", "x_", ",", "poly_", ",", 
    RowBox[{"OptionsPattern", "[", "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "matr"}]}], ",", "order", ",", 
      "\[IndentingNewLine]", 
      RowBox[{"m", "=", "matr"}], ",", "mt", ",", "i1", ",", "i2", ",", 
      "\[IndentingNewLine]", "ind1", ",", "ind2", ",", "t", ",", "o", ",", 
      "vars", ",", "sol", ",", "\[IndentingNewLine]", "transform", ",", "c", 
      ",", "\[IndentingNewLine]", "poles", ",", 
      RowBox[{"oc", "=", 
       RowBox[{"Boole", "[", 
        RowBox[{"Not", "[", 
         RowBox[{"TrueQ", "@", 
          RowBox[{"OptionValue", "[", "Simplify", "]"}]}], "]"}], "]"}]}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"blocks", "=", 
       RowBox[{"EntangledBlocksIndices", "[", "matr", "]"}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Modified", " ", "18.05", ".2019"}], "*)"}], 
    RowBox[{
     RowBox[{"poles", "=", 
      RowBox[{"Reverse", "@", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{
         RowBox[{"Replace", "[", 
          RowBox[{"p", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"All", ":>", 
              RowBox[{"PolesInfo", "[", 
               RowBox[{"matr", ",", "x"}], "]"}]}], ",", 
             RowBox[{"_", "\[RuleDelayed]", 
              RowBox[{"Replace", "[", 
               RowBox[{"p", ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"z_List", "\[RuleDelayed]", "z"}], ",", 
                  RowBox[{"z_", ":>", 
                   RowBox[{"{", 
                    RowBox[{"z", ",", 
                    RowBox[{"PoincareRank", "[", 
                    RowBox[{"matr", ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "z"}], "}"}]}], "]"}]}], "}"}]}]}], 
                 "}"}], ",", 
                RowBox[{"{", "1", "}"}]}], "]"}]}]}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"_", ",", 
           RowBox[{"_", "?", "Negative"}]}], "}"}]}], "]"}]}]}], 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"/", "Modified"}], " ", "18.05", ".2019"}], "*)"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"transform", "=", 
      RowBox[{"IdentityMatrix", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"poles", "\[Equal]", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"Return", "[", "transform", "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"(*", 
       RowBox[{"Deleted", " ", "09.02", ".2018"}], "*)"}], 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"OptionValue", "[", "Check", "]"}], ",", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"And", "@@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"FuchsianQ", "[", 
                  RowBox[{
                   RowBox[{"m", "[", 
                    RowBox[{"[", 
                    RowBox[{"#", ",", "#"}], "]"}], "]"}], ",", "x"}], "]"}], 
                 "&"}], "/@", "blocks"}], ")"}]}]}], ",", 
            RowBox[{"Message", "[", 
             RowBox[{"BlockTriangularToFuchsian", "::", "blocks"}], "]"}]}], 
           "]"}], ";", 
          RowBox[{"Return", "[", 
           RowBox[{"IdentityMatrix", "[", "n", "]"}], "]"}]}]}], "]"}], ";"}], 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"/", "Deleted"}], " ", "09.02", ".2018"}], "*)"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x0", ",", "order"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Cycle", " ", "over", " ", 
          RowBox[{"blocks", "."}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Do", "[", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"First", ",", " ", 
             RowBox[{"generate", " ", "matrix"}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"i2", "=", "\"\<?\>\""}], ";", "\[IndentingNewLine]", 
             RowBox[{"c", "=", 
              RowBox[{"ConstantArray", "[", 
               RowBox[{"0", ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"ind1", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"blocks", "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], ";", 
             RowBox[{"ind2", "=", 
              RowBox[{"Flatten", "[", 
               RowBox[{"blocks", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", 
                  RowBox[{"(", 
                   RowBox[{"i1", "-", "1"}], ")"}]}], "]"}], "]"}], "]"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"vars", "=", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Unique", "[", "\"\<c\>\"", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Length", "@", "ind1"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Length", "@", "ind2"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"[", 
                RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], "=", "vars"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"vars", "=", 
              RowBox[{"Flatten", "@", "vars"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"matrix", " ", "generated"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"(*", 
               RowBox[{"Deleted", " ", "19.05", ".2019"}], "*)"}], 
              RowBox[{
               RowBox[{"order", "=", 
                RowBox[{"PoincareRank", "[", 
                 RowBox[{
                  RowBox[{"m", "[", 
                   RowBox[{"[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ";"}], 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"/", "Deleted"}], " ", "19.05", ".2019"}], "*)"}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "Now", " ", "cycle", " ", "over", " ", "pole", " ", "order"}], 
              "*)"}], "\[IndentingNewLine]", 
             RowBox[{"Unset", "[", "i2", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"x0", "=!=", "\[Infinity]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t", "=", 
                    RowBox[{
                    RowBox[{"IdentityMatrix", "[", "n", "]"}], "+", 
                    RowBox[{"c", "/", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"x", "-", "x0"}], ")"}], "^", "i2"}]}]}]}], ";", 
                   RowBox[{"o", "=", 
                    RowBox[{"-", "1"}]}]}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"t", "=", 
                    RowBox[{
                    RowBox[{"IdentityMatrix", "[", "n", "]"}], "+", 
                    RowBox[{"c", "*", 
                    RowBox[{
                    RowBox[{"(", "x", ")"}], "^", "i2"}]}]}]}], ";", 
                   RowBox[{"o", "=", "1"}]}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"mt", "=", 
                 RowBox[{"Transform", "[", 
                  RowBox[{"m", ",", "t", ",", "x"}], "]"}]}], ";", 
                RowBox[{"(*", 
                 RowBox[{"TODO", ":", " ", 
                  RowBox[{
                  "here", " ", "Fermat", " ", "should", " ", "not", " ", "be",
                    " ", "used"}]}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{"Quiet", "[", 
                 RowBox[{
                  RowBox[{"Check", "[", 
                   RowBox[{
                    RowBox[{"sol", "=", 
                    RowBox[{"GaussSolve", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i2", ">", "0"}], ",", "SortBy", ",", 
                    RowBox[{"#1", "&"}]}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"SeriesCoefficient", "[", 
                    RowBox[{
                    RowBox[{"mt", "[", 
                    RowBox[{"[", 
                    RowBox[{"ind1", ",", "ind2"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"x", ",", "x0", ",", 
                    RowBox[{"o", "-", "i2"}]}], "}"}]}], "]"}], "]"}], ",", 
                    "ByteCount"}], "]"}], ",", "vars"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i2", ">", "0"}], ",", 
                    RowBox[{"Print", "[", "\"\<Problem\>\"", "]"}]}], "]"}], 
                    ";", 
                    RowBox[{"Continue", "[", "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"GaussSolve", "::", "inconsistent"}], "}"}]}], 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"GaussSolve", "::", "inconsistent"}], "}"}]}], 
                 "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"m", "=", 
                 RowBox[{"Factor", "[", 
                  RowBox[{
                   RowBox[{"mt", "/.", "sol"}], "/.", 
                   RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "@", "c"}], "\[Rule]", "0"}], "]"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"transform", "=", 
                 RowBox[{"ODot", "[", 
                  RowBox[{"transform", ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"t", "/.", "sol"}], "/.", 
                    RowBox[{"Thread", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "@", "c"}], "\[Rule]", "0"}], "]"}]}], 
                    ")"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i2", ",", "order", ",", "oc", ",", 
                 RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", "2", ",", 
              RowBox[{"Length", "@", "blocks"}]}], "}"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Row", "[", 
           RowBox[{"{", 
            RowBox[{
            "x0", ",", "\"\<:\>\"", ",", "i1", ",", "\"\<\[LeftArrow]\>\"", 
             ",", "i2"}], "}"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
       "]"}], 
      RowBox[{"(*", 
       RowBox[{"Modified", " ", "19.05", ".2019"}], "*)"}], "@@@", "poles"}], 
     ";", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"/", "Modified"}], " ", "19.05", ".2019"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "transform", "]"}], ";"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellOpen->False,
 CellChangeTimes->{{3.767228202568763*^9, 3.767228204975161*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", 
   "\"\<BlockTriangularToFuchsian, option Simplify\[Rule]True seems to be \
broken\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.728195827669364*^9, 3.728195859821919*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", "\"\<BlockTriangularToFuchsian, treat Notations.\>\"", "]"}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7608588701918907`*^9, 3.760858889631557*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["FuchsifyBlock", "Subsubsection",
 CellChangeTimes->{{3.768295166154064*^9, 3.7682951691955843`*^9}},
 ExpressionUUID -> "4d491bdf-31c7-432c-82b2-834897935dde"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FuchsifyBlock", "::", "usage"}], "=", "\"\<FuchsifyBlock[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\),{{\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"j\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"j\", \"TI\"], \"2\"]\),\[Ellipsis]}}] is supposed to Fuchsify \
block \!\(\*
StyleBox[\"m\", \"TI\"]\)\!\(\*
StyleBox[\"[\", \"TI\"]\)\!\(\*
StyleBox[\"[\", \"TI\"]\){\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"i\", \"TI\"], \"2\"]\),\[Ellipsis]},{\!\(\*SubscriptBox[
StyleBox[\"j\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"j\", \"TI\"], \"2\"]\),\[Ellipsis]}]].\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.768295191596539*^9, 3.7682952334217377`*^9}, {
  3.768295317456188*^9, 3.768295447023134*^9}, {3.768296301953854*^9, 
  3.768296360766267*^9}},
 ExpressionUUID -> "8d955731-4dc3-4e4a-a83b-eb81e43f0b1d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "done", "[", 
   "\"\<FuchsifyBlock works now without applying  transformation \
beforehand.\>\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.7683154065305023`*^9, 3.768315490883442*^9}, {
  3.769392040364167*^9, 3.769392074244122*^9}},
 ExpressionUUID -> "115fe183-9109-4176-8e6c-43258f58d967"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FuchsifyBlock", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol", ",", 
    RowBox[{"{", 
     RowBox[{"high_List", ",", "low_List"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"m", ",", 
      RowBox[{"all", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"high", ",", "low"}], "]"}]}], ",", 
      RowBox[{"ll", "=", 
       RowBox[{"Length", "@", "low"}]}], ",", 
      RowBox[{"lh", "=", 
       RowBox[{"Length", "@", "high"}]}], ",", "y", ",", "x2y", ",", "t", ",", 
      RowBox[{"notas", "=", 
       RowBox[{
        RowBox[{"Notations", "[", "ds", "]"}], "/.", 
        RowBox[{"Association", "\[Rule]", "List"}]}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"m", "=", 
      RowBox[{
       RowBox[{"ds", "[", "x", "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"all", ",", "all"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"notas", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"notas", ",", 
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"m", ",", 
            RowBox[{"First", "[", "#", "]"}]}], "]"}], "]"}], "&"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"FuchsifyBlock", "[", 
      RowBox[{"m", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "notas"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Range", "[", "lh", "]"}], ",", 
         RowBox[{"Range", "[", 
          RowBox[{
           RowBox[{"lh", "+", "1"}], ",", 
           RowBox[{"lh", "+", "ll"}]}], "]"}]}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "notas"}], ">", "1"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FuchsifyBlock", "::", "notas"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "notas"}], "\[Equal]", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"FuchsifyBlock", "[", 
        RowBox[{"m", ",", "x", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Range", "[", "lh", "]"}], ",", 
           RowBox[{"Range", "[", 
            RowBox[{
             RowBox[{"lh", "+", "1"}], ",", 
             RowBox[{"lh", "+", "ll"}]}], "]"}]}], "}"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "PrintTemporary", "[", 
         "\"\<Found one notation. Changing variable...\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"y", ",", "x2y"}], "}"}], "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{"NotationToRule", "[", 
              RowBox[{
               RowBox[{"#1", "\[Rule]", "#2"}], ",", "x"}], "]"}]}], "}"}], 
           "&"}], "@@", 
          RowBox[{"(", 
           RowBox[{"notas", "=", 
            RowBox[{"First", "[", "notas", "]"}]}], ")"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ModNotation", "[", 
         RowBox[{
          RowBox[{"FuchsifyBlock", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"m", "/.", "x2y"}], ")"}], "*", 
             RowBox[{"D", "[", 
              RowBox[{
               RowBox[{"x2y", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ",", "y"}], "]"}]}], ",", "y",
             ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Range", "[", "lh", "]"}], ",", 
              RowBox[{"Range", "[", 
               RowBox[{
                RowBox[{"lh", "+", "1"}], ",", 
                RowBox[{"lh", "+", "ll"}]}], "]"}]}], "}"}]}], "]"}], ",", 
          "notas"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "*)"}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{
  3.768339634008937*^9, 3.768523670050066*^9, {3.768523703270153*^9, 
   3.7685238492385263`*^9}, {3.768523941967523*^9, 3.7685242056252337`*^9}, {
   3.7685243267065783`*^9, 3.7685244125250607`*^9}, {3.770602792848959*^9, 
   3.770602796705654*^9}, {3.770964317371998*^9, 3.770964400298429*^9}},
 ExpressionUUID -> "12025c97-70a9-4da4-9f1b-a786e8c36989"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FuchsifyBlock", "::", "pr"}], "=", 
   "\"\<Diagonal block `1` is not Fuchsian. Aborting...\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FuchsifyBlock", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MatrixQ"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x_Symbol", ",", 
       RowBox[{"notations", ":", 
        RowBox[{"_Association", "|", 
         RowBox[{"{", "___Rule", "}"}]}], ":", 
        RowBox[{"{", "}"}]}]}], "}"}], "|", "x_Symbol"}], ",", 
    RowBox[{"{", 
     RowBox[{"high_List", ",", "low_List"}], "}"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"all", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"high", ",", "low"}], "]"}]}], ",", 
      RowBox[{"lhigh", "=", 
       RowBox[{"Length", "@", "high"}]}], ",", 
      RowBox[{"llow", "=", 
       RowBox[{"Length", "@", "low"}]}], ",", "densPR", ",", "infPR", ",", 
      "deg", ",", "vars", ",", "c", ",", "cm", ",", "t", ",", "p", ",", "b", 
      ",", "Ah", ",", "Al", ",", "Bhl", ",", "part1", ",", "part2", ",", "y", 
      ",", "x2y", ",", "notas"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "notations", "}"}], "===", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"notas", "=", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"notas", "=", 
        RowBox[{"notations", "/.", 
         RowBox[{"Association", "\[Rule]", "List"}]}]}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"NewDSystem", "[", 
      RowBox[{"b", ",", 
       RowBox[{"x", "\[Rule]", 
        RowBox[{"m", "[", 
         RowBox[{"[", 
          RowBox[{"all", ",", "all"}], "]"}], "]"}]}], ",", 
       RowBox[{"Print", "\[Rule]", "False"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Treat", " ", "notations"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"notas", "=", 
      RowBox[{"Select", "[", 
       RowBox[{"notas", ",", 
        RowBox[{
         RowBox[{"Not", "[", 
          RowBox[{"FreeQ", "[", 
           RowBox[{
            RowBox[{"b", "[", "x", "]"}], ",", 
            RowBox[{"First", "[", "#", "]"}]}], "]"}], "]"}], "&"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "notas"}], ">", "1"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"FuchsifyBlock", "::", "notas"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "notas"}], "\[Equal]", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "PrintTemporary", "[", 
         "\"\<Found one notation. Changing variable...\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"y", ",", "x2y"}], "}"}], "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"notas", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"NotationToRule", "[", 
            RowBox[{
             RowBox[{"notas", "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", "x"}], "]"}]}], "}"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"ChangeVar", "[", 
         RowBox[{"b", ",", "x2y", ",", "y"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"y", "=", "x"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"/", "Treat"}], " ", "notations"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"AddNotation", "[", 
          RowBox[{"b", ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"{", "notas", "}"}], "/.", 
          RowBox[{"Association", "\[Rule]", "List"}]}], "]"}]}], ";"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Check", " ", "that", " ", "diagonal", " ", "blocks", " ", "are", " ", 
       "Fuchsian"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"densPR", "=", 
      RowBox[{"DenominatorsInfo", "[", 
       RowBox[{
        RowBox[{"b", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"-", "llow"}], ")"}], ";;"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"-", "llow"}], ")"}], ";;"}]}], "]"}], "]"}], ",", "y"}],
        "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"Last", "/@", "densPR"}], ",", 
         RowBox[{"_", "?", "Positive"}]}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FuchsifyBlock", "::", "pr"}], ",", "low"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"densPR", "=", 
      RowBox[{"DenominatorsInfo", "[", 
       RowBox[{
        RowBox[{"b", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{";;", "lhigh"}], ",", 
           RowBox[{";;", "lhigh"}]}], "]"}], "]"}], ",", "y"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{
         RowBox[{"Last", "/@", "densPR"}], ",", 
         RowBox[{"_", "?", "Positive"}]}], "]"}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"FuchsifyBlock", "::", "pr"}], ",", "high"}], "]"}], ";", 
        RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"/", "Check"}], " ", "that", " ", "diagonal", " ", "blocks", 
       " ", "are", " ", "Fuchsian"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Extracting", " ", "Poincare", " ", "ranks"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"densPR", "=", 
      RowBox[{"DenominatorsInfo", "[", 
       RowBox[{
        RowBox[{"b", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{";;", "lhigh"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"-", "llow"}], ")"}], ";;"}]}], "]"}], "]"}], ",", "y"}],
        "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"1", "/", "y"}], " ", "is", " ", 
         RowBox[{"special", ":", " ", "y"}]}], "=", "\[Infinity]"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "infPR", "}"}], "=", 
        RowBox[{"Cases", "[", 
         RowBox[{"densPR", ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1", "/", "y"}], ",", "r_"}], "}"}], "\[RuleDelayed]", 
           "r"}]}], "]"}]}], ";", 
       RowBox[{"Print", "[", "infPR", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"densPR", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"densPR", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"1", "/", "y"}], ",", "_"}], "}"}]}], "]"}]}], ";"}], 
      RowBox[{"(*", 
       RowBox[{"here", " ", "they", " ", "are", " ", "only", " ", "finite"}], 
       "*)"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"den", ",", "pr"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"CWrite", "[", 
          RowBox[{"\"\<\\n\>\"", "<>", 
           RowBox[{"ToString", "[", 
            RowBox[{"InputForm", "[", "den", "]"}], "]"}], "<>", 
           "\"\<: [\>\"", "<>", 
           RowBox[{"ToString", "[", "pr", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"FCMonitor", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"den", "=!=", 
              RowBox[{"1", "/", "y"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"finite", " ", "singularities"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"deg", "=", 
               RowBox[{"Exponent", "[", 
                RowBox[{"den", ",", "y"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"vars", "=", 
               RowBox[{"Array", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", 
                  RowBox[{"lhigh", ",", "llow", ",", "deg"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1", ",", "0"}], "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Diagonal", " ", "blocks"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"Ah", "=", 
               RowBox[{"QuolyMod", "[", 
                RowBox[{
                 RowBox[{"den", "*", 
                  RowBox[{
                   RowBox[{"b", "[", "y", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{";;", "lhigh"}], ",", 
                    RowBox[{";;", "lhigh"}]}], "]"}], "]"}]}], ",", "den", 
                 ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Al", "=", 
               RowBox[{"QuolyMod", "[", 
                RowBox[{
                 RowBox[{"den", "*", 
                  RowBox[{
                   RowBox[{"b", "[", "y", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "llow"}], ")"}], ";;"}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "llow"}], ")"}], ";;"}]}], "]"}], "]"}]}], 
                 ",", "den", ",", "y"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"t", "=", 
               RowBox[{"IdentityMatrix", "[", 
                RowBox[{"lhigh", "+", "llow"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"cm", "=", 
               RowBox[{"vars", ".", 
                SuperscriptBox["y", 
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"Exponent", "[", 
                    RowBox[{"den", ",", "y"}], "]"}], "-", "1"}]}], 
                  "]"}]]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"part1", "=", 
               RowBox[{"QuolyMod", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Ah", ".", "cm"}], "-", 
                  RowBox[{"cm", ".", "Al"}]}], ",", "den", ",", "y"}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"part2", "=", 
               RowBox[{"QuolyMod", "[", 
                RowBox[{
                 RowBox[{"cm", "*", 
                  RowBox[{"D", "[", 
                   RowBox[{"den", ",", "y"}], "]"}]}], ",", "den", ",", "y"}],
                 "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"Bhl", "=", 
                  RowBox[{"QuolyMod", "[", 
                   RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"b", "[", "y", "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{";;", "lhigh"}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "llow"}], ")"}], ";;"}]}], "]"}], "]"}], 
                    SuperscriptBox["den", 
                    RowBox[{"p", "+", "1"}]]}], "]"}], ",", "den", ",", "y"}],
                    "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"t", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{";;", "lhigh"}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "llow"}], ")"}], ";;"}]}], "]"}], "]"}], "=", 
                  RowBox[{
                   FractionBox["cm", 
                    SuperscriptBox["den", "p"]], "/.", 
                   RowBox[{"GaussSolve", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"CoefficientList", "[", 
                    RowBox[{
                    RowBox[{"Bhl", "+", "part1", "+", 
                    RowBox[{"p", "*", "part2"}]}], ",", "y"}], "]"}], "]"}], 
                    ",", 
                    RowBox[{"Flatten", "[", "vars", "]"}]}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Transform", "[", 
                  RowBox[{"b", ",", "t", ",", 
                   RowBox[{"Print", "\[Rule]", "False"}]}], "]"}]}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"p", ",", "pr", ",", "1", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", "infinity", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"vars", "=", 
               RowBox[{"Array", "[", 
                RowBox[{"c", ",", 
                 RowBox[{"{", 
                  RowBox[{"lhigh", ",", "llow"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"t", "=", 
               RowBox[{"IdentityMatrix", "[", 
                RowBox[{"lhigh", "+", "llow"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Ah", "=", 
               RowBox[{"SeriesCoefficient", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"b", "[", "y", "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{";;", "lhigh"}], ",", 
                    RowBox[{";;", "lhigh"}]}], "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"y", ",", "\[Infinity]", ",", "1"}], "}"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Al", "=", 
               RowBox[{"SeriesCoefficient", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"b", "[", "y", "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "llow"}], ")"}], ";;"}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "llow"}], ")"}], ";;"}]}], "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"y", ",", "\[Infinity]", ",", "1"}], "}"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"Bhl", "=", 
                  RowBox[{"SeriesCoefficient", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"b", "[", "y", "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{";;", "lhigh"}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "llow"}], ")"}], ";;"}]}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"y", ",", "\[Infinity]", ",", 
                    RowBox[{"1", "-", "p"}]}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"t", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{";;", "lhigh"}], ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"-", "llow"}], ")"}], ";;"}]}], "]"}], "]"}], "=", 
                  RowBox[{
                   RowBox[{"vars", "*", 
                    SuperscriptBox["y", "p"]}], "/.", 
                   RowBox[{"GaussSolve", "[", 
                    RowBox[{
                    RowBox[{"Bhl", "+", 
                    RowBox[{"Ah", ".", "vars"}], "-", 
                    RowBox[{"vars", ".", "Al"}], "-", 
                    RowBox[{"p", "*", "vars"}]}], ",", 
                    RowBox[{"Flatten", "[", "vars", "]"}]}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Transform", "[", 
                  RowBox[{"b", ",", "t", ",", 
                   RowBox[{"Print", "\[Rule]", "False"}]}], "]"}]}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{"p", ",", "pr", ",", "1", ",", 
                  RowBox[{"-", "1"}]}], "}"}]}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Row", "[", 
            RowBox[{"{", 
             RowBox[{"den", ",", "\"\<:\>\"", ",", "p"}], "}"}], "]"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"CWrite", "[", "\"\<]\>\"", "]"}]}]}], "\[IndentingNewLine]",
        "]"}], "@@@", "densPR"}], ";", "\[IndentingNewLine]", 
     RowBox[{"t", "=", 
      RowBox[{"Fold", "[", 
       RowBox[{"QuolyMod", ",", 
        RowBox[{"HistoryConsolidate", "[", 
         RowBox[{"b", ",", 
          RowBox[{"HistoryAppend", "->", "False"}], ",", 
          RowBox[{"Inverse", "\[Rule]", "False"}]}], "]"}], ",", "notas"}], 
       "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Code",
 CellChangeTimes->{{3.768295246779846*^9, 3.768295299259428*^9}, 
   3.768295343760974*^9, 3.768295387216332*^9, {3.7682962725334806`*^9, 
   3.768296283592351*^9}, {3.76829637608848*^9, 3.768296391446813*^9}, {
   3.768305841330846*^9, 3.7683058778297653`*^9}, {3.7683060102679787`*^9, 
   3.768306019399096*^9}, {3.768306071416368*^9, 3.768306080684619*^9}, {
   3.768339780762537*^9, 3.76833978379707*^9}, 3.7683426335018682`*^9, {
   3.768694494963427*^9, 3.768694526788422*^9}, {3.7686946144993258`*^9, 
   3.768694682301737*^9}, {3.770156596284747*^9, 3.770156641277087*^9}, 
   3.7701609310021276`*^9, {3.770164493765891*^9, 3.770164522772917*^9}, {
   3.770296229407606*^9, 3.770296238379839*^9}, {3.7709634207113934`*^9, 
   3.770963492549637*^9}, {3.7709635318274107`*^9, 3.77096353405028*^9}, {
   3.7709635716181717`*^9, 3.770963655501539*^9}, {3.7709637369243402`*^9, 
   3.77096376079072*^9}, {3.7709637980769978`*^9, 3.770963958920314*^9}, {
   3.770963990693377*^9, 3.7709640558201447`*^9}, {3.770964086371084*^9, 
   3.77096419798623*^9}, {3.7709642337948723`*^9, 3.770964258226708*^9}, {
   3.770972996454183*^9, 3.77097299953433*^9}, 3.770973045162773*^9},
 ExpressionUUID -> "4cf2d0e0-9cf1-4b25-9d2c-2ce5ff4a7290"],

Cell[BoxData[
 RowBox[{
  RowBox[{"todo", "[", "\"\<Check FuchsifyBlock with notations.\>\"", "]"}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.770964416410561*^9, 3.7709644334910097`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Fuchsify", "Subsubsection",
 CellChangeTimes->{{3.768295166154064*^9, 3.7682951691955843`*^9}, 
   3.77096277813274*^9},
 ExpressionUUID -> "4d491bdf-31c7-432c-82b2-834897935dde"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Fuchsify", "::", "usage"}], "=", "\"\<Fuchsify[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] is supposed to Fuchsify \!\(\*
StyleBox[\"m\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.768295191596539*^9, 3.7682952334217377`*^9}, {
  3.768295317456188*^9, 3.768295447023134*^9}, {3.768296301953854*^9, 
  3.768296360766267*^9}, {3.7709627816794863`*^9, 3.770962797102819*^9}},
 ExpressionUUID -> "8d955731-4dc3-4e4a-a83b-eb81e43f0b1d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Fuchsify", "[", 
   RowBox[{
    RowBox[{"m_", "?", "MatrixQ"}], ",", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x_Symbol", ",", 
       RowBox[{"notas", ":", 
        RowBox[{"_Association", "|", 
         RowBox[{"{", "___Rule", "}"}]}], ":", 
        RowBox[{"{", "}"}]}]}], "}"}], "|", "x_Symbol"}]}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"odi", "=", 
       RowBox[{"OffDiagonalBlocksIndices", "[", 
        RowBox[{"m", ",", 
         RowBox[{"Flatten", "\[Rule]", "False"}], ",", 
         RowBox[{"Sort", "\[Rule]", "Diagonal"}]}], "]"}]}], ",", 
      RowBox[{"m1", "=", "m"}], ",", "t", ",", "t1"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"t", "=", 
      RowBox[{"IdentityMatrix", "[", 
       RowBox[{"Length", "@", "m"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", "blocks", "}"}], ",", 
        RowBox[{
         RowBox[{"t1", "=", 
          RowBox[{"IdentityMatrix", "[", 
           RowBox[{"Length", "@", "m1"}], "]"}]}], ";", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"t1", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"Flatten", "@", "#"}], ",", 
                RowBox[{"Flatten", "@", "#"}]}], "]"}], "]"}], "=", 
             RowBox[{"FuchsifyBlock", "[", 
              RowBox[{"m1", ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "notas"}], "}"}], ",", "#"}], "]"}]}], 
            ")"}], "&"}], "/@", "blocks"}], ";", "\[IndentingNewLine]", 
         RowBox[{"m1", "=", 
          RowBox[{"Transform", "[", 
           RowBox[{"m1", ",", "t1", ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "notas"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"t", "=", 
          RowBox[{"ODot", "[", 
           RowBox[{"t", ",", "t1"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], "/@", "odi"}], ";", "\[IndentingNewLine]", "t"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.768295246779846*^9, 3.768295299259428*^9}, 
   3.768295343760974*^9, 3.768295387216332*^9, {3.7682962725334806`*^9, 
   3.768296283592351*^9}, {3.76829637608848*^9, 3.768296391446813*^9}, {
   3.768305841330846*^9, 3.7683058778297653`*^9}, {3.7683060102679787`*^9, 
   3.768306019399096*^9}, {3.768306071416368*^9, 3.768306080684619*^9}, {
   3.768339780762537*^9, 3.76833978379707*^9}, 3.7683426335018682`*^9, {
   3.768694494963427*^9, 3.768694526788422*^9}, {3.7686946144993258`*^9, 
   3.768694682301737*^9}, {3.770156596284747*^9, 3.770156641277087*^9}, 
   3.7701609310021276`*^9, {3.770164493765891*^9, 3.770164522772917*^9}, {
   3.770296229407606*^9, 3.770296238379839*^9}, {3.770962866648987*^9, 
   3.7709629227478657`*^9}, {3.770962974150948*^9, 3.7709631470968924`*^9}, {
   3.770963192048876*^9, 3.7709632468172607`*^9}, 3.770963337188242*^9, {
   3.770964504667996*^9, 3.770964612436679*^9}, {3.770964689117425*^9, 
   3.770964699156575*^9}, 3.770973453991959*^9, {3.7709736530166807`*^9, 
   3.770973662735375*^9}},
 ExpressionUUID -> "4cf2d0e0-9cf1-4b25-9d2c-2ce5ff4a7290"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Fuchsify", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"a", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x_Symbol", ",", 
         RowBox[{"notas", ":", 
          RowBox[{"_Association", "|", 
           RowBox[{"{", "___Rule", "}"}]}], ":", 
          RowBox[{"{", "}"}]}]}], "}"}], "|", "x_Symbol"}], ")"}]}]}], "]"}], 
  ":=", 
  RowBox[{"Fuchsify", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "a"}], "]"}]}]], "Code",
 CellChangeTimes->{{3.770973783748548*^9, 3.7709738422950706`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["ReduceOffDiagonal", "Subsubsection",
 CellChangeTimes->{
  3.726905061378427*^9, {3.726967769907435*^9, 3.726967804371705*^9}}],

Cell["New code for BlockTriangularToFuchsian.", "Text",
 CellChangeTimes->{{3.726896129595035*^9, 3.726896175131281*^9}, {
   3.726896205475298*^9, 3.7268962213394527`*^9}, 3.7269049028703413`*^9}],

Cell[TextData[{
 "There will be the following call formats:\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"ReduceOffDiagonal", "[", 
    RowBox[{"m", ",", "x"}], "]"}], TraditionalForm]]],
 " \[LongDash] reduce all matrix elements in all points\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"ReduceOffDiagonal", "[", 
    RowBox[{"m", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", 
       SubscriptBox["x", "0"]}], "}"}]}], "]"}], TraditionalForm]]],
 " \[LongDash] reduce all matrix elements in specified point\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"ReduceOffDiagonal", "[", 
    RowBox[{"m", ",", 
     RowBox[{"{", 
      RowBox[{"x", ",", 
       RowBox[{"{", 
        RowBox[{
         SubscriptBox["x", "1"], ",", 
         SubscriptBox["x", "2"], ",", "..."}], "}"}]}], "}"}]}], "]"}], 
   TraditionalForm]]],
 " \[LongDash] reduce all matrix elements in specified points\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"ReduceOffDiagonal", "[", 
    RowBox[{"m", ",", "x", ",", 
     SubscriptBox["b", "1"]}], "]"}], TraditionalForm]]],
 " \[LongDash] reduce rows with indices in ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["b", "1"], TraditionalForm]]],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{"ReduceOffDiagonal", "[", 
    RowBox[{"m", ",", "x", ",", 
     SubscriptBox["b", "1"], ",", 
     SubscriptBox["b", "2"]}], "]"}], TraditionalForm]]],
 " \[LongDash] reduce elements with row indices in ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["b", "1"], TraditionalForm]]],
 " and column indices in ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["b", "2"], TraditionalForm]]],
 "\nHere ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["b", 
    RowBox[{"1", ",", "2"}]], TraditionalForm]]],
 " should be the sets of indices of some diagonal blocks."
}], "Text",
 CellChangeTimes->{{3.726967256691351*^9, 3.72696754276501*^9}, {
  3.726967598955905*^9, 3.7269677392117453`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReduceOffDiagonal", "::", "usage"}], "=", 
   "\"\<\!\(TraditionalForm\`ReduceOffDiagonal[m, x]\\\ \[LongDash]\\\ reduce\
\\\ all\\\ matrix\\\ elements\\\ in\\\ all\\\ points  \\\\n  \
ReduceOffDiagonal[m, {x, \*SubscriptBox[\(x\), \(0\)]}]\\\ \[LongDash]\\\ \
reduce\\\ all\\\ matrix\\\ elements\\\ in\\\ specified\\\ point . \\\\n  \
ReduceOffDiagonal[m, {x, {\*SubscriptBox[\(x\), \(1\)], \*SubscriptBox[\(x\), \
\(2\)],  ... }}]\\\ \[LongDash]\\\ reduce\\\ all\\\ matrix\\\ elements\\\ \
in\\\ specified\\\ points  \\\\n  ReduceOffDiagonal[m, xspec, \*SubscriptBox[\
\(b\), \(1\)]]\\\ \[LongDash]\\\ reduce\\\ rows\\\ with\\\ indices\\\ in\\\ \
\*SubscriptBox[\(b\), \(1\)] \\\\n  ReduceOffDiagonal[m, xspec, \
\*SubscriptBox[\(b\), \(1\)], \*SubscriptBox[\(b\), \(2\)]]\\\ \[LongDash]\\\ \
reduce\\\ elements\\\ with\\\ row\\\ indices\\\ in\\\ \*SubscriptBox[\(b\), \
\(1\)]\\\ and\\\ column\\\ indices\\\ in\\\ \*SubscriptBox[\(b\), \(2\)] \
\\\\n  Here\\\ \*SubscriptBox[\(b\), \(1, 2\)]\\\ should\\\ be\\\ the\\\ sets\
\\\ of\\\ indices\\\ of\\\ some\\\ diagonal\\\ blocks\\\ and\\\ xspec\\\ is\\\
\ either\\\ x, \\\ or\\\ {x, \*SubscriptBox[\(x\), \(0\)]}, \\\ or\\\ \(\({x, \
{\*SubscriptBox[\(x\), \(1\)], \*SubscriptBox[\(x\), \(2\)],  ... }}\)\(.\)\)\
\)\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.7269050801842327`*^9, 3.726905082179491*^9}, {
   3.726905119152047*^9, 3.726905137195279*^9}, {3.726905410120417*^9, 
   3.726905482273068*^9}, {3.7269639233309917`*^9, 3.726963983923004*^9}, {
   3.726967210156505*^9, 3.726967211412828*^9}, {3.726967247524151*^9, 
   3.7269672513800707`*^9}, {3.726967293892645*^9, 3.726967296260105*^9}, {
   3.72696789268538*^9, 3.726967994413987*^9}, 3.726970879178297*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Options", "[", "ReduceOffDiagonal", "]"}], "=", 
   RowBox[{"{", 
    RowBox[{"Check", "\[Rule]", "True"}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.726963904067038*^9, 3.726963920164158*^9}, {
   3.7269671890124617`*^9, 3.7269671900762167`*^9}, 3.726969423401349*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReduceOffDiagonal", "::", "blocks"}], "=", 
   "\"\<Diagonal blocks are not Fuchsian...\>\""}], ";"}]], "Input",
 CellChangeTimes->{3.726964897849649*^9, 3.726967194379924*^9, 
  3.726969426904018*^9}],

Cell["Normalize second argument", "Text",
 CellChangeTimes->{{3.7269704033916807`*^9, 3.72697041351191*^9}, {
  3.726970979481604*^9, 3.726970982233747*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ReduceOffDiagonal", "[", 
   RowBox[{
    RowBox[{"m", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"_", "?", "SquareMatrixQ"}], "|", "_Association", "|", 
       RowBox[{"_", "?", "DSystemQ"}]}], ")"}]}], ",", "x_Symbol", ",", 
    "p___"}], "]"}], ":=", 
  RowBox[{"ReduceOffDiagonal", "[", 
   RowBox[{"m", ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", 
      RowBox[{"PolesPosition", "[", 
       RowBox[{"m", ",", "x"}], "]"}]}], "}"}], ",", "p"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ReduceOffDiagonal", "[", 
   RowBox[{
    RowBox[{"m", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"_", "?", "SquareMatrixQ"}], "|", "_Association", "|", 
       RowBox[{"_", "?", "DSystemQ"}]}], ")"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"x_", ",", 
      RowBox[{"x0", ":", 
       RowBox[{"Except", "[", "_List", "]"}]}]}], "}"}], ",", "p___"}], "]"}],
   ":=", 
  RowBox[{"ReduceOffDiagonal", "[", 
   RowBox[{"m", ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", 
      RowBox[{"{", "x0", "}"}]}], "}"}], ",", "p"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.726968561023774*^9, 3.726968594703855*^9}, {
  3.726969342048862*^9, 3.726969372903956*^9}, {3.726969429424253*^9, 
  3.7269694308166733`*^9}, {3.726970322528809*^9, 3.7269703430881567`*^9}, {
  3.726970387769012*^9, 3.726970388936981*^9}, {3.726970498081423*^9, 
  3.7269705420250597`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReduceOffDiagonal", "[", 
   RowBox[{
    RowBox[{"m", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"_", "?", "SquareMatrixQ"}], "|", "_Association", "|", 
       RowBox[{"_", "?", "DSystemQ"}]}], ")"}]}], ",", "xspec_"}], "]"}], ":=", 
  RowBox[{"ReduceOffDiagonal", "[", 
   RowBox[{"m", ",", "xspec", ",", 
    RowBox[{"Subsets", "[", 
     RowBox[{
      RowBox[{"Reverse", "[", 
       RowBox[{"EntangledBlocksIndices", "[", "m", "]"}], "]"}], ",", "2"}], 
     "]"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.726969387096346*^9, 3.7269694382401237`*^9}, {
   3.7269702969204197`*^9, 3.726970301888504*^9}, {3.7269704446647463`*^9, 
   3.7269704906011143`*^9}, 3.7269705460832033`*^9, {3.72697081345006*^9, 
   3.72697083898571*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReduceOffDiagonal", "[", 
   RowBox[{
    RowBox[{"m", ":", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"_", "?", "SquareMatrixQ"}], "|", "_Association", "|", 
       RowBox[{"_", "?", "DSystemQ"}]}], ")"}]}], ",", "xspec_", ",", 
    RowBox[{"b1", ":", 
     RowBox[{"{", "__Integers", "}"}]}]}], "]"}], ":=", 
  RowBox[{"ReduceOffDiagonal", "[", 
   RowBox[{"m", ",", "xspec", ",", 
    RowBox[{"Reverse", "[", 
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{"EntangledBlocksIndices", "[", "m", "]"}], ",", 
       RowBox[{"ContainsAny", "[", "b1", "]"}]}], "]"}], "]"}]}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.726969387096346*^9, 3.7269694382401237`*^9}, {
  3.7269702969204197`*^9, 3.726970301888504*^9}, {3.7269704446647463`*^9, 
  3.7269704906011143`*^9}, {3.7269705460832033`*^9, 3.7269706308976793`*^9}}],

Cell["\<\
NB: the cycle over r below is incorrect. Probably, the application of the \
found transformation on the intermediate stages is inevitable. There is a \
possibility to apply only for the block.\
\>", "Text",
 CellChangeTimes->{{3.726971625579629*^9, 3.726971710459486*^9}, {
  3.726971776651657*^9, 3.7269718237958813`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"reduceoffdiagonal", "[", 
    RowBox[{
     RowBox[{"m_", "?", "SquareMatrixQ"}], ",", "x_", ",", "x0_", ",", "b1_", 
     ",", "b2_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"L", ",", "B", ",", "R", ",", 
       RowBox[{"t", "=", "0"}], ",", 
       RowBox[{"T", "=", 
        RowBox[{"IdentityMatrix", "[", 
         RowBox[{"Length", "@", "m"}], "]"}]}], ",", "r"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "calculate", " ", "Poincare", " ", "rank", " ", "of", " ", "off"}], 
       "-", 
       RowBox[{"diagonal", " ", "block"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"r", "=", 
       RowBox[{"PoincareRank", "[", 
        RowBox[{
         RowBox[{"m", "[", 
          RowBox[{"[", 
           RowBox[{"b1", ",", "b2"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"x0", "=!=", "\[Infinity]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"L", "=", 
          RowBox[{"SeriesCoefficient", "[", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"b1", ",", "b1"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "x0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"R", "=", 
          RowBox[{"SeriesCoefficient", "[", 
           RowBox[{
            RowBox[{"m", "[", 
             RowBox[{"[", 
              RowBox[{"b2", ",", "b2"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", "x0", ",", 
              RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"r", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"B", "=", 
             RowBox[{"SeriesCoefficient", "[", 
              RowBox[{
               RowBox[{"m", "[", 
                RowBox[{"[", 
                 RowBox[{"b1", ",", "b2"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "x0", ",", 
                 RowBox[{
                  RowBox[{"-", "1"}], "-", "r"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"t", "+=", 
             RowBox[{
              RowBox[{"BTSolve", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"L", "/", "r"}], ",", 
                 RowBox[{"B", "/", "r"}], ",", 
                 RowBox[{"R", "/", "r"}]}], "}"}], "]"}], 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"x", "-", "x0"}], ")"}], 
               RowBox[{"-", "r"}]]}]}], ";", 
            RowBox[{"(*", 
             RowBox[{"off", "-", 
              RowBox[{
              "diagonal", " ", "block", " ", "is", " ", "additive", " ", 
               "under", " ", "matrix", " ", "multiplication"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"r", "--"}]}]}], "\[IndentingNewLine]", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"L", "=", 
          RowBox[{"-", 
           RowBox[{"SeriesCoefficient", "[", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"b1", ",", "b1"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "\[Infinity]", ",", "1"}], "}"}]}], "]"}]}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"R", "=", 
          RowBox[{"-", 
           RowBox[{"SeriesCoefficient", "[", 
            RowBox[{
             RowBox[{"m", "[", 
              RowBox[{"[", 
               RowBox[{"b2", ",", "b2"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"x", ",", "\[Infinity]", ",", "1"}], "}"}]}], "]"}]}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"While", "[", 
          RowBox[{
           RowBox[{"r", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"B", "=", 
             RowBox[{"-", 
              RowBox[{"SeriesCoefficient", "[", 
               RowBox[{
                RowBox[{"m", "[", 
                 RowBox[{"[", 
                  RowBox[{"b1", ",", "b2"}], "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "\[Infinity]", ",", 
                  RowBox[{"1", "-", "r"}]}], "}"}]}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"t", "+=", 
             RowBox[{
              RowBox[{"BTSolve", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"L", "/", "r"}], ",", 
                 RowBox[{"B", "/", "r"}], ",", 
                 RowBox[{"R", "/", "r"}]}], "}"}], "]"}], 
              SuperscriptBox["x", "r"]}]}], ";", 
            RowBox[{"(*", 
             RowBox[{"off", "-", 
              RowBox[{
              "diagonal", " ", "block", " ", "is", " ", "additive", " ", 
               "under", " ", "matrix", " ", "multiplication"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"r", "--"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"T", "[", 
        RowBox[{"[", 
         RowBox[{"b1", ",", "b2"}], "]"}], "]"}], "=", "t"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "T", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.726968016910445*^9, 3.726968051302794*^9}, {
   3.726968110830677*^9, 3.726968135079049*^9}, {3.726968172247731*^9, 
   3.7269681748872557`*^9}, 3.7269683158231497`*^9, 3.726971618882929*^9, {
   3.726971918309763*^9, 3.726971924461782*^9}},
 ExpressionUUID -> "907c494a-490b-4d1a-82a0-7076f2766aee"]
}, Closed]],

Cell[CellGroupData[{

Cell["BTSolve", "Subsubsection",
 CellChangeTimes->{
  3.726905061378427*^9, {3.726905522497095*^9, 3.7269055461795273`*^9}},
 ExpressionUUID -> "240a1df5-828b-47f5-a3fc-df7a6644e689"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BTSolve", "::", "usage"}], "=", "\"\<BTSolve[{\!\(\*SubscriptBox[
StyleBox[\"L\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"R\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"B\", \"TI\"], \"1\"]\),\!\(\*SubscriptBox[
StyleBox[\"a\", \"TI\"], \"1\"]\)},{\!\(\*SubscriptBox[
StyleBox[\"L\", \"TI\"], \"2\"]\),\!\(\*SubscriptBox[
StyleBox[\"R\", \"TI\"], \"2\"]\),\!\(\*SubscriptBox[
StyleBox[\"B\", \"TI\"], \"2\"]\),\!\(\*SubscriptBox[
StyleBox[\"a\", \"TI\"], \"2\"]\)},\[Ellipsis]] returns the matrix X which is \
the solution of the equation \!\(\*SubscriptBox[
StyleBox[\"a\", \"TI\"], \"i\"]\)\!\(\*
StyleBox[\"x\", \"TI\"]\)\!\(\*
StyleBox[\"+\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"L\", \"TI\"], \"i\"]\)\!\(\*
StyleBox[\"X\", \"TI\"]\)\!\(\*
StyleBox[\"+\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"XR\", \"TI\"], \"i\"]\)\!\(\*
StyleBox[\"+\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"B\", \"TI\"], \"i\"]\)\!\(\*
StyleBox[\"=\", \"TI\"]\)\!\(\*
StyleBox[\(\*
StyleBox[\"0\", \"TI\"] . \)]\) Here \!\(\*SubscriptBox[
StyleBox[\"a\", \"TI\"], \"i\"]\) are numbers and \!\(\*SubscriptBox[
StyleBox[\"L\", \"TI\"], \"i\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"B\", \"TI\"], \"i\"]\)\!\(\*
StyleBox[\",\", \"TI\"]\)\!\(\*SubscriptBox[
StyleBox[\"R\", \"TI\"], \"i\"]\) are \!\(\*
StyleBox[\"n\", \"TI\"]\)\!\(\*
StyleBox[\"\[Times]\", \"TI\"]\)\!\(\*
StyleBox[\"n\", \"TI\"]\), \!\(\*
StyleBox[\"n\", \"TI\"]\)\!\(\*
StyleBox[\"\[Times]\", \"TI\"]\)\!\(\*
StyleBox[\"m\", \"TI\"]\), and \!\(\*
StyleBox[\"m\", \"TI\"]\)\!\(\*
StyleBox[\"\[Times]\", \"TI\"]\)\!\(\*
StyleBox[\"m\", \"TI\"]\) matrices, respectively. If \!\(\*
StyleBox[\"B\", \"TI\"]\) is omitted, it is zero. If \!\(\*
StyleBox[\"a\", \"TI\"]\) is omitted, it is zero.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.7269050801842327`*^9, 3.726905082179491*^9}, {
  3.726905119152047*^9, 3.726905137195279*^9}, {3.726905410120417*^9, 
  3.726905482273068*^9}, {3.726905555305915*^9, 3.7269056967459517`*^9}, {
  3.726905998753599*^9, 3.726905999208053*^9}, {3.726906030354031*^9, 
  3.726906036538341*^9}, {3.726906160324307*^9, 3.7269061655639553`*^9}, {
  3.7269069845194674`*^9, 3.726906992823998*^9}, {3.769392157508005*^9, 
  3.769392177149887*^9}, {3.769392211173956*^9, 3.769392280588421*^9}, {
  3.769392352133119*^9, 3.769392370580737*^9}, {3.769392415612832*^9, 
  3.7693924425355387`*^9}, {3.7693924804478407`*^9, 3.769392641598403*^9}, {
  3.769392697718858*^9, 3.769392699383347*^9}, {3.769392738472538*^9, 
  3.7693927568216267`*^9}, {3.769394718359413*^9, 3.769394880215641*^9}},
 ExpressionUUID -> "ba82264a-c2d9-4093-b6ca-22c0c8c7b98e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BTSolve", "[", 
   RowBox[{"seq", ":", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"_", "?", "SquareMatrixQ"}], ",", 
       RowBox[{"_", "?", "SquareMatrixQ"}], ",", "___"}], "}"}], ".."}]}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"n", ",", "m", ",", "X", ",", "LRBaList"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"n", "=", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"{", "seq", "}"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
     RowBox[{"m", "=", 
      RowBox[{"Length", "[", 
       RowBox[{
        RowBox[{"{", "seq", "}"}], "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"TODO", ":", " ", 
       RowBox[{
       "check", " ", "consistency", " ", "of", " ", "the", " ", 
        "parameters"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"X", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"C", ",", 
          RowBox[{"n", "*", "m"}]}], "]"}], ",", "m"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"LRBaList", "=", 
      RowBox[{"Replace", "[", 
       RowBox[{
        RowBox[{"{", "seq", "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"L_", "?", "SquareMatrixQ"}], ",", 
             RowBox[{"R_", "?", "SquareMatrixQ"}], ",", 
             RowBox[{"B", ":", 
              RowBox[{"(", 
               RowBox[{"_", "?", "MatrixQ"}], ")"}], ":", 
              RowBox[{"{", 
               RowBox[{"{", "0", "}"}], "}"}]}], ",", 
             RowBox[{"a_:", "0"}]}], "}"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"a", "*", "X"}], "+", 
            RowBox[{"ODot", "[", 
             RowBox[{"L", ",", "X"}], "]"}], "-", 
            RowBox[{"ODot", "[", 
             RowBox[{"X", ",", "R"}], "]"}], "+", 
            RowBox[{"Replace", "[", 
             RowBox[{"B", ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"{", "0", "}"}], "}"}], "\[RuleDelayed]", 
               RowBox[{"ConstantArray", "[", 
                RowBox[{"0", ",", 
                 RowBox[{"{", 
                  RowBox[{"n", ",", "m"}], "}"}]}], "]"}]}]}], "]"}]}]}], ",", 
          RowBox[{"_", "\[RuleDelayed]", 
           RowBox[{"Return", "[", "$Failed", "]"}]}]}], "}"}], ",", 
        RowBox[{"{", "1", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"X", "/.", 
      RowBox[{"GaussSolve", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", "LRBaList", "]"}], ",", 
        RowBox[{"Flatten", "[", "X", "]"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.76939489896028*^9, 3.769394935688272*^9}, {
  3.769394998920562*^9, 3.7693950024885197`*^9}, {3.769398856677096*^9, 
  3.769398858392365*^9}, {3.769748556784977*^9, 3.7697485572168007`*^9}, {
  3.769825944861731*^9, 3.769825944909205*^9}},
 ExpressionUUID -> "3945bef8-0e08-47a5-b0f0-b363e4b0bcca"],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", 
   "\"\<implement option Pattern in BTSolve, similar to DependentRowIndices\>\
\"", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.769819361916024*^9, 3.7698194154360228`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "todo", "[", 
   "\"\<rewrite BTSolve without necessity to introduce indeterminates\>\"", 
   "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.769749958078973*^9, 3.769750006925934*^9}},
 ExpressionUUID -> "b8bc9045-5664-421d-8d8f-80a357de82f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BTSolve", "[", 
   RowBox[{
    RowBox[{"L_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"R_", "?", "SquareMatrixQ"}], ",", 
    RowBox[{"B", ":", 
     RowBox[{"(", 
      RowBox[{"_", "?", "MatrixQ"}], ")"}], ":", 
     RowBox[{"{", 
      RowBox[{"{", "0", "}"}], "}"}]}], ",", 
    RowBox[{"a_:", "0"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Length", "@", "L"}]}], ",", 
      RowBox[{"m", "=", 
       RowBox[{"Length", "@", "R"}]}], ",", "Ba", ",", 
      RowBox[{"(*", 
       RowBox[{"T", ","}], "*)"}], "X"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"B", "===", 
        RowBox[{"{", 
         RowBox[{"{", "0", "}"}], "}"}]}], ",", 
       RowBox[{"Ba", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "m"}], "}"}]}], "]"}]}], ",", 
       RowBox[{"Ba", "=", "B"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Dimensions", "[", "Ba", "]"}], "=!=", 
        RowBox[{"{", 
         RowBox[{"n", ",", "m"}], "}"}]}], ",", 
       RowBox[{"Abort", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"X", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"C", ",", 
          RowBox[{"n", "*", "m"}]}], "]"}], ",", "m"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"X", "/.", 
      RowBox[{"GaussSolve", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"a", " ", "X"}], "+", 
          RowBox[{"ODot", "[", 
           RowBox[{"L", ",", "X"}], "]"}], "-", 
          RowBox[{"ODot", "[", 
           RowBox[{"X", ",", "R"}], "]"}], "+", "Ba"}], "]"}], ",", 
        RowBox[{"Flatten", "[", "X", "]"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"T", "=", 
      RowBox[{
       RowBox[{"a", " ", 
        RowBox[{"IdentityMatrix", "[", 
         RowBox[{"n", "*", "m"}], "]"}]}], "+", 
       RowBox[{"ArrayFlatten", "[", 
        RowBox[{
         RowBox[{"Outer", "[", 
          RowBox[{"Times", ",", "L", ",", 
           RowBox[{"IdentityMatrix", "[", "m", "]"}]}], "]"}], "-", 
         RowBox[{"Outer", "[", 
          RowBox[{"Times", ",", 
           RowBox[{"IdentityMatrix", "[", "n", "]"}], ",", 
           RowBox[{"Transpose", "@", "R"}]}], "]"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"Check", "[", 
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"LinearSolve", "[", 
           RowBox[{"T", ",", 
            RowBox[{"-", 
             RowBox[{"Flatten", "@", "Ba"}]}]}], "]"}], ",", "m"}], "]"}], 
        ",", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"Indeterminate", ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "m"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"LinearSolve", "::", "nosol"}], "}"}]}], "]"}], "]"}]}], 
    "*)"}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.726904856120495*^9, 3.726904863831859*^9}, {
   3.726904910178049*^9, 3.726904953417794*^9}, {3.7269050279139433`*^9, 
   3.7269050719259043`*^9}, {3.72690570408204*^9, 3.726905793777645*^9}, {
   3.726905971926701*^9, 3.726905980763021*^9}, {3.726906039744851*^9, 
   3.726906301925432*^9}, 3.726906859089663*^9, {3.7269069981676064`*^9, 
   3.726907019008062*^9}, {3.726962605194149*^9, 3.7269626354191313`*^9}, {
   3.726963358951992*^9, 3.726963365111867*^9}, {3.769392287513541*^9, 
   3.769392324038309*^9}, {3.7693924536778383`*^9, 3.769392454061894*^9}, {
   3.7693926485504417`*^9, 3.7693926751904497`*^9}, {3.769392713390523*^9, 
   3.76939273208635*^9}, {3.7693927805098267`*^9, 3.769392963990101*^9}, {
   3.76939311115716*^9, 3.769393117164303*^9}, {3.769393900797091*^9, 
   3.769393933117518*^9}, {3.769393977565135*^9, 3.769394184365488*^9}, 
   3.7693943189341497`*^9},
 ExpressionUUID -> "2abbd909-254c-4f8e-bde7-bc803f18a060"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Extra information", "Subsection",
 CellChangeTimes->{{3.719625063544799*^9, 3.719625067337255*^9}}],

Cell[CellGroupData[{

Cell["Denominators", "Subsubsection",
 CellChangeTimes->{
  3.7185784431616087`*^9, {3.719597588805992*^9, 3.719597599101102*^9}, {
   3.7217290573432302`*^9, 3.721729058225082*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Denominators", "::", "usage"}], "=", "\"\<Denominators[\!\(\*
StyleBox[\"m\", \"TI\"]\)|\!\(\*
StyleBox[\"ds\", \"TI\"]\)] tries to define denominators in the \
system.\\nDenominators[\!\(\*
StyleBox[\"m\", \"TI\"]\)|\!\(\*
StyleBox[\"ds\", \"TI\"]\),\!\(\*
StyleBox[\"pat\", \"TI\"]\)] gives only denominators depending on \!\(\*
StyleBox[\"pat\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719597605100361*^9, 3.719597607809556*^9}, {
  3.71960027405249*^9, 3.719600306629243*^9}, {3.719736929151567*^9, 
  3.719736942518878*^9}, {3.768187923057427*^9, 3.768188001841322*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Denominators", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"pat_:", "_"}], ",", 
    RowBox[{"excl_:", 
     RowBox[{"_", "?", "NumericQ"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "dens", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"dens", "=", 
      RowBox[{"Denominators", "/.", 
       RowBox[{"Drop", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"History", "[", "ds", "]"}], "[", 
          RowBox[{"[", 
           RowBox[{"HistoryIndex", "[", "ds", "]"}], "]"}], "]"}], ",", "2"}],
         "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"dens", "===", "Denominators"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dens", "=", 
         RowBox[{"Denominators", "[", 
          RowBox[{
           RowBox[{"Values", "[", 
            RowBox[{"ds", "[", "]"}], "]"}], ",", 
           RowBox[{"Alternatives", "@@", 
            RowBox[{"Variables", "[", "ds", "]"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"HistoryAddExtra", "[", 
         RowBox[{"ds", ",", 
          RowBox[{"Denominators", "\[Rule]", "dens"}]}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Read Denominators from extras.\>\"", ",", "Small"}], 
         "]"}], "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{"dens", ",", 
       RowBox[{
        RowBox[{"_", "?", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"FreeQ", "[", 
            RowBox[{"#", ",", "pat"}], "]"}], "&"}], ")"}]}], "|", "excl"}]}],
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Code",
 CellChangeTimes->{{3.719739273660943*^9, 3.719739343502132*^9}, {
   3.71973939476729*^9, 3.7197394794307613`*^9}, 3.7197395324401283`*^9, {
   3.719739567592842*^9, 3.7197396052156553`*^9}, {3.7197396500726433`*^9, 
   3.7197396607606077`*^9}, {3.7197567098197803`*^9, 3.719756750010198*^9}, 
   3.721354420145203*^9, 3.721381329565214*^9, {3.7232504707835407`*^9, 
   3.7232504844710627`*^9}, {3.768187526429796*^9, 3.768187553026297*^9}, 
   3.768187622923674*^9, {3.768187659920917*^9, 3.768187660304244*^9}, {
   3.768187695208647*^9, 3.768187729363194*^9}, {3.768187793344882*^9, 
   3.768187840153206*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Denominators", "[", 
   RowBox[{"m_List", ",", 
    RowBox[{"pat_:", "_"}], ",", 
    RowBox[{"excl_:", 
     RowBox[{"_", "?", "NumericQ"}]}]}], "]"}], ":=", 
  RowBox[{"Sort", "@", 
   RowBox[{"DeleteCases", "[", 
    RowBox[{
     RowBox[{"DeleteDuplicates", "@", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"First", "/@", 
           RowBox[{"FactorList", "[", "#", "]"}]}], ")"}], "&"}], "/@", 
        RowBox[{"Denominator", "/@", 
         RowBox[{"Flatten", "[", "m", "]"}]}]}], "]"}]}], ",", 
     RowBox[{
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"#", ",", "pat"}], "]"}], "&"}], ")"}]}], "|", "excl"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Denominators", "[", 
   RowBox[{"ex_", ",", 
    RowBox[{"pat_:", "_"}], ",", 
    RowBox[{"excl_:", 
     RowBox[{"_", "?", "NumericQ"}]}]}], "]"}], ":=", 
  RowBox[{"Sort", "@", 
   RowBox[{"DeleteCases", "[", 
    RowBox[{
     RowBox[{"First", "/@", 
      RowBox[{"FactorList", "[", 
       RowBox[{"Denominator", "@", "ex"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{"_", "?", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"#", ",", "pat"}], "]"}], "&"}], ")"}]}], "|", "excl"}]}], 
    "]"}]}]}]}], "Code",
 CellChangeTimes->{{3.719736979223723*^9, 3.7197370963939323`*^9}, {
   3.719737141498554*^9, 3.719737156138322*^9}, {3.719737196555374*^9, 
   3.719737213387659*^9}, {3.719739556214695*^9, 3.719739556895228*^9}, {
   3.7219765641782227`*^9, 3.721976617151422*^9}, {3.721976736923223*^9, 
   3.721976739294664*^9}, {3.7681867732238483`*^9, 3.768186891735517*^9}, {
   3.7681869755518208`*^9, 3.768187001225642*^9}, {3.768187164775887*^9, 
   3.768187282279893*^9}, {3.768187320887686*^9, 3.768187359751566*^9}, 
   3.76818771616595*^9, {3.768188050313767*^9, 3.7681880603054667`*^9}, 
   3.768188284490049*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Denominators", "[", 
   RowBox[{"as_Assiciation", ",", 
    RowBox[{"pat_:", "_"}], ",", 
    RowBox[{"excl_:", 
     RowBox[{"_", "?", "NumericQ"}]}]}], "]"}], ":=", 
  RowBox[{"Denominators", "[", 
   RowBox[{
    RowBox[{"Values", "[", "as", "]"}], ",", 
    RowBox[{"Alternatives", "@@", 
     RowBox[{"Keys", "[", "as", "]"}]}], ",", 
    RowBox[{
     RowBox[{"_", "?", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{"#", ",", "pat"}], "]"}], "&"}], ")"}]}], "|", "excl"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.723250512343438*^9, 3.723250567967629*^9}, {
   3.76818757125747*^9, 3.768187590480051*^9}, 3.768187638082445*^9, 
   3.7681883209570303`*^9, {3.7681883897943773`*^9, 3.7681884229728947`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["DenominatorOrder (inactive)", "Subsubsection",
 CellChangeTimes->{{3.721976901002058*^9, 3.721976907290285*^9}, {
  3.768785875285831*^9, 3.768785878293797*^9}, {3.768786229519294*^9, 
  3.768786231230783*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DenominatorOrder", "::", "usage"}], "=", 
   "\"\<DenominatorOrder[m|ds,den] tries to define the power of the \
denominator. Negative values correspond to numerators.\\nNB: Old definitions \
turned off. Use more solid LeadingOrderMod instead.\>\""}], ";"}]], "Input",
 CellChangeTimes->{{3.721977034499267*^9, 3.721977109251379*^9}, {
   3.7687859471428337`*^9, 3.7687859873746443`*^9}, {3.7687862379042797`*^9, 
   3.768786264664242*^9}, 3.7705915589783087`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DenominatorOrder", "[", 
    RowBox[{"0", ",", "den_"}], "]"}], ":=", 
   RowBox[{"-", "\[Infinity]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DenominatorOrder", "[", 
    RowBox[{"ex_", ",", "den_"}], "]"}], ":=", 
   RowBox[{"Plus", "@@", 
    RowBox[{"Cases", "[", 
     RowBox[{
      RowBox[{"FactorList", "[", 
       RowBox[{"Denominator", "@", "ex"}], "]"}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"den", ",", "n_"}], "}"}], "\[RuleDelayed]", "n"}]}], 
     "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DenominatorOrder", "[", 
    RowBox[{"m_List", ",", "den_"}], "]"}], ":=", 
   RowBox[{"Max", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"DenominatorOrder", "[", 
       RowBox[{"#", ",", "den"}], "]"}], "&"}], "/@", 
     RowBox[{"Flatten", "[", "m", "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7219769260513144`*^9, 3.721977021490905*^9}, {
   3.721977243052451*^9, 3.7219772526602697`*^9}, 3.7220344398076468`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DenominatorOrder", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "den_"}], "]"}], ":=", 
  RowBox[{"DenominatorOrder", "[", 
   RowBox[{
    RowBox[{"Values", "[", 
     RowBox[{
      RowBox[{"History", "[", "ds", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"HistoryIndex", "[", "ds", "]"}], ",", "1"}], "]"}], "]"}], 
     "]"}], ",", "den"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7219773444077044`*^9, 3.7219773755458612`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["PolesPosition,PoincareRank,PolesInfo", "Subsubsection",
 CellChangeTimes->{{3.719736554330112*^9, 3.719736556618268*^9}, {
   3.719736660651943*^9, 3.719736666874962*^9}, 3.721347165912397*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolesPosition", "::", "usage"}], "=", "\"\<PolesPosition[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] tries to determine all singular points of the \
matrix \!\(\*
StyleBox[\"m\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.719736704108397*^9, 3.719736705123682*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PolesPosition", "[", 
   RowBox[{"m_List", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"xf", ",", "t", ",", "mr"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"xf", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"x", "/.", "#"}], "&"}], "/@", 
       RowBox[{"Union", "@", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Solve", "[", 
            RowBox[{
             RowBox[{"#", "==", "0"}], ",", "x"}], "]"}], "&"}], "/@", 
          RowBox[{"Denominators", "[", 
           RowBox[{
            RowBox[{"{", "m", "}"}], ",", "x"}], "]"}]}], "]"}]}]}]}], ";", 
     "\n", 
     RowBox[{"mr", "=", 
      RowBox[{"Factor", "[", 
       RowBox[{
        RowBox[{"m", "/", 
         RowBox[{"t", "^", "2"}]}], "/.", 
        RowBox[{"x", "->", 
         RowBox[{"1", "/", "t"}]}]}], "]"}]}], ";", "\n", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"Quiet", "[", 
        RowBox[{"Check", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"mr", "/.", 
            RowBox[{"t", "->", "0"}]}], ";", "False"}], ",", "True", ",", 
          RowBox[{"Power", "::", "infy"}]}], "]"}], "]"}], ",", 
       RowBox[{"Sort", "[", 
        RowBox[{"Append", "[", 
         RowBox[{"xf", ",", "\[Infinity]"}], "]"}], "]"}], ",", 
       RowBox[{"Sort", "[", "xf", "]"}]}], "]"}]}]}], "\n", "]"}]}]], "Code",
 CellChangeTimes->{{3.719736677996518*^9, 3.719736681067746*^9}, {
   3.719736796861615*^9, 3.719736799341333*^9}, {3.719737425433752*^9, 
   3.719737439536669*^9}, {3.719737481561388*^9, 3.719737501386426*^9}, {
   3.719737535102695*^9, 3.719737535244396*^9}, {3.719738178275887*^9, 
   3.719738197978187*^9}, {3.7197382627759027`*^9, 3.7197382767438726`*^9}, {
   3.719738380699574*^9, 3.7197383815550003`*^9}, 3.71974030262138*^9, {
   3.719740334420204*^9, 3.719740335031684*^9}, {3.719740374899373*^9, 
   3.719740378611689*^9}, {3.72134945235882*^9, 3.721349453006645*^9}, 
   3.7686033765503473`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PolesPosition", "[", 
   RowBox[{"ds_Association", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesPosition", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolesPosition", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesPosition", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.721349470158216*^9, 3.721349516490541*^9}, 
   3.72135442548881*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PoincareRank", "::", "usage"}], "=", "\"\<PoincareRank[\!\(\*
StyleBox[\"m\", \"TI\"]\),{\!\(\*
StyleBox[\"x\", \"TI\"]\),\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"0\"]\)}] gives the Poincare rank \!\(\*
StyleBox[\"r\", \"TI\"]\) of the singular point \!\(\*
StyleBox[\"x\", \"TI\"]\)=\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"0\"]\) of \!\(\*
StyleBox[\"m\", \"TI\"]\). When \!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"0\"]\)\[NotEqual]\[Infinity] the Poincare rank is \
the pole order minus 1 (by convention, we put \!\(\*
StyleBox[\"r\", \"TI\"]\)=-1 for regular point). For \
\!\(\*SubscriptBox[\(x\), \(0\)]\)=\[Infinity] the Poincare rank is 1 minus \
the leading series order.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721346202040065*^9, 3.721346398389421*^9}, 
   3.721346429046461*^9, {3.7213469490178432`*^9, 3.721346989273954*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PoincareRank", "[", 
   RowBox[{"m_", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Max", "[", 
   RowBox[{
    RowBox[{"-", "1"}], ",", 
    RowBox[{
     RowBox[{"2", "*", 
      RowBox[{"Boole", "[", 
       RowBox[{"x0", "===", "\[Infinity]"}], "]"}]}], "-", "1", "-", 
     RowBox[{"LeadingOrder", "[", 
      RowBox[{"m", ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.6060104322261157`*^9, 3.606010433280815*^9}, {
   3.606010794843848*^9, 3.6060107983871937`*^9}, {3.636452713578679*^9, 
   3.6364527589755373`*^9}, 3.6364537390104094`*^9, {3.719737559467444*^9, 
   3.719737583875655*^9}, {3.7197387621489964`*^9, 3.71973877283679*^9}, {
   3.719738810405044*^9, 3.7197388577660933`*^9}, {3.719738889964478*^9, 
   3.719738971732685*^9}, {3.719739031860281*^9, 3.719739052652994*^9}, {
   3.7197390888280697`*^9, 3.719739090508568*^9}, {3.7213464644795017`*^9, 
   3.721346549557172*^9}, 3.721346647794207*^9, {3.721346696386647*^9, 
   3.721346712981488*^9}, {3.721346761507785*^9, 3.7213467744992247`*^9}, {
   3.7213495512639713`*^9, 3.721349551880341*^9}, 3.768189470392549*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PoincareRank", "[", 
   RowBox[{"ds_Association", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"PoincareRank", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PoincareRank", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"PoincareRank", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.6060104322261157`*^9, 3.606010433280815*^9}, {
   3.606010794843848*^9, 3.6060107983871937`*^9}, {3.636452713578679*^9, 
   3.6364527589755373`*^9}, 3.6364537390104094`*^9, {3.719737559467444*^9, 
   3.719737583875655*^9}, {3.7197387621489964`*^9, 3.71973877283679*^9}, {
   3.719738810405044*^9, 3.7197388577660933`*^9}, {3.719738889964478*^9, 
   3.719738971732685*^9}, {3.719739031860281*^9, 3.719739052652994*^9}, {
   3.7197390888280697`*^9, 3.719739090508568*^9}, {3.7213464644795017`*^9, 
   3.721346549557172*^9}, 3.721346647794207*^9, {3.721346696386647*^9, 
   3.721346712981488*^9}, {3.721346761507785*^9, 3.7213467744992247`*^9}, {
   3.7213495512639713`*^9, 3.721349551880341*^9}, {3.721349592686908*^9, 
   3.721349620397695*^9}, 3.721354427344561*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{"ds_Association", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.721349470158216*^9, 3.72134953699432*^9}, 
   3.721354428888761*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PolesInfo", "[", "ds_Association", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"#", "\[Rule]", 
      RowBox[{"PolesInfo", "[", 
       RowBox[{
        RowBox[{"ds", "[", "#", "]"}], ",", "#"}], "]"}]}], ")"}], "&"}], "/@", 
   RowBox[{"Keys", "[", "ds", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{"ds_", "?", "DSystemQ"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"#", "\[Rule]", 
      RowBox[{"PolesInfo", "[", 
       RowBox[{
        RowBox[{"ds", "[", "#", "]"}], ",", "#"}], "]"}]}], ")"}], "&"}], "/@", 
   RowBox[{"Keys", "[", "ds", "]"}]}]}]}], "Code",
 CellChangeTimes->{{3.721349470158216*^9, 3.72134953699432*^9}, 
   3.721354428888761*^9, {3.760857389355032*^9, 3.7608574255635366`*^9}, {
   3.76713242206142*^9, 3.7671324222676153`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolesInfo", "::", "usage"}], "=", "\"\<PolesInfo[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] gives a list of pairs {\!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"i\"]\),\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], \"i\"]\)}, where \!\(\*SubscriptBox[
StyleBox[\"x\", \"TI\"], \"i\"]\) is the position of the pole, and \
\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], \"i\"]\) is its Poincare rank.\>\""}], ";"}]], "Code",
 CellChangeTimes->{
  3.7197365605941353`*^9, {3.721347111973639*^9, 3.721347114445216*^9}, {
   3.721347197030368*^9, 3.721347214415675*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{"m_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"xs", ",", "n"}], "}"}], ",", "\n", 
    RowBox[{
     RowBox[{"xs", "=", 
      RowBox[{"PolesPosition", "[", 
       RowBox[{"m", ",", "x"}], "]"}]}], ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"#", ",", 
         RowBox[{"PoincareRank", "[", 
          RowBox[{"m", ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "#"}], "}"}]}], "]"}]}], "}"}], "&"}], "/@", 
      "xs"}]}]}], "\n", "]"}]}]], "Code",
 CellChangeTimes->{{3.719736607475049*^9, 3.719736611291503*^9}, {
   3.719738641382263*^9, 3.719738680285675*^9}, 3.719740305637042*^9, {
   3.719740341595805*^9, 3.719740343459861*^9}, 3.719740384834916*^9, 
   3.7213470266041317`*^9, {3.7213471288688993`*^9, 3.721347129221262*^9}, {
   3.721347191166375*^9, 3.721347191302505*^9}, 3.7213495596023006`*^9, 
   3.7681894772645597`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{"ds_Association", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"PolesInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.721349470158216*^9, 3.72134953699432*^9}, 
   3.721354430784215*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["DenominatorsInfo", "Subsubsection",
 CellChangeTimes->{3.76818896273361*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyPoincareRank", "::", "usage"}], "=", 
   "\"\<PolyPoincareRank[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"d\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] gives the Poincare rank \!\(\*
StyleBox[\"r\", \"TI\"]\)  of \!\(\*
StyleBox[\"m\", \"TI\"]\)\!\(\*
StyleBox[\"  \", \"TI\"]\)at zeros of \!\(\*
StyleBox[\"d\", \"TI\"]\).\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721346202040065*^9, 3.721346398389421*^9}, 
   3.721346429046461*^9, {3.7213469490178432`*^9, 3.721346989273954*^9}, {
   3.770472463221649*^9, 3.7704725845419493`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PolyPoincareRank", "[", 
   RowBox[{"m_", ",", "poly_", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"Max", "[", 
   RowBox[{
    RowBox[{"-", "1"}], ",", 
    RowBox[{
     RowBox[{"2", "*", 
      RowBox[{"Boole", "[", 
       RowBox[{"poly", "===", 
        RowBox[{"1", "/", "x"}]}], "]"}]}], "-", "1", "-", 
     RowBox[{"LeadingOrderMod", "[", 
      RowBox[{"m", ",", 
       RowBox[{"x", "\[Rule]", "poly"}]}], "]"}]}]}], "]"}]}]], "Code",
 CellChangeTimes->{{3.6060104322261157`*^9, 3.606010433280815*^9}, {
   3.606010794843848*^9, 3.6060107983871937`*^9}, {3.636452713578679*^9, 
   3.6364527589755373`*^9}, 3.6364537390104094`*^9, {3.719737559467444*^9, 
   3.719737583875655*^9}, {3.7197387621489964`*^9, 3.71973877283679*^9}, {
   3.719738810405044*^9, 3.7197388577660933`*^9}, {3.719738889964478*^9, 
   3.719738971732685*^9}, {3.719739031860281*^9, 3.719739052652994*^9}, {
   3.7197390888280697`*^9, 3.719739090508568*^9}, {3.7213464644795017`*^9, 
   3.721346549557172*^9}, 3.721346647794207*^9, {3.721346696386647*^9, 
   3.721346712981488*^9}, {3.721346761507785*^9, 3.7213467744992247`*^9}, {
   3.7213495512639713`*^9, 3.721349551880341*^9}, 3.768189470392549*^9, {
   3.770472589616206*^9, 3.7704726305901213`*^9}, 3.770591559821991*^9, {
   3.770602452494917*^9, 3.77060245517515*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PolyPoincareRank", "[", 
   RowBox[{"ds_Association", ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"PolyPoincareRank", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PolyPoincareRank", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", 
    RowBox[{"{", 
     RowBox[{"x_Symbol", ",", "x0_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"PolyPoincareRank", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"x", ",", "x0"}], "}"}]}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.6060104322261157`*^9, 3.606010433280815*^9}, {
   3.606010794843848*^9, 3.6060107983871937`*^9}, {3.636452713578679*^9, 
   3.6364527589755373`*^9}, 3.6364537390104094`*^9, {3.719737559467444*^9, 
   3.719737583875655*^9}, {3.7197387621489964`*^9, 3.71973877283679*^9}, {
   3.719738810405044*^9, 3.7197388577660933`*^9}, {3.719738889964478*^9, 
   3.719738971732685*^9}, {3.719739031860281*^9, 3.719739052652994*^9}, {
   3.7197390888280697`*^9, 3.719739090508568*^9}, {3.7213464644795017`*^9, 
   3.721346549557172*^9}, 3.721346647794207*^9, {3.721346696386647*^9, 
   3.721346712981488*^9}, {3.721346761507785*^9, 3.7213467744992247`*^9}, {
   3.7213495512639713`*^9, 3.721349551880341*^9}, {3.721349592686908*^9, 
   3.721349620397695*^9}, 3.721354427344561*^9, {3.770472658089017*^9, 
   3.770472663911574*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DenominatorsInfo", "::", "usage"}], "=", 
   "\"\<DenominatorsInfo[\!\(\*
StyleBox[\"m\", \"TI\"]\),\!\(\*
StyleBox[\"x\", \"TI\"]\)] gives a list of pairs {\!\(\*SubscriptBox[
StyleBox[\"d\", \"TI\"], \"i\"]\),\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], \"i\"]\)}, where \!\(\*SubscriptBox[
StyleBox[\"d\", \"TI\"], \"i\"]\) are irreducible denominators and \
\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], \"i\"]\) are their Poincare ranks. The last entry is \
special: {\!\(\*SuperscriptBox[
StyleBox[\"x\", \"TI\"], 
RowBox[{\"-\", \"1\"}]]\),\!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], \"\[Infinity]\"]\)}, where \!\(\*SubscriptBox[
StyleBox[\"r\", \"TI\"], \"\[Infinity]\"]\) is the Poincare rank at infinity.\
\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.768189274529409*^9, 3.768189337275279*^9}, {
  3.768189522939507*^9, 3.768189604777402*^9}},
 ExpressionUUID -> "47a0be8c-d6fa-4b76-bf60-3610d18a2b1e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"DenominatorsInfo", "[", 
   RowBox[{"m_", ",", "x_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"dens", "=", 
      RowBox[{"Denominators", "[", 
       RowBox[{"m", ",", "x"}], "]"}]}], "}"}], ",", 
    RowBox[{"Append", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"PolyPoincareRank", "[", 
           RowBox[{"m", ",", "#", ",", "x"}], "]"}]}], "}"}], "&"}], "/@", 
       "dens"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "/", "x"}], ",", 
        RowBox[{"PolyPoincareRank", "[", 
         RowBox[{"m", ",", 
          RowBox[{"1", "/", "x"}], ",", "x"}], "]"}]}], "}"}]}], "]"}]}], 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.768189625345817*^9, 3.768189631706664*^9}, 
   3.768515077331307*^9, {3.770472678056958*^9, 3.7704726835997887`*^9}, {
   3.770472714461618*^9, 3.770472729072391*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DenominatorsInfo", "[", 
   RowBox[{"ds_Association", ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"DenominatorsInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DenominatorsInfo", "[", 
   RowBox[{
    RowBox[{"ds_", "?", "DSystemQ"}], ",", "x_Symbol"}], "]"}], ":=", 
  RowBox[{"DenominatorsInfo", "[", 
   RowBox[{
    RowBox[{"ds", "[", "x", "]"}], ",", "x"}], "]"}]}]}], "Code",
 CellChangeTimes->{{3.7681896588834953`*^9, 3.768189662242654*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Factors,FactorPlus,FactorListPlus", "Subsubsection",
 CellChangeTimes->{{3.72121812606629*^9, 3.721218138809308*^9}, {
  3.7212577743235197`*^9, 3.721257774665484*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FactorPlus", "::", "usage"}], "=", 
   "\"\<FactorPlus[expr] factors expr iff it has head \\\"Plus\\\"\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7201569301182413`*^9, 3.720156963814578*^9}, {
   3.721217950727635*^9, 3.7212179540357018`*^9}, 3.72121803285843*^9, 
   3.721255680360464*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"FactorPlus", ",", "Listable"}], "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.7201604711240253`*^9, 3.720160489131838*^9}, 
   3.721218038959566*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FactorPlus", "[", "expr_Plus", "]"}], ":=", 
   RowBox[{"Factor", "[", "expr", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorPlus", "[", "expr_", "]"}], ":=", "expr"}], ";"}]}], "Code",
 CellChangeTimes->{{3.720156901182169*^9, 3.7201569031104116`*^9}, {
  3.720156974135043*^9, 3.72015700130232*^9}, {3.721218041024757*^9, 
  3.721218042173778*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FactorListPlus", "::", "usage"}], "=", 
   "\"\<FactorListPlus[expr] factors expr iff it has head \\\"Plus\\\" and \
gives a list of the factors, together with their exponents.\>\""}], 
  ";"}]], "Code",
 CellChangeTimes->{{3.7201569301182413`*^9, 3.720156963814578*^9}, {
   3.721217950727635*^9, 3.7212179540357018`*^9}, 3.72121803285843*^9, {
   3.721255673455359*^9, 3.721255674800858*^9}, {3.721255790986165*^9, 
   3.7212558085368643`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FactorListPlus", "[", "expr_Plus", "]"}], ":=", 
   RowBox[{"FactorList", "[", "expr", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FactorListPlus", "[", "expr_", "]"}], ":=", 
   RowBox[{"Factors", "[", "expr", "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.720156901182169*^9, 3.7201569031104116`*^9}, {
   3.720156974135043*^9, 3.72015700130232*^9}, {3.721218044402382*^9, 
   3.7212180467970657`*^9}, {3.7212556329173717`*^9, 3.7212556602155323`*^9}, 
   3.721257928501527*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Factors", "::", "usage"}], "=", 
   "\"\<Factors[expr] returns the list of expr factors not trying to \
factorize it.\>\""}], ";"}]], "Code",
 CellChangeTimes->{{3.721216305176919*^9, 3.721216333021512*^9}, {
  3.7212579009307003`*^9, 3.721257913769446*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Factors", "[", "expr_", "]"}], ":=", 
  RowBox[{"Replace", "[", 
   RowBox[{
    RowBox[{"Replace", "[", 
     RowBox[{
      RowBox[{"{", "expr", "}"}], ",", 
      RowBox[{"Times", "\[Rule]", "Sequence"}], ",", 
      RowBox[{"{", "2", "}"}], ",", 
      RowBox[{"Heads", "\[Rule]", "True"}]}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"x_", "^", "n_Integer"}], "\[RuleDelayed]", 
       RowBox[{"{", 
        RowBox[{"x", ",", "n"}], "}"}]}], ",", 
      RowBox[{"x_", "\[RuleDelayed]", 
       RowBox[{"{", 
        RowBox[{"x", ",", "1"}], "}"}]}]}], "}"}], ",", 
    RowBox[{"{", "1", "}"}]}], "]"}]}]], "Code",
 CellChangeTimes->{3.721257910984249*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Timing", "[", 
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"FactorList", "@", "#"}], ",", 
       RowBox[{"{", "1000", "}"}]}], "]"}], ";"}], "]"}], "&"}], "[", 
  RowBox[{"Factor", "[", 
   RowBox[{"Hypergeometric2F1", "[", 
    RowBox[{
     RowBox[{"-", "6"}], ",", 
     RowBox[{
      FractionBox["1", "2"], "+", 
      RowBox[{"I", " ", 
       RowBox[{"(", 
        RowBox[{"x", "+", "u"}], ")"}]}]}], ",", "1", ",", "2"}], "]"}], 
   "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Timing", "[", 
    RowBox[{
     RowBox[{"Do", "[", 
      RowBox[{
       RowBox[{"Factors", "@", "#"}], ",", 
       RowBox[{"{", "1000", "}"}]}], "]"}], ";"}], "]"}], "&"}], "[", 
  RowBox[{"Factor", "[", 
   RowBox[{"Hypergeometric2F1", "[", 
    RowBox[{
     RowBox[{"-", "6"}], ",", 
     RowBox[{
      FractionBox["1", "2"], "+", 
      RowBox[{"I", " ", 
       RowBox[{"(", 
        RowBox[{"x", "+", "u"}], ")"}]}]}], ",", "1", ",", "2"}], "]"}], 
   "]"}], "]"}]}], "Input",
 CellChangeTimes->{{3.7212161386638412`*^9, 3.721216141969819*^9}, 
   3.721257915432176*^9}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Internal functions", "Subsection",
 CellChangeTimes->{{3.719634263608427*^9, 3.7196342671958313`*^9}, 
   3.719656274546493*^9}],

Cell["\<\
bsqr is a boolean version of the matrix square m.m, where \[Times] and + are \
replaced by \[And] and \[Or], respectively.
Looks like it is not needed yet.\
\>", "Text",
 CellChangeTimes->{{3.719634319009001*^9, 3.719634377969325*^9}, {
  3.71963694173005*^9, 3.719637066778029*^9}, {3.719637429974394*^9, 
  3.719637447334557*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bsqr", ":=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"m", ",", "_Integer", ",", "2"}], "}"}], "}"}], ",", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"mc", "=", "m"}], "}"}], ",", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"mc", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", "j"}], "]"}], "]"}], "\[Equal]", "1"}], "&&", 
             RowBox[{
              RowBox[{"mc", "[", 
               RowBox[{"[", 
                RowBox[{"j", ",", "k"}], "]"}], "]"}], "\[Equal]", "1"}]}], 
            ",", 
            RowBox[{
             RowBox[{"mc", "[", 
              RowBox[{"[", 
               RowBox[{"i", ",", "k"}], "]"}], "]"}], "=", "1"}]}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"Length", "@", "mc"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "mc"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", 
            RowBox[{"Length", "@", "mc"}]}], "}"}]}], "]"}], ";", "mc"}]}], 
      "]"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7196343020585814`*^9, 3.7196343098696404`*^9}, {
  3.719636938900462*^9, 3.71963696847867*^9}, {3.71963721238832*^9, 
  3.7196372141228456`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ker", "[", 
   RowBox[{"m_", "?", "MatrixQ"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"cs", ",", 
      RowBox[{"l", "=", 
       RowBox[{"Length", "@", 
        RowBox[{"First", "@", "m"}]}]}], " ", 
      RowBox[{"(*", 
       RowBox[{"#", " ", "of", " ", "cols"}], "*)"}], ",", "cs1", ",", "eqs", 
      ",", "sol"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"cs", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Unique", "[", "\"\<c\>\"", "]"}], ",", 
        RowBox[{"{", "l", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"eqs", "=", 
      RowBox[{"Dot", "[", 
       RowBox[{"m", ",", "cs"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sol", "=", 
      RowBox[{"GaussSolve", "[", 
       RowBox[{"eqs", ",", "cs"}], "]"}]}], ";", 
     RowBox[{"(*", 
      RowBox[{"always", " ", "should", " ", "be", " ", "a", " ", "solution"}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"cs1", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{"cs", ",", 
        RowBox[{"First", "/@", "sol"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"cs1", "===", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"0", "&"}], "/@", "cs"}], "}"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"Transpose", "@", 
         RowBox[{"Outer", "[", 
          RowBox[{"Coefficient", ",", 
           RowBox[{"cs", "/.", "sol"}], ",", "cs1"}], "]"}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Code",
 CellChangeTimes->{{3.7274235420654383`*^9, 3.7274238032272797`*^9}, {
   3.727423875035776*^9, 3.727423901427799*^9}, {3.727424479150663*^9, 
   3.727424505461998*^9}, 3.727424673384941*^9, {3.727424706791813*^9, 
   3.727424709311295*^9}, {3.7274247404315434`*^9, 3.727424776790658*^9}, {
   3.7274248108877687`*^9, 3.727424814312065*^9}, {3.7277441814062843`*^9, 
   3.727744186982222*^9}, 3.768994055298251*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"im", "=", 
   RowBox[{"ker", "@*", "ker", "@*", "Transpose"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.721439314751301*^9, 3.721439421748402*^9}, 
   3.721693424070169*^9, {3.721695363519683*^9, 3.7216953666797028`*^9}, 
   3.721695483442234*^9, 3.727423940851158*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"ns", "=", 
     RowBox[{"Function", "[", 
      RowBox[{"m", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"#", "===", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{"0", ",", 
              RowBox[{"Length", "@", "m"}]}], "]"}], "}"}], ",", "#"}], "]"}],
          "&"}], "[", 
        RowBox[{"NullSpace", "[", "m", "]"}], "]"}]}], "]"}]}], ";"}], "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"ker", "=", 
     RowBox[{"Transpose", "@*", "ns"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"coker", "=", 
     RowBox[{"ns", "@*", "Transpose"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"im", "=", 
     RowBox[{"ker", "@*", "coker"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"coim", "=", 
     RowBox[{"coker", "@*", "ker"}]}], ";"}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.7213693089166*^9, 3.721369331164702*^9}, {
   3.721439435340481*^9, 3.7214394408276873`*^9}, 3.721683103667425*^9, 
   3.72168314664146*^9, {3.7216934016043177`*^9, 3.721693415648487*^9}, {
   3.7216950106123962`*^9, 3.721695035436893*^9}, 3.721695361959712*^9, {
   3.72169550337118*^9, 3.721695511379306*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"preim", "[", 
       RowBox[{"matrix", ",", "space"}], "]"}], " ", "--"}], "-", " ", 
     RowBox[{
     "preimage", " ", "of", " ", "space", " ", "wrt", " ", "matrix"}]}], ",", 
    " ", 
    RowBox[{
     RowBox[{"i", ".", "e", ".", " ", "matrix", ".", 
      RowBox[{"preim", "[", 
       RowBox[{"matrix", ",", "space"}], "]"}]}], "=", "space"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"similarly", ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"copreim", "[", 
       RowBox[{"matrix", ",", "space"}], "]"}], ".", "matrix"}], "=", 
     "space"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"preim", "=", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"ker", "@", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"coker", "@", "#2"}], ".", "#1"}], ")"}]}], "&"}], 
      "\[IndentingNewLine]", "copreim"}], "=", 
     RowBox[{
      RowBox[{"coker", "@", 
       RowBox[{"(", 
        RowBox[{"#1", ".", 
         RowBox[{"ker", "@", "#2"}]}], ")"}]}], "&"}]}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.7213693089166*^9, 3.721369550750214*^9}, 
   3.721695351253429*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"bjf", "::", "usage"}], "=", "\"\<bjf[\!\(\*
StyleBox[\"A\", \"TI\"]\),\!\(\*
StyleBox[\"B\", \"TI\"]\),\!\(\*
StyleBox[\"k\", \"TI\"]\)] constructs block matrix of the form \
\!\(\*Cell[TextData[Cell[BoxData[
FormBox[
RowBox[{\"(\", \"\[NoBreak]\", GridBox[{
{
StyleBox[\"A\", \"TI\"], 
StyleBox[\"B\", \"TI\"], \"0\"},
{\"0\", 
StyleBox[\"A\", \"TI\"], 
StyleBox[\"B\", \"TI\"]},
{\"0\", \"0\", 
StyleBox[\"A\", \"TI\"]}
}], \"\[NoBreak]\", \")\"}], TraditionalForm]]]]]\) where \!\(\*
StyleBox[\"A\", \"TI\"]\) is repeated \!\(\*
StyleBox[\"k\", \"TI\"]\)\!\(\*
StyleBox[\" \", \"TI\"]\)times. In particular, bjf[\[Lambda],1,\!\(\*
StyleBox[\"k\", \"TI\"]\)] gives \!\(\*
StyleBox[\"k\", \"TI\"]\)\[Times]\!\(\*
StyleBox[\"k\", \"TI\"]\) Jordan cell.\>\""}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"bjf", "[", 
    RowBox[{"a_", ",", "b_", ",", "k_Integer"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ap", ",", "bp"}], "}"}], ",", 
     RowBox[{"ArrayFlatten", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"IdentityMatrix", "[", "k", "]"}], "*", "ap"}], "+", 
        RowBox[{
         RowBox[{"Rest", "[", 
          RowBox[{"Transpose", "[", 
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"{", 
             RowBox[{"k", ",", 
              RowBox[{"k", "+", "1"}]}], "}"}], "]"}], "]"}], "]"}], "*", 
         "bp"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ap", "\[Rule]", "a"}], ",", 
         RowBox[{"bp", "\[Rule]", "b"}]}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}]}], "Code",
 CellChangeTimes->{3.77035352632733*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"obsolete", "::", "warn"}], "=", 
  "\"\<The syntax `1` is obsolete. Use `2` instead.\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"obsolete", "[", 
    RowBox[{"ex_", ",", 
     RowBox[{"old_String", "\[Rule]", "new_String"}]}], "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Message", "[", 
      RowBox[{
       RowBox[{"obsolete", "::", "warn"}], ",", "old", ",", "new"}], "]"}], 
     ";", "ex"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"obsolete", "[", 
    RowBox[{"ex_", ",", "___"}], "]"}], ":=", "ex"}], ";"}]}], "Code",
 CellChangeTimes->{{3.770592040169029*^9, 3.7705921295824614`*^9}, {
   3.7705921772690496`*^9, 3.770592178140926*^9}, {3.770592257750547*^9, 
   3.770592432000861*^9}, 3.7705924981913652`*^9, {3.770603448042245*^9, 
   3.770603481346402*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"patternQ", "[", "ex_", "]"}], ":=", 
   RowBox[{"!", 
    RowBox[{"FreeQ", "[", 
     RowBox[{"ex", ",", 
      RowBox[{
      "Pattern", "|", "Except", "|", "PatternTest", "|", "Blank", "|", 
       "BlankSequence", "|", "BlankNullSequence", "|", "Alternatives"}]}], 
     "]"}]}]}], ";"}]], "Code",
 CellChangeTimes->{{3.770954991763226*^9, 3.770955003323246*^9}, {
  3.770955071290769*^9, 3.770955096504964*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["End Private", "Section",
 CellChangeTimes->{{3.718578431606361*^9, 3.718578432129777*^9}, {
  3.7700248041690893`*^9, 3.770024806878068*^9}}],

Cell["Print issues", "Text",
 CellChangeTimes->{{3.721113210345653*^9, 3.721113213625433*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.718577835840699*^9, 3.7185778372135468`*^9}, 
   3.7225550002331467`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Load Addons", "Section",
 CellChangeTimes->{{3.770024413245212*^9, 3.770024415925291*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GetIfExists", "[", "name_String", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"If", " ", "[", 
      RowBox[{
       RowBox[{"FileExistsQ", "[", "#", "]"}], ",", 
       RowBox[{"Get", "[", "#", "]"}]}], "]"}], "&"}], "[", 
    RowBox[{
     RowBox[{"DirectoryName", "[", "$LibraInputFileName", "]"}], "<>", 
     "name"}], "]"}]}], ";"}]], "Code",
 CellChangeTimes->{{3.7700249565057096`*^9, 3.770024989687778*^9}, {
  3.7700250265874166`*^9, 3.770025026770158*^9}, {3.7700251022118807`*^9, 
  3.7700251239501953`*^9}, {3.7700402961801567`*^9, 3.770040321257104*^9}}],

Cell[BoxData[
 RowBox[{"GetIfExists", "[", "\"\<Addons/BlockCompanionDecomposition.m\>\"", 
  "]"}]], "Code",
 CellChangeTimes->{{3.770024420737163*^9, 3.770024429948391*^9}, {
   3.770024870015954*^9, 3.770024949210697*^9}, 3.770025146416964*^9, 
   3.770040290475079*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["End", "Section",
 CellChangeTimes->{{3.718578431606361*^9, 3.718578432129777*^9}, {
  3.7700248041690893`*^9, 3.770024806878068*^9}, {3.770024839465455*^9, 
  3.770024839613092*^9}}],

Cell[BoxData[
 RowBox[{"EndPackage", "[", "]"}]], "Code",
 CellChangeTimes->{{3.7185778094737587`*^9, 3.718577815669742*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"$LibraUseFermat", "=", 
      RowBox[{"MemberQ", "[", 
       RowBox[{"$ContextPath", ",", "\"\<Fermatica`\>\""}], "]"}]}], ")"}], 
    ",", 
    RowBox[{
    "Print", "[", "\"\<Prepared to use Fermatica for matrix operations!\>\"", 
     "]"}]}], "]"}], ";"}]], "Code",
 CellChangeTimes->{
  3.7277493939344263`*^9, {3.727750169405266*^9, 3.7277502048813467`*^9}, {
   3.7277504178545094`*^9, 3.727750418370432*^9}, 3.7280015383196793`*^9, {
   3.768607731986858*^9, 3.768607735726803*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"NameQ", "[", "\"\<Global`$LibraTODO\>\"", "]"}], "&&", 
     RowBox[{"Symbol", "[", "\"\<Global`$LibraTODO\>\"", "]"}]}], ",", 
    RowBox[{
     RowBox[{"CellPrint", "[", 
      RowBox[{"Cell", "[", 
       RowBox[{"\"\<todo:\>\"", ",", " ", "\"\<Print\>\"", ",", " ", 
        RowBox[{"CellFrame", "->", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "1"}], "}"}]}], "}"}]}]}], "]"}], "]"}], 
     ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{
          RowBox[{"\"\<\[FilledSmallCircle] \>\"", "<>", "#"}], ",", 
          RowBox[{"{", 
           RowBox[{"\"\<Text\>\"", ",", "Small"}], "}"}]}], "]"}], "]"}], 
       "&"}], "/@", "Libra`Private`todolist"}], ";", "\[IndentingNewLine]", 
     RowBox[{"CellPrint", "[", 
      RowBox[{"Cell", "[", 
       RowBox[{"\"\<done:\>\"", ",", " ", "\"\<Print\>\"", ",", " ", 
        RowBox[{"CellFrame", "->", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "1"}], "}"}]}], "}"}]}]}], "]"}], "]"}], 
     ";", "\n", 
     RowBox[{
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{
          RowBox[{"\"\<\[Checkmark] \>\"", "<>", "#"}], ",", 
          RowBox[{"{", 
           RowBox[{"\"\<Text\>\"", ",", "Small"}], "}"}]}], "]"}], "]"}], 
       "&"}], "/@", "Libra`Private`donelist"}]}]}], "]"}], ";"}]], "Code",
 CellChangeTimes->{{3.721113774614596*^9, 3.7211137785561857`*^9}, {
   3.7211138390549803`*^9, 3.721113848133545*^9}, {3.7211138790936604`*^9, 
   3.721113908166081*^9}, {3.7211153773938103`*^9, 3.7211153809493313`*^9}, {
   3.727750344397735*^9, 3.72775035165458*^9}, {3.762409525304439*^9, 
   3.762409545386833*^9}, {3.7632125934688253`*^9, 3.763212629562544*^9}, {
   3.7632126769404078`*^9, 3.7632126888386307`*^9}, 3.76321277066229*^9, {
   3.763213055082279*^9, 3.76321306065589*^9}, {3.7686106022994137`*^9, 
   3.768610631843794*^9}}]
}, Closed]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
WindowSize->{1793, 2045},
WindowMargins->{{1920, 76}, {0, Automatic}},
Magnification:>2. Inherited,
FrontEndVersion->"11.0 for Linux x86 (64-bit) (September 21, 2016)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Stylesheet.nb"]]}, Visible -> False, 
  FrontEndVersion -> "11.0 for Linux x86 (64-bit) (September 21, 2016)", 
  StyleDefinitions -> "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "Queries"->{
  Cell[11801, 291, 784, 13, 222, "Code",
   CellTags->"Queries"],
  Cell[330247, 7976, 1520, 27, 261, "Code",
   CellTags->"Queries"],
  Cell[345286, 8348, 1429, 26, 15104, "Code",
   CellTags->"Queries"],
  Cell[347803, 8407, 512, 12, 9600, "Code",
   CellTags->"Queries"]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"Queries", 999145, 23683}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 331, 5, 186, "Title"],
Cell[756, 22, 546, 9, 106, "Text"],
Cell[CellGroupData[{
Cell[1327, 35, 219, 3, 88, "Subsection"],
Cell[1549, 40, 780, 22, 183, "Input"],
Cell[2332, 64, 1477, 44, 269, "Input"],
Cell[3812, 110, 987, 26, 310, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[4836, 141, 200, 3, 161, "Section"],
Cell[5039, 146, 496, 7, 104, "Code"],
Cell[CellGroupData[{
Cell[5560, 157, 211, 3, 70, "Subsubsection"],
Cell[5774, 162, 180, 4, 104, "Code"],
Cell[5957, 168, 736, 14, 183, "Code"],
Cell[6696, 184, 597, 10, 104, "Code"],
Cell[7296, 196, 911, 15, 183, "Code"],
Cell[8210, 213, 372, 6, 144, "Code"],
Cell[8585, 221, 848, 13, 339, "Code"],
Cell[9436, 236, 224, 4, 104, "Code"],
Cell[9663, 242, 350, 7, 183, "Code"],
Cell[10016, 251, 486, 7, 104, "Code"],
Cell[10505, 260, 223, 5, 104, "Code"],
Cell[10731, 267, 201, 4, 104, "Code"],
Cell[10935, 273, 425, 7, 104, "Code"],
Cell[11363, 282, 435, 7, 104, "Code"],
Cell[11801, 291, 784, 13, 222, "Code",
 CellTags->"Queries"],
Cell[12588, 306, 256, 4, 104, "Code"],
Cell[12847, 312, 207, 4, 104, "Code"],
Cell[13057, 318, 215, 4, 104, "Code"],
Cell[13275, 324, 269, 4, 104, "Code"],
Cell[13547, 330, 276, 5, 104, "Code"],
Cell[13826, 337, 402, 7, 104, "Code"],
Cell[14231, 346, 201, 4, 104, "Code"],
Cell[14435, 352, 380, 6, 144, "Code"],
Cell[14818, 360, 372, 8, 104, "Code"],
Cell[15193, 370, 252, 4, 104, "Code"],
Cell[15448, 376, 178, 4, 104, "Code"],
Cell[15629, 382, 216, 4, 104, "Code"],
Cell[15848, 388, 250, 4, 104, "Code"],
Cell[16101, 394, 227, 5, 104, "Code"],
Cell[16331, 401, 148, 3, 104, "Code"],
Cell[16482, 406, 155, 3, 104, "Code"],
Cell[16640, 411, 250, 5, 104, "Code"],
Cell[16893, 418, 2003, 32, 368, "Code"],
Cell[18899, 452, 390, 6, 104, "Code"],
Cell[19292, 460, 160, 4, 104, "Code"],
Cell[19455, 466, 215, 3, 104, "Code"],
Cell[19673, 471, 191, 3, 104, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[19901, 479, 159, 2, 70, "Subsubsection"],
Cell[20063, 483, 1416, 26, 222, "Code"],
Cell[21482, 511, 389, 5, 573, "Code"],
Cell[21874, 518, 530, 7, 573, "Code"],
Cell[22407, 527, 101, 2, 104, "Code"],
Cell[22511, 531, 100, 2, 104, "Code"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[22660, 539, 159, 2, 161, "Section"],
Cell[22822, 543, 199, 3, 104, "Code"],
Cell[CellGroupData[{
Cell[23046, 550, 167, 2, 88, "Subsection"],
Cell[CellGroupData[{
Cell[23238, 556, 125, 1, 560, "Subsubsection"],
Cell[23366, 559, 376, 8, 1464, "Code"],
Cell[23745, 569, 389, 8, 1152, "Code"],
Cell[24137, 579, 4550, 124, 5520, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[28724, 708, 144, 2, 432, "Subsubsection"],
Cell[28871, 712, 574, 10, 12352, "Code"],
Cell[29448, 724, 833, 25, 15104, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[30318, 754, 205, 3, 432, "Subsubsection"],
Cell[30526, 759, 426, 9, 1464, "Code"],
Cell[30955, 770, 1184, 35, 1152, "Code"],
Cell[32142, 807, 1014, 17, 2712, "Code"],
Cell[33159, 826, 290, 6, 832, "Code"],
Cell[33452, 834, 2792, 70, 3336, "Code"],
Cell[36247, 906, 1234, 30, 1776, "Code"],
Cell[37484, 938, 1392, 34, 2000, "Code"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[38925, 978, 149, 2, 68, "Subsection"],
Cell[39077, 982, 1739, 38, 2088, "Code"],
Cell[40819, 1022, 1759, 42, 2712, "Code"],
Cell[42581, 1066, 950, 25, 1152, "Code"],
Cell[43534, 1093, 1553, 28, 1776, "Code"],
Cell[45090, 1123, 451, 11, 832, "Code"],
Cell[45544, 1136, 767, 20, 1776, "Code"],
Cell[46314, 1158, 227, 4, 832, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[46578, 1167, 96, 1, 68, "Subsection"],
Cell[46677, 1170, 570, 14, 1464, "Code"],
Cell[47250, 1186, 1874, 33, 1152, "Code"],
Cell[49127, 1221, 1902, 33, 1464, "Code"],
Cell[51032, 1256, 1954, 34, 1464, "Code"],
Cell[52989, 1292, 2017, 35, 1152, "Code"],
Cell[55009, 1329, 2016, 35, 1152, "Code"],
Cell[57028, 1366, 2010, 35, 1152, "Code"],
Cell[59041, 1403, 2183, 38, 1464, "Code"],
Cell[61227, 1443, 2308, 42, 1464, "Code"],
Cell[63538, 1487, 2332, 42, 1464, "Code"],
Cell[65873, 1531, 952, 20, 1152, "Code"],
Cell[66828, 1553, 927, 20, 1152, "Code"],
Cell[67758, 1575, 893, 19, 1152, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[68688, 1599, 180, 3, 68, "Subsection"],
Cell[68871, 1604, 437, 9, 106, "Text"],
Cell[CellGroupData[{
Cell[69333, 1617, 170, 2, 70, "Subsubsection"],
Cell[69506, 1621, 392, 9, 12288, "Code"],
Cell[69901, 1632, 306, 7, 6912, "Code"],
Cell[70210, 1641, 285, 6, 6912, "Code"],
Cell[70498, 1649, 276, 6, 6912, "Code"],
Cell[70777, 1657, 267, 6, 6912, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[71081, 1668, 272, 3, 54, "Subsubsection"],
Cell[71356, 1673, 473, 10, 9600, "Code"],
Cell[71832, 1685, 471, 11, 6912, "Code"],
Cell[72306, 1698, 521, 9, 12288, "Code"],
Cell[72830, 1709, 2591, 60, 28928, "Code"],
Cell[75424, 1771, 421, 8, 12352, "Code"],
Cell[75848, 1781, 302, 7, 6912, "Code"],
Cell[76153, 1790, 2461, 55, 28864, "Code"],
Cell[78617, 1847, 408, 8, 12352, "Code"],
Cell[79028, 1857, 283, 7, 6912, "Code"],
Cell[79314, 1866, 1722, 41, 26176, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[81073, 1912, 220, 3, 54, "Subsubsection"],
Cell[81296, 1917, 1947, 44, 300, "Code"],
Cell[83246, 1963, 1115, 28, 300, "Code"],
Cell[84364, 1993, 1874, 44, 261, "Code"],
Cell[86241, 2039, 1335, 32, 261, "Code"],
Cell[87579, 2073, 341, 7, 144, "Code"],
Cell[87923, 2082, 640, 16, 222, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[88600, 2103, 168, 2, 70, "Subsubsection"],
Cell[88771, 2107, 437, 8, 104, "Code"],
Cell[89211, 2117, 517, 11, 183, "Code"],
Cell[89731, 2130, 940, 20, 183, "Code"],
Cell[90674, 2152, 19885, 438, 2486, "Code"],
Cell[110562, 2592, 383, 8, 12288, "Code"],
Cell[110948, 2602, 260, 6, 6912, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[111245, 2613, 187, 3, 54, "Subsubsection"],
Cell[111435, 2618, 428, 9, 12288, "Code"],
Cell[111866, 2629, 4797, 113, 64320, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[116700, 2747, 263, 4, 54, "Subsubsection"],
Cell[116966, 2753, 255, 6, 6912, "Code"],
Cell[117224, 2761, 239, 5, 6784, "Code"],
Cell[117466, 2768, 3567, 90, 39872, "Code"],
Cell[121036, 2860, 244, 5, 6912, "Code"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[121329, 2871, 183, 3, 88, "Subsection"],
Cell[CellGroupData[{
Cell[121537, 2878, 211, 3, 70, "Subsubsection"],
Cell[121751, 2883, 940, 19, 17856, "Code"],
Cell[122694, 2904, 296, 7, 6912, "Code"],
Cell[122993, 2913, 260, 5, 6784, "Code"],
Cell[123256, 2920, 299, 7, 6912, "Code"],
Cell[123558, 2929, 8068, 176, 83648, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[131663, 3110, 263, 4, 54, "Subsubsection"],
Cell[131929, 3116, 902, 21, 17920, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[132868, 3142, 146, 2, 54, "Subsubsection"],
Cell[133017, 3146, 9059, 233, 80896, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[142113, 3384, 185, 3, 54, "Subsubsection"],
Cell[142301, 3389, 459, 11, 9664, "Code"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[142809, 3406, 166, 2, 68, "Subsection"],
Cell[CellGroupData[{
Cell[143000, 3412, 166, 2, 70, "Subsubsection"],
Cell[143169, 3416, 1412, 31, 2712, "Code"],
Cell[144584, 3449, 197, 4, 832, "Code"],
Cell[144784, 3455, 885, 18, 1776, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[145706, 3478, 503, 8, 54, "Subsubsection"],
Cell[146212, 3488, 1425, 35, 9600, "Code"],
Cell[147640, 3525, 707, 13, 6912, "Code"],
Cell[148350, 3540, 267, 7, 6912, "Code"],
Cell[148620, 3549, 1227, 30, 19840, "Code"],
Cell[149850, 3581, 400, 10, 6912, "Code"],
Cell[150253, 3593, 201, 5, 6336, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[150491, 3603, 429, 7, 54, "Subsubsection"],
Cell[150923, 3612, 1983, 49, 15104, "Code"],
Cell[152909, 3663, 369, 7, 6912, "Code"],
Cell[153281, 3672, 1401, 28, 9664, "Code"],
Cell[154685, 3702, 296, 8, 6912, "Code"],
Cell[154984, 3712, 1651, 37, 15104, "Code"],
Cell[156638, 3751, 1096, 20, 6912, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[157771, 3776, 166, 2, 54, "Subsubsection"],
Cell[157940, 3780, 2428, 64, 15168, "Code"],
Cell[160371, 3846, 410, 9, 6912, "Code"],
Cell[160784, 3857, 1183, 22, 6912, "Code"],
Cell[161970, 3881, 1219, 21, 6912, "Code"],
Cell[163192, 3904, 306, 8, 6912, "Code"],
Cell[163501, 3914, 3667, 84, 48128, "Code"],
Cell[167171, 4000, 417, 10, 6912, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[167625, 4015, 213, 3, 54, "Subsubsection"],
Cell[167841, 4020, 1840, 42, 12416, "Code"],
Cell[169684, 4064, 1005, 21, 9664, "Code"],
Cell[170692, 4087, 741, 15, 9280, "Input"],
Cell[171436, 4104, 1143, 26, 12416, "Code"],
Cell[172582, 4132, 146, 2, 4224, "Text"],
Cell[172731, 4136, 2255, 48, 17920, "Code"],
Cell[174989, 4186, 147, 2, 4224, "Text"],
Cell[175139, 4190, 447, 10, 9280, "Input"],
Cell[175589, 4202, 226, 5, 6912, "Code"],
Cell[175818, 4209, 461, 12, 9600, "Code"],
Cell[176282, 4223, 680, 17, 6912, "Code"],
Cell[176965, 4242, 4504, 99, 53568, "Code"],
Cell[181472, 4343, 450, 12, 9664, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[181959, 4360, 298, 4, 54, "Subsubsection"],
Cell[182260, 4366, 326, 7, 6912, "Code"],
Cell[182589, 4375, 4563, 114, 2432, "Input",
 CellOpen->False],
Cell[187155, 4491, 2467, 64, 17920, "Input"],
Cell[189625, 4557, 690, 16, 9280, "Input"],
Cell[190318, 4575, 1295, 25, 9280, "Input"],
Cell[191616, 4602, 2434, 52, 20800, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[194087, 4659, 235, 4, 54, "Subsubsection"],
Cell[194325, 4665, 1557, 41, 11968, "Code"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[195931, 4712, 161, 2, 68, "Subsection"],
Cell[CellGroupData[{
Cell[196117, 4718, 181, 3, 70, "Subsubsection"],
Cell[196301, 4723, 684, 12, 1464, "Code"],
Cell[196988, 4737, 1427, 36, 1464, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[198452, 4778, 234, 4, 54, "Subsubsection"],
Cell[198689, 4784, 2753, 66, 8352, "Code"],
Cell[201445, 4852, 656, 14, 3200, "Input"],
Cell[202104, 4868, 1457, 39, 8416, "Code"],
Cell[203564, 4909, 508, 14, 3424, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[204109, 4928, 154, 2, 54, "Subsubsection"],
Cell[204266, 4932, 1487, 32, 5856, "Code"],
Cell[205756, 4966, 837, 17, 3200, "Input"],
Cell[206596, 4985, 1205, 27, 4672, "Code"],
Cell[207804, 5014, 493, 14, 3424, "Code"],
Cell[208300, 5030, 2992, 79, 13408, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[211329, 5114, 216, 4, 54, "Subsubsection"],
Cell[211548, 5120, 1465, 32, 1464, "Code"],
Cell[213016, 5154, 916, 18, 800, "Input"],
Cell[213935, 5174, 412, 10, 856, "Code"],
Cell[214350, 5186, 575, 16, 1168, "Code"],
Cell[214928, 5204, 507, 14, 1168, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[215472, 5223, 157, 2, 54, "Subsubsection"],
Cell[215632, 5227, 1184, 29, 5856, "Code"],
Cell[216819, 5258, 733, 15, 3200, "Input"],
Cell[217555, 5275, 423, 11, 3424, "Code"],
Cell[217981, 5288, 1128, 28, 5920, "Code"],
Cell[219112, 5318, 507, 14, 4672, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[219656, 5337, 330, 5, 54, "Subsubsection"],
Cell[219989, 5344, 438, 10, 5856, "Code"],
Cell[220430, 5356, 1869, 49, 10848, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[222336, 5410, 77, 1, 54, "Subsubsection"],
Cell[222416, 5413, 1940, 44, 8352, "Code"],
Cell[224359, 5459, 893, 16, 3136, "Input"],
Cell[225255, 5477, 249, 6, 3328, "Code"],
Cell[225507, 5485, 3688, 92, 14592, "Code"],
Cell[229198, 5579, 346, 9, 3328, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[229581, 5593, 75, 1, 54, "Subsubsection"],
Cell[229659, 5596, 702, 14, 1464, "Code"],
Cell[230364, 5612, 470, 12, 832, "Code"],
Cell[230837, 5626, 561, 15, 832, "Code"],
Cell[231401, 5643, 1035, 25, 1152, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[232473, 5673, 262, 4, 54, "Subsubsection"],
Cell[232738, 5679, 1474, 33, 1776, "Code"],
Cell[234215, 5714, 548, 13, 784, "Input"],
Cell[234766, 5729, 987, 22, 832, "Code"],
Cell[235756, 5753, 774, 19, 832, "Code"],
Cell[236533, 5774, 1347, 32, 1464, "Code"],
Cell[237883, 5808, 407, 12, 832, "Code"],
Cell[238293, 5822, 549, 9, 1152, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[238879, 5836, 76, 1, 54, "Subsubsection"],
Cell[238958, 5839, 1311, 34, 12352, "Code"],
Cell[240272, 5875, 1138, 29, 12416, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[241447, 5909, 259, 4, 54, "Subsubsection"],
Cell[241709, 5915, 2255, 51, 15104, "Code"],
Cell[243967, 5968, 620, 11, 6912, "Code"],
Cell[244590, 5981, 722, 13, 6336, "Input"],
Cell[245315, 5996, 1842, 45, 17856, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[247194, 6046, 168, 2, 54, "Subsubsection"],
Cell[247365, 6050, 804, 17, 222, "Code"],
Cell[248172, 6069, 7874, 186, 924, "Code"],
Cell[256049, 6257, 601, 11, 183, "Code"],
Cell[256653, 6270, 1461, 25, 104, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[258151, 6300, 320, 4, 70, "Subsubsection"],
Cell[258474, 6306, 313, 8, 98, "Input"],
Cell[258790, 6316, 3058, 52, 144, "Code"],
Cell[261851, 6370, 3172, 53, 144, "Code"],
Cell[265026, 6425, 2956, 48, 144, "Code"],
Cell[267985, 6475, 7837, 173, 924, "Code"],
Cell[275825, 6650, 414, 12, 104, "Code"],
Cell[276242, 6664, 202, 5, 104, "Code"],
Cell[276447, 6671, 1591, 26, 104, "Code"],
Cell[278041, 6699, 234, 4, 104, "Code"],
Cell[278278, 6705, 200, 5, 104, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[278515, 6715, 131, 2, 54, "Subsubsection"],
Cell[278649, 6719, 918, 19, 261, "Code"],
Cell[279570, 6740, 2188, 53, 495, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[281795, 6798, 209, 4, 54, "Subsubsection"],
Cell[282007, 6804, 2684, 63, 534, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[284728, 6872, 273, 4, 70, "Subsubsection"],
Cell[285004, 6878, 937, 18, 15040, "Code"],
Cell[285944, 6898, 3472, 73, 36992, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[289453, 6976, 177, 2, 54, "Subsubsection"],
Cell[289633, 6980, 1175, 23, 20544, "Code"],
Cell[290811, 7005, 2978, 72, 53568, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[293826, 7082, 186, 3, 54, "Subsubsection"],
Cell[294015, 7087, 676, 12, 300, "Code"],
Cell[294694, 7101, 281, 6, 104, "Code"],
Cell[294978, 7109, 996, 17, 104, "Code"],
Cell[295977, 7128, 5868, 124, 768, "Code"],
Cell[301848, 7254, 268, 5, 104, "Code"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[302165, 7265, 270, 4, 68, "Subsection"],
Cell[CellGroupData[{
Cell[302460, 7273, 312, 7, 118, "Subsubsection"],
Cell[302775, 7282, 1064, 27, 15104, "Code"],
Cell[303842, 7311, 952, 25, 12416, "Code"],
Cell[304797, 7338, 2127, 57, 34368, "Code"],
Cell[306927, 7397, 2179, 57, 34368, "Code"],
Cell[309109, 7456, 2681, 73, 36992, "Code"],
Cell[311793, 7531, 1362, 33, 12416, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[313192, 7569, 260, 4, 54, "Subsubsection"],
Cell[313455, 7575, 772, 14, 12288, "Code"],
Cell[314230, 7591, 355, 8, 6912, "Code"],
Cell[314588, 7601, 4407, 101, 56256, "Code"],
Cell[318998, 7704, 2688, 60, 31552, "Code"],
Cell[321689, 7766, 1956, 44, 17856, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[323682, 7815, 414, 5, 54, "Subsubsection"],
Cell[324099, 7822, 694, 13, 12288, "Code"],
Cell[324796, 7837, 1592, 36, 12544, "Code"],
Cell[326391, 7875, 506, 12, 6912, "Code"],
Cell[326900, 7889, 669, 12, 12288, "Code"],
Cell[327572, 7903, 1764, 47, 20672, "Code"],
Cell[329339, 7952, 571, 13, 9664, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[329947, 7970, 297, 4, 54, "Subsubsection"],
Cell[330247, 7976, 1520, 27, 261, "Code",
 CellTags->"Queries"],
Cell[331770, 8005, 1678, 36, 185, "Code"],
Cell[333451, 8043, 2158, 52, 272, "Input"],
Cell[335612, 8097, 467, 11, 104, "Code"],
Cell[336082, 8110, 1445, 40, 227, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[337564, 8155, 298, 4, 54, "Subsubsection"],
Cell[337865, 8161, 752, 14, 222, "Code"],
Cell[338620, 8177, 614, 16, 144, "Code"],
Cell[339237, 8195, 5136, 126, 770, "Code"],
Cell[344376, 8323, 469, 11, 144, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[344882, 8339, 211, 3, 54, "Subsubsection"],
Cell[345096, 8344, 187, 2, 4224, "Text"],
Cell[345286, 8348, 1429, 26, 15104, "Code",
 CellTags->"Queries"],
Cell[346718, 8376, 826, 21, 9664, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[347581, 8402, 219, 3, 54, "Subsubsection"],
Cell[347803, 8407, 512, 12, 9600, "Code",
 CellTags->"Queries"],
Cell[348318, 8421, 1175, 28, 9792, "Code"],
Cell[349496, 8451, 862, 18, 9664, "Code"],
Cell[350361, 8471, 1063, 25, 9280, "Input"],
Cell[351427, 8498, 401, 9, 9600, "Code"],
Cell[351831, 8509, 619, 12, 6912, "Code"],
Cell[352453, 8523, 868, 18, 9664, "Code"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[353370, 8547, 223, 3, 88, "Subsection"],
Cell[CellGroupData[{
Cell[353618, 8554, 212, 3, 70, "Subsubsection"],
Cell[353833, 8559, 1276, 34, 26048, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[355146, 8598, 157, 2, 54, "Subsubsection"],
Cell[355306, 8602, 391, 8, 12352, "Code"],
Cell[355700, 8612, 350, 8, 6912, "Code"],
Cell[356053, 8622, 384, 9, 6912, "Code"],
Cell[356440, 8633, 1028, 19, 9664, "Code"],
Cell[357471, 8654, 1711, 39, 17920, "Code"],
Cell[359185, 8695, 969, 18, 9600, "Code"],
Cell[360157, 8715, 458, 10, 12288, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[360652, 8730, 181, 3, 54, "Subsubsection"],
Cell[360836, 8735, 167, 2, 4224, "Text"],
Cell[361006, 8739, 362, 7, 6912, "Code"],
Cell[361371, 8748, 447, 11, 6912, "Code"],
Cell[361821, 8761, 1883, 44, 15168, "Code"],
Cell[363707, 8807, 876, 17, 9600, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[364620, 8829, 203, 3, 54, "Subsubsection"],
Cell[364826, 8834, 167, 2, 4224, "Text"],
Cell[364996, 8838, 431, 8, 6784, "Code"],
Cell[365430, 8848, 381, 9, 6912, "Code"],
Cell[365814, 8859, 1549, 35, 15168, "Code"],
Cell[367366, 8896, 970, 19, 9600, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[368373, 8920, 255, 4, 54, "Subsubsection"],
Cell[368631, 8926, 485, 8, 6784, "Code"],
Cell[369119, 8936, 403, 9, 6912, "Code"],
Cell[369525, 8947, 1772, 40, 17920, "Code"],
Cell[371300, 8989, 971, 19, 9600, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[372308, 9013, 376, 5, 54, "Subsubsection"],
Cell[372687, 9020, 497, 10, 6912, "Code"],
Cell[373187, 9032, 587, 12, 6912, "Code"],
Cell[373777, 9046, 6373, 146, 67264, "Code"],
Cell[380153, 9194, 768, 16, 9600, "Code"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[380970, 9216, 262, 4, 68, "Subsection"],
Cell[CellGroupData[{
Cell[381257, 9224, 336, 4, 560, "Subsubsection"],
Cell[381596, 9230, 286, 6, 4224, "Text"],
Cell[381885, 9238, 1454, 37, 17856, "Code"],
Cell[383342, 9277, 365, 8, 6336, "Input"],
Cell[383710, 9287, 485, 6, 4224, "Text"],
Cell[384198, 9295, 487, 10, 12352, "Code"],
Cell[384688, 9307, 1604, 40, 20608, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[386329, 9352, 450, 7, 432, "Subsubsection"],
Cell[386782, 9361, 476, 10, 12352, "Code"],
Cell[387261, 9373, 2931, 72, 31552, "Code"],
Cell[390195, 9447, 395, 8, 12352, "Code"],
Cell[390593, 9457, 1181, 30, 17856, "Code"],
Cell[391777, 9489, 470, 6, 4224, "Text"],
Cell[392250, 9497, 479, 9, 12352, "Code"],
Cell[392732, 9508, 1985, 47, 23296, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[394754, 9560, 140, 2, 432, "Subsubsection"],
Cell[394897, 9564, 528, 10, 12352, "Code"],
Cell[395428, 9576, 2066, 57, 17792, "Code"],
Cell[397497, 9635, 4667, 126, 32320, "Input"],
Cell[402167, 9763, 1921, 59, 17920, "Code"],
Cell[404091, 9824, 153, 2, 4224, "Text"],
Cell[404247, 9828, 1027, 27, 15040, "Input"],
Cell[405277, 9857, 335, 8, 6336, "Input"],
Cell[405615, 9867, 970, 25, 15040, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[406622, 9897, 162, 2, 432, "Subsubsection"],
Cell[406787, 9901, 2820, 70, 1552, "Code"],
Cell[409610, 9973, 3199, 85, 5376, "Code"],
Cell[412812, 10060, 461, 14, 832, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[413310, 10079, 221, 4, 560, "Subsubsection"],
Cell[413534, 10085, 1433, 32, 1160, "Code"],
Cell[414970, 10119, 1209, 33, 1152, "Code"],
Cell[416182, 10154, 473, 14, 832, "Code"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[416704, 10174, 165, 2, 68, "Subsection"],
Cell[CellGroupData[{
Cell[416894, 10180, 194, 3, 4608, "Subsubsection"],
Cell[417091, 10185, 3786, 62, 31424, "Code"],
Cell[420880, 10249, 15712, 385, 154432, "Code"],
Cell[436595, 10636, 4876, 109, 26560, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[441508, 10750, 222, 3, 4608, "Subsubsection"],
Cell[441733, 10755, 2945, 45, 45184, "Code"],
Cell[444681, 10802, 640, 13, 6912, "Code"],
Cell[445324, 10817, 7036, 158, 50880, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[452397, 10980, 193, 3, 4608, "Subsubsection"],
Cell[452593, 10985, 1219, 19, 21696, "Code"],
Cell[453815, 11006, 3557, 95, 37056, "Code"],
Cell[457375, 11103, 3531, 94, 39744, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[460943, 11202, 243, 3, 4608, "Subsubsection"],
Cell[461189, 11207, 4715, 123, 43840, "Input"],
Cell[465907, 11332, 1974, 51, 23296, "Code"],
Cell[467884, 11385, 260, 6, 6912, "Code"],
Cell[468147, 11393, 4280, 113, 31552, "Code"],
Cell[472430, 11508, 2385, 66, 20800, "Input"],
Cell[474818, 11576, 4737, 124, 43840, "Input"],
Cell[479558, 11702, 4416, 114, 31552, "Code"],
Cell[483977, 11818, 2339, 64, 20800, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[486353, 11887, 170, 2, 4608, "Subsubsection"],
Cell[486526, 11891, 9555, 218, 92992, "Code"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[496130, 12115, 162, 2, 68, "Subsection"],
Cell[CellGroupData[{
Cell[496317, 12121, 135, 2, 70, "Subsubsection"],
Cell[496455, 12125, 1523, 43, 15232, "Code"],
Cell[497981, 12170, 2056, 49, 34240, "Code"],
Cell[500040, 12221, 2332, 65, 15680, "Code"],
Cell[502375, 12288, 510, 14, 9472, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[502922, 12307, 210, 3, 54, "Subsubsection"],
Cell[503135, 12312, 302, 5, 104, "Code"],
Cell[503440, 12319, 1017, 24, 183, "Code"],
Cell[504460, 12345, 568, 12, 104, "Code"],
Cell[505031, 12359, 629, 14, 144, "Code"],
Cell[505663, 12375, 3628, 75, 419, "Code"],
Cell[509294, 12452, 2184, 54, 306, "Code"],
Cell[511481, 12508, 2370, 58, 341, "Code"],
Cell[513854, 12568, 5040, 111, 466, "Code"],
Cell[518897, 12681, 4276, 94, 38, "Input",
 CellOpen->False],
Cell[523176, 12777, 7546, 184, 811, "Code"],
Cell[530725, 12963, 1076, 27, 225, "Input"],
Cell[531804, 12992, 1458, 36, 272, "Input"],
Cell[533265, 13030, 2674, 62, 341, "Code"],
Cell[535942, 13094, 177, 2, 64, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[536156, 13101, 186, 3, 70, "Subsubsection"],
Cell[536345, 13106, 378, 8, 6912, "Code"],
Cell[536726, 13116, 554, 14, 6912, "Code"],
Cell[537283, 13132, 3211, 78, 31680, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[540531, 13215, 240, 4, 54, "Subsubsection"],
Cell[540774, 13221, 544, 10, 6912, "Code"],
Cell[541321, 13233, 2481, 56, 31552, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[543839, 13294, 223, 3, 54, "Subsubsection"],
Cell[544065, 13299, 988, 25, 12160, "Input"],
Cell[545056, 13326, 332, 7, 6336, "Input"],
Cell[545391, 13335, 699, 17, 9472, "Input"],
Cell[546093, 13354, 324, 6, 6336, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[546454, 13365, 181, 2, 54, "Subsubsection"],
Cell[546638, 13369, 1325, 34, 9600, "Code"],
Cell[547966, 13405, 281, 6, 6912, "Code"],
Cell[548250, 13413, 1212, 29, 23232, "Code"],
Cell[549465, 13444, 1357, 35, 9600, "Code"],
Cell[550825, 13481, 310, 7, 6912, "Code"],
Cell[551138, 13490, 1511, 38, 23360, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[552686, 13533, 322, 4, 54, "Subsubsection"],
Cell[553011, 13539, 846, 14, 225, "Input"],
Cell[553860, 13555, 450, 9, 98, "Input"],
Cell[554313, 13566, 3057, 75, 484, "Input"],
Cell[557373, 13643, 247, 5, 98, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[557657, 13653, 397, 5, 54, "Subsubsection"],
Cell[558057, 13660, 215, 3, 96, "Input"],
Cell[558275, 13665, 1006, 16, 225, "Input"],
Cell[559284, 13683, 405, 9, 126, "Input"],
Cell[559692, 13694, 3336, 81, 512, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[563065, 13780, 214, 3, 54, "Subsubsection"],
Cell[563282, 13785, 744, 21, 106, "Text"],
Cell[564029, 13808, 1851, 37, 83, "TI"],
Cell[565883, 13847, 1033, 27, 132, "Text"],
Cell[566919, 13876, 1986, 39, 94, "DisplayFormula"],
Cell[568908, 13917, 2265, 45, 64, "Text"],
Cell[571176, 13964, 254, 3, 64, "Text"],
Cell[571433, 13969, 2420, 50, 87, "DisplayFormula"],
Cell[573856, 14021, 2962, 71, 120, "Text"],
Cell[576821, 14094, 2219, 37, 64, "Text"],
Cell[579043, 14133, 2150, 56, 149, "Text"],
Cell[581196, 14191, 698, 13, 183, "Code"],
Cell[581897, 14206, 4239, 109, 611, "Input"],
Cell[586139, 14317, 736, 20, 144, "Code"],
Cell[586878, 14339, 3706, 96, 523, "Code"],
Cell[590587, 14437, 387, 8, 104, "Code"],
Cell[590977, 14447, 4470, 81, 106, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[595484, 14533, 266, 4, 54, "Subsubsection"],
Cell[595753, 14539, 816, 14, 183, "Code"],
Cell[596572, 14555, 1003, 27, 144, "Code"],
Cell[597578, 14584, 4827, 120, 573, "Code"],
Cell[602408, 14706, 4470, 81, 106, "Text"]
}, Closed]],
Cell[CellGroupData[{
Cell[606915, 14792, 260, 4, 54, "Subsubsection"],
Cell[607178, 14798, 516, 9, 222, "Code"],
Cell[607697, 14809, 276, 6, 104, "Code"],
Cell[607976, 14817, 909, 25, 144, "Code"],
Cell[608888, 14844, 1107, 30, 222, "Code"],
Cell[609998, 14876, 6678, 152, 1342, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[616713, 15033, 157, 2, 54, "Subsubsection"],
Cell[616873, 15037, 1868, 42, 1808, "Code"],
Cell[618744, 15081, 307, 7, 832, "Code"],
Cell[619054, 15090, 961, 21, 1064, "Code"],
Cell[620018, 15113, 2543, 69, 3712, "Input"],
Cell[622564, 15184, 924, 20, 832, "Code"],
Cell[623491, 15206, 2473, 68, 3176, "Input"],
Cell[625967, 15276, 943, 21, 1096, "Code"],
Cell[626913, 15299, 2597, 71, 3712, "Input"],
Cell[629513, 15372, 432, 9, 832, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[629982, 15386, 140, 2, 54, "Subsubsection"],
Cell[630125, 15390, 491, 10, 183, "Code"],
Cell[630619, 15402, 543, 13, 104, "Code"],
Cell[631165, 15417, 780, 18, 146, "Code"],
Cell[631948, 15437, 806, 17, 146, "Code"],
Cell[632757, 15456, 46478, 915, 6152, "Code"],
Cell[679238, 16373, 474, 9, 144, "Code"],
Cell[679715, 16384, 52363, 1115, 38, "Input",
 CellOpen->False]
}, Open  ]],
Cell[CellGroupData[{
Cell[732115, 17504, 143, 2, 70, "Subsubsection"],
Cell[732261, 17508, 484, 11, 183, "Code"],
Cell[732748, 17521, 740, 16, 144, "Code"],
Cell[733491, 17539, 984, 21, 146, "Code"],
Cell[734478, 17562, 1006, 21, 146, "Code"],
Cell[735487, 17585, 9421, 133, 144, "Code"],
Cell[744911, 17720, 63243, 1318, 9701, "Code"],
Cell[808157, 19040, 36802, 794, 7018, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[844996, 19839, 159, 2, 70, "Subsubsection"],
Cell[845158, 19843, 262, 6, 6912, "Code"],
Cell[845423, 19851, 269, 6, 6912, "Code"],
Cell[845695, 19859, 2517, 43, 12416, "Code"],
Cell[848215, 19904, 2824, 50, 9664, "Code"],
Cell[851042, 19956, 4032, 80, 32768, "Code"],
Cell[855077, 20038, 268, 6, 6912, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[855382, 20049, 216, 3, 54, "Subsubsection"],
Cell[855601, 20054, 398, 8, 12352, "Code"],
Cell[856002, 20064, 7989, 181, 64320, "Code"],
Cell[863994, 20247, 335, 8, 6912, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[864366, 20260, 354, 5, 54, "Subsubsection"],
Cell[864723, 20267, 1540, 33, 261, "Code"],
Cell[866266, 20302, 920, 21, 222, "Code"],
Cell[867189, 20325, 626, 17, 146, "Code"],
Cell[867818, 20344, 649, 16, 146, "Code"],
Cell[868470, 20362, 17329, 364, 2291, "Code"],
Cell[885802, 20728, 12098, 287, 38, "Input",
 CellOpen->False],
Cell[897903, 21017, 228, 6, 104, "Code"],
Cell[898134, 21025, 198, 5, 104, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[898369, 21035, 165, 2, 70, "Subsubsection"],
Cell[898537, 21039, 1040, 21, 144, "Code"],
Cell[899580, 21062, 334, 8, 104, "Code"],
Cell[899917, 21072, 4448, 122, 612, "Code"],
Cell[904368, 21196, 19394, 466, 3085, "Code"],
Cell[923765, 21664, 187, 4, 104, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[923989, 21673, 185, 3, 70, "Subsubsection"],
Cell[924177, 21678, 515, 10, 104, "Code"],
Cell[924695, 21690, 3341, 76, 497, "Code"],
Cell[928039, 21768, 602, 18, 146, "Code"]
}, Open  ]],
Cell[CellGroupData[{
Cell[928678, 21791, 133, 2, 70, "Subsubsection"],
Cell[928814, 21795, 197, 2, 4224, "Text"],
Cell[929014, 21799, 1874, 59, 21248, "Text"],
Cell[930891, 21860, 1774, 26, 26944, "Input"],
Cell[932668, 21888, 322, 7, 6336, "Input"],
Cell[932993, 21897, 248, 6, 6336, "Input"],
Cell[933244, 21905, 157, 2, 4224, "Text"],
Cell[933404, 21909, 1426, 39, 15488, "Input"],
Cell[934833, 21950, 785, 19, 9472, "Input"],
Cell[935621, 21971, 873, 21, 9472, "Input"],
Cell[936497, 21994, 333, 6, 7040, "Text"],
Cell[936833, 22002, 6084, 155, 75520, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[942954, 22162, 184, 3, 54, "Subsubsection"],
Cell[943141, 22167, 2707, 53, 17856, "Code"],
Cell[945851, 22222, 3233, 86, 31488, "Code"],
Cell[949087, 22310, 225, 6, 6912, "Code"],
Cell[949315, 22318, 278, 7, 6912, "Code"],
Cell[949596, 22327, 4204, 107, 35200, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[953849, 22440, 105, 1, 88, "Subsection"],
Cell[CellGroupData[{
Cell[953979, 22445, 182, 3, 4608, "Subsubsection"],
Cell[954164, 22450, 639, 13, 12352, "Code"],
Cell[954806, 22465, 2453, 59, 28992, "Code"],
Cell[957262, 22526, 2016, 53, 18176, "Code"],
Cell[959281, 22581, 791, 21, 9792, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[960109, 22607, 216, 3, 4608, "Subsubsection"],
Cell[960328, 22612, 510, 9, 15040, "Input"],
Cell[960841, 22623, 1070, 30, 12160, "Input"],
Cell[961914, 22655, 505, 14, 9280, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[962456, 22674, 199, 2, 4608, "Subsubsection"],
Cell[962658, 22678, 349, 8, 6912, "Code"],
Cell[963010, 22688, 2070, 52, 17856, "Code"],
Cell[965083, 22742, 572, 15, 9664, "Code"],
Cell[965658, 22759, 907, 17, 15104, "Code"],
Cell[966568, 22778, 1251, 26, 6912, "Code"],
Cell[967822, 22806, 1476, 32, 9664, "Code"],
Cell[969301, 22840, 556, 15, 9664, "Code"],
Cell[969860, 22857, 882, 24, 9664, "Code"],
Cell[970745, 22883, 633, 13, 12352, "Code"],
Cell[971381, 22898, 1012, 26, 15104, "Code"],
Cell[972396, 22926, 556, 15, 9664, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[972989, 22946, 82, 1, 4608, "Subsubsection"],
Cell[973074, 22949, 601, 14, 6912, "Code"],
Cell[973678, 22965, 1342, 26, 6912, "Code"],
Cell[975023, 22993, 1542, 33, 9664, "Code"],
Cell[976568, 23028, 962, 20, 15104, "Code"],
Cell[977533, 23050, 973, 28, 12416, "Code"],
Cell[978509, 23080, 561, 14, 9664, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[979107, 23099, 174, 2, 4608, "Subsubsection"],
Cell[979284, 23103, 343, 8, 6912, "Code"],
Cell[979630, 23113, 217, 5, 6912, "Code"],
Cell[979850, 23120, 431, 10, 9664, "Code"],
Cell[980284, 23132, 493, 10, 12288, "Code"],
Cell[980780, 23144, 558, 12, 9664, "Code"],
Cell[981341, 23158, 305, 7, 6912, "Code"],
Cell[981649, 23167, 728, 21, 9664, "Code"],
Cell[982380, 23190, 1166, 38, 14080, "Input"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[983595, 23234, 134, 2, 68, "Subsection"],
Cell[983732, 23238, 342, 7, 106, "Text"],
Cell[984077, 23247, 1526, 44, 227, "Input"],
Cell[985606, 23293, 2193, 54, 456, "Code"],
Cell[987802, 23349, 303, 6, 104, "Code"],
Cell[988108, 23357, 1441, 40, 312, "Input"],
Cell[989552, 23399, 1245, 39, 225, "Input"],
Cell[990800, 23440, 1692, 51, 415, "Code"],
Cell[992495, 23493, 874, 23, 183, "Code"],
Cell[993372, 23518, 462, 12, 146, "Code"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[993883, 23536, 147, 2, 161, "Section"],
Cell[994033, 23540, 94, 1, 4224, "Text"],
Cell[994130, 23543, 164, 4, 6912, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[994331, 23552, 96, 1, 97, "Section"],
Cell[994430, 23555, 623, 15, 6912, "Code"],
Cell[995056, 23572, 273, 5, 6784, "Code"]
}, Closed]],
Cell[CellGroupData[{
Cell[995366, 23582, 188, 3, 97, "Section"],
Cell[995557, 23587, 125, 2, 6784, "Code"],
Cell[995685, 23591, 581, 15, 9664, "Code"],
Cell[996269, 23608, 2292, 55, 17920, "Code"]
}, Closed]]
}, Open  ]]
}
]
*)

